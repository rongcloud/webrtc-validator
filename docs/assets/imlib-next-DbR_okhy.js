import{v as st,W as g,O as ut,M as z,q as b,Z as U,k as W,G as ve,r as _e,H as Te,P as ke,C as y,z as ct,h as w,N as dt,D as R,_ as lt,a as ue,X as ie,n as et,$ as ft,e as mt,c as pt,b as X,d as G,L as gt,j as ht,y as St}from"./engine-Boc6HqbT.js";var Et={},Ce=function(e,n){return Ce=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])},Ce(e,n)};function J(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}Ce(e,n),e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var q=function(){return q=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},q.apply(this,arguments)};function O(e,n,t,o){return new(t||(t=Promise))(function(i,u){function r(d){try{c(o.next(d))}catch(a){u(a)}}function s(d){try{c(o.throw(d))}catch(a){u(a)}}function c(d){var a;d.done?i(d.value):(a=d.value,a instanceof t?a:new t(function(l){l(a)})).then(r,s)}c((o=o.apply(e,n||[])).next())})}function A(e,n){var t,o,i,u,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(c){return function(d){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;u&&(u=0,a[0]&&(r=0)),r;)try{if(t=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!((i=i.length>0&&i[i.length-1])||a[0]!==6&&a[0]!==2)){r=0;continue}if(a[0]===3&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(a[0]===6&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=n.call(e,r)}catch(l){a=[6,l],o=0}finally{t=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([c,d])}}}var te=function(){return!(typeof uni>"u"||!function(e){for(var n=["request","getSystemInfo"],t=0,o=n.length;t<o;t++)if(!e[n[t]])return!1;return!0}(uni))},vt=te(),ye=null,ce=function(e){return O(void 0,void 0,void 0,function(){var n;return A(this,function(t){switch(t.label){case 0:return[4,Re.getNetworkType()];case 1:return n=t.sent(),ye({status:e.type==="online",type:n}),[2]}})})},Re={tag:"browser",httpReq:U,localStorage:window==null?void 0:window.localStorage,sessionStorage:window==null?void 0:window.sessionStorage,useNavi:!0,connectPlatform:"",isFromUniapp:vt,createWebSocket:function(e,n){var t=new WebSocket(e,n);return t.binaryType="arraybuffer",{id:Date.now(),onClose:function(o){t.onclose=function(i){var u=i.code,r=i.reason;o(u,r)}},onError:function(o){t.onerror=o},onMessage:function(o){t.onmessage=function(i){o(i.data)}},onOpen:function(o){t.onopen=o},send:function(o){t.send(o)},close:function(o,i){t.close()}}},getNetworkType:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{effectiveType:W.UNKONWN},n=e.type,t=e.effectiveType,o=n||t||W.UNKONWN;return Promise.resolve(o)},setNetworkStatusListener:function(e){ye=e,typeof window<"u"&&window&&(window.addEventListener("offline",ce),window.addEventListener("online",ce))},removeNetworkStatusListener:function(){typeof window<"u"&&window&&(window.removeEventListener("offline",ce),window.removeEventListener("online",ce)),ye=null}},_t=te(),de=function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return wx[e].apply(wx,n)}catch(o){console==null||console.error(o)}}},be={setItem:de("setStorageSync"),getItem:de("getStorageSync"),removeItem:de("removeStorageSync"),clear:de("clearStorageSync")},Oe=null,Ge=function(e){var n=e.isConnected,t=e.networkType;Oe({status:n,type:t})},xe={tag:"wechat",httpReq:function(e){var n=e.method||ve.GET,t=e.timeout||_e,o=e.headers,i=e.query,u=e.body,r=Te(e.url,i);return new Promise(function(s){wx.request({url:r,method:n,header:o,timeout:t,data:u,success:function(c){s({data:c.data,status:c.statusCode})},fail:function(){s({status:g.RC_HTTP_REQ_FAIL})}})})},localStorage:be,sessionStorage:be,useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:_t,createWebSocket:function(e,n){var t=wx.connectSocket({url:e,protocols:n});return{id:Date.now(),onClose:function(o){t.onClose(function(i){o(i.code,i.reason)})},onError:function(o){t.onError(function(i){o(i.errMsg)})},onMessage:function(o){t.onMessage(function(i){o(i.data)})},onOpen:function(o){t.onOpen(o)},send:function(o){t.send({data:o})},close:function(o,i){t.close({code:o,reason:i})}}},getNetworkType:function(){return new Promise(function(e){wx.getNetworkType({success:function(n){var t=n.networkType;e(t)},fail:function(){e(W.UNKONWN)}})})},setNetworkStatusListener:function(e){Oe=e,wx.onNetworkStatusChange(Ge)},removeNetworkStatusListener:function(){wx.offNetworkStatusChange(Ge),Oe=null}},Tt=te(),le=function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{if(e==="setStorageSync")return my[e]({key:n[0],data:JSON.parse(n[1])});if(e==="clearStorageSync")return my[e]();if(e==="removeStorageSync")return my[e]({key:n[0]});var o=my[e]({key:n[0]}).data;return o&&JSON.stringify(o)}catch{}}},Fe={setItem:le("setStorageSync"),getItem:le("getStorageSync"),removeItem:le("removeStorageSync"),clear:le("clearStorageSync")},Ae=null,Be=function(e){var n=e.isConnected,t=e.networkType;Ae({status:n,type:t})},He={tag:"alipay",httpReq:function(e){var n=e.method||ve.GET,t=e.timeout||_e,o=e.headers,i=e.query,u=e.body,r=Te(e.url,i),s=e.dataType||"json";return new Promise(function(c){my.request({url:r,method:n,headers:o,timeout:t,data:u,dataType:s,success:function(d){c({data:d.data,status:d.status})},fail:function(){c({status:g.RC_HTTP_REQ_FAIL})}})})},localStorage:Fe,sessionStorage:Fe,useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:Tt,createWebSocket:function(e){var n=my.connectSocket({url:e,multiple:!0});return{id:Date.now(),onClose:function(t){n.onClose(t)},onError:function(t){n.onError(function(o){t(o.errMsg)})},onMessage:function(t){n.onMessage(function(o){o.data.isBuffer?t(my.base64ToArrayBuffer(o.data.data)):t(o.data.data)})},onOpen:function(t){n.onOpen(t)},send:function(t){n.send({data:my.arrayBufferToBase64(t),isBuffer:!0})},close:function(){n.close()}}},getNetworkType:function(){return new Promise(function(e){my.getNetworkType({success:function(n){var t=n.networkType;e(t)},fail:function(){e(W.UNKONWN)}})})},setNetworkStatusListener:function(e){Ae=e,my.onNetworkStatusChange(Be)},removeNetworkStatusListener:function(){my.offNetworkStatusChange(Be),Ae=null}},Nt=te(),fe=function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return tt[e].apply(tt,n)}catch{}}},Ve={setItem:fe("setStorageSync"),getItem:fe("getStorageSync"),removeItem:fe("removeStorageSync"),clear:fe("clearStorageSync")},Ue=null,qe=function(e){var n=e.isConnected,t=e.networkType;Ue({status:n,type:t})},Ke={tag:"toutiao",useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:Nt,localStorage:Ve,sessionStorage:Ve,httpReq:function(e){return new Promise(function(n){tt.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(t){var o=(t==null?void 0:t.data)||{},i={data:JSON.stringify(o),status:t.statusCode};n(i)},fail:function(t){n({status:g.RC_HTTP_REQ_FAIL})}})})},createWebSocket:function(e,n){var t=tt.connectSocket({url:e,protocols:n});return{id:Date.now(),onOpen:function(o){t.onOpen(o)},onClose:function(o){t.onClose(function(i){return o(i.code,i.reason)})},onError:function(o){t.onError(function(i){return o(i.errMsg)})},onMessage:function(o){t.onMessage(function(i){return o(i.data)})},send:function(o){t.send({data:o})},close:function(o,i){t.close({code:o,reason:i})}}},getNetworkType:function(){return new Promise(function(e){tt.getNetworkType({success:function(n){var t=n.networkType;e(t)},fail:function(){e(W.UNKONWN)}})})},setNetworkStatusListener:function(e){Ue=e,tt.onNetworkStatusChange(qe)},removeNetworkStatusListener:function(){tt.offNetworkStatusChange(qe),Ue=null}},It=te(),me=function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return swan[e].apply(swan,n)}catch{}}},ze={setItem:me("setStorageSync"),getItem:me("getStorageSync"),removeItem:me("removeStorageSync"),clear:me("clearStorageSync")},Pe=null,We=function(e){var n=e.isConnected,t=e.networkType;Pe({status:n,type:t})},je={tag:"baidu",useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:It,localStorage:ze,sessionStorage:ze,httpReq:function(e){return new Promise(function(n,t){swan.request({url:e.url,data:e.body,header:e.headers,method:e.method,success:function(o){var i=(o==null?void 0:o.data)||{},u={data:JSON.stringify(i),status:o.statusCode};n(u)},fail:function(o){n({status:g.RC_HTTP_REQ_FAIL})}})})},createWebSocket:function(e,n){var t=swan.connectSocket({url:e,protocols:n});return{id:Date.now(),onOpen:function(o){t.onOpen(o)},onClose:function(o){t.onClose(function(i){return o(i.code,i.reason)})},onError:function(o){t.onError(function(i){return o(i.errMsg)})},onMessage:function(o){t.onMessage(function(i){return o(i.data)})},send:function(o){t.send({data:o})},close:function(o,i){t.close({code:o,reason:i})}}},getNetworkType:function(){return O(this,void 0,void 0,function(){return A(this,function(e){return[2,new Promise(function(n){swan.getNetworkType({success:function(t){var o=t.networkType;n(o)},fail:function(){n(W.UNKONWN)}})})]})})},setNetworkStatusListener:function(e){Pe=e,swan.onNetworkStatusChange(We)},removeNetworkStatusListener:function(){swan.offNetworkStatusChange(We),Pe=null}},Ct=te(),pe=function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return jd[e].apply(jd,n)}catch(o){console==null||console.error(o)}}},Xe={setItem:pe("setStorageSync"),getItem:pe("getStorageSync"),removeItem:pe("removeStorageSync"),clear:pe("clearStorageSync")},Me=null,Je=function(e){var n=e.isConnected,t=e.networkType;Me({status:n,type:t})},Qe={tag:"jingdong",httpReq:function(e){var n=e.method||ve.GET,t=e.timeout||_e,o=e.headers,i=e.query,u=e.body,r=Te(e.url,i);return new Promise(function(s){jd.request({url:r,method:n,headers:o,timeout:t,data:u,success:function(c){s({data:c.data,status:c.statusCode})},fail:function(){s({status:g.RC_HTTP_REQ_FAIL})}})})},localStorage:Xe,sessionStorage:Xe,useNavi:!1,connectPlatform:"MiniProgram",isFromUniapp:Ct,createWebSocket:function(e,n){return jd.connectSocket({url:e,protocols:n}),{id:Date.now(),onClose:function(t){jd.onSocketClose(function(o){t(o.code,o.reason)})},onError:function(t){jd.onSocketError(function(o){t(o.errMsg)})},onMessage:function(t){jd.onSocketMessage(function(o){t(o.data)})},onOpen:function(t){jd.onSocketOpen(t)},send:function(t){jd.sendSocketMessage({data:t})},close:function(t,o){jd.closeSocket({code:t,reason:o})}}},getNetworkType:function(){return new Promise(function(e){jd.getNetworkType({success:function(n){var t=n.networkType;e(t)},fail:function(){e(W.UNKONWN)}})})},setNetworkStatusListener:function(e){Me=e,jd.onNetworkStatusChange(Je)},removeNetworkStatusListener:function(){jd.offNetworkStatusChange(Je),Me=null}},ge=function(e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];try{return uni[e].apply(uni,n)}catch(o){console==null||console.error(o)}}},Ye={setItem:ge("setStorageSync"),getItem:ge("getStorageSync"),removeItem:ge("removeStorageSync"),clear:ge("clearStorageSync")},we=null,Ze=function(e){var n=e.isConnected,t=e.networkType;we({status:n,type:t})},N,yt={tag:"uniapp",httpReq:function(e){var n=e.method||ve.GET,t=e.timeout||_e,o=e.headers,i=e.query,u=e.body,r=Te(e.url,i);return new Promise(function(s){uni.request({url:r,method:n,header:o,timeout:t,data:u,success:function(c){s({data:c.data,status:c.statusCode})},fail:function(){s({status:g.RC_HTTP_REQ_FAIL})}})})},localStorage:Ye,sessionStorage:Ye,useNavi:!0,connectPlatform:"",isFromUniapp:!0,createWebSocket:function(e,n){var t={complete:function(){},url:e,protocols:n},o=uni.connectSocket(t);return{id:Date.now(),onClose:function(i){o.onClose(function(u){i(u.code,u.reason)})},onError:function(i){o.onError(function(u){i(u.errMsg)})},onMessage:function(i){o.onMessage(function(u){i(u.data)})},onOpen:function(i){o.onOpen(i)},send:function(i){o.send({data:i})},close:function(i,u){o.close({code:i,reason:u})}}},getNetworkType:function(){return new Promise(function(e){uni.getNetworkType({success:function(n){var t=n.networkType;e(t)},fail:function(){e(W.UNKONWN)}})})},setNetworkStatusListener:function(e){we=e,uni.onNetworkStatusChange(Ze)},removeNetworkStatusListener:function(){uni.offNetworkStatusChange(Ze),we=null}},$=function(e){return e&&e.request&&e.getSystemInfo},Rt=typeof uni<"u"&&$(uni)?function(){switch(Et.VUE_APP_PLATFORM){case"app-plus":return yt;case"mp-jd":return Qe;case"mp-baidu":return je;case"mp-toutiao":return Ke;case"mp-alipay":return He;case"mp-weixin":return xe;default:return Re}}():typeof jd<"u"&&$(jd)?Qe:typeof my<"u"&&$(my)?He:typeof tt<"u"&&$(tt)?Ke:typeof swan<"u"&&$(swan)?je:typeof wx<"u"&&$(wx)?xe:Re;function F(e){var n=e.conversationType,t=e.channelId,o=e.messageType,i=e.content,u=e.senderUserId,r=e.targetId,s=e.sentTime,c=e.receivedTime,d=e.messageUId,a=e.messageDirection,l=e.isPersited,f=e.isCounted,h=e.isOffLineMessage,p=e.canIncludeExpansion,v=e.expansion,S=e.receivedStatus,m=e.disableNotification,E=e.isMentioned,C=e.isStatusMessage,T=e.readReceiptInfo,_=e.pushConfig,L=e.messageId,D=e.isInterrupt,Y=e.isModifyMessage,x=e.channelType,k=e.sentStatus;S||(S=et.UNREAD);var B={messageType:o,channelId:t||"",content:i,senderUserId:u,targetId:r,conversationType:n,sentTime:s,receivedTime:c,messageUId:d,messageDirection:a,isPersited:l,isCounted:f,isMentioned:E,disableNotification:m,isStatusMessage:C,canIncludeExpansion:p,expansion:v,receivedStatus:S,readReceiptInfo:T,pushConfig:_,messageId:L,isInterrupt:D,isModifyMessage:Y,sentStatus:k};return n!==ie.ULTRA_GROUP&&(B.isOffLineMessage=h),n===ie.ULTRA_GROUP&&ft(x)&&(B.channelType=x),B}function Ot(e){var n=e.conversationType,t=e.targetId,o=e.latestMessage,i=e.unreadMessageCount,u=e.hasMentioned,r=e.mentionedInfo,s=e.lastUnreadTime,c=e.notificationStatus,d=e.notificationLevel,a=e.isTop,l=e.channelId,f=e.unreadMentionedCount,h=e.matchCount,p=e.unreadMentionedMeCount,v=e.draft,S=e.operationTime,m={conversationType:n,targetId:t,latestMessage:o&&F(o),unreadMessageCount:i,hasMentioned:u,mentionedInfo:u?{type:r==null?void 0:r.type,userIdList:r==null?void 0:r.userIdList}:void 0,lastUnreadTime:s,notificationStatus:c,notificationLevel:d,isTop:a,channelId:l,unreadMentionedCount:f,matchCount:h,unreadMentionedMeCount:p,draft:v,operationTime:S};return m.conversationType===ie.ULTRA_GROUP&&(m.firstUnreadMessage=e.firstUnreadMessage,m.channelType=e.channelType),m}(function(e){e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.DISCONNECT="DISCONNECT",e.SUSPEND="SUSPEND",e.MESSAGES="MESSAGES",e.READ_RECEIPT_RECEIVED="READ_RECEIPT_RECEIVED",e.MESSAGE_RECEIPT_REQUEST="MESSAGE_RECEIPT_REQUEST",e.MESSAGE_RECEIPT_RESPONSE="MESSAGE_RECEIPT_RESPONSE",e.CONVERSATION="CONVERSATION",e.CHATROOM="CHATROOM",e.EXPANSION="EXPANSION",e.PULL_OFFLINE_MESSAGE_FINISHED="PULL_OFFLINE_MESSAGE_FINISHED",e.TAG="TAG",e.CONVERSATION_TAG="CONVERSATION_TAG",e.TYPING_STATUS="TYPING_STATUS",e.MESSAGE_BLOCKED="MESSAGE_BLOCKED",e.ULTRA_GROUP_ENABLE="ULTRA_GROUP_ENABLE",e.OPERATE_STATUS="OPERATE_STATUS",e.ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED="ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED",e.ULTRA_GROUP_MESSAGE_MODIFIED="ULTRA_GROUP_MESSAGE_MODIFIED",e.ULTRA_GROUP_MESSAGE_RECALLED="ULTRA_GROUP_MESSAGE_RECALLED",e.ULTRA_GROUP_CHANNEL_TYPE_CHANGE="ULTRA_GROUP_CHANNEL_TYPE_CHANGE",e.ULTRA_GROUP_CHANNEL_DELETE="ULTRA_GROUP_CHANNEL_DELETE",e.ULTRA_GROUP_CHANNEL_USER_KICKED="ULTRA_GROUP_CHANNEL_USER_KICKED",e.PRIVATE_MESSAGE_DELIVERED="PRIVATE_MESSAGE_DELIVERED",e.GROUP_MESSAGE_DELIVERED="GROUP_MESSAGE_DELIVERED",e.USER_GROUP_STATUS="USER_GROUP_STATUS"})(N||(N={}));var I=new lt,At={connection:function(e,n){switch(e){case ue.CONNECTED:I.emit(N.CONNECTED);break;case ue.CONNECTING:I.emit(N.CONNECTING);break;case ue.SUSPENDED:I.emit(N.SUSPEND,n);break;case ue.DISCONNECTED:I.emit(N.DISCONNECT,n)}},batchMessage:function(e){I.emit(N.MESSAGES,{messages:e.map(function(n){return F(n)})})},typingState:function(e){I.emit(N.TYPING_STATUS,{status:e})},readReceiptReceived:function(e,n,t){I.emit(N.READ_RECEIPT_RECEIVED,{conversation:e,messageUId:n,sentTime:t})},messageReceiptRequest:function(e,n,t){I.emit(N.MESSAGE_RECEIPT_REQUEST,{conversation:e,messageUId:n,senderUserId:t})},messageReceiptResponse:function(e,n,t){I.emit(N.MESSAGE_RECEIPT_RESPONSE,{conversation:e,receivedUserId:n,messageUIdList:t})},conversationState:function(e){var n=e.map(function(t){var o=t.conversationType,i={conversationType:o,latestMessage:t.latestMessage?F(t.latestMessage):null,targetId:t.targetId,unreadMessageCount:t.unreadMessageCount,unreadMentionedCount:t.unreadMentionedCount,notificationStatus:t.notificationStatus,notificationLevel:t.notificationLevel,lastUnreadTime:t.lastUnreadTime,channelId:t.channelId};return o===ie.ULTRA_GROUP?(i.versionTime=t.versionTime,i.unreadMessageCount=Ne(t.unreadMessageCount||0),i.unreadMentionedCount=Ne(t.unreadMentionedCount||0),i.unreadMentionedMeCount=Ne(t.unreadMentionedMeCount||0),{conversation:i}):(i.hasMentioned=t.hasMentioned,i.mentionedInfo=t.mentionedInfo,i.isTop=t.isTop,{conversation:i,updatedItems:t.updatedItems})});I.emit(N.CONVERSATION,{conversationList:n})},chatroomState:function(e){I.emit(N.CHATROOM,e)},expansion:function(e){I.emit(N.EXPANSION,e)},pullFinished:function(){I.emit(N.PULL_OFFLINE_MESSAGE_FINISHED)},tag:function(){I.emit(N.TAG)},conversationTagChanged:function(){I.emit(N.CONVERSATION_TAG)},messageBlocked:function(e){I.emit(N.MESSAGE_BLOCKED,e)},messageDelivered:function(e){I.emit(N.PRIVATE_MESSAGE_DELIVERED,e)},groupMessageDeliveredStatus:function(e){I.emit(N.GROUP_MESSAGE_DELIVERED,e)},ultraGroupEnable:function(e){I.emit(N.ULTRA_GROUP_ENABLE,e.map(function(n){return Ot(n)}))},operateStatus:function(e){I.emit(N.OPERATE_STATUS,e)},ultraGroupMessageExpansionUpdated:function(e){I.emit(N.ULTRA_GROUP_MESSAGE_EXPANSION_UPDATED,e.map(function(n){return F(n)}))},ultraGroupMessageModified:function(e){I.emit(N.ULTRA_GROUP_MESSAGE_MODIFIED,e.map(function(n){return F(n)}))},ultraGroupMessageRecalled:function(e){I.emit(N.ULTRA_GROUP_MESSAGE_RECALLED,e.map(function(n){return F(n)}))},ultraGroupChannelChangeType:function(e){I.emit(N.ULTRA_GROUP_CHANNEL_TYPE_CHANGE,e)},ultraGroupChannelUserKicked:function(e){I.emit(N.ULTRA_GROUP_CHANNEL_USER_KICKED,e)},ultraGroupChannelDelete:function(e){I.emit(N.ULTRA_GROUP_CHANNEL_DELETE,e)},userGroupStatus:function(e){I.emit(N.USER_GROUP_STATUS,e)}};function Ne(e){return e>999?999:e}st.add("imlib-next","5.8.2-enterprise.4");var K=null,Le=null,ee=null;function nt(e){if(!K)throw new Error("Not initialized yet!");return e(K,ee,Le)}function he(e){return K?e(K,ee,Le):Promise.resolve({code:g.BIZ_ERROR_CLIENT_NOT_INIT})}function Yt(e,n,t){I.on(e,n,t)}function Zt(e){(function(n){var t,o,i=n.appkey,u=n.navigators;K?ee.warn(w.A_INIT_REPEAT_O):(ke("options.appkey",n.appkey,y.STRING,!0),ke("options.navigators",n.navigators,function(r){return mt(r)&&(r.length===0||r.every(pt))}),Le=n,K=ct.init(((t=n.__runtimeCreator__)===null||t===void 0?void 0:t.call(n))||Rt,{appkey:n.appkey,navigators:n.navigators||[],miniCMPProxy:n.customCMP||[],logOutputLevel:n.logOutputLevel,__reportLogLevel:n.__reportLogLevel,httpInMainProcess:!!n.httpInMainProcess,logExpireTime:n.logExpireTime,areaCode:n.areaCode,logServerUrl:n.logServerUrl,environment:(o=n.environment)!==null&&o!==void 0?o:"default"}),(ee=K.createLogger("RC-IM","IM")).setOutputLevel(n.logOutputLevel),ee.info(w.A_INIT_O,JSON.stringify({appkey:i,navigators:u,version:"5.8.2-enterprise.4",commit:"6d681dbc4c78eb23bb4ea2400eeadea4e5901f92"})),K.assignWatcher(At),dt.init(ee))})(e)}function $t(){return nt(function(e){return e.getConnectionStatus()})}function en(e,n){return nt(function(t){return t.install(e,n)})}var Se={TIMEOUT:{code:-1,msg:"Network timeout"},SDK_INTERNAL_ERROR:{code:-2,msg:"SDK internal error"},PARAMETER_ERROR:{code:-3,msg:"Please check the parameters, the {param} expected a value of {expect} but received {current}"},REJECTED_BY_BLACKLIST:{code:405,msg:"Blacklisted by the other party"},SEND_TOO_FAST:{code:20604,msg:"Sending messages too quickly"},NOT_IN_GROUP:{code:22406,msg:"Not in group"},ULTRA_GROUP_USER_NOT_IN_PRIVATE_CHANNEL:{code:g.ULTRA_GROUP_USER_NOT_IN_PRIVATE_CHANNEL,msg:"ultra group user not in private channel"},FORBIDDEN_IN_GROUP:{code:22408,msg:"Forbbiden from speaking in the group"},NOT_IN_CHATROOM:{code:23406,msg:"Not in chatRoom"},FORBIDDEN_IN_CHATROOM:{code:23408,msg:"Forbbiden from speaking in the chatRoom"},KICKED_FROM_CHATROOM:{code:23409,msg:"Kicked out and forbbiden from joining the chatRoom"},CHATROOM_NOT_EXIST:{code:23410,msg:"ChatRoom does not exist"},CHATROOM_IS_FULL:{code:23411,msg:"ChatRoom members exceeded"},PARAMETER_INVALID_CHATROOM:{code:23412,msg:"Invalid chatRoom parameters"},ROAMING_SERVICE_UNAVAILABLE_CHATROOM:{code:23414,msg:"ChatRoom message roaming service is not open, Please go to the developer to open this service"},RECALLMESSAGE_PARAMETER_INVALID:{code:25101,msg:"Invalid recall message parameter"},ROAMING_SERVICE_UNAVAILABLE_MESSAGE:{code:25102,msg:"Single group chat roaming service is not open, Please go to the developer to open this service"},PUSHSETTING_PARAMETER_INVALID:{code:26001,msg:"Invalid push parameter"},OPERATION_BLOCKED:{code:20605,msg:"Operation is blocked"},OPERATION_NOT_SUPPORT:{code:20606,msg:"Operation is not supported"},MSG_BLOCKED_SENSITIVE_WORD:{code:21501,msg:"The sent message contains sensitive words"},REPLACED_SENSITIVE_WORD:{code:21502,msg:"Sensitive words in the message have been replaced"},NOT_CONNECTED:{code:30001,msg:"Please connect successfully first"},NAVI_REQUEST_ERROR:{code:30007,msg:"Navigation http request failed"},CMP_REQUEST_ERROR:{code:30010,msg:"CMP sniff http request failed"},CONN_APPKEY_FAKE:{code:31002,msg:"Your appkey is fake"},CONN_MINI_SERVICE_NOT_OPEN:{code:31003,msg:"Mini program service is not open, Please go to the developer to open this service"},CONN_ACK_TIMEOUT:{code:31e3,msg:"Connection ACK timeout"},CONN_TOKEN_INCORRECT:{code:31004,msg:"Your token is not valid or expired"},CONN_NOT_AUTHRORIZED:{code:31005,msg:"AppKey and Token do not match"},CONN_REDIRECTED:{code:31006,msg:"Connection redirection"},CONN_APP_BLOCKED_OR_DELETED:{code:31008,msg:"AppKey is banned or deleted"},CONN_USER_BLOCKED:{code:31009,msg:"User blocked"},CONN_DOMAIN_INCORRECT:{code:31012,msg:"Connect domain error, Please check the set security domain"},ROAMING_SERVICE_UNAVAILABLE:{code:33007,msg:"Roaming service cloud is not open, Please go to the developer to open this service"},RC_CONNECTION_EXIST:{code:34001,msg:"Connection already exists"},CHATROOM_KV_EXCEED:{code:23423,msg:"ChatRoom KV setting exceeds maximum"},CHATROOM_KV_OVERWRITE_INVALID:{code:23424,msg:"ChatRoom KV already exists"},CHATROOM_KV_STORE_NOT_OPEN:{code:23426,msg:"ChatRoom KV storage service is not open, Please go to the developer to open this service"},CHATROOM_KEY_NOT_EXIST:{code:23427,msg:"ChatRoom key does not exist"},MSG_KV_NOT_SUPPORT:{code:34008,msg:"The message cannot be extended"},SEND_MESSAGE_KV_FAIL:{code:34009,msg:"Sending RC expansion message fail"},EXPANSION_LIMIT_EXCEET:{code:34010,msg:"The message expansion size is beyond the limit"},ILLGAL_PARAMS:{code:33003,msg:"Incorrect parameters passed in while calling the interface"},UPLOAD_FILE_FAILED:{code:35020,msg:"File upload failed"},CHATROOM_KV_STORE_NOT_ALL_SUCCESS:{code:23428,msg:"Chatroom kv store not all success"},CHATROOM_KV_STORE_OUT_LIMIT:{code:23429,msg:"Chatroom kv's length is out of limit"},TAG_EXISTS:{code:33101,msg:"The tag already exists"},TAG_NOT_EXIST:{code:33100,msg:"The tag does not exist"},NOT_SUPPORT:{code:g.NOT_SUPPORT,msg:"The method is not supported in a browser!"}},Ee={};for(var $e in Se){var Ut=Se[$e].code;Ee[Ut]=$e}function tn(e,n){return O(this,void 0,void 0,function(){var t=this;return A(this,function(o){return[2,he(function(i,u){return O(t,void 0,void 0,function(){var r,s,c;return A(this,function(d){switch(d.label){case 0:return R("token",e,y.STRING,!0)&&R("reconnectKickEnable",n,y.BOOLEAN)?(r=u.createTraceId(),u.info(w.A_CONNECT_T,JSON.stringify({token:e,reconnectKickEnable:n}),r),[4,i.connect(e,!!n,r)]):[2,{code:g.BIZ_ERROR_INVALID_PARAMETER}];case 1:return s=d.sent(),c=s.code===g.SUCCESS?"info":"warn",u[c](w.A_CONNECT_R,JSON.stringify({code:s.code,userId:s.userId}),r),s.code===g.SUCCESS?[2,{code:s.code,data:{userId:s.userId}}]:[2,{code:s.code,msg:Ee[s.code]}]}})})})]})})}Se.ROAMING_SERVICE_UNAVAILABLE.code;var ot=function(e,n,t,o){t===void 0&&(t=!0),o===void 0&&(o=!0),this.messageType=e,this.content=n,this.isPersited=t,this.isCounted=o};function P(e,n,t){return n===void 0&&(n=!0),t===void 0&&(t=!0),function(o){return new ot(e,o,n,t)}}var M,Pt=P("RC:ImgMsg"),Mt=P("RC:HQVCMsg"),wt=P("RC:SightMsg");P("RC:TxtMsg");var Lt=P("RC:CombineMsg"),Dt=P("RC:FileMsg"),kt=P("RC:GIFMsg");P("RC:VcMsg");P("RC:LBSMsg");P("RC:ReferenceMsg");P("RC:ImgTextMsg");P("RC:CmdMsg");P("RC:InfoNtf");P("RC:GrpNtf");(function(e){e.ALIYUN="aliyun",e.S3="s3",e.STC="stc",e.MINIO="minio",e.QINIU="qiniu",e.BAIDU="baidu",e.RCX="rcx"})(M||(M={}));var V,Ie,Q=function(){function e(n,t,o){this.isSupportMultipart=!1,this._serverType=0,this._url=n,this._getFileToken=t,this._serverType=o}return e.prototype.upload=function(n){return n.file.size>ut?Promise.resolve({code:g.UPLOAD_FAIL,msg:"the file size is over 5GB!"}):n.file.size>z&&this.isSupportMultipart?this.multipartUpload(n):this.commonUpload(n)},e}(),bt=function(e){function n(){return e!==null&&e.apply(this,arguments)||this}return J(n,e),n.prototype.commonUpload=function(t){return O(this,void 0,void 0,function(){var o,i,u,r,s,c,d;return A(this,function(a){switch(a.label){case 0:return o=t.file,i=t.onProgress,u=t.fileType,[4,this._getFileToken(u,o.name)];case 1:return r=a.sent(),s={},(c=new FormData).set("token",r.token),c.set("key",r.fileName),c.set("file",o),[4,U({url:G(this._url),headers:s,onProgress:function(l){return i==null?void 0:i(l.loaded,l.total)},method:"POST",body:c,timeout:0})];case 2:return(d=a.sent().status)===200||d===204?[2,{code:g.SUCCESS,data:{uniqueName:r.fileName,uploadMethod:X.QINIU}}]:[2,{code:g.UPLOAD_FAIL,msg:d.toString()}]}})})},n.prototype.multipartUpload=function(t){return O(this,void 0,void 0,function(){return A(this,function(o){throw new Error("Method not implemented.")})})},n}(Q),Gt=function(e){function n(){return e!==null&&e.apply(this,arguments)||this}return J(n,e),n.prototype.commonUpload=function(t){return O(this,void 0,void 0,function(){var o,i,u,r,s,c,d;return A(this,function(a){switch(a.label){case 0:return o=t.file,i=t.onProgress,u=t.fileType,[4,this._getFileToken(u)];case 1:return r=a.sent(),s=G("".concat(r.ossBucketName,".").concat(this._url)),(c=new FormData).set("token",r.token),c.set("OSSAccessKeyId",r.osskeyId),c.set("policy",r.ossPolicy),c.set("Signature",r.ossSign),c.set("success_action_status","200"),c.set("key",r.fileName),c.set("file",o),[4,U({url:s,onProgress:function(l){return i==null?void 0:i(l.loaded,l.total)},method:"POST",body:c,timeout:0})];case 2:return(d=a.sent().status)===200||d===204?[2,{code:g.SUCCESS,data:{uniqueName:r.fileName,uploadMethod:X.ALI}}]:[2,{code:g.UPLOAD_FAIL,msg:d.toString()}]}})})},n.prototype.multipartUpload=function(t){throw new Error("Method not implemented.")},n}(Q),xt=function(e){function n(){return e!==null&&e.apply(this,arguments)||this}return J(n,e),n.prototype.commonUpload=function(t){return O(this,void 0,void 0,function(){var o,i,u,r,s,c,d,a,l;return A(this,function(f){switch(f.label){case 0:return o=t.file,i=t.onProgress,u=t.fileType,r=t.contentDisposition,[4,this._getFileToken(u<=b.FILE?u:b.FILE)];case 1:return s=f.sent(),c=r||(o.type==="text/html"?"inline":"attachment"),d={authorization:s.bosToken,"x-bce-date":s.bosDate,"Content-Disposition":"".concat(c,"; filename=").concat(encodeURIComponent(o.name),";")},a=G("".concat(this._url).concat(s.path)),[4,U({url:a,headers:d,onProgress:function(h){return i==null?void 0:i(h.loaded,h.total)},method:"POST",body:o,timeout:0})];case 2:return(l=f.sent().status)===200||l===204?[2,{code:g.SUCCESS,data:{uniqueName:s.fileName,downloadUrl:a}}]:[2,{code:g.UPLOAD_FAIL,msg:l.toString()}]}})})},n.prototype.multipartUpload=function(t){throw new Error("Method not implemented.")},n}(Q),Ft=function(e){function n(){return e!==null&&e.apply(this,arguments)||this}return J(n,e),n.prototype.commonUpload=function(t){return O(this,void 0,void 0,function(){var o,i,u,r,s,c,d,a,l,f;return A(this,function(h){switch(h.label){case 0:return o=t.file,i=t.onProgress,u=t.fileType,r=t.contentDisposition,[4,this._getFileToken(u,o.name)];case 1:return s=h.sent(),c={},d=G("".concat(s.s3BucketName,".").concat(this._url)),a=new FormData,r?a.set("Content-Disposition",r):a.set("Content-Disposition",o.type==="text/html"?"inline;":"attachment;"),a.set("Content-Type",o.type),a.set("x-amz-credential",s.s3Credential),a.set("x-amz-algorithm",s.s3Algorithm),a.set("x-amz-date",s.s3Date),a.set("policy",s.s3Policy),a.set("x-amz-signature",s.s3Signature),a.set("key",s.fileName),a.set("file",o),[4,U({url:d,headers:c,onProgress:function(p){return i==null?void 0:i(p.loaded,p.total)},method:"POST",body:a,timeout:0})];case 2:return l=h.sent(),f=l.status,l.data,f===200||f===204?[2,{code:g.SUCCESS,data:{uniqueName:s.fileName,uploadMethod:X.AWS}}]:[2,{code:g.UPLOAD_FAIL,msg:f.toString()}]}})})},n.prototype.multipartUpload=function(t){throw new Error("Method not implemented.")},n}(Q),Bt=function(e){function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.isSupportMultipart=!0,t}return J(n,e),n.prototype.commonUpload=function(t){return O(this,void 0,void 0,function(){var o,i,u,r,s,c,d;return A(this,function(a){switch(a.label){case 0:return o=t.file,i=t.onProgress,u=t.fileType,[4,this._getFileToken(u)];case 1:return r=a.sent(),s=G("".concat(this._url,"/").concat(r.stcBucketName,"/").concat(r.fileName)),c=this.getBaseHeaders(o,r,t),[4,U({url:s,headers:c,onProgress:function(l){return i==null?void 0:i(l.loaded,l.total)},method:"PUT",body:o,timeout:0})];case 2:return(d=a.sent().status)===200||d===204?[2,{code:g.SUCCESS,data:{uniqueName:r.fileName,uploadMethod:X.STC}}]:[2,{code:g.UPLOAD_FAIL}]}})})},n.prototype.multipartUpload=function(t){var o;return O(this,void 0,void 0,function(){var i,u,r,s,c,d,a,l,f,h,p,v,S,m,E,C,T;return A(this,function(_){switch(_.label){case 0:return i=t.file,t.onProgress,u=t.fileType,[4,this._getFileToken(u,i.name,"POST","uploads")];case 1:return r=_.sent(),s=G("".concat(this._url,"/").concat(r.stcBucketName,"/").concat(r.fileName)),c=this.getBaseHeaders(i,r,t),[4,U({url:"".concat(s,"?uploads"),headers:c,method:"POST"})];case 2:return d=_.sent(),a=d.status,l=d.data,f=(o=l==null?void 0:l.match(/(?:<UploadId>)(\S*?)(?:<\/UploadId>)/))===null||o===void 0?void 0:o[1],a!==200&&a!==204||!f?[2,{code:g.UPLOAD_FAIL,msg:"start upload fail"}]:(h=[],[4,this.requestUploadPart(s,i,f,r.fileName,t,h)]);case 3:return p=_.sent(),v=p.code,S=p.msg,v!==g.SUCCESS?[2,{code:v,msg:S}]:[4,this._getFileToken(u,r.fileName,"POST","uploadId=".concat(f))];case 4:return m=_.sent(),E=h.map(function(L,D){return"<Part><PartNumber>".concat(D+1,"</PartNumber><ETag>").concat(L,"</ETag></Part>")}).join(""),E="<CompleteMultipartUpload xmlns='http://s3.amazonaws.com/doc/2006-03-01/'>".concat(E,"</CompleteMultipartUpload>"),C=this.getBaseHeaders(i,m,t),[4,U({url:"".concat(s,"?uploadId=").concat(f),headers:C,method:"POST",body:E})];case 5:return(T=_.sent().status)===200||T===204?[2,{code:g.SUCCESS,data:{uniqueName:r.fileName,uploadMethod:X.STC}}]:[2,{code:g.UPLOAD_FAIL,msg:"end upload fail"}]}})})},n.prototype.requestUploadPart=function(t,o,i,u,r,s,c,d){return c===void 0&&(c=1),d===void 0&&(d=0),O(this,void 0,void 0,function(){var a,l,f,h,p,v,S,m,E;return A(this,function(C){switch(C.label){case 0:return d>=5?[2,{code:g.UPLOAD_FAIL,msg:"Upload retry times exceeded 5. Procedure"}]:(a=(c-1)*z,l=Math.min(z,o.size-a),f="partNumber=".concat(c,"&uploadId=").concat(i),[4,this._getFileToken(r.fileType,u,"PUT",f)]);case 1:return h=C.sent(),p=o.slice(a,c*z),v=this.getBaseHeaders(o,h,r),[4,U({url:"".concat(t,"?").concat(f),headers:v,method:"PUT",body:p,onProgress:function(T){var _;return(_=r==null?void 0:r.onProgress)===null||_===void 0?void 0:_.call(r,a+T.loaded,o.size)},timeout:0})];case 2:return S=C.sent(),m=S.status,S.data,E=S.xhr,m===200||m===204?(s.push((E==null?void 0:E.getResponseHeader("ETag"))||""),a+l<o.size?[2,this.requestUploadPart(t,o,i,u,r,s,c+1,0)]:[2,{code:g.SUCCESS}]):[2,this.requestUploadPart(t,o,i,u,r,s,c,d+1)]}})})},n.prototype.getBaseHeaders=function(t,o,i){var u=i.contentDisposition||(t.type==="text/html"?"inline":"attachment");return{"Content-Disposition":"".concat(u,"; filename=").concat(encodeURIComponent(t.name),";"),Authorization:o.stcAuthorization,"x-amz-content-sha256":o.stcContentSha256,"x-amz-date":o.stcDate,"Content-Type":t.type||"text/plain"}},n}(Q),Ht=function(e){function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.isSupportMultipart=!0,t}return J(n,e),n.prototype.commonUpload=function(t){return O(this,void 0,void 0,function(){var o,i,u,r,s,c,d;return A(this,function(a){switch(a.label){case 0:return o=t.file,i=t.onProgress,u=t.fileType,[4,this._getFileToken(u)];case 1:return r=a.sent(),s=G("".concat(this._url,"/").concat(r.minioBucketName,"/").concat(r.fileName)),c=this.getBaseHeaders(o,r,t),[4,U({url:s,headers:c,onProgress:function(l){return i==null?void 0:i(l.loaded,l.total)},method:"PUT",body:o,timeout:0})];case 2:return(d=a.sent().status)===200||d===204?[2,{code:g.SUCCESS,data:{uniqueName:r.fileName,uploadMethod:X.MINIO}}]:[2,{code:g.UPLOAD_FAIL,msg:d.toString()}]}})})},n.prototype.multipartUpload=function(t){var o;return O(this,void 0,void 0,function(){var i,u,r,s,c,d,a,l,f,h,p,v,S,m,E,C,T;return A(this,function(_){switch(_.label){case 0:return i=t.file,u=t.fileType,[4,this._getFileToken(u,i.name,"POST","uploads")];case 1:return r=_.sent(),s=G("".concat(this._url,"/").concat(r.minioBucketName,"/").concat(r.fileName)),c=this.getBaseHeaders(i,r,t),[4,U({url:"".concat(s,"?uploads"),headers:c,method:"POST"})];case 2:return d=_.sent(),a=d.status,l=d.data,f=(o=l==null?void 0:l.match(/(?:<UploadId>)(\S*?)(?:<\/UploadId>)/))===null||o===void 0?void 0:o[1],a!==200&&a!==204||!f?[2,{code:g.UPLOAD_FAIL,msg:"start upload fail"}]:(h=[],[4,this.requestUploadPart(s,i,f,r.fileName,t,h)]);case 3:return p=_.sent(),v=p.code,S=p.msg,v!==g.SUCCESS?[2,{code:v,msg:S}]:[4,this._getFileToken(u,r.fileName,"POST","uploadId=".concat(f))];case 4:return m=_.sent(),E=h.map(function(L,D){return"<Part><PartNumber>".concat(D+1,"</PartNumber><ETag>").concat(L,"</ETag></Part>")}).join(""),E="<CompleteMultipartUpload xmlns='http://s3.amazonaws.com/doc/2006-03-01/'>".concat(E,"</CompleteMultipartUpload>"),C=this.getBaseHeaders(i,m,t),[4,U({url:"".concat(s,"?uploadId=").concat(f),headers:C,method:"POST",body:E,timeout:0})];case 5:return(T=_.sent().status)===200||T===204?[2,{code:g.SUCCESS,data:{uniqueName:r.fileName,uploadMethod:X.MINIO}}]:[2,{code:g.UPLOAD_FAIL,msg:"end upload fail"}]}})})},n.prototype.requestUploadPart=function(t,o,i,u,r,s,c,d){return c===void 0&&(c=1),d===void 0&&(d=0),O(this,void 0,void 0,function(){var a,l,f,h,p,v,S,m,E;return A(this,function(C){switch(C.label){case 0:return d>=5?[2,{code:g.UPLOAD_FAIL,msg:"Upload retry times exceeded 5. Procedure"}]:(a=(c-1)*z,l=Math.min(z,o.size-a),f="partNumber=".concat(c,"&uploadId=").concat(i),[4,this._getFileToken(r.fileType,u,"PUT",f)]);case 1:return h=C.sent(),p=o.slice(a,c*z),v=this.getBaseHeaders(o,h,r),[4,U({url:"".concat(t,"?").concat(f),headers:v,method:"PUT",body:p,timeout:0,onProgress:function(T){var _;return(_=r==null?void 0:r.onProgress)===null||_===void 0?void 0:_.call(r,a+T.loaded,o.size)}})];case 2:return S=C.sent(),m=S.status,E=S.xhr,m===200||m===204?(s.push((E==null?void 0:E.getResponseHeader("ETag"))||""),a+l<o.size?[2,this.requestUploadPart(t,o,i,u,r,s,c+1,0)]:[2,{code:g.SUCCESS}]):[2,this.requestUploadPart(t,o,i,u,r,s,c,d+1)]}})})},n.prototype.getBaseHeaders=function(t,o,i){var u=i.contentDisposition||(t.type==="text/html"?"inline":"attachment");return{"Content-Disposition":"".concat(u,"; filename=").concat(encodeURIComponent(t.name),";"),Authorization:o.minioAuthorization,"x-amz-content-sha256":o.minioContentSha256,"x-amz-date":o.minioDate,"Content-Type":t.type||"text/plain"}},n}(Q),Vt=function(e){function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.isSupportMultipart=!0,t}return J(n,e),n.prototype.commonUpload=function(t){return O(this,void 0,void 0,function(){var o,i,u,r,s,c,d,a,l,f,h;return A(this,function(p){switch(p.label){case 0:return o=t.file,i=t.onProgress,u=t.fileType,[4,this._getFileToken(u,o.name)];case 1:return r=p.sent(),s={},(c=new FormData).set("token",r.token),c.set("key",r.fileName),c.set("file",o),d=G(this._url),[4,U({url:d,headers:s,onProgress:function(v){return i==null?void 0:i(v.loaded,v.total)},method:"POST",body:c,timeout:0})];case 2:return a=p.sent(),l=a.status,f=a.data,l!==200&&l!==204||!f?[2,{code:g.UPLOAD_FAIL,msg:l.toString()}]:(h=JSON.parse(f),[2,{code:g.SUCCESS,data:{uniqueName:h.rc_url.file_name,downloadUrl:"".concat(d,"/").concat(h.rc_url.path)}}])}})})},n.prototype.multipartUpload=function(t){return O(this,void 0,void 0,function(){var o,i,u,r,s;return A(this,function(c){switch(c.label){case 0:return o=t.file,i=t.onProgress,u=t.fileType,r=gt(),[4,this._getFileToken(u,o.name)];case 1:return s=c.sent().token,[2,this._requestUploadPart(r,o,s,i)]}})})},n.prototype._requestUploadPart=function(t,o,i,u,r){return r===void 0&&(r=0),O(this,void 0,void 0,function(){var s,c,d,a,l,f,h,p,v,S;return A(this,function(m){switch(m.label){case 0:return s=Math.min(z,o.size-r),c=t+o.name.substring(o.name.lastIndexOf(".")),d={Range:"bytes=".concat(r,"-").concat(r+s),"X-File-TransactionId":c,"X-File-Total-Size":o.size.toString()},a=o.slice(r,r+s),(l=new FormData).set("file",a,o.name),l.set("key",c),l.set("name",c),l.set("token",i),f=G(this._url),[4,U({url:f,headers:d,onProgress:function(E){return u==null?void 0:u(r+E.loaded,o.size)},method:"POST",body:l,timeout:0})];case 1:return h=m.sent(),p=h.status,v=h.data,p===200||p===204?r+s<o.size?[2,this._requestUploadPart(t,o,i,u,r+s)]:(S=JSON.parse(v),[2,{code:g.SUCCESS,data:{uniqueName:S.rc_url.file_name,downloadUrl:"".concat(f,"/").concat(S.rc_url.path)}}]):[2,{code:g.UPLOAD_FAIL,msg:p.toString()}]}})})},n}(Q);function qt(e,n){return O(this,void 0,void 0,function(){var t,o,i,u,r,s,c,d,a,l,f,h,p,v,S,m,E,C,T,_,L,D,Y,x;return A(this,function(k){switch(k.label){case 0:return t=n.getFileToken,o=n.serverType,i=n.customDomain,u=n.ossConfig,r=n.uploadServer,s=n.bosAddr,c=e.file,d=e.fileType,a=e.thumbnailConfig,l=function(B,De,re,ae,se){if(re)return[{type:M.RCX,url:re,p:"1"}];if(B)return JSON.parse(B).map(function(j){var H={type:M.QINIU,url:"",p:""};return Object.keys(j).forEach(function(Z){Z==="p"?H.p=j[Z]:(H.type=Z,H.url=j[Z])}),H}).sort(function(j,H){return j.p-H.p});var oe=[];return ae&&oe.push({type:M.QINIU,url:ae,p:"1"}),se&&oe.push({type:M.BAIDU,url:se,p:"2"}),oe}(u,0,i,r,s),l.length===0?[2,Promise.resolve({code:g.BIZ_ERROR_INVALID_PARAMETER,msg:"uploadUrlList is empty"})]:[4,it(l,e,t,o)];case 1:return f=k.sent(),h=f.code,p=f.data,v=f.msg,h===g.SUCCESS&&p?[4,Kt(e,n,p)]:[2,{code:h,msg:v}];case 2:return S=k.sent(),m={downloadUrl:S,uniqueName:(p==null?void 0:p.uniqueName)||"",name:c.name,size:c.size,type:c.type},d!==b.AUDIO?[3,5]:[4,c.arrayBuffer()];case 3:return[4,zt(k.sent())];case 4:return E=k.sent(),C=E.duration,T=E.length,x=q(q({},m),{duration:C,length:T}),[2,{code:h,data:x}];case 5:return d!==b.IMAGE?[3,7]:[4,jt(c,a)];case 6:return _=k.sent(),L=_.thumbnail,D=_.width,Y=_.height,x=q(q({},m),{thumbnail:L,width:D,height:Y}),[2,{code:h,data:x}];case 7:return[2,{code:h,data:m}]}})})}function Kt(e,n,t){return O(this,void 0,void 0,function(){var o,i,u,r,s,c,d;return A(this,function(a){switch(a.label){case 0:return o=n.getFileUrl,i=e.fileType,u=e.file,r=t.uploadMethod,s=t.downloadUrl,c=t.uniqueName,(d=s)?[3,2]:[4,o(i,c,u.name,void 0,r)];case 1:d=a.sent().downloadUrl,a.label=2;case 2:return[2,d]}})})}function zt(e){return Ie=Ie||new AudioContext,new Promise(function(n,t){Ie.decodeAudioData(e,function(o){n({duration:o.duration,length:o.length})},t)})}var Wt=((V={})[M.QINIU]=bt,V[M.ALIYUN]=Gt,V[M.BAIDU]=xt,V[M.S3]=Ft,V[M.STC]=Bt,V[M.MINIO]=Ht,V[M.RCX]=Vt,V);function it(e,n,t,o,i){return i===void 0&&(i=[]),O(this,void 0,void 0,function(){var u,r,s,c,d;return A(this,function(a){switch(a.label){case 0:return e.length===0?[2,Promise.resolve({code:g.UPLOAD_FAIL,msg:"Failed to upload all channels, msg: ".concat(JSON.stringify(i))})]:(u=e.shift(),[4,new Wt[u.type](u.url,t,o).upload(n)]);case 1:return r=a.sent(),s=r.code,c=r.data,d=r.msg,s!==g.SUCCESS?(i.push({type:u.type,url:u.url,code:s,msg:d}),[2,it(e,n,t,o,i)]):[2,{code:s,data:c}]}})})}function jt(e,n){return new Promise(function(t,o){var i=document.createElement("canvas"),u=i.getContext("2d"),r=new Image;r.onload=function(s){var c=n||{},d=c.maxHeight,a=d===void 0?160:d,l=c.maxWidth,f=l===void 0?160:l,h=c.quality,p=h===void 0?.7:h,v=c.scale,S=v===void 0?1:v,m=Xt(r.width,r.height,{maxHeight:a,maxWidth:f,scale:S});i.width=Math.min(m.w,f),i.height=Math.min(m.h,a),u.drawImage(r,m.x,m.y,m.w,m.h);var E=i.toDataURL(typeof e=="string"?"image/jpg":e.type,p);E=E.replace(/data:image\/[^;]+;base64,/,""),t({thumbnail:E,width:m.w,height:m.h})},r.src=(window.URL||window.webkitURL).createObjectURL(e)})}var Xt=function(e,n,t){var o,i,u=t.maxHeight,r=u===void 0?160:u,s=t.maxWidth,c=s===void 0?160:s,d=t.scale,a=e<n,l=0,f=0;return(a?n/e:e/n)>(d===void 0?1:d)?(a?(o=100,f=((i=n/(e/100))-r)/2):(i=100,l=((o=e/(n/100))-c)/2),{w:o,h:i,x:-l,y:-f}):(a?(i=r,o=e/(n/r)):(o=c,i=n/(e/c)),{w:o,h:i,x:-l,y:-f})};function Jt(e,n,t){return O(this,void 0,void 0,function(){var o=this;return A(this,function(i){return[2,he(function(u,r){return O(o,void 0,void 0,function(){var s,c,d,a,l,f,h,p,v,S,m,E;return A(this,function(C){switch(C.label){case 0:return t=t||{},n instanceof ot?R("conversation",e,y.OBJECT,!0)?(s=e.conversationType,c=e.targetId,d=e.channelId,R("conversation.targetId",c,y.STRING,!0)&&R("conversation.conversationType",s,y.NUMBER,!0)&&R("conversation.channelId",d,y.CHANNEL_ID)&&R("options.isStatusMessage",t==null?void 0:t.isStatusMessage,y.BOOLEAN)&&R("options.disableNotification",t==null?void 0:t.disableNotification,y.BOOLEAN)&&R("options.pushContent",t==null?void 0:t.pushContent,y.STRING)&&R("options.pushData",t==null?void 0:t.pushData,y.STRING)&&R("options.isMentioned",t==null?void 0:t.isMentioned,y.BOOLEAN)&&R("options.mentionedType",t==null?void 0:t.mentionedType,y.NUMBER)&&R("options.mentionedUserIdList",t==null?void 0:t.mentionedUserIdList,y.ARRAY)&&R("options.directionalUserIdList",t==null?void 0:t.directionalUserIdList,y.ARRAY)&&R("options.isVoipPush",t==null?void 0:t.isVoipPush,y.BOOLEAN)&&R("options.canIncludeExpansion",t==null?void 0:t.canIncludeExpansion,y.BOOLEAN)&&R("options.expansion",t==null?void 0:t.expansion,y.OBJECT)&&R("options.pushConfig",t==null?void 0:t.pushConfig,y.OBJECT)&&R("options.messageId",t==null?void 0:t.messageId,y.NUMBER)?(a="conversationType:".concat(s,",targetId:").concat(c),r.debug(w.O,"send message  ->".concat(a)),l=function(T,_,L){var D=T.isStatusMessage,Y=T.disableNotification,x=T.pushContent,k=T.pushData,B=T.isMentioned,De=T.mentionedType,re=T.mentionedUserIdList,ae=T.directionalUserIdList,se=T.isVoipPush,oe=T.canIncludeExpansion,j=T.expansion,H=T.isFilerWhiteBlacklist,Z=T.pushConfig,rt=T.messageId,at=L.channelId;return q({isStatusMessage:D,disableNotification:Y,pushContent:x,pushData:k,isMentioned:B,mentionedType:De,mentionedUserIdList:re,directionalUserIdList:ae,isVoipPush:se,canIncludeExpansion:oe,expansion:j,isFilerWhiteBlacklist:H,pushConfig:Z,channelId:at||"",messageId:rt},_)}(t,n,e),f={isMentioned:!!t.isMentioned,content:n.content,messageType:n.messageType,isPersited:!!n.isPersited,isCounted:!!n.isCounted,disableNotification:!!(t!=null&&t.disableNotification),canIncludeExpansion:!!(t!=null&&t.canIncludeExpansion),expansion:(t==null?void 0:t.expansion)||null,conversationType:e.conversationType,targetId:e.targetId,channelId:e.channelId,senderUserId:u.getCurrentUserId(),messageUId:"",messageDirection:ht.SEND,receivedTime:0,isStatusMessage:!!t.isStatusMessage,receivedStatus:et.UNREAD,isOffLineMessage:!1,pushConfig:t==null?void 0:t.pushConfig,sentStatus:St.SENDING},s!==ie.ULTRA_GROUP&&(f.isOffLineMessage=!1),h=r.createTraceId(),p=function(T){f.messageId=T;try{t!=null&&t.onSendBefore&&t.onSendBefore(F(f))}catch(_){r.error(w.O,`Callback method "onSendBefore" execution error.
`.concat(_==null?void 0:_.stack),h)}},r.info(w.A_SEND_MSG_T,JSON.stringify({messageType:n.messageType,conversationType:s,targetId:c,channelId:d}),h),[4,u.sendMessage(s,c,l,p,h)]):[2,{code:g.BIZ_ERROR_INVALID_PARAMETER}]):[2,{code:g.BIZ_ERROR_INVALID_PARAMETER}]:(r.warn(w.O,"send message fail -> message parameter is not an instance of BaseMessage"),[2,Se.ILLGAL_PARAMS]);case 1:return v=C.sent(),S=v.code,m=v.data,S===g.SUCCESS?(r.info(w.A_SEND_MSG_R,JSON.stringify({code:S,messageUId:m.messageUId,messageId:m.messageId}),h),E=F(m),[2,{code:S,data:E}]):(r.warn(w.A_SEND_MSG_R,"send message fail ->".concat(S,":").concat(Ee[S],",").concat(a)),f.sentTime=(m==null?void 0:m.sentTime)||0,f.sentStatus=m==null?void 0:m.sentStatus,[2,{code:S,msg:Ee[S],data:F(f)}])}})})})]})})}function ne(e,n){return function(t,o,i,u){if(!R("sendOptions.contentDisposition",u==null?void 0:u.contentDisposition,function(c){return["inline","attachment"].includes(c)}))return Promise.resolve({code:g.BIZ_ERROR_INVALID_PARAMETER});var r={contentDisposition:u==null?void 0:u.contentDisposition};if(u&&"thumbnailConfig"in u){var s=u==null?void 0:u.thumbnailConfig;if(!(R("sendOptions.maxHeight",s==null?void 0:s.maxHeight,y.NUMBER)&&R("sendOptions.maxWidth",s==null?void 0:s.maxWidth,y.NUMBER)&&R("sendOptions.quality",s==null?void 0:s.quality,y.NUMBER)&&R("sendOptions.scale",s==null?void 0:s.scale,y.NUMBER)))return Promise.resolve({code:g.BIZ_ERROR_INVALID_PARAMETER});r.thumbnailConfig=s}return he(function(c,d,a){return new Promise(function(l){var f,h=d.createTraceId();d.info(w.L_MEDIA_UPLOAD_T,JSON.stringify({filesize:o.file.size,type:e}),h),(f={file:o.file,fileType:e,onProgress:function(p,v){var S;(S=i==null?void 0:i.onProgress)===null||S===void 0||S.call(i,Math.floor(p/v*100))},contentDisposition:r.contentDisposition,thumbnailConfig:r.thumbnailConfig},he(function(p,v,S){return new Promise(function(m){var E=p.getNaviInfoFromCache();qt(f,{getFileToken:p.getFileToken.bind(p),getFileUrl:p.getFileUrl.bind(p),customDomain:S.uploadDomain||"",serverType:E==null?void 0:E.type,ossConfig:E==null?void 0:E.ossConfig,uploadServer:E==null?void 0:E.uploadServer,bosAddr:E==null?void 0:E.bosAddr}).then(function(C){m(C)})})})).then(function(p){var v,S=p.code,m=p.data,E=p.msg;if(S===g.SUCCESS&&m){var C=((v=i==null?void 0:i.onComplete)===null||v===void 0?void 0:v.call(i,q({url:m.downloadUrl},m)))||n(m,o);return d.info(w.L_MEDIA_UPLOAD_R,JSON.stringify({downurl:m.downloadUrl,code:g.SUCCESS}),h),void Jt(t,C,u).then(l)}l({code:S,msg:E})})})})}}ne(b.FILE,function(e,n){return new Dt({name:e.name,size:n.file.size,type:(t=e.name,o=t.match(/\.(\w+)$/),o?o[1]:"bin"),fileUrl:e.downloadUrl,user:n.user,extra:n.extra});var t,o});ne(b.IMAGE,function(e,n){return new Pt({content:e.thumbnail,imageUri:e.downloadUrl,user:n.user,extra:n.extra})});ne(b.IMAGE,function(e,n){return new kt({gifDataSize:e.size,remoteUrl:e.downloadUrl,width:e.width,height:e.height,user:n.user,extra:n.extra})});ne(b.AUDIO,function(e,n){return new Mt({remoteUrl:e.downloadUrl,duration:e.duration,type:e.type,user:n.user,extra:n.extra})});ne(b.SIGHT,function(e,n){return new wt({sightUrl:e.downloadUrl,content:n.thumbnail,duration:n.duration,size:n.file.size||e.size,name:n.name||e.name,user:n.user,extra:n.extra})});ne(b.COMBINE_HTML,function(e,n){return new Lt({remoteUrl:e.downloadUrl,nameList:n.nameList,summaryList:n.summaryList,conversationType:n.conversationType,user:n.user,extra:n.extra})});export{N as A,Yt as H,$t as W,en as n,tn as s,Zt as z};
