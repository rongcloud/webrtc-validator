var qn;(function(t){t[t.READ=1]="READ",t[t.LISTENED=2]="LISTENED",t[t.DOWNLOADED=4]="DOWNLOADED",t[t.RETRIEVED=8]="RETRIEVED",t[t.UNREAD=0]="UNREAD"})(qn||(qn={}));var Mn,Yn=qn,to=72e5,Yo=6e4,eo=1e4,jo=131072,Qo=18e4,gi="RCV4-",pi={"RC:TxtMsg":{isCounted:!0,isPersited:!0},"RC:ImgMsg":{isCounted:!0,isPersited:!0},"RC:VcMsg":{isCounted:!0,isPersited:!0},"RC:ImgTextMsg":{isCounted:!0,isPersited:!0,searchProps:["content","title"]},"RC:FileMsg":{isCounted:!0,isPersited:!0},"RC:HQVCMsg":{isCounted:!0,isPersited:!0},"RC:LBSMsg":{isCounted:!0,isPersited:!0},"RC:PSImgTxtMsg":{isCounted:!0,isPersited:!0},"RC:PSMultiImgTxtMsg":{isCounted:!0,isPersited:!0},"RCJrmf:RpMsg":{isCounted:!0,isPersited:!0},"RCJrmf:RpOpendMsg":{isCounted:!0,isPersited:!0},"RC:CombineMsg":{isCounted:!0,isPersited:!0},"RC:ReferenceMsg":{isCounted:!0,isPersited:!0,searchProps:["content"]},"RC:SightMsg":{isCounted:!0,isPersited:!0},"RC:GIFMsg":{isCounted:!0,isPersited:!0},"RC:RLStart":{isCounted:!0,isPersited:!0},"RC:RLEnd":{isCounted:!0,isPersited:!0},"RC:InfoNtf":{isCounted:!1,isPersited:!0},"RC:ContactNtf":{isCounted:!1,isPersited:!0},"RC:ProfileNtf":{isCounted:!1,isPersited:!0},"RC:CmdNtf":{isCounted:!1,isPersited:!0},"RC:GrpNtf":{isCounted:!1,isPersited:!0},"RC:RcCmd":{isCounted:!1,isPersited:!0},"RC:CmdMsg":{isCounted:!1,isPersited:!1},"RC:TypSts":{isCounted:!1,isPersited:!1},"RC:PSCmd":{isCounted:!1,isPersited:!1},"RC:SRSMsg":{isCounted:!1,isPersited:!1},"RC:RRReqMsg":{isCounted:!1,isPersited:!1},"RC:RRRspMsg":{isCounted:!1,isPersited:!1},"RC:CsChaR":{isCounted:!1,isPersited:!1},"RC:CSCha":{isCounted:!1,isPersited:!1},"RC:CsEva":{isCounted:!1,isPersited:!1},"RC:CsContact":{isCounted:!1,isPersited:!1},"RC:CsHs":{isCounted:!1,isPersited:!1},"RC:CsHsR":{isCounted:!1,isPersited:!1},"RC:CsSp":{isCounted:!1,isPersited:!1},"RC:CsEnd":{isCounted:!1,isPersited:!1},"RC:CsUpdate":{isCounted:!1,isPersited:!1},"RC:ReadNtf":{isCounted:!1,isPersited:!1},"RC:chrmKVNotiMsg":{isCounted:!1,isPersited:!1},"RC:VCAccept":{isCounted:!1,isPersited:!1},"RC:VCRinging":{isCounted:!1,isPersited:!1},"RC:VCSummary":{isCounted:!1,isPersited:!1},"RC:VCHangup":{isCounted:!1,isPersited:!1},"RC:VCInvite":{isCounted:!1,isPersited:!1},"RC:VCModifyMedia":{isCounted:!1,isPersited:!1},"RC:VCModifyMem":{isCounted:!1,isPersited:!1},"RC:MsgExMsg":{isCounted:!1,isPersited:!1},"RC:Delivered":{isCounted:!1,isPersited:!1},"RC:RRMsg":{isCounted:!1,isPersited:!1},"RC:LogCmdMsg":{isCounted:!1,isPersited:!1},"RC:InterceptMsg":{isCounted:!1,isPersited:!1},"RC:RLJoin":{isCounted:!1,isPersited:!1},"RC:RLQuit":{isCounted:!1,isPersited:!1},"RC:RL":{isCounted:!1,isPersited:!1}},Wo=["RC:TypSts","RC:InterceptMsg","RC:RL"],Jo="5.8.2-enterprise.4",no=Jo.replace(/-.+$/,""),vu=5368709120,Tu=10485760,pn=function(t){return Mn||(Mn={set:function(n,e){t.localStorage.setItem(n,JSON.stringify(e))},get:function(n){var e;try{e=JSON.parse(t.localStorage.getItem(n))}catch{e=null}return e},remove:function(n){return t.localStorage.removeItem(n)},getKeys:function(){var n=[];for(var e in t.localStorage)n.push(e);return n}}),Mn},Xo=function(){function t(n){this._caches={},n&&(this._caches=n)}return t.prototype.set=function(n,e){this._caches[n]=e},t.prototype.remove=function(n){var e=this.get(n);return delete this._caches[n],e},t.prototype.get=function(n){return this._caches[n]},t.prototype.getKeys=function(){var n=[];for(var e in this._caches)n.push(e);return n},t}(),Xe=function(){function t(n,e){var r,i=e?"".concat(gi).concat(e):gi;this._rootStorage=pn(n);var o=this._rootStorage.get(i)||{};this._cache=new Xo(((r={})[i]=o,r)),this._storageKey=i}return t.prototype._get=function(){var n=this._storageKey;return this._cache.get(n)||{}},t.prototype._set=function(n){var e=this._storageKey;n=n||{},this._cache.set(e,n),this._rootStorage.set(e,n)},t.prototype.set=function(n,e){var r=this._get();r[n]=e,this._set(r)},t.prototype.remove=function(n){var e=this._get();delete e[n],this._set(e)},t.prototype.clear=function(){var n=this._storageKey;this._rootStorage.remove(n),this._cache.remove(n)},t.prototype.get=function(n){return this._get()[n]},t.prototype.getKeys=function(){var n=this._get(),e=[];for(var r in n)e.push(r);return e},t.prototype.getValues=function(){return this._get()||{}},t}(),jn=function(t,n){return jn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},jn(t,n)};function dt(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}jn(t,n),t.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}var Z=function(){return Z=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},Z.apply(this,arguments)};function L(t,n,e,r){return new(e||(e=Promise))(function(i,o){function s(c){try{l(r.next(c))}catch(d){o(d)}}function h(c){try{l(r.throw(c))}catch(d){o(d)}}function l(c){var d;c.done?i(c.value):(d=c.value,d instanceof e?d:new e(function(_){_(d)})).then(s,h)}l((r=r.apply(t,n||[])).next())})}function M(t,n){var e,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function h(l){return function(c){return function(d){if(e)throw new TypeError("Generator is already executing.");for(;o&&(o=0,d[0]&&(s=0)),s;)try{if(e=1,r&&(i=2&d[0]?r.return:d[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,d[1])).done)return i;switch(r=0,i&&(d=[2&d[0],i.value]),d[0]){case 0:case 1:i=d;break;case 4:return s.label++,{value:d[1],done:!1};case 5:s.label++,r=d[1],d=[0];continue;case 7:d=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!((i=i.length>0&&i[i.length-1])||d[0]!==6&&d[0]!==2)){s=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){s.label=d[1];break}if(d[0]===6&&s.label<i[1]){s.label=i[1],i=d;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(d);break}i[2]&&s.ops.pop(),s.trys.pop();continue}d=n.call(t,s)}catch(_){d=[6,_],r=0}finally{e=i=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([l,c])}}}function vt(t,n,e){if(e||arguments.length===2)for(var r,i=0,o=n.length;i<o;i++)!r&&i in n||(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return t.concat(r||Array.prototype.slice.call(n))}var Qn;(function(t){function n(e){return t.call(this,"TODO => ".concat(e))||this}return dt(n,t),n})(Error);var Zo=function(t){for(var n=0,e=0,r=t.length;e<r;e++)n+=t.charCodeAt(e)<=65535?2:4;return n},zo=function(t){for(var n,e=0,r=0,i=t.length;r<i;r++)e+=(n=t.charCodeAt(r))<127?1:n<=2047?2:n<=65535?3:4;return e},$o=function(t,n){if(t=t.replace(/\?$/,""),!n)return t;var e=Object.keys(n).map(function(r){return"".concat(r,"=").concat(n[r])}).filter(function(r){return!!r});return e.length?[t,e.join("&")].join("?"):t};(function(t){t[t.IMAGE=1]="IMAGE",t[t.AUDIO=2]="AUDIO",t[t.VIDEO=3]="VIDEO",t[t.FILE=4]="FILE",t[t.SIGHT=5]="SIGHT",t[t.COMBINE_HTML=6]="COMBINE_HTML"})(Qn||(Qn={}));var Wn,Wt=Qn;(function(t){t[t.SEND=1]="SEND",t[t.RECEIVE=2]="RECEIVE"})(Wn||(Wn={}));var Jn,Ot=Wn;(function(t){t[t.TIMEOUT=-1]="TIMEOUT",t[t.UNKNOWN=-2]="UNKNOWN",t[t.PARAMETER_ERROR=-3]="PARAMETER_ERROR",t[t.EXTRA_METHOD_UNDEFINED=-4]="EXTRA_METHOD_UNDEFINED",t[t.MAIN_PROCESS_ERROR=-5]="MAIN_PROCESS_ERROR",t[t.PARAMETER_CHANGED=-6]="PARAMETER_CHANGED",t[t.SUCCESS=0]="SUCCESS",t[t.SYS_CONVERSATION_NOT_SUPPORT_MESSAGE=20109]="SYS_CONVERSATION_NOT_SUPPORT_MESSAGE",t[t.RC_DISCUSSION_GROUP_ID_INVALID=20407]="RC_DISCUSSION_GROUP_ID_INVALID",t[t.SEND_FREQUENCY_TOO_FAST=20604]="SEND_FREQUENCY_TOO_FAST",t[t.NOT_IN_DISCUSSION=21406]="NOT_IN_DISCUSSION",t[t.FORBIDDEN_IN_GROUP=22408]="FORBIDDEN_IN_GROUP",t[t.RECALL_MESSAGE=25101]="RECALL_MESSAGE",t[t.NOT_IN_GROUP=22406]="NOT_IN_GROUP",t[t.NOT_IN_CHATROOM=23406]="NOT_IN_CHATROOM",t[t.FORBIDDEN_IN_CHATROOM=23408]="FORBIDDEN_IN_CHATROOM",t[t.RC_CHATROOM_USER_KICKED=23409]="RC_CHATROOM_USER_KICKED",t[t.RC_CHATROOM_NOT_EXIST=23410]="RC_CHATROOM_NOT_EXIST",t[t.RC_CHATROOM_IS_FULL=23411]="RC_CHATROOM_IS_FULL",t[t.RC_CHATROOM_PATAMETER_INVALID=23412]="RC_CHATROOM_PATAMETER_INVALID",t[t.CHATROOM_GET_HISTORYMSG_ERROR=23413]="CHATROOM_GET_HISTORYMSG_ERROR",t[t.CHATROOM_NOT_OPEN_HISTORYMSG_STORE=23414]="CHATROOM_NOT_OPEN_HISTORYMSG_STORE",t[t.CHATROOM_KV_EXCEED=23423]="CHATROOM_KV_EXCEED",t[t.CHATROOM_KV_OVERWRITE_INVALID=23424]="CHATROOM_KV_OVERWRITE_INVALID",t[t.CHATROOM_KV_STORE_NOT_OPEN=23426]="CHATROOM_KV_STORE_NOT_OPEN",t[t.CHATROOM_KEY_NOT_EXIST=23427]="CHATROOM_KEY_NOT_EXIST",t[t.CHATROOM_KV_SET_ERROR=23431]="CHATROOM_KV_SET_ERROR",t[t.SENSITIVE_SHIELD=21501]="SENSITIVE_SHIELD",t[t.SENSITIVE_REPLACE=21502]="SENSITIVE_REPLACE",t[t.JOIN_IN_DISCUSSION=21407]="JOIN_IN_DISCUSSION",t[t.CREATE_DISCUSSION=21408]="CREATE_DISCUSSION",t[t.INVITE_DICUSSION=21409]="INVITE_DICUSSION",t[t.GET_USERINFO_ERROR=23407]="GET_USERINFO_ERROR",t[t.REJECTED_BY_BLACKLIST=405]="REJECTED_BY_BLACKLIST",t[t.RC_NET_CHANNEL_INVALID=30001]="RC_NET_CHANNEL_INVALID",t[t.RC_NET_UNAVAILABLE=30002]="RC_NET_UNAVAILABLE",t[t.RC_MSG_RESP_TIMEOUT=30003]="RC_MSG_RESP_TIMEOUT",t[t.RC_HTTP_SEND_FAIL=30004]="RC_HTTP_SEND_FAIL",t[t.RC_HTTP_REQ_FAIL=30005]="RC_HTTP_REQ_FAIL",t[t.RC_HTTP_RECV_FAIL=30006]="RC_HTTP_RECV_FAIL",t[t.RC_NAVI_REQ_FAILED=30007]="RC_NAVI_REQ_FAILED",t[t.RC_NODE_NOT_FOUND=30008]="RC_NODE_NOT_FOUND",t[t.RC_DOMAIN_NOT_RESOLVE=30009]="RC_DOMAIN_NOT_RESOLVE",t[t.RC_SOCKET_NOT_CREATED=30010]="RC_SOCKET_NOT_CREATED",t[t.RC_SOCKET_DISCONNECTED=30011]="RC_SOCKET_DISCONNECTED",t[t.RC_PING_EXCEED_LIMIT=30012]="RC_PING_EXCEED_LIMIT",t[t.RC_MSG_SEND_FAIL=30014]="RC_MSG_SEND_FAIL",t[t.RC_MSG_CONTENT_EXCEED_LIMIT=30016]="RC_MSG_CONTENT_EXCEED_LIMIT",t[t.RC_NETWORK_DOWN=30019]="RC_NETWORK_DOWN",t[t.RC_TCP_DISCONNECTED_NO_RMTP=30021]="RC_TCP_DISCONNECTED_NO_RMTP",t[t.RC_CONN_ACK_TIMEOUT=31e3]="RC_CONN_ACK_TIMEOUT",t[t.RC_CONN_PROTO_VERSION_ERROR=31001]="RC_CONN_PROTO_VERSION_ERROR",t[t.RC_CONN_IDENTIFIER_REJECTED=31002]="RC_CONN_IDENTIFIER_REJECTED",t[t.RC_CONN_SERVER_UNAVAILABLE=31003]="RC_CONN_SERVER_UNAVAILABLE",t[t.RC_CONN_TOKEN_INCORRECT=31004]="RC_CONN_TOKEN_INCORRECT",t[t.RC_CONN_NOT_AUTHRORIZED=31005]="RC_CONN_NOT_AUTHRORIZED",t[t.RC_CONN_REDIRECTED=31006]="RC_CONN_REDIRECTED",t[t.RC_CONN_PACKAGE_NAME_INVALID=31007]="RC_CONN_PACKAGE_NAME_INVALID",t[t.RC_CONN_APP_BLOCKED_OR_DELETED=31008]="RC_CONN_APP_BLOCKED_OR_DELETED",t[t.RC_CONN_USER_BLOCKED=31009]="RC_CONN_USER_BLOCKED",t[t.RC_DISCONN_KICK=31010]="RC_DISCONN_KICK",t[t.RC_DISCONN_EXCEPTION=31011]="RC_DISCONN_EXCEPTION",t[t.RC_CONN_TOKEN_EXPIRED=31020]="RC_CONN_TOKEN_EXPIRED",t[t.RC_CONN_DEVICE_ERROR=31021]="RC_CONN_DEVICE_ERROR",t[t.RC_CONN_HOSTNAME_ERROR=31022]="RC_CONN_HOSTNAME_ERROR",t[t.RC_DISCONN_SAME_CLIENT_ON_LINE=31023]="RC_DISCONN_SAME_CLIENT_ON_LINE",t[t.RC_LISCENSE_COUNT_OUT_OF_LIMIT=31024]="RC_LISCENSE_COUNT_OUT_OF_LIMIT",t[t.RC_CONN_WRONG_CLUSTER=31025]="RC_CONN_WRONG_CLUSTER",t[t.RC_APP_AUTH_NOT_PASS=31026]="RC_APP_AUTH_NOT_PASS",t[t.RC_OTP_USED=31027]="RC_OTP_USED",t[t.RC_PLATFORM_ERROR=31028]="RC_PLATFORM_ERROR",t[t.RC_ACCOUNT_CANCELLATION=31029]="RC_ACCOUNT_CANCELLATION",t[t.RC_LICENSE_EXPIRED=31030]="RC_LICENSE_EXPIRED",t[t.RC_QUERY_ACK_NO_DATA=32001]="RC_QUERY_ACK_NO_DATA",t[t.RC_MSG_DATA_INCOMPLETE=32002]="RC_MSG_DATA_INCOMPLETE",t[t.RC_UDP_DISCONNECTED=32011]="RC_UDP_DISCONNECTED",t[t.RC_TCP_RESET=32054]="RC_TCP_RESET",t[t.BIZ_ERROR_CLIENT_NOT_INIT=33001]="BIZ_ERROR_CLIENT_NOT_INIT",t[t.BIZ_ERROR_DATABASE_ERROR=33002]="BIZ_ERROR_DATABASE_ERROR",t[t.BIZ_ERROR_INVALID_PARAMETER=33003]="BIZ_ERROR_INVALID_PARAMETER",t[t.BIZ_ERROR_NO_CHANNEL=33004]="BIZ_ERROR_NO_CHANNEL",t[t.BIZ_ERROR_RECONNECT_SUCCESS=33005]="BIZ_ERROR_RECONNECT_SUCCESS",t[t.BIZ_ERROR_CONNECTING=33006]="BIZ_ERROR_CONNECTING",t[t.MSG_ROAMING_SERVICE_UNAVAILABLE=33007]="MSG_ROAMING_SERVICE_UNAVAILABLE",t[t.MSG_INSERT_ERROR=33008]="MSG_INSERT_ERROR",t[t.MSG_DEL_ERROR=33009]="MSG_DEL_ERROR",t[t.TAG_EXISTS=33101]="TAG_EXISTS",t[t.TAG_NOT_EXIST=33100]="TAG_NOT_EXIST",t[t.NO_TAG_IN_CONVER=33102]="NO_TAG_IN_CONVER",t[t.RC_CONNECTION_EXIST=34001]="RC_CONNECTION_EXIST",t[t.CONVER_GETLIST_ERROR=34002]="CONVER_GETLIST_ERROR",t[t.CONVER_SETOP_ERROR=34003]="CONVER_SETOP_ERROR",t[t.CONVER_TOTAL_UNREAD_ERROR=34004]="CONVER_TOTAL_UNREAD_ERROR",t[t.CONVER_TYPE_UNREAD_ERROR=34005]="CONVER_TYPE_UNREAD_ERROR",t[t.CONVER_ID_TYPE_UNREAD_ERROR=34006]="CONVER_ID_TYPE_UNREAD_ERROR",t[t.EXPANSION_LIMIT_EXCEET=34010]="EXPANSION_LIMIT_EXCEET",t[t.MESSAGE_KV_NOT_SUPPORT=34008]="MESSAGE_KV_NOT_SUPPORT",t[t.UPLOAD_FAIL=34011]="UPLOAD_FAIL",t[t.CONVER_OUT_LIMIT_ERROR=34013]="CONVER_OUT_LIMIT_ERROR",t[t.CONVER_GET_ERROR=35021]="CONVER_GET_ERROR",t[t.GROUP_SYNC_ERROR=35001]="GROUP_SYNC_ERROR",t[t.GROUP_MATCH_ERROR=35002]="GROUP_MATCH_ERROR",t[t.READ_RECEIPT_ERROR=35003]="READ_RECEIPT_ERROR",t[t.PACKAGE_ENVIRONMENT_ERROR=35006]="PACKAGE_ENVIRONMENT_ERROR",t[t.CAN_NOT_RECONNECT=35007]="CAN_NOT_RECONNECT",t[t.SERVER_UNAVAILABLE=35008]="SERVER_UNAVAILABLE",t[t.HOSTNAME_ERROR=35009]="HOSTNAME_ERROR",t[t.HAS_OHTER_SAME_CLIENT_ON_LINE=35010]="HAS_OHTER_SAME_CLIENT_ON_LINE",t[t.METHOD_NOT_AVAILABLE=35011]="METHOD_NOT_AVAILABLE",t[t.METHOD_NOT_SUPPORT=35012]="METHOD_NOT_SUPPORT",t[t.MSG_LIMIT_ERROR=35013]="MSG_LIMIT_ERROR",t[t.METHOD_ONLY_SUPPORT_ULTRA_GROUP=35014]="METHOD_ONLY_SUPPORT_ULTRA_GROUP",t[t.CHATROOM_ID_ISNULL=36001]="CHATROOM_ID_ISNULL",t[t.CHARTOOM_JOIN_ERROR=36002]="CHARTOOM_JOIN_ERROR",t[t.CHATROOM_HISMESSAGE_ERROR=36003]="CHATROOM_HISMESSAGE_ERROR",t[t.CHATROOM_KV_NOT_FOUND=36004]="CHATROOM_KV_NOT_FOUND",t[t.BLACK_ADD_ERROR=37001]="BLACK_ADD_ERROR",t[t.BLACK_GETSTATUS_ERROR=37002]="BLACK_GETSTATUS_ERROR",t[t.BLACK_REMOVE_ERROR=37003]="BLACK_REMOVE_ERROR",t[t.DRAF_GET_ERROR=38001]="DRAF_GET_ERROR",t[t.DRAF_SAVE_ERROR=38002]="DRAF_SAVE_ERROR",t[t.DRAF_REMOVE_ERROR=38003]="DRAF_REMOVE_ERROR",t[t.SUBSCRIBE_ERROR=39001]="SUBSCRIBE_ERROR",t[t.NOT_SUPPORT=39002]="NOT_SUPPORT",t[t.QNTKN_FILETYPE_ERROR=41001]="QNTKN_FILETYPE_ERROR",t[t.QNTKN_GET_ERROR=41002]="QNTKN_GET_ERROR",t[t.COOKIE_ENABLE=51001]="COOKIE_ENABLE",t[t.HAVNODEVICEID=24001]="HAVNODEVICEID",t[t.DEVICEIDISHAVE=24002]="DEVICEIDISHAVE",t[t.FEILD=24009]="FEILD",t[t.VOIPISNULL=24013]="VOIPISNULL",t[t.NOENGINETYPE=24010]="NOENGINETYPE",t[t.NULLCHANNELNAME=24011]="NULLCHANNELNAME",t[t.VOIPDYANMICERROR=24012]="VOIPDYANMICERROR",t[t.NOVOIP=24014]="NOVOIP",t[t.INTERNALERRROR=24015]="INTERNALERRROR",t[t.VOIPCLOSE=24016]="VOIPCLOSE",t[t.ULTRA_GROUP_USER_NOT_IN_PRIVATE_CHANNEL=24416]="ULTRA_GROUP_USER_NOT_IN_PRIVATE_CHANNEL",t[t.CANCEL=1]="CANCEL",t[t.REJECT=2]="REJECT",t[t.HANGUP=3]="HANGUP",t[t.BUSYLINE=4]="BUSYLINE",t[t.NO_RESPONSE=5]="NO_RESPONSE",t[t.ENGINE_UN_SUPPORTED=6]="ENGINE_UN_SUPPORTED",t[t.NETWORK_ERROR=7]="NETWORK_ERROR",t[t.REMOTE_CANCEL=11]="REMOTE_CANCEL",t[t.REMOTE_REJECT=12]="REMOTE_REJECT",t[t.REMOTE_HANGUP=13]="REMOTE_HANGUP",t[t.REMOTE_BUSYLINE=14]="REMOTE_BUSYLINE",t[t.REMOTE_NO_RESPONSE=15]="REMOTE_NO_RESPONSE",t[t.REMOTE_ENGINE_UN_SUPPORTED=16]="REMOTE_ENGINE_UN_SUPPORTED",t[t.REMOTE_NETWORK_ERROR=17]="REMOTE_NETWORK_ERROR",t[t.VOIP_NOT_AVALIABLE=18]="VOIP_NOT_AVALIABLE",t[t.CHATROOM_KV_STORE_NOT_ALL_SUCCESS=23428]="CHATROOM_KV_STORE_NOT_ALL_SUCCESS",t[t.CHATROOM_KV_STORE_OUT_LIMIT=23429]="CHATROOM_KV_STORE_OUT_LIMIT",t[t.SEARCH_PROPS_LIMIT_ERROR=35022]="SEARCH_PROPS_LIMIT_ERROR",t[t.INVALID_PARAMETER_PROXY=34238]="INVALID_PARAMETER_PROXY",t[t.INVALID_PARAMETER_TESTHOST=34239]="INVALID_PARAMETER_TESTHOST",t[t.INVALID_CONNECT_TESTHOST_FAILED=34240]="INVALID_CONNECT_TESTHOST_FAILED",t[t.RC_CONN_PROXY_UNAVAILABLE=35028]="RC_CONN_PROXY_UNAVAILABLE",t[t.PROXY_UNAVAILABLE=17]="PROXY_UNAVAILABLE"})(Jn||(Jn={}));var Xn,R=Jn;(function(t){t[t.NONE=0]="NONE",t[t.PRIVATE=1]="PRIVATE",t[t.DISCUSSION=2]="DISCUSSION",t[t.GROUP=3]="GROUP",t[t.CHATROOM=4]="CHATROOM",t[t.CUSTOMER_SERVICE=5]="CUSTOMER_SERVICE",t[t.SYSTEM=6]="SYSTEM",t[t.APP_PUBLIC_SERVICE=7]="APP_PUBLIC_SERVICE",t[t.PUBLIC_SERVICE=8]="PUBLIC_SERVICE",t[t.ULTRA_GROUP=10]="ULTRA_GROUP",t[t.RTC_ROOM=12]="RTC_ROOM"})(Xn||(Xn={}));var fi,B=Xn;(function(t){t[t.CONNECTED=0]="CONNECTED",t[t.CONNECTING=1]="CONNECTING",t[t.DISCONNECTED=2]="DISCONNECTED",t[t.NETWORK_UNAVAILABLE=3]="NETWORK_UNAVAILABLE",t[t.CONNECTION_CLOSED=4]="CONNECTION_CLOSED",t[t.KICKED_OFFLINE_BY_OTHER_CLIENT=6]="KICKED_OFFLINE_BY_OTHER_CLIENT",t[t.WEBSOCKET_UNAVAILABLE=7]="WEBSOCKET_UNAVAILABLE",t[t.WEBSOCKET_ERROR=8]="WEBSOCKET_ERROR",t[t.BLOCKED=9]="BLOCKED",t[t.DOMAIN_INCORRECT=12]="DOMAIN_INCORRECT",t[t.DISCONNECT_BY_SERVER=13]="DISCONNECT_BY_SERVER",t[t.REDIRECT=14]="REDIRECT",t[t.USER_LOGOUT=19]="USER_LOGOUT",t[t.APPKEY_IS_FAKE=20]="APPKEY_IS_FAKE",t[t.FORBID_RECONNECT_BY_OTHER_SAME_CLIENT=31023]="FORBID_RECONNECT_BY_OTHER_SAME_CLIENT",t[t.ULTRALIMIT=1101]="ULTRALIMIT",t[t.REQUEST_NAVI=201]="REQUEST_NAVI",t[t.RESPONSE_NAVI=202]="RESPONSE_NAVI",t[t.RESPONSE_NAVI_ERROR=203]="RESPONSE_NAVI_ERROR",t[t.RESPONSE_NAVI_TIMEOUT=204]="RESPONSE_NAVI_TIMEOUT",t[t.RC_LICENSE_EXPIRED=31030]="RC_LICENSE_EXPIRED",t[t.RC_CONN_USER_OR_PASSWD_ERROR=31004]="RC_CONN_USER_OR_PASSWD_ERROR"})(fi||(fi={}));var Zn;(function(t){t.TextMessage="RC:TxtMsg",t.VOICE="RC:VcMsg",t.HQ_VOICE="RC:HQVCMsg",t.IMAGE="RC:ImgMsg",t.GIF="RC:GIFMsg",t.RICH_CONTENT="RC:ImgTextMsg",t.LOCATION="RC:LBSMsg",t.FILE="RC:FileMsg",t.SIGHT="RC:SightMsg",t.COMBINE="RC:CombineMsg",t.CHRM_KV_NOTIFY="RC:chrmKVNotiMsg",t.LOG_COMMAND="RC:LogCmdMsg",t.EXPANSION_NOTIFY="RC:MsgExMsg",t.REFERENCE="RC:ReferenceMsg",t.RECALL="RC:RcCmd",t.RECALL_NOTIFICATION_MESSAGE="RC:RcNtf",t.READ_RECEIPT="RC:ReadNtf",t.READ_RECEIPT_REQUEST="RC:RRReqMsg",t.READ_RECEIPT_RESPONSE="RC:RRRspMsg",t.SYNC_READ_STATUS="RC:SRSMsg",t.GROUP_READ_RECEIPT_REQUEST="RC:RRMsg",t.DELIVERED="RC:Delivered",t.DELIVERED_MSG="RC:DRMsg",t.CHATROOM_JOIN="RC:ChrmJoinNtf",t.CHATROOM_LEFT="RC:ChrmQuitNtf",t.CHATROOM_MERGE_CHANGE="RC:ChrmMemChange",t.CHATROOM_SYNC_MSG="RC:ChrmSyncMsg",t.CHATROOM_MERGE_BLOCK="RC:ChrmBlockMsg",t.CHATROOM_MERGE_BAN="RC:ChrmBanMsg",t.TYPING_STATUS="RC:TypSts",t.INTERCEPT="RC:InterceptMsg"})(Zn||(Zn={}));var zn,nt=Zn;(function(t){t[t.OPEN=1]="OPEN",t[t.CLOSE=2]="CLOSE"})(zn||(zn={}));var $n,Rt=zn;(function(t){t[t.ALL_MESSAGE=-1]="ALL_MESSAGE",t[t.NOT_SET=0]="NOT_SET",t[t.AT_MESSAGE_NOTIFICATION=1]="AT_MESSAGE_NOTIFICATION",t[t.AT_USER_NOTIFICATION=2]="AT_USER_NOTIFICATION",t[t.AT_GROUP_ALL_USER_NOTIFICATION=4]="AT_GROUP_ALL_USER_NOTIFICATION",t[t.NOT_MESSAGE_NOTIFICATION=5]="NOT_MESSAGE_NOTIFICATION"})($n||($n={}));var tr,Ht=$n;(function(t){t[t.ALL=1]="ALL",t[t.SINGAL=2]="SINGAL"})(tr||(tr={}));var er,me=tr;(function(t){t[t.QINIU=1]="QINIU",t[t.ALI=2]="ALI",t[t.AWS=3]="AWS",t[t.STC=4]="STC",t[t.MINIO=5]="MINIO"})(er||(er={}));var nr,te=er;(function(t){t[t.UPDATE=1]="UPDATE",t[t.DELETE=2]="DELETE"})(nr||(nr={}));var Bt,_i,P,wt,rr,Ct=nr;(function(t){t[t.LOG=0]="LOG",t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t[t.FATAL=4]="FATAL",t[t.STATISTICS=6]="STATISTICS",t[t.NONE=1e3]="NONE"})(Bt||(Bt={})),function(t){t.IM="IM",t.RTC="RTC"}(_i||(_i={})),function(t){t.L_IMSDK_VER_O="L-imsdk_ver-O",t.A_INIT_O="A-init-O",t.A_INIT_REPEAT_O="A_INIT_REPEAT_O",t.L_INIT_O="L-init-O",t.A_DESTROY_O="A_DESTROY_O",t.L_DESTROY_O="L_DESTROY_O",t.A_CONNECT_T="A-connect-T",t.A_CONNECT_R="A-connect-R",t.A_CONNECT_S="A-connect-S",t.A_DISCONNECT_O="A-disconnect-O",t.A_RECONNECT_T="A-reconnect-T",t.A_RECONNECT_R="A_RECONNECT_R",t.L_CONNECT_T="L-connect-T",t.L_CONNECT_R="L-connect-R",t.L_CONNECT_S="L-connect-S",t.L_NOTIFY_ULTRA_ONLINE_S="L-notify-ultra-online-S",t.L_ULTRA_SYNC_DONE_S="L-ultra-sync-done-S",t.L_BATCH_MESSAGE_O="L-BATCH_MESSAGE-O",t.A_MSG_LISTENER_E="A-MSG_LISTENER-E",t.O="L-original-O",t.T="L-TEST-O",t.L_INSTALL_PLUGIN_T="L-INSTALL_PLUGIN-T",t.L_INSTALL_PLUGIN_R="L-INSTALL_PLUGIN-R",t.L_NAVI_CONF_E="L-NAVI_CONF_ERROR-E",t.A_SEND_MSG_T="A-send_msg-T",t.A_SEND_MSG_R="A-send_msg-R",t.L_SEND_MSG_T="L-send_msg-T",t.L_SEND_MSG_R="L-send_msg-R",t.L_PULL_MSG_T="L-pull_msg-T",t.L_PULL_MSG_R="L-pull_msg-R",t.L_PULL_MSG_O="L-pull_msg-O",t.L_PULL_ULTRA_MSG_T="L-pull_ultra_msg-T",t.L_PULL_ULTRA_MSG_R="L-pull_ultra_msg-R",t.L_PULL_CHATROOM_KV_T="L-pull_chatroom_kv-T",t.L_PULL_CHATROOM_KV_R="L-pull_chatroom_kv-R",t.L_PULL_CHATROOM_MSG_T="L-pull_chatroom_msg-T",t.L_PULL_CHATROOM_MSG_R="L-pull_chatroom_msg-R",t.L_RECV_MULTI_SYNC_MSG_O="L-recv_multi_sync_msg-O",t.L_RECV_S_MSG_O="L-recv_s_msg-O",t.A_DELETE_MESSAGES_S="A-delete_messages-S",t.P_DELETE_MSG_S="P-delete_msg-S",t.L_PULL_CONVERSATION_S="L-pull_conversation-S",t.L_RECALL_ULTRA_MSG_S="L-recall_ultra_msg-S",t.A_REGTYP_O="A-regtyp-O",t.P_REGTYP_E="P-regtype-E",t.L_GET_NAVI_T="L-get_navi-T",t.L_GET_NAVI_R="L-get_navi-R",t.L_REQUEST_T="L-request-T",t.L_REQUEST_R="L-request-R",t.L_PARSE_NAVI_E="L-parse_navi-E",t.L_ENV_S="L-Env-S",t.L_GET_INDEX_NAVI_S="L-get_index_navi-S",t.A_JOIN_CHATROOM_T="A-join_chatroom-T",t.A_JOIN_CHATROOM_R="A-join_chatroom-R",t.L_JOIN_CHATROOM_T="L-join_chatroom-T",t.L_JOIN_CHATROOM_R="L-join_chatroom-R",t.A_QUIT_CHATROOM_T="A-quit_chatroom-T",t.A_QUIT_CHATROOM_R="A-quit_chatroom-R",t.L_REJOIN_CHATROOM_T="L-rejoin_chatroom-T",t.L_REJOIN_CHATROOM_R="L-rejoin_chatroom-R",t.L_REJOIN_CHATROOM_S="L-rejoin_chatroom-S",t.L_MEDIA_S="L-media-S",t.L_MEDIA_UPLOAD_T="L-media_upload-T",t.L_MEDIA_UPLOAD_R="L-media_upload-R",t.G_UPLOAD_LOG_S="G-upload_log-S",t.G_REPORT_LOG_S="G-report_log-S",t.G_UPLOAD_LOG_E="G-upload_log-E",t.G_GET_REAL_TIMELOG_COMMAND_S="G-get_real_timelog_command-S",t.L_CHECK_ALIVE_IM_T="L-check_alive_im-T",t.L_CHECK_ALIVE_IM_R="L-check_alive_im-R",t.L_CHECK_ALIVE_IM_S="L-check_alive_im-S",t.A_GET_HISTORY_MSG_T="A-get_history_msg-T",t.A_GET_HISTORY_MSG_R="A-get_history_msg-R",t.L_GET_HISTORY_MSG_T="L-get_history_msg-T",t.L_GET_HISTORY_MSG_R="L-get_history_msg-R",t.A_GET_PRIVATE_MESSAGE_DELIVER_TIME_E="A-get_privage_message_deliver_time-E",t.A_GET_GROUP_MESSAGE_DELIVER_LIST_E="A-get_group_message_deliver_list-E",t.A_CALLBACK_O="A-callback-O",t.A_CALLBACK_E="A-callback-E",t.L_CALLBACK_E="L-callback-E",t.A_GET_TOP_CONVERSATION_LIST_E="A-get_top_conversation_list-E",t.L_PB_ENCODE_E="L-pb-encode-E",t.L_PB_DECODE_E="L-pb-decode-E",t.L_NOTIFY_NAVI_CHANGE_E="L-notify_navi_change-E",t.L_REPORT_FULL_LOG_O="L-report_full_log-O",t.L_REPORT_FULL_LOG_T="L-report_full_log-T",t.L_REPORT_FULL_LOG_R="L-report_full_log-R",t.L_REPORT_LOG_POLICY_E="L-parse_navi_logpolicy-E",t.L_UNSUPPORT_INDEXDB_O="L-unsupport_IndexDB-O",t.L_LOGDB_OPEN_FAILED_E="L-logDB_open_failed-E",t.L_LOGDB_CLOSED_S="L-logDB_closed-S",t.L_LOGDB_ERROR_E="L-logDB_error-S",t.L_LOGDB_ABORT_S="L-logDB_abort-S",t.L_REALTIME_LOG_R="L_REALTIME_LOG_R",t.L_REALTIME_LOG_O="L_REALTIME_LOG_O",t.L_REALTIME_LOG_T="L_REALTIME_LOG_T",t.L_UNKNOWN_TOPIC_E="L_UNKNOWN_TOPIC_E",t.L_RECV_RMTP_O="L_RECV_RMTP_O",t.L_RECV_RMTP_E="L_RECV_RMTP_E",t.L_RECV_S_NTF_O="L-recv_s_ntf_O",t.L_VER_REPORT_T="L-VER_REPORT-T",t.L_VER_REPORT_R="L-VER_REPORT-R",t.L_CALL_MAIN_SYNC_O="L_CALL_MAIN_SYNC_O",t.L_UNSUPPORT_NTF_FROM_MAIN_E="L_UNSUPPORT_NTF_FROM_MAIN_E",t.A_SET_MSG_CONTENT_O="A_SET_MSG_CONTENT_O",t.A_REMOVE_PROXY_O="A-remove_proxy-O",t.A_SET_PROXY_O="A-set_proxy-O",t.A_TEST_PROXY_O="A-test_proxy-O",t.L_WEBSOCKET_DISACCORD_E="L-websocket_disaccord-e",t.A_SEARCH_MESSAGE_BY_USER_T="A-search_messages_by_user-T",t.A_SEARCH_MESSAGE_BY_USER_R="A-search_messages_by_user-R",t.L_PARSE_JSON_MSGS_E="L-parse_json_messsages-E",t.L_PARSE_JSON_E="L-parse_json-E"}(P||(P={})),function(t){t.IM_NAVI="IM-stats_navi-S",t.IM_WEBSOCKET="IM-stats_websocket-S",t.IM_CONNECTION_DURATION="IM-stats_con_dur-S",t.IM_CMP="IM-stats_cmp-S",t.IM_CMP_RMTP="IM-stats_cmp_rmtp-S",t.IM_STATS_CS="IM-stats_cs-S",t.IM_NETWORK_CHANGE="IM-stats_network_change-S"}(wt||(wt={})),function(t){t[t.QUIT=0]="QUIT",t[t.JOIN=1]="JOIN"}(rr||(rr={}));var Ei,Ze,vi=rr;(function(t){t[t.GLOBAL=1]="GLOBAL",t[t.CUSTOM=2]="CUSTOM",t[t.THIRD_PARTY=3]="THIRD_PARTY"})(Ei||(Ei={})),function(t){t[t.MSG_ORIGINAL=0]="MSG_ORIGINAL",t[t.MSG_EXPANSION=1]="MSG_EXPANSION",t[t.MSG_MODIFY=2]="MSG_MODIFY"}(Ze||(Ze={}));var Ti;(function(t){t[t.typing=0]="typing"})(Ti||(Ti={}));var ce,mi;(function(t){t[t.SENDING=10]="SENDING",t[t.FAILED=20]="FAILED",t[t.SENT=30]="SENT",t[t.RECEIVED=40]="RECEIVED",t[t.READ=50]="READ",t[t.DESTROYED=60]="DESTROYED"})(ce||(ce={})),function(t){t[t.QUIT=0]="QUIT",t[t.JOIN=1]="JOIN"}(mi||(mi={}));var yi;(function(t){t[t.Deblock=0]="Deblock",t[t.Blocked=1]="Blocked"})(yi||(yi={}));var Ii;(function(t){t[t.UnmuteUsers=0]="UnmuteUsers",t[t.MuteUsers=1]="MuteUsers",t[t.UnmuteAll=2]="UnmuteAll",t[t.MuteAll=3]="MuteAll",t[t.RemoveWhitelist=4]="RemoveWhitelist",t[t.AddWhitelist=5]="AddWhitelist",t[t.UnmuteGloble=6]="UnmuteGloble",t[t.MuteGloble=7]="MuteGloble"})(Ii||(Ii={}));var Ci;(function(t){t[t.LeaveOnMyOwn=0]="LeaveOnMyOwn",t[t.OtherDeviceLogin=1]="OtherDeviceLogin"})(Ci||(Ci={}));var Ri,Si,kt,pe,Ut,Kt,qt,fe,Oi,ye,ze,Ie,$e,ee,ir,Ni,Mi;(function(t){t.PASSIVE="passive",t.ACTIVE="active",t.TIME_SENSITIVE="time-sensitive",t.CRITICAL="critical"})(Ri||(Ri={})),function(t){t.NAVI="rc-navi",t.REALTIME_LOG_TIMESTAMP="rc-realtime-log-timestamp"}(Si||(Si={})),function(t){t[t.PUBLIC=0]="PUBLIC",t[t.PRIVATE=1]="PRIVATE"}(kt||(kt={})),function(t){t[t.PUBLIC_TO_PRIVATE=2]="PUBLIC_TO_PRIVATE",t[t.PRIVATE_TO_PUBLIC=3]="PRIVATE_TO_PUBLIC",t[t.PUBLIC_TO_PRIVATE_USER_NOT_IN=6]="PUBLIC_TO_PRIVATE_USER_NOT_IN"}(pe||(pe={})),function(t){t[t.MSG_EXPANSION=1]="MSG_EXPANSION",t[t.MSG_MODIFY=2]="MSG_MODIFY",t[t.MSG_RECALL=3]="MSG_RECALL",t[t.CHANNEL_CHANGE=4]="CHANNEL_CHANGE",t[t.USER_GROUP_CHANGE=5]="USER_GROUP_CHANGE"}(Ut||(Ut={})),function(t){t[t.CHANNEL_DELETE=1]="CHANNEL_DELETE",t[t.PUBLIC_TO_PRIVATE=2]="PUBLIC_TO_PRIVATE",t[t.PRIVATE_TO_PUBLIC=3]="PRIVATE_TO_PUBLIC",t[t.PRIVATE_CHANNEL_USER_JOIN_PUBLIC=4]="PRIVATE_CHANNEL_USER_JOIN_PUBLIC",t[t.CHANNEL_USER_KICKED=5]="CHANNEL_USER_KICKED",t[t.PUBLIC_TO_PRIVATE_USER_NOT_IN=6]="PUBLIC_TO_PRIVATE_USER_NOT_IN"}(Kt||(Kt={})),function(t){t[t.REMOVE_USER_GROUP=1]="REMOVE_USER_GROUP",t[t.JOIN_USER_GROUP=2]="JOIN_USER_GROUP",t[t.EXIT_USER_GROUP=3]="EXIT_USER_GROUP",t[t.CHANNEL_BIND_USER_GROUP=4]="CHANNEL_BIND_USER_GROUP",t[t.CHANNEL_UNBIND_USER_GROUP=5]="CHANNEL_UNBIND_USER_GROUP"}(qt||(qt={})),function(t){t[t.NOT_MENTIONED=0]="NOT_MENTIONED",t[t.ALL=1]="ALL",t[t.ME=2]="ME"}(fe||(fe={})),function(t){t[t.PRIVATE=1]="PRIVATE",t[t.OPEN=0]="OPEN"}(Oi||(Oi={})),function(t){t[t.NAVI=1]="NAVI",t[t.TCP=2]="TCP",t[t.WS=3]="WS"}(ye||(ye={})),function(t){t[t.REQUEST=0]="REQUEST",t[t.LOCAL=1]="LOCAL"}(ze||(ze={})),function(t){t[t.CURRENT=2]="CURRENT"}(Ie||(Ie={})),function(t){t[t.CONNECT=0]="CONNECT",t[t.RECONNECT=1]="RECONNECT"}($e||($e={})),function(t){t[t.CONNECT=0]="CONNECT",t[t.RECONNECT=1]="RECONNECT",t[t.REDIRECTED=3]="REDIRECTED",t[t.TIMEOUT=4]="TIMEOUT"}(ee||(ee={})),function(t){t[t.RTC=0]="RTC",t[t.LIVE=2]="LIVE",t[t.SIP=4]="SIP",t[t.CALL=5]="CALL",t[t.MEETING=6]="MEETING",t[t.CROSS_MUTI=7]="CROSS_MUTI",t[t.CROSS_LIVE=8]="CROSS_LIVE"}(ir||(ir={})),function(t){t[t.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",t[t.AUDIO=1]="AUDIO"}(Ni||(Ni={})),function(t){t[t.ANCHOR=1]="ANCHOR",t[t.AUDIENCE=2]="AUDIENCE"}(Mi||(Mi={}));var Li,Ui,Ai;(function(t){t[t.ROOM=1]="ROOM",t[t.PERSON=2]="PERSON"})(Li||(Li={})),function(t){t[t.AnchorToViewer=1]="AnchorToViewer",t[t.ViewerToAnchor=2]="ViewerToAnchor"}(Ui||(Ui={})),function(t){t[t.KICK=0]="KICK",t[t.REFUSE=1]="REFUSE",t[t.COEXIST=2]="COEXIST"}(Ai||(Ai={}));var Lt=function(t){return typeof t=="string"},mu=function(t){return typeof t=="boolean"},Ce=function(t){return typeof t=="number"&&!Number.isNaN(t)},fn=function(t){return Object.prototype.toString.call(t).indexOf("Array")!==-1},wi=function(t){return Object.prototype.toString.call(t)==="[object ArrayBuffer]"},ts=function(t){return Lt(t)&&t.length>0},yu=function(t){return fn(t)&&t.length>0},It=function(t){return Object.prototype.toString.call(t)==="[object Object]"},tn=function(t){return Object.prototype.toString.call(t)==="[object Function]"},ot=function(t){return t===void 0||Object.prototype.toString.call(t)==="[object Undefined]"},en=function(t){return Lt(t)&&/https?:\/\//.test(t)},re=function(t){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n))return!0;return!1},es=function(t){return Ce(t)&&Object.prototype.hasOwnProperty.call(B,t)},bi=function(t){var n=!1;return Lt(t)&&!/_/g.test(t)&&t.length<=20&&(n=!0),n},Ln=function(t){var n=!1,e=!1,r=!1;if(It(t)){var i=Object.keys(t).length;for(var o in n=i>20,t)if(e||(e=Lt(o)&&!/^[A-Za-z0-9_=+-]+$/.test(o)),!r){var s=t[o];r=o.length>32||s.length>4096}}return{isExceedLimit:n,isIllgalEx:e,isExKeyOrValLengthExceedLimit:r}},ro=function(){function t(){this._map={}}return t.prototype.on=function(n,e,r){var i=this._map[n]||(this._map[n]=[]);i.some(function(o){return o.listener===e&&o.target===r})||i.push({listener:e,target:r})},t.prototype.once=function(n,e,r){var i=this._map[n]||(this._map[n]=[]);i.some(function(o){return o.listener===e&&o.target===r})||i.push({listener:e,target:r,once:!0})},t.prototype.off=function(n,e,r){var i=this._map[n];i&&((i=i.filter(function(o){return o.listener!==e||o.target!==r})).length?this._map[n]=i:delete this._map[n])},t.prototype.emit=function(n){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=this._map[n];if(i)for(var o=i.length-1;o>=0;o-=1){var s=i[o],h=s.target,l=s.once,c=s.listener;l&&i.splice(o,1);try{c.call.apply(c,vt([h],e,!1))}catch(d){console==null||console.error(d)}}},t.prototype.removeAll=function(n){delete this._map[n]},t.prototype.clear=function(){Object.keys(this._map).forEach(this.removeAll,this)},t}(),Ke=typeof window<"u"&&window?(window.__RCVersionInfo||(window.__RCVersionInfo={}),window.__RCVersionInfo):{};Ke.engine="5.8.2-enterprise.4";var io=function(){function t(){}return t.add=function(n,e){Ke[n]=e},t.validEngine=function(n){var e=n.match(/\d+\.\d+\.\d+/);if(!e)return!1;var r=e[0].split(".").map(function(i){return i.padStart(3,"0")}).join("");return Ke.engine.match(/\d+\.\d+\.\d+/)[0].split(".").map(function(i){return i.padStart(3,"0")}).join("")>=r},t.getInfo=function(){return Ke},t}(),or=null;function le(t,n,e,r){e===void 0&&(e={});var i=["error","warn","info","debug"][3-t];if(or&&t<Bt.FATAL)try{var o=JSON.stringify(e);or[i](n,o)}catch(s){console.error(s)}}var Nt,St,ns=le.bind(null,Bt.DEBUG),rs=le.bind(null,Bt.INFO),is=le.bind(null,Bt.WARN),os=le.bind(null,Bt.ERROR),ss=le.bind(null,Bt.FATAL),Iu=Object.freeze({__proto__:null,init:function(t){or=t},log:le,debug:ns,info:rs,warn:is,error:os,fatal:ss}),Tr=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=16*Math.random()|0;return(t==="x"?n:3&n|8).toString(16)})},mr=function(){var t=Tr();if(t="".concat(t.replace(/-/g,""),"a"),t=function(r){var i="0123456789abcdefghigklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZa0".split(""),o=i.length+1,s=+r,h=[];do{var l=s%o;s=(s-l)/o,h.unshift(i[l])}while(s);return h.join("")}(t=parseInt(t,16)),t.length>22&&(t=t.slice(0,22)),t.length<22)for(var n=22-t.length,e=0;e<n;e++)t+="0";return t};(function(t){t[t.STRING=0]="STRING",t[t.ONLY_STRING=1]="ONLY_STRING",t[t.NUMBER=2]="NUMBER",t[t.BOOLEAN=3]="BOOLEAN",t[t.OBJECT=4]="OBJECT",t[t.ARRAY=5]="ARRAY",t[t.CALLBACK=6]="CALLBACK",t[t.CHANNEL_ID=7]="CHANNEL_ID",t[t.CONVERSATION=8]="CONVERSATION"})(St||(St={}));var nn,as=((Nt={})[St.STRING]=ts,Nt[St.ONLY_STRING]=Lt,Nt[St.NUMBER]=Ce,Nt[St.BOOLEAN]=function(t){return typeof t=="boolean"},Nt[St.OBJECT]=It,Nt[St.ARRAY]=fn,Nt[St.CALLBACK]=function(t){var n=!0;return It(t)||(n=!1),(t=t||{}).onSuccess&&!tn(t.onSuccess)&&(n=!1),t.onError&&!tn(t.onError)&&(n=!1),n},Nt[St.CHANNEL_ID]=bi,Nt[St.CONVERSATION]=function(t){var n=!0;return It(t)||(n=!1),Lt(t.targetId)||(n=!1),es(t.conversationType)||(n=!1),ot(t.channelId)||bi(t.channelId)||(n=!1),n},Nt),us=function(t){function n(e){var r=t.call(this,e)||this;return r.name="RCAssertError",r}return dt(n,t),n}(Error),Cu=function(t,n,e,r){if(r===void 0&&(r=!1),!cs(t,n,e,r))throw new us("'".concat(t,"' is invalid: ").concat(JSON.stringify(n)))},cs=function(t,n,e,r){r===void 0&&(r=!1),e=as[e]||e;var i=r?e(n):ot(n)||n==null||e(n);return i||console===null||console===void 0||console.error("'".concat(t,"' is invalid: ").concat(JSON.stringify(n))),i};(function(t){t.ALIYUN="aliyun",t.S3="s3",t.STC="stc",t.MINIO="minio",t.QINIU="qiniu",t.BAIDU="baidu",t.RCX="rcx"})(nn||(nn={}));var be,sr,ar,Pi,ut=function(t){if(!It(t)||t.low===void 0||t.high===void 0)return t;var n=t.low;return n<0&&(n+=4294967296),n=n.toString(16),parseInt(t.high.toString(16)+"00000000".replace(new RegExp("0{".concat(n.length,"}$")),n),16)},ls=function(t,n){var e=Math.floor(1e3*Math.random()%1e4),r=Tr(),i=function(l){l=l||"-";var c=new Date,d=c.getFullYear(),_=c.getMonth()+1,v=c.getDate();return"".concat(d).concat(l).concat(_).concat(l).concat(v)}(),o=new Date().getTime(),s="";if(n){var h=n.split(".");s=".".concat(h[h.length-1])}return"".concat(t,"__RC-").concat(i,"_").concat(e,"_").concat(o).concat(r).concat(s)},hs=function(t,n){t===void 0&&(t={}),n===void 0&&(n={});var e=t.threadId,r=t.apnsCollapseId,i=t.category,o=t.richMediaUri,s=t.interruptionLevel,h=n.channelIdMi,l=n.channelIdHW,c=n.channelIdOPPO,d=n.typeVivo,_=n.googleConfig,v=n.miLargeIconUrl,I=n.importanceHW,T=n.categoryHW,a=n.imageUrlHW,u=n.categoryVivo,p={};p["thread-id"]=e||"",p["apns-collapse-id"]=r||"",p.category=i||"",p.richMediaUri=o||"",p["interruption-level"]=s||"active";var f={};f.collapse_key=_==null?void 0:_.collapseKey,f.imageUrl=_==null?void 0:_.imageUrl;var E=_==null?void 0:_.priority;E&&!["high","normal"].includes(E)&&(E="normal"),f.priority=E;var m=[{HW:{channelId:l||"",importance:I||"NORMAL",image:a||"",category:T||""}},{MI:{channelId:h||"",large_icon_uri:v||""}},{OPPO:{channelId:c||""}},{VIVO:{classification:d||"",category:u||""}},{APNS:p},{FCM:f}];return JSON.stringify(m)},ds=function(t,n,e){var r={},i={notificationId:e||""};if(!n)return{iOSConfig:r,androidConfig:i};try{var o=JSON.parse(n);o==null||o.forEach(function(s){var h,l,c,d,_,v,I,T,a,u=Object.keys(s);if(u.length!==0){var p=u[0];switch(p){case"HW":return i.channelIdHW=(h=s[p])===null||h===void 0?void 0:h.channelId,i.importanceHW=(l=s[p])===null||l===void 0?void 0:l.importance,i.imageUrlHW=(c=s[p])===null||c===void 0?void 0:c.image,void(i.categoryHW=(d=s[p])===null||d===void 0?void 0:d.category);case"MI":return i.channelIdMi=(_=s[p])===null||_===void 0?void 0:_.channelId,void(i.miLargeIconUrl=(v=s[p])===null||v===void 0?void 0:v.large_icon_uri);case"OPPO":return void(i.channelIdOPPO=(I=s[p])===null||I===void 0?void 0:I.channelId);case"VIVO":return i.typeVivo=(T=s[p])===null||T===void 0?void 0:T.classification,void(i.categoryVivo=(a=s[p])===null||a===void 0?void 0:a.category);case"APNS":return r.threadId=s[p]["thread-id"],r.apnsCollapseId=s[p]["apns-collapse-id"],r.category=s[p].category,r.richMediaUri=s[p].richMediaUri,void(r.interruptionLevel=s[p]["interruption-level"]);case"FCM":i.googleConfig={collapseKey:s[p].collapse_key||"",imageUrl:s[p].imageUrl||"",priority:s[p].priority||""}}}})}catch{t.error(P.O,"Wrong format for pushConfigs field! content: ".concat(n))}return{iOSConfig:r,androidConfig:i}},Jt=function(t){var n=/^[A-Za-z0-9_=+-]+$/.test(t),e=t.length;return n&&e<=128&&e>=1},Un=function(t){var n=t.length;return n<=4096&&n>=1},Di=(be=0,function(){var t=((4294967295&Date.now())>>>0).toString(2),n=Math.floor(Math.random()*(Math.pow(2,20)-1)),e=t+be.toString(2).padStart(11,"0")+n.toString(2).padStart(20,"0");return be=2047&++be,parseInt(e,2)}),rn=function(){var t=io.getInfo(),n="electron";for(var e in t)e!=="engine"&&(n=["imlib-v2-adapter","imlib-v4-adapter","imlib-next"].includes(e)?e:"electron");return n},Vi=function(t,n){if(!t)return"";var e=t.ossConfig,r=e===void 0?"":e,i="";try{var o=JSON.parse(r);if(o.length>0){var s=o.find(function(h){return h[nn.MINIO]});s&&(i=s[nn.MINIO])}}catch(h){n.warn(P.L_PARSE_JSON_E,JSON.stringify({ossConfig:r,error:h}))}return i};(function(t){t.GET="GET",t.POST="POST",t.PUT="PUT"})(sr||(sr={})),function(t){t.WIFI="wifi",t.FOUR_G="4g",t.THREE_G="3g",t.TWO_G="2g",t.FIVE_G="2g",t.THREE_GENT="3gnet",t.UNKONWN="unknown"}(ar||(ar={})),function(t){t[t.add=1]="add",t[t.update=2]="update",t[t.delete=3]="delete"}(Pi||(Pi={}));var gs=function(){var t=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest;return typeof XMLHttpRequest<"u"&&t?new XMLHttpRequest:typeof XDomainRequest<"u"?new XDomainRequest:new ActiveXObject("Microsoft.XMLHTTP")};function Ru(t){var n=t.method||sr.GET,e=t.timeout||Yo,r=t.headers,i=t.query,o=t.body,s=t.onProgress,h=$o(t.url,i),l=gs(),c=Object.prototype.toString.call(l)==="[object XDomainRequest]";if(l.open(n,h),r&&l.setRequestHeader)for(var d in r)l.setRequestHeader(d,r[d]);return c?function(_,v,I){return new Promise(function(T){v!==0&&(_.timeout=v),_.onload=function(){T({data:_.responseText,status:_.status||200})},_.onerror=function(){T({status:_.status})},_.ontimeout=function(){T({status:_.status})};var a=typeof I=="object"?JSON.stringify(I):I;_.send(a)})}(l,e,o):function(_,v,I,T){return new Promise(function(a){_.onreadystatechange=function(){_.readyState===4&&a({data:_.responseText,status:_.status,xhr:_})},_.onerror=function(){a({status:_.status})},T&&(_.upload.onprogress=function(u){return T(u)}),v!==0&&setTimeout(function(){_.abort(),a({status:_.status})},v),_.send(I)})}(l,e,o,s)}var ct,F,mt=function(t,n,e){var r=e==null?void 0:e.isReverse;It(t)&&function(){for(var i in t)n(t[i],i,t)}(),(fn(t)||Lt(t))&&function(){if(r)for(var i=t.length-1;i>=0;i--)n(t[i],i);else for(var o=0,s=t.length;o<s;o++)n(t[o],o)}()},Pe=function(t,n){return mt(t,function(e,r){t[r]=n(e,r)}),t},ps=function(t,n){if(t.indexOf)return t.indexOf(n);var e=-1;return mt(t,function(r,i){n===r&&(e=i)}),e},fs=function(t,n){var e=[];return mt(t,function(r){e.push(r)}),ps(e,n)!==-1},_e=function(t){return JSON.parse(JSON.stringify(t))},_s=function(){return typeof RCCppEngine<"u"},Es=function(t){if(t.tag!=="browser")return{type:t.tag,version:"UnKonw"};var n,e,r=navigator.userAgent,i={IE:/rv:([\d.]+)\) like Gecko|MSIE ([\d.]+)/,Edge:/Edge\/([\d.]+)/,Firefox:/Firefox\/([\d.]+)/,Opera:/(?:OPERA|OPR).([\d.]+)/,WeChat:/MicroMessenger\/([\d.]+)/,QQBrowser:/QQBrowser\/([\d.]+)/,Chrome:/Chrome\/([\d.]+)/,Safari:/Version\/([\d.]+).*Safari/,iOSChrome:/Mobile\/([\d.]+).*Safari/};for(var o in i)if(i.hasOwnProperty(o)){var s=r.match(i[o]);if(s){e=o,n=s[1]||s[2];break}}return{type:e||"UnKonw",version:n||"UnKonw"}},ur=function(t){var n;if(typeof t=="object"&&t!==null)if(Array.isArray(t))for(var e in n=[],t)n.push(ur(t[e]));else for(var e in n={},t)n[e]=ur(t[e]);else n=t;return n},xt=function(t){var n;try{n=ur(t)}catch{n=JSON.parse(JSON.stringify(t))}return n},Su=function(t){return t?/http(s)?:\/\//.test(t)?t:"https://".concat(t):""},ne={_delayTime:0,setTime:function(t){var n=new Date().getTime();ne._delayTime=n-t},getTime:function(){var t=ne._delayTime;return new Date().getTime()-t}},Gi=function(t,n){var e=0;return t.isAutoDelete&&(e|=1),t.isOverwrite&&(e|=2),n===2&&(e|=4),e},oo=function(){function t(n){this._pullQueue=[],this._isPulling=!1,this._pullTime=0,this._engine=n}return t.prototype._startPull=function(){return L(this,void 0,void 0,function(){var n,e,r,i,o,s,h;return M(this,function(l){switch(l.label){case 0:return this._isPulling||this._pullQueue.length===0?[2]:(this._isPulling=!0,n=this._pullQueue.splice(0,1)[0],e=n.roomId,r=n.timestamp,(i=this._pullTime)>r?(this._isPulling=!1,this._startPull(),[2]):[4,this._engine.pullRTCRoomEntry(e,i)]);case 1:return o=l.sent(),s=o.code,h=o.data,s===R.SUCCESS?(this._isPulling=!1,this._pullTime=h.syncTime||0,this._startPull()):this._startPull(),[2]}})})},t.prototype.pullEntry=function(n,e){this._pullQueue.push({roomId:n,timestamp:e}),this._startPull()},t.prototype.reset=function(){this._pullTime=0,this._isPulling=!1},t}(),vs="rtcRJoin_data",Ts="rtcRExit",ms="rtcRInfo",ys="rtcUData",Is="rtcUPut",Cs="rtcUDel",Rs="rtcSetData",cr="userSetData",Ss="rtcQryData",Os="rtcDelData",Ns="rtcToken",Ms="rtcUserState",Ls="rtcUList",Us="viewerJoinR",As="viewerExitR",ws="rtcPullKv",bs="rtcIdentityChange",Ps="rtcInvite",Ds="rtcCancelInvite",Vs="rtcInviteAnswer",Gs="rtcEndInvite",ks="rtcQueryJoined";(function(t){t.RtcInput="RtcInput",t.RtcUserListOutput="RtcUserListOutput",t.SetUserStatusInput="SetUserStatusInput",t.RtcSetDataInput="RtcSetDataInput",t.RtcUserSetDataInput="RtcUserSetDataInput",t.RtcDataInput="RtcDataInput",t.RtcSetOutDataInput="RtcSetOutDataInput",t.MCFollowInput="MCFollowInput",t.RtcTokenOutput="RtcTokenOutput",t.RtcQryOutput="RtcQryOutput",t.RtcQryUserOutDataInput="RtcQryUserOutDataInput",t.RtcUserOutDataOutput="RtcUserOutDataOutput",t.RtcQueryListInput="RtcQueryListInput",t.RtcRoomInfoOutput="RtcRoomInfoOutput",t.RtcValueInfo="RtcValueInfo",t.RtcKeyDeleteInput="RtcKeyDeleteInput",t.RtcNotifyMsg="RtcNotifyMsg",t.RtcPullKV="RtcPullKV",t.RtcKVOutput="RtcKVOutput",t.RtcQueryUserJoinedInput="RtcQueryUserJoinedInput",t.RtcQueryUserJoinedOutput="RtcQueryUserJoinedOutput",t.RtcViewerJoinedOutput="RtcViewerJoinedOutput",t.RtcInviteInput="RtcInviteInput",t.RtcCancelInviteInput="RtcCancelInviteInput",t.RtcInviteAnswerInput="RtcInviteAnswerInput",t.RtcEndInviteInput="RtcEndInviteInput",t.RtcOutput="RtcOutput"})(F||(F={}));var Bs=((ct={})[F.RtcInput]=["roomType","broadcastType","extraInnerData","needSysChatroom","identityChangeType","joinType","innerDatas","outerDatas"],ct[F.RtcUserListOutput]=["users","token","sessionId","roomInfo"],ct[F.SetUserStatusInput]=["status"],ct[F.RtcSetDataInput]=["interior","target","key","value","objectName","content"],ct[F.RtcUserSetDataInput]=["valueInfo","objectName","content"],ct[F.RtcDataInput]=["interior","target","key","objectName","content"],ct[F.RtcSetOutDataInput]=["target","valueInfo","objectName","content"],ct[F.MCFollowInput]=["state"],ct[F.RtcTokenOutput]=["rtcToken"],ct[F.RtcQryOutput]=["outInfo"],ct[F.RtcQryUserOutDataInput]=["userId"],ct[F.RtcUserOutDataOutput]=["user"],ct[F.RtcQueryListInput]=["order"],ct[F.RtcRoomInfoOutput]=["roomId","roomData","userCount","list"],ct[F.RtcValueInfo]=["key","value"],ct[F.RtcKeyDeleteInput]=["key"],ct[F.RtcNotifyMsg]=["type","time","roomId"],ct[F.RtcPullKV]=["timestamp","roomId"],ct[F.RtcKVOutput]=["entries","bFullUpdate","syncTime"],ct[F.RtcQueryUserJoinedInput]=["userId"],ct[F.RtcQueryUserJoinedOutput]=["info"],ct[F.RtcInviteInput]=["invitedUserId","timeoutTime","invitedRoomId","inviteInfo","inviteSessionId"],ct[F.RtcCancelInviteInput]=["invitedUserId","invitedRoomId","inviteInfo","inviteSessionId"],ct[F.RtcInviteAnswerInput]=["inviteUserId","answerCode","inviteRoomId","inviteSessionId","content","key","value"],ct[F.RtcEndInviteInput]=["inviteRoomId","inviteSessionId","inviteContent","inviteRoomKeys"],ct),xs=`
package Modules;
message probuf {
  enum JoinType {
    KICK = 0; //踢前一个设备
    REFUSE = 1; //当前加入拒绝
    COEXIST = 2; //两个设备共存
  }
  enum targetType {
    ROOM =1 ;
    PERSON = 2;
  }
  message `.concat(F.SetUserStatusInput,`
  {
    optional int32 status=1;
  }
  message `).concat(F.MCFollowInput,`
  {
    required string state = 1;
  }
  message `).concat(F.RtcQueryListInput,`{
    optional int32 order=1;
  }
  message `).concat(F.RtcKeyDeleteInput,`{
    repeated string key=1;
  }
  message `).concat(F.RtcValueInfo,`{
    required string key=1;
    required string value=2;
  }
  message RtcUserInfo{
    required string userId=1;
    repeated `).concat(F.RtcValueInfo,` userData=2; //用户资源信息
  }
  message `).concat(F.RtcUserListOutput,`{
    repeated RtcUserInfo users=1;
    optional string token=2;
    optional string sessionId=3;
    repeated RtcValueInfo roomInfo = 4; //房间key value
    repeated RtcKVEntity entries = 5;//直播KV属性对象集合
    optional int64 syncTime = 6;//所有属性的最大时间戳（下次拉取KV时用）。
    optional int32 offlineKickTime = 7;//server超时踢人时间，默认60s
  }
  message RtcRoomInfoOutput{
    optional string roomId = 1;
    repeated `).concat(F.RtcValueInfo,` roomData = 2;
    optional int32 userCount = 3;
    repeated RtcUserInfo list=4;
  }
  message `).concat(F.RtcInput,`{
    required int32 roomType=1;
    optional int32 broadcastType=2;
    optional RtcValueInfo extraInnerData = 3;
    optional bool needSysChatroom = 4; //是否需要同步聊天室
    optional IdentityChangeType identityChangeType = 5; //身份变更类型
    optional JoinType joinType = 6; // 加入房间类型
    repeated `).concat(F.RtcValueInfo,` innerDatas = 7; //用户内部inner数据，角色或者连麦信息等
    repeated `).concat(F.RtcValueInfo,` outerDatas = 8; //用户内部outer数据，自定义数据结构RtcInput。
  }
  message `).concat(F.RtcQryOutput,`{
    repeated `).concat(F.RtcValueInfo,` outInfo=1;
  }
  message `).concat(F.RtcDataInput,`{
    required bool interior=1;
    required targetType target=2;
    repeated string key=3;
    optional string objectName=4;
    optional string content=5;
  }
  message `).concat(F.RtcSetDataInput,`{
    required bool interior=1;
    required targetType target=2;
    required string key=3;
    required string value=4;
    optional string objectName=5;
    optional string content=6;
  }
  message `).concat(F.RtcUserSetDataInput,` {
    repeated `).concat(F.RtcValueInfo,` valueInfo = 1;
    required string objectName = 2;
    repeated `).concat(F.RtcValueInfo,` content = 3;
  }
  message RtcQryInput{
    required bool isInterior=1;
    required targetType target=2;
    repeated string key=3;
  }
  message RtcDelDataInput{
    repeated string key=1;
    required bool isInterior=2;
    required targetType target=3;
  }
  message RtcOutput
  {
    optional int32 nothing=1;
    optional int64 version=2;
  }
  message `).concat(F.RtcTokenOutput,`{
    required string rtcToken=1;
  }
  message `).concat(F.RtcSetOutDataInput,`{
    required targetType target=1;
    repeated `).concat(F.RtcValueInfo,` valueInfo=2;
    optional string objectName=3;
    optional string content=4;
  }
  message `).concat(F.RtcQryUserOutDataInput,`{
    repeated string userId = 1;
  }
  message `).concat(F.RtcUserOutDataOutput,`{
    repeated RtcUserInfo user = 1;
  }
  message `).concat(F.RtcNotifyMsg,` 
  {
    required int32 type= 1;   //(通知类型 1:rtc房间状态KV变更通知)
    optional int64 time= 2;   //消息产生时间
    optional string roomId=3; //主播房间id
  }
  message `).concat(F.RtcPullKV,`
  {
    required int64 timestamp = 1;
    required string roomId = 2;
  }
  message RtcKVEntity 
  {
    required string key = 1;
    required string value = 2;
    optional int32 status = 3;
    optional int64 timestamp = 4;
    optional string uid = 5;
  }
  message `).concat(F.RtcKVOutput,`
  {
    repeated RtcKVEntity entries = 1;
    optional bool bFullUpdate = 2;
    optional int64 syncTime = 3; 
  }
  enum IdentityChangeType 
  {
    AnchorToViewer = 1; //1为主播变观众
    ViewerToAnchor = 2; //2为观众变主播
  }
  message `).concat(F.RtcQueryUserJoinedInput,`
  {
    required string userId = 1;
  }
  message RtcJoinedInfo
  {
    required string deviceId = 1; //设备ID
    required string roomId = 2;   //加入的房间ID
    optional int64 joinTime = 3;  //加入的时间
  }
  message `).concat(F.RtcQueryUserJoinedOutput,`
  {
    repeated RtcJoinedInfo info = 1;
  }
  message `).concat(F.RtcViewerJoinedOutput,`
  {
    required string rtcToken=1;
    repeated RtcKVEntity entries = 2;//KV属性对象集合
    optional int64 syncTime = 3;//所有属性的最大时间戳（下次拉取KV时用）。
  }
  message `).concat(F.RtcInviteInput,`
  {
    required string invitedUserId=1;    //被邀请的人的uid
    optional int32  timeoutTime=2;       //邀请超时时间(秒),默认三十秒
    required string invitedRoomId=3;    //被邀请的房间
    required string inviteInfo=4;       //邀请的信息(包含邀请人,被邀请人,各自userid)客户端定义好.协议栈和server透传
    required string inviteSessionId= 5; //客户端保证唯一性(建议roomid_userid_时间戳_随机数)
  }
  message `).concat(F.RtcCancelInviteInput,`
  {
    required string invitedUserId=1;   //被邀请的人的uid
    required string invitedRoomId=2;   //被邀请的房间
    required string inviteInfo=3;      //取消邀请的信息(包含邀请人,被邀请人,各自userid)客户端定义好.协议栈和server透传
    required string inviteSessionId=4; //邀请的sessionId,客户端发起邀请时产生
  }
  message `).concat(F.RtcInviteAnswerInput,`
  {
    required string inviteUserId=1;    //邀请的人的uid
    required int32  answerCode=2;      //是否接受连麦邀请.0为拒绝,1为接受
    required string inviteRoomId=3;    //邀请的房间
    required string inviteSessionId=4; //邀请的sessionId
    required string content=5;         //需要转发的content
    optional string key=6;             //如果接受的话,需要加这个字段,放在room级别的k和v,新加入房间的能拉取到
    optional string value=7;           //如果接受的话,需要加这个字段,放在room级别的k和v,新加入房间的能拉取到
  }
  message `).concat(F.RtcEndInviteInput,`
  {
    required string inviteRoomId=1;    //邀请的房间
    required string inviteSessionId=2; //邀请的sessionId
    required string inviteContent=3;   //结束连麦的信息(需要透传给房间内其他人)
    repeated string inviteRoomKeys=4;  //需要删除连麦的信息的key
  }
}
`),Fs=function(){function t(n,e,r,i,o,s){this.runtime=n,this.rtcCodec=e,this._watcher=r,this._options=i,this.logger=o,this.statisticLog=s,this._appkey=this._options.appkey,this._rtcKVManager=new oo(this)}return t.prototype.registerRTCSignalingListener=function(n){this._rtcSignalingListener=n},t.prototype.getInnerLogger=function(){return this.logger},t.prototype.getInnerStatisticLog=function(){return this.statisticLog},t.prototype.pullRTCRoomEntry=function(n,e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return r=this.rtcCodec.encode(F.RtcPullKV,{timestamp:0,roomId:n}),[4,this.rtcSignaling(n,ws,!0,r)];case 1:return i=d.sent(),o=i.code,s=i.buffer,o!==R.SUCCESS?[2,{code:o}]:(h=this.rtcCodec.decode(F.RtcKVOutput,s),l=h.entries,c=h.syncTime,l=(l||[]).map(function(_){return Z(Z({},_),{timestamp:ut(_.timestamp)})}),this._watcher.onRTCDataChange(l,n),[2,{code:o,data:{kvEntries:l,syncTime:ut(c)}}])}})})},t.prototype._receiveRtcKv=function(n){if(this._rtcSignalingListener)this._rtcSignalingListener(n);else{var e=this.rtcCodec.decode(F.RtcNotifyMsg,n),r=e.time,i=e.type,o=e.roomId;i===1&&this._rtcKVManager.pullEntry(o,ut(r))}},t.prototype.destroy=function(){},t}();function so(t){var n=function(){function i(S,k,j){this.low=0|S,this.high=0|k,this.unsigned=!!j}function o(S){return(S&&S.__isLong__)===!0}function s(S,k){var j,tt,C;return k?(C=(S>>>=0)>=0&&S<256)&&(tt=v[S])?tt:(j=l(S,(0|S)<0?-1:0,!0),C&&(v[S]=j),j):(C=(S|=0)>=-128&&S<128)&&(tt=_[S])?tt:(j=l(S,S<0?-1:0,!1),C&&(_[S]=j),j)}function h(S,k){if(isNaN(S)||!isFinite(S))return k?E:f;if(k){if(S<0)return E;if(S>=a)return K}else{if(-u>=S)return Y;if(S+1>=u)return A}return S<0?h(-S,k).neg():l(0|S%T,0|S/T,k)}function l(S,k,j){return new i(S,k,j)}function c(S,k,j){var tt,C,O,U,w,b,x;if(S.length===0)throw Error("empty string");if(S==="NaN"||S==="Infinity"||S==="+Infinity"||S==="-Infinity")return f;if(typeof k=="number"?(j=k,k=!1):k=!!k,(j=j||10)<2||j>36)throw RangeError("radix");if((tt=S.indexOf("-"))>0)throw Error("interior hyphen");if(tt===0)return c(S.substring(1),k,j).neg();for(C=h(I(j,8)),O=f,U=0;U<S.length;U+=8)w=Math.min(8,S.length-U),b=parseInt(S.substring(U,U+w),j),w<8?(x=h(I(j,w)),O=O.mul(x).add(h(b))):O=(O=O.mul(C)).add(h(b));return O.unsigned=k,O}function d(S){return S instanceof i?S:typeof S=="number"?h(S):typeof S=="string"?c(S):l(S.low,S.high,S.unsigned)}var _,v,I,T,a,u,p,f,E,m,y,N,A,K,Y,G;return i.prototype.__isLong__,Object.defineProperty(i.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),i.isLong=o,_={},v={},i.fromInt=s,i.fromNumber=h,i.fromBits=l,I=Math.pow,i.fromString=c,i.fromValue=d,u=(a=(T=4294967296)*T)/2,p=s(16777216),f=s(0),i.ZERO=f,E=s(0,!0),i.UZERO=E,m=s(1),i.ONE=m,y=s(1,!0),i.UONE=y,N=s(-1),i.NEG_ONE=N,A=l(-1,2147483647,!1),i.MAX_VALUE=A,K=l(-1,-1,!0),i.MAX_UNSIGNED_VALUE=K,Y=l(0,-2147483648,!1),i.MIN_VALUE=Y,(G=i.prototype).toInt=function(){return this.unsigned?this.low>>>0:this.low},G.toNumber=function(){return this.unsigned?(this.high>>>0)*T+(this.low>>>0):this.high*T+(this.low>>>0)},G.toString=function(S){var k,j,tt,C,O,U,w,b;if((S=S||10)<2||S>36)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())return this.eq(Y)?(k=h(S),tt=(j=this.div(k)).mul(k).sub(this),j.toString(S)+tt.toInt().toString(S)):"-"+this.neg().toString(S);for(C=h(I(S,6),this.unsigned),O=this,U="";;){if(w=O.div(C),b=(O.sub(w.mul(C)).toInt()>>>0).toString(S),(O=w).isZero())return b+U;for(;b.length<6;)b="0"+b;U=""+b+U}},G.getHighBits=function(){return this.high},G.getHighBitsUnsigned=function(){return this.high>>>0},G.getLowBits=function(){return this.low},G.getLowBitsUnsigned=function(){return this.low>>>0},G.getNumBitsAbs=function(){var S,k;if(this.isNegative())return this.eq(Y)?64:this.neg().getNumBitsAbs();for(S=this.high!=0?this.high:this.low,k=31;k>0&&!(S&1<<k);k--);return this.high!=0?k+33:k+1},G.isZero=function(){return this.high===0&&this.low===0},G.isNegative=function(){return!this.unsigned&&this.high<0},G.isPositive=function(){return this.unsigned||this.high>=0},G.isOdd=function(){return(1&this.low)==1},G.isEven=function(){return(1&this.low)==0},G.equals=function(S){return o(S)||(S=d(S)),(this.unsigned===S.unsigned||this.high>>>31!=1||S.high>>>31!=1)&&this.high===S.high&&this.low===S.low},G.eq=G.equals,G.notEquals=function(S){return!this.eq(S)},G.neq=G.notEquals,G.lessThan=function(S){return this.comp(S)<0},G.lt=G.lessThan,G.lessThanOrEqual=function(S){return this.comp(S)<=0},G.lte=G.lessThanOrEqual,G.greaterThan=function(S){return this.comp(S)>0},G.gt=G.greaterThan,G.greaterThanOrEqual=function(S){return this.comp(S)>=0},G.gte=G.greaterThanOrEqual,G.compare=function(S){if(o(S)||(S=d(S)),this.eq(S))return 0;var k=this.isNegative(),j=S.isNegative();return k&&!j?-1:!k&&j?1:this.unsigned?S.high>>>0>this.high>>>0||S.high===this.high&&S.low>>>0>this.low>>>0?-1:1:this.sub(S).isNegative()?-1:1},G.comp=G.compare,G.negate=function(){return!this.unsigned&&this.eq(Y)?Y:this.not().add(m)},G.neg=G.negate,G.add=function(S){var k,j,tt,C,O,U,w,b,x,H,Q;return o(S)||(S=d(S)),k=this.high>>>16,j=65535&this.high,tt=this.low>>>16,C=65535&this.low,O=S.high>>>16,U=65535&S.high,w=S.low>>>16,b=0,x=0,H=0,Q=0,H+=(Q+=C+(65535&S.low))>>>16,x+=(H+=tt+w)>>>16,b+=(x+=j+U)>>>16,b+=k+O,l((H&=65535)<<16|(Q&=65535),(b&=65535)<<16|(x&=65535),this.unsigned)},G.subtract=function(S){return o(S)||(S=d(S)),this.add(S.neg())},G.sub=G.subtract,G.multiply=function(S){var k,j,tt,C,O,U,w,b,x,H,Q,J;return this.isZero()?f:(o(S)||(S=d(S)),S.isZero()?f:this.eq(Y)?S.isOdd()?Y:f:S.eq(Y)?this.isOdd()?Y:f:this.isNegative()?S.isNegative()?this.neg().mul(S.neg()):this.neg().mul(S).neg():S.isNegative()?this.mul(S.neg()).neg():this.lt(p)&&S.lt(p)?h(this.toNumber()*S.toNumber(),this.unsigned):(k=this.high>>>16,j=65535&this.high,tt=this.low>>>16,C=65535&this.low,O=S.high>>>16,U=65535&S.high,w=S.low>>>16,x=0,H=0,Q=0,J=0,Q+=(J+=C*(b=65535&S.low))>>>16,H+=(Q+=tt*b)>>>16,Q&=65535,H+=(Q+=C*w)>>>16,x+=(H+=j*b)>>>16,H&=65535,x+=(H+=tt*w)>>>16,H&=65535,x+=(H+=C*U)>>>16,x+=k*b+j*w+tt*U+C*O,l((Q&=65535)<<16|(J&=65535),(x&=65535)<<16|(H&=65535),this.unsigned)))},G.mul=G.multiply,G.divide=function(S){var k,j,tt,C,O,U,w;if(o(S)||(S=d(S)),S.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?E:f;if(this.unsigned){if(S.unsigned||(S=S.toUnsigned()),S.gt(this))return E;if(S.gt(this.shru(1)))return y;tt=E}else{if(this.eq(Y))return S.eq(m)||S.eq(N)?Y:S.eq(Y)?m:(k=this.shr(1).div(S).shl(1)).eq(f)?S.isNegative()?m:N:(j=this.sub(S.mul(k)),tt=k.add(j.div(S)));if(S.eq(Y))return this.unsigned?E:f;if(this.isNegative())return S.isNegative()?this.neg().div(S.neg()):this.neg().div(S).neg();if(S.isNegative())return this.div(S.neg()).neg();tt=f}for(j=this;j.gte(S);){for(k=Math.max(1,Math.floor(j.toNumber()/S.toNumber())),O=(C=Math.ceil(Math.log(k)/Math.LN2))<=48?1:I(2,C-48),w=(U=h(k)).mul(S);w.isNegative()||w.gt(j);)w=(U=h(k-=O,this.unsigned)).mul(S);U.isZero()&&(U=m),tt=tt.add(U),j=j.sub(w)}return tt},G.div=G.divide,G.modulo=function(S){return o(S)||(S=d(S)),this.sub(this.div(S).mul(S))},G.mod=G.modulo,G.not=function(){return l(~this.low,~this.high,this.unsigned)},G.and=function(S){return o(S)||(S=d(S)),l(this.low&S.low,this.high&S.high,this.unsigned)},G.or=function(S){return o(S)||(S=d(S)),l(this.low|S.low,this.high|S.high,this.unsigned)},G.xor=function(S){return o(S)||(S=d(S)),l(this.low^S.low,this.high^S.high,this.unsigned)},G.shiftLeft=function(S){return o(S)&&(S=S.toInt()),(S&=63)==0?this:S<32?l(this.low<<S,this.high<<S|this.low>>>32-S,this.unsigned):l(0,this.low<<S-32,this.unsigned)},G.shl=G.shiftLeft,G.shiftRight=function(S){return o(S)&&(S=S.toInt()),(S&=63)==0?this:S<32?l(this.low>>>S|this.high<<32-S,this.high>>S,this.unsigned):l(this.high>>S-32,this.high>=0?0:-1,this.unsigned)},G.shr=G.shiftRight,G.shiftRightUnsigned=function(S){var k;return o(S)&&(S=S.toInt()),(S&=63)===0?this:(k=this.high,S<32?l(this.low>>>S|k<<32-S,k>>>S,this.unsigned):l(S===32?k:k>>>S-32,0,this.unsigned))},G.shru=G.shiftRightUnsigned,G.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},G.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},G.toBytes=function(S){return S?this.toBytesLE():this.toBytesBE()},G.toBytesLE=function(){var S=this.high,k=this.low;return[255&k,255&k>>>8,255&k>>>16,255&k>>>24,255&S,255&S>>>8,255&S>>>16,255&S>>>24]},G.toBytesBE=function(){var S=this.high,k=this.low;return[255&S>>>24,255&S>>>16,255&S>>>8,255&S,255&k>>>24,255&k>>>16,255&k>>>8,255&k]},i}(),e=function(i){function o(a){var u=0;return function(){return u<a.length?a.charCodeAt(u++):null}}function s(){var a=[],u=[];return function(){return arguments.length===0?u.join("")+_.apply(String,a):(a.length+arguments.length>1024&&(u.push(_.apply(String,a)),a.length=0),void Array.prototype.push.apply(a,arguments))}}function h(a,u,p,f,E){var m,y,N=8*E-f-1,A=(1<<N)-1,K=A>>1,Y=-7,G=p?E-1:0,S=p?-1:1,k=a[u+G];for(G+=S,m=k&(1<<-Y)-1,k>>=-Y,Y+=N;Y>0;m=256*m+a[u+G],G+=S,Y-=8);for(y=m&(1<<-Y)-1,m>>=-Y,Y+=f;Y>0;y=256*y+a[u+G],G+=S,Y-=8);if(m===0)m=1-K;else{if(m===A)return y?NaN:1/0*(k?-1:1);y+=Math.pow(2,f),m-=K}return(k?-1:1)*y*Math.pow(2,m-f)}function l(a,u,p,f,E,m){var y,N,A,K=8*m-E-1,Y=(1<<K)-1,G=Y>>1,S=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=f?0:m-1,j=f?1:-1,tt=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(N=isNaN(u)?1:0,y=Y):(y=Math.floor(Math.log(u)/Math.LN2),u*(A=Math.pow(2,-y))<1&&(y--,A*=2),(u+=y+G>=1?S/A:S*Math.pow(2,1-G))*A>=2&&(y++,A/=2),y+G>=Y?(N=0,y=Y):y+G>=1?(N=(u*A-1)*Math.pow(2,E),y+=G):(N=u*Math.pow(2,G-1)*Math.pow(2,E),y=0));E>=8;a[p+k]=255&N,k+=j,N/=256,E-=8);for(y=y<<E|N,K+=E;K>0;a[p+k]=255&y,k+=j,y/=256,K-=8);a[p+k-j]|=128*tt}var c,d,_,v,I,T=function(a,u,p){if(a===void 0&&(a=T.DEFAULT_CAPACITY),u===void 0&&(u=T.DEFAULT_ENDIAN),p===void 0&&(p=T.DEFAULT_NOASSERT),!p){if((a|=0)<0)throw RangeError("Illegal capacity");u=!!u,p=!!p}this.buffer=a===0?d:new ArrayBuffer(a),this.view=a===0?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=a,this.littleEndian=u,this.noAssert=p};return T.VERSION="5.0.1",T.LITTLE_ENDIAN=!0,T.BIG_ENDIAN=!1,T.DEFAULT_CAPACITY=16,T.DEFAULT_ENDIAN=T.BIG_ENDIAN,T.DEFAULT_NOASSERT=!1,T.Long=i||null,(c=T.prototype).__isByteBuffer__,Object.defineProperty(c,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1}),d=new ArrayBuffer(0),_=String.fromCharCode,T.accessor=function(){return Uint8Array},T.allocate=function(a,u,p){return new T(a,u,p)},T.concat=function(a,u,p,f){var E,m,y,N,A,K;for((typeof u=="boolean"||typeof u!="string")&&(f=p,p=u,u=void 0),E=0,y=0,N=a.length;N>y;++y)T.isByteBuffer(a[y])||(a[y]=T.wrap(a[y],u)),(m=a[y].limit-a[y].offset)>0&&(E+=m);if(E===0)return new T(0,p,f);for(K=new T(E,p,f),y=0;N>y;)(m=(A=a[y++]).limit-A.offset)<=0||(K.view.set(A.view.subarray(A.offset,A.limit),K.offset),K.offset+=m);return K.limit=K.offset,K.offset=0,K},T.isByteBuffer=function(a){return(a&&a.__isByteBuffer__)===!0},T.type=function(){return ArrayBuffer},T.wrap=function(a,u,p,f){var E,m;if(typeof u!="string"&&(f=p,p=u,u=void 0),typeof a=="string")switch(u===void 0&&(u="utf8"),u){case"base64":return T.fromBase64(a,p);case"hex":return T.fromHex(a,p);case"binary":return T.fromBinary(a,p);case"utf8":return T.fromUTF8(a,p);case"debug":return T.fromDebug(a,p);default:throw Error("Unsupported encoding: "+u)}if(a===null||typeof a!="object")throw TypeError("Illegal buffer");if(T.isByteBuffer(a))return(E=c.clone.call(a)).markedOffset=-1,E;if(a instanceof Uint8Array)E=new T(0,p,f),a.length>0&&(E.buffer=a.buffer,E.offset=a.byteOffset,E.limit=a.byteOffset+a.byteLength,E.view=new Uint8Array(a.buffer));else if(a instanceof ArrayBuffer)E=new T(0,p,f),a.byteLength>0&&(E.buffer=a,E.offset=0,E.limit=a.byteLength,E.view=a.byteLength>0?new Uint8Array(a):null);else{if(Object.prototype.toString.call(a)!=="[object Array]")throw TypeError("Illegal buffer");for((E=new T(a.length,p,f)).limit=a.length,m=0;m<a.length;++m)E.view[m]=a[m]}return E},c.writeBitSet=function(a,u){var p,f,E,m,y,N,A=u===void 0;if(A&&(u=this.offset),!this.noAssert){if(!(a instanceof Array))throw TypeError("Illegal BitSet: Not an array");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}for(f=u,m=(E=a.length)>>3,y=0,u+=this.writeVarint32(E,u);m--;)p=1&!!a[y++]|(1&!!a[y++])<<1|(1&!!a[y++])<<2|(1&!!a[y++])<<3|(1&!!a[y++])<<4|(1&!!a[y++])<<5|(1&!!a[y++])<<6|(1&!!a[y++])<<7,this.writeByte(p,u++);if(E>y){for(N=0,p=0;E>y;)p|=(1&!!a[y++])<<N++;this.writeByte(p,u++)}return A?(this.offset=u,this):u-f},c.readBitSet=function(a){var u,p,f,E,m,y,N,A=a===void 0;for(A&&(a=this.offset),E=(f=(p=this.readVarint32(a)).value)>>3,m=0,y=[],a+=p.length;E--;)u=this.readByte(a++),y[m++]=!!(1&u),y[m++]=!!(2&u),y[m++]=!!(4&u),y[m++]=!!(8&u),y[m++]=!!(16&u),y[m++]=!!(32&u),y[m++]=!!(64&u),y[m++]=!!(128&u);if(f>m)for(N=0,u=this.readByte(a++);f>m;)y[m++]=!!(1&u>>N++);return A&&(this.offset=a),y},c.readBytes=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+"+a+") <= "+this.buffer.byteLength)}return p=this.slice(u,u+a),f&&(this.offset+=a),p},c.writeBytes=c.append,c.writeInt8=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return(u+=1)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=1,this.view[u]=a,f&&(this.offset+=1),this},c.writeByte=c.writeInt8,c.readInt8=function(a){var u,p=a===void 0;if(p&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}return(128&(u=this.view[a]))==128&&(u=-(255-u+1)),p&&(this.offset+=1),u},c.readByte=c.readInt8,c.writeUint8=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return(u+=1)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=1,this.view[u]=a,f&&(this.offset+=1),this},c.writeUInt8=c.writeUint8,c.readUint8=function(a){var u,p=a===void 0;if(p&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}return u=this.view[a],p&&(this.offset+=1),u},c.readUInt8=c.readUint8,c.writeInt16=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return(u+=2)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=2,this.littleEndian?(this.view[u+1]=(65280&a)>>>8,this.view[u]=255&a):(this.view[u]=(65280&a)>>>8,this.view[u+1]=255&a),f&&(this.offset+=2),this},c.writeShort=c.writeInt16,c.readInt16=function(a){var u,p=a===void 0;if(p&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}return u=0,this.littleEndian?(u=this.view[a],u|=this.view[a+1]<<8):(u=this.view[a]<<8,u|=this.view[a+1]),(32768&u)==32768&&(u=-(65535-u+1)),p&&(this.offset+=2),u},c.readShort=c.readInt16,c.writeUint16=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return(u+=2)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=2,this.littleEndian?(this.view[u+1]=(65280&a)>>>8,this.view[u]=255&a):(this.view[u]=(65280&a)>>>8,this.view[u+1]=255&a),f&&(this.offset+=2),this},c.writeUInt16=c.writeUint16,c.readUint16=function(a){var u,p=a===void 0;if(p&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}return u=0,this.littleEndian?(u=this.view[a],u|=this.view[a+1]<<8):(u=this.view[a]<<8,u|=this.view[a+1]),p&&(this.offset+=2),u},c.readUInt16=c.readUint16,c.writeInt32=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return(u+=4)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=4,this.littleEndian?(this.view[u+3]=255&a>>>24,this.view[u+2]=255&a>>>16,this.view[u+1]=255&a>>>8,this.view[u]=255&a):(this.view[u]=255&a>>>24,this.view[u+1]=255&a>>>16,this.view[u+2]=255&a>>>8,this.view[u+3]=255&a),f&&(this.offset+=4),this},c.writeInt=c.writeInt32,c.readInt32=function(a){var u,p=a===void 0;if(p&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}return u=0,this.littleEndian?(u=this.view[a+2]<<16,u|=this.view[a+1]<<8,u|=this.view[a],u+=this.view[a+3]<<24>>>0):(u=this.view[a+1]<<16,u|=this.view[a+2]<<8,u|=this.view[a+3],u+=this.view[a]<<24>>>0),u|=0,p&&(this.offset+=4),u},c.readInt=c.readInt32,c.writeUint32=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return(u+=4)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=4,this.littleEndian?(this.view[u+3]=255&a>>>24,this.view[u+2]=255&a>>>16,this.view[u+1]=255&a>>>8,this.view[u]=255&a):(this.view[u]=255&a>>>24,this.view[u+1]=255&a>>>16,this.view[u+2]=255&a>>>8,this.view[u+3]=255&a),f&&(this.offset+=4),this},c.writeUInt32=c.writeUint32,c.readUint32=function(a){var u,p=a===void 0;if(p&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}return u=0,this.littleEndian?(u=this.view[a+2]<<16,u|=this.view[a+1]<<8,u|=this.view[a],u+=this.view[a+3]<<24>>>0):(u=this.view[a+1]<<16,u|=this.view[a+2]<<8,u|=this.view[a+3],u+=this.view[a]<<24>>>0),p&&(this.offset+=4),u},c.readUInt32=c.readUint32,i&&(c.writeInt64=function(a,u){var p,f,E,m=u===void 0;if(m&&(u=this.offset),!this.noAssert){if(typeof a=="number")a=i.fromNumber(a);else if(typeof a=="string")a=i.fromString(a);else if(!(a&&a instanceof i))throw TypeError("Illegal value: "+a+" (not an integer or Long)");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return typeof a=="number"?a=i.fromNumber(a):typeof a=="string"&&(a=i.fromString(a)),(u+=8)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=8,f=a.low,E=a.high,this.littleEndian?(this.view[u+3]=255&f>>>24,this.view[u+2]=255&f>>>16,this.view[u+1]=255&f>>>8,this.view[u]=255&f,u+=4,this.view[u+3]=255&E>>>24,this.view[u+2]=255&E>>>16,this.view[u+1]=255&E>>>8,this.view[u]=255&E):(this.view[u]=255&E>>>24,this.view[u+1]=255&E>>>16,this.view[u+2]=255&E>>>8,this.view[u+3]=255&E,u+=4,this.view[u]=255&f>>>24,this.view[u+1]=255&f>>>16,this.view[u+2]=255&f>>>8,this.view[u+3]=255&f),m&&(this.offset+=8),this},c.writeLong=c.writeInt64,c.readInt64=function(a){var u,p,f,E=a===void 0;if(E&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}return u=0,p=0,this.littleEndian?(u=this.view[a+2]<<16,u|=this.view[a+1]<<8,u|=this.view[a],u+=this.view[a+3]<<24>>>0,a+=4,p=this.view[a+2]<<16,p|=this.view[a+1]<<8,p|=this.view[a],p+=this.view[a+3]<<24>>>0):(p=this.view[a+1]<<16,p|=this.view[a+2]<<8,p|=this.view[a+3],p+=this.view[a]<<24>>>0,a+=4,u=this.view[a+1]<<16,u|=this.view[a+2]<<8,u|=this.view[a+3],u+=this.view[a]<<24>>>0),f=new i(u,p,!1),E&&(this.offset+=8),f},c.readLong=c.readInt64,c.writeUint64=function(a,u){var p,f,E,m=u===void 0;if(m&&(u=this.offset),!this.noAssert){if(typeof a=="number")a=i.fromNumber(a);else if(typeof a=="string")a=i.fromString(a);else if(!(a&&a instanceof i))throw TypeError("Illegal value: "+a+" (not an integer or Long)");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return typeof a=="number"?a=i.fromNumber(a):typeof a=="string"&&(a=i.fromString(a)),(u+=8)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=8,f=a.low,E=a.high,this.littleEndian?(this.view[u+3]=255&f>>>24,this.view[u+2]=255&f>>>16,this.view[u+1]=255&f>>>8,this.view[u]=255&f,u+=4,this.view[u+3]=255&E>>>24,this.view[u+2]=255&E>>>16,this.view[u+1]=255&E>>>8,this.view[u]=255&E):(this.view[u]=255&E>>>24,this.view[u+1]=255&E>>>16,this.view[u+2]=255&E>>>8,this.view[u+3]=255&E,u+=4,this.view[u]=255&f>>>24,this.view[u+1]=255&f>>>16,this.view[u+2]=255&f>>>8,this.view[u+3]=255&f),m&&(this.offset+=8),this},c.writeUInt64=c.writeUint64,c.readUint64=function(a){var u,p,f,E=a===void 0;if(E&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}return u=0,p=0,this.littleEndian?(u=this.view[a+2]<<16,u|=this.view[a+1]<<8,u|=this.view[a],u+=this.view[a+3]<<24>>>0,a+=4,p=this.view[a+2]<<16,p|=this.view[a+1]<<8,p|=this.view[a],p+=this.view[a+3]<<24>>>0):(p=this.view[a+1]<<16,p|=this.view[a+2]<<8,p|=this.view[a+3],p+=this.view[a]<<24>>>0,a+=4,u=this.view[a+1]<<16,u|=this.view[a+2]<<8,u|=this.view[a+3],u+=this.view[a]<<24>>>0),f=new i(u,p,!0),E&&(this.offset+=8),f},c.readUInt64=c.readUint64),c.writeFloat32=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof a!="number")throw TypeError("Illegal value: "+a+" (not a number)");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return(u+=4)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=4,l(this.view,a,u,this.littleEndian,23,4),f&&(this.offset+=4),this},c.writeFloat=c.writeFloat32,c.readFloat32=function(a){var u,p=a===void 0;if(p&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}return u=h(this.view,a,this.littleEndian,23,4),p&&(this.offset+=4),u},c.readFloat=c.readFloat32,c.writeFloat64=function(a,u){var p,f=u===void 0;if(f&&(u=this.offset),!this.noAssert){if(typeof a!="number")throw TypeError("Illegal value: "+a+" (not a number)");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return(u+=8)>(p=this.buffer.byteLength)&&this.resize((p*=2)>u?p:u),u-=8,l(this.view,a,u,this.littleEndian,52,8),f&&(this.offset+=8),this},c.writeDouble=c.writeFloat64,c.readFloat64=function(a){var u,p=a===void 0;if(p&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}return u=h(this.view,a,this.littleEndian,52,8),p&&(this.offset+=8),u},c.readDouble=c.readFloat64,T.MAX_VARINT32_BYTES=5,T.calculateVarint32=function(a){return(a>>>=0)<128?1:a<16384?2:1<<21>a?3:1<<28>a?4:5},T.zigZagEncode32=function(a){return((a|=0)<<1^a>>31)>>>0},T.zigZagDecode32=function(a){return 0|a>>>1^-(1&a)},c.writeVarint32=function(a,u){var p,f,E,m=u===void 0;if(m&&(u=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}for((u+=f=T.calculateVarint32(a))>(E=this.buffer.byteLength)&&this.resize((E*=2)>u?E:u),u-=f,a>>>=0;a>=128;)p=128|127&a,this.view[u++]=p,a>>>=7;return this.view[u++]=a,m?(this.offset=u,this):f},c.writeVarint32ZigZag=function(a,u){return this.writeVarint32(T.zigZagEncode32(a),u)},c.readVarint32=function(a){var u,p,f,E,m=a===void 0;if(m&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}p=0,f=0;do{if(!this.noAssert&&a>this.limit)throw(E=Error("Truncated")).truncated=!0,E;u=this.view[a++],p<5&&(f|=(127&u)<<7*p),++p}while(128&u);return f|=0,m?(this.offset=a,f):{value:f,length:p}},c.readVarint32ZigZag=function(a){var u=this.readVarint32(a);return typeof u=="object"?u.value=T.zigZagDecode32(u.value):u=T.zigZagDecode32(u),u},i&&(T.MAX_VARINT64_BYTES=10,T.calculateVarint64=function(a){typeof a=="number"?a=i.fromNumber(a):typeof a=="string"&&(a=i.fromString(a));var u=a.toInt()>>>0,p=a.shiftRightUnsigned(28).toInt()>>>0,f=a.shiftRightUnsigned(56).toInt()>>>0;return f==0?p==0?u<16384?u<128?1:2:1<<21>u?3:4:p<16384?p<128?5:6:1<<21>p?7:8:f<128?9:10},T.zigZagEncode64=function(a){return typeof a=="number"?a=i.fromNumber(a,!1):typeof a=="string"?a=i.fromString(a,!1):a.unsigned!==!1&&(a=a.toSigned()),a.shiftLeft(1).xor(a.shiftRight(63)).toUnsigned()},T.zigZagDecode64=function(a){return typeof a=="number"?a=i.fromNumber(a,!1):typeof a=="string"?a=i.fromString(a,!1):a.unsigned!==!1&&(a=a.toSigned()),a.shiftRightUnsigned(1).xor(a.and(i.ONE).toSigned().negate()).toSigned()},c.writeVarint64=function(a,u){var p,f,E,m,y,N=u===void 0;if(N&&(u=this.offset),!this.noAssert){if(typeof a=="number")a=i.fromNumber(a);else if(typeof a=="string")a=i.fromString(a);else if(!(a&&a instanceof i))throw TypeError("Illegal value: "+a+" (not an integer or Long)");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}switch(typeof a=="number"?a=i.fromNumber(a,!1):typeof a=="string"?a=i.fromString(a,!1):a.unsigned!==!1&&(a=a.toSigned()),p=T.calculateVarint64(a),f=a.toInt()>>>0,E=a.shiftRightUnsigned(28).toInt()>>>0,m=a.shiftRightUnsigned(56).toInt()>>>0,(u+=p)>(y=this.buffer.byteLength)&&this.resize((y*=2)>u?y:u),u-=p,p){case 10:this.view[u+9]=1&m>>>7;case 9:this.view[u+8]=p!==9?128|m:127&m;case 8:this.view[u+7]=p!==8?128|E>>>21:127&E>>>21;case 7:this.view[u+6]=p!==7?128|E>>>14:127&E>>>14;case 6:this.view[u+5]=p!==6?128|E>>>7:127&E>>>7;case 5:this.view[u+4]=p!==5?128|E:127&E;case 4:this.view[u+3]=p!==4?128|f>>>21:127&f>>>21;case 3:this.view[u+2]=p!==3?128|f>>>14:127&f>>>14;case 2:this.view[u+1]=p!==2?128|f>>>7:127&f>>>7;case 1:this.view[u]=p!==1?128|f:127&f}return N?(this.offset+=p,this):p},c.writeVarint64ZigZag=function(a,u){return this.writeVarint64(T.zigZagEncode64(a),u)},c.readVarint64=function(a){var u,p,f,E,m,y,N=a===void 0;if(N&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}if(u=a,p=0,f=0,E=0,m=0,p=127&(m=this.view[a++]),128&m&&(p|=(127&(m=this.view[a++]))<<7,(128&m||this.noAssert&&m===void 0)&&(p|=(127&(m=this.view[a++]))<<14,(128&m||this.noAssert&&m===void 0)&&(p|=(127&(m=this.view[a++]))<<21,(128&m||this.noAssert&&m===void 0)&&(f=127&(m=this.view[a++]),(128&m||this.noAssert&&m===void 0)&&(f|=(127&(m=this.view[a++]))<<7,(128&m||this.noAssert&&m===void 0)&&(f|=(127&(m=this.view[a++]))<<14,(128&m||this.noAssert&&m===void 0)&&(f|=(127&(m=this.view[a++]))<<21,(128&m||this.noAssert&&m===void 0)&&(E=127&(m=this.view[a++]),(128&m||this.noAssert&&m===void 0)&&(E|=(127&(m=this.view[a++]))<<7,128&m||this.noAssert&&m===void 0))))))))))throw Error("Buffer overrun");return y=i.fromBits(p|f<<28,f>>>4|E<<24,!1),N?(this.offset=a,y):{value:y,length:a-u}},c.readVarint64ZigZag=function(a){var u=this.readVarint64(a);return u&&u.value instanceof i?u.value=T.zigZagDecode64(u.value):u=T.zigZagDecode64(u),u}),c.writeCString=function(a,u){var p,f,E,m=u===void 0;if(m&&(u=this.offset),f=a.length,!this.noAssert){if(typeof a!="string")throw TypeError("Illegal str: Not a string");for(p=0;f>p;++p)if(a.charCodeAt(p)===0)throw RangeError("Illegal str: Contains NULL-characters");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return f=I.calculateUTF16asUTF8(o(a))[1],u+=f+1,E=this.buffer.byteLength,u>E&&this.resize((E*=2)>u?E:u),u-=f+1,I.encodeUTF16toUTF8(o(a),(function(y){this.view[u++]=y}).bind(this)),this.view[u++]=0,m?(this.offset=u,this):f},c.readCString=function(a){var u,p,f,E=a===void 0;if(E&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}return u=a,f=-1,I.decodeUTF8toUTF16((function(){if(f===0)return null;if(a>=this.limit)throw RangeError("Illegal range: Truncated data, "+a+" < "+this.limit);return(f=this.view[a++])===0?null:f}).bind(this),p=s(),!0),E?(this.offset=a,p()):{string:p(),length:a-u}},c.writeIString=function(a,u){var p,f,E,m=u===void 0;if(m&&(u=this.offset),!this.noAssert){if(typeof a!="string")throw TypeError("Illegal str: Not a string");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}if(f=u,p=I.calculateUTF16asUTF8(o(a),this.noAssert)[1],u+=4+p,E=this.buffer.byteLength,u>E&&this.resize((E*=2)>u?E:u),u-=4+p,this.littleEndian?(this.view[u+3]=255&p>>>24,this.view[u+2]=255&p>>>16,this.view[u+1]=255&p>>>8,this.view[u]=255&p):(this.view[u]=255&p>>>24,this.view[u+1]=255&p>>>16,this.view[u+2]=255&p>>>8,this.view[u+3]=255&p),u+=4,I.encodeUTF16toUTF8(o(a),(function(y){this.view[u++]=y}).bind(this)),u!==f+4+p)throw RangeError("Illegal range: Truncated data, "+u+" == "+(u+4+p));return m?(this.offset=u,this):u-f},c.readIString=function(a){var u,p,f,E=a===void 0;if(E&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}return u=a,p=this.readUint32(a),f=this.readUTF8String(p,T.METRICS_BYTES,a+=4),a+=f.length,E?(this.offset=a,f.string):{string:f.string,length:a-u}},T.METRICS_CHARS="c",T.METRICS_BYTES="b",c.writeUTF8String=function(a,u){var p,f,E,m=u===void 0;if(m&&(u=this.offset),!this.noAssert){if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}return f=u,p=I.calculateUTF16asUTF8(o(a))[1],u+=p,E=this.buffer.byteLength,u>E&&this.resize((E*=2)>u?E:u),u-=p,I.encodeUTF16toUTF8(o(a),(function(y){this.view[u++]=y}).bind(this)),m?(this.offset=u,this):u-f},c.writeString=c.writeUTF8String,T.calculateUTF8Chars=function(a){return I.calculateUTF16asUTF8(o(a))[0]},T.calculateUTF8Bytes=function(a){return I.calculateUTF16asUTF8(o(a))[1]},T.calculateString=T.calculateUTF8Bytes,c.readUTF8String=function(a,u,p){var f,E,m,y,N;if(typeof u=="number"&&(p=u,u=void 0),(f=p===void 0)&&(p=this.offset),u===void 0&&(u=T.METRICS_CHARS),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal length: "+a+" (not an integer)");if(a|=0,typeof p!="number"||p%1!=0)throw TypeError("Illegal offset: "+p+" (not an integer)");if((p>>>=0)<0||p+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+p+" (+0) <= "+this.buffer.byteLength)}if(m=0,y=p,u===T.METRICS_CHARS){if(E=s(),I.decodeUTF8((function(){return a>m&&p<this.limit?this.view[p++]:null}).bind(this),function(A){++m,I.UTF8toUTF16(A,E)}),m!==a)throw RangeError("Illegal range: Truncated data, "+m+" == "+a);return f?(this.offset=p,E()):{string:E(),length:p-y}}if(u===T.METRICS_BYTES){if(!this.noAssert){if(typeof p!="number"||p%1!=0)throw TypeError("Illegal offset: "+p+" (not an integer)");if((p>>>=0)<0||p+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+p+" (+"+a+") <= "+this.buffer.byteLength)}if(N=p+a,I.decodeUTF8toUTF16((function(){return N>p?this.view[p++]:null}).bind(this),E=s(),this.noAssert),p!==N)throw RangeError("Illegal range: Truncated data, "+p+" == "+N);return f?(this.offset=p,E()):{string:E(),length:p-y}}throw TypeError("Unsupported metrics: "+u)},c.readString=c.readUTF8String,c.writeVString=function(a,u){var p,f,E,m,y=u===void 0;if(y&&(u=this.offset),!this.noAssert){if(typeof a!="string")throw TypeError("Illegal str: Not a string");if(typeof u!="number"||u%1!=0)throw TypeError("Illegal offset: "+u+" (not an integer)");if((u>>>=0)<0||u+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+u+" (+0) <= "+this.buffer.byteLength)}if(E=u,p=I.calculateUTF16asUTF8(o(a),this.noAssert)[1],f=T.calculateVarint32(p),u+=f+p,m=this.buffer.byteLength,u>m&&this.resize((m*=2)>u?m:u),u-=f+p,u+=this.writeVarint32(p,u),I.encodeUTF16toUTF8(o(a),(function(N){this.view[u++]=N}).bind(this)),u!==E+p+f)throw RangeError("Illegal range: Truncated data, "+u+" == "+(u+p+f));return y?(this.offset=u,this):u-E},c.readVString=function(a){var u,p,f,E=a===void 0;if(E&&(a=this.offset),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}return u=a,p=this.readVarint32(a),f=this.readUTF8String(p.value,T.METRICS_BYTES,a+=p.length),a+=f.length,E?(this.offset=a,f.string):{string:f.string,length:a-u}},c.append=function(a,u,p){var f,E,m;if((typeof u=="number"||typeof u!="string")&&(p=u,u=void 0),(f=p===void 0)&&(p=this.offset),!this.noAssert){if(typeof p!="number"||p%1!=0)throw TypeError("Illegal offset: "+p+" (not an integer)");if((p>>>=0)<0||p+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+p+" (+0) <= "+this.buffer.byteLength)}return a instanceof T||(a=T.wrap(a,u)),(E=a.limit-a.offset)<=0||((p+=E)>(m=this.buffer.byteLength)&&this.resize((m*=2)>p?m:p),p-=E,this.view.set(a.view.subarray(a.offset,a.limit),p),a.offset+=E,f&&(this.offset+=E)),this},c.appendTo=function(a,u){return a.append(this,u),this},c.assert=function(a){return this.noAssert=!a,this},c.capacity=function(){return this.buffer.byteLength},c.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},c.clone=function(a){var u=new T(0,this.littleEndian,this.noAssert);return a?(u.buffer=new ArrayBuffer(this.buffer.byteLength),u.view=new Uint8Array(u.buffer)):(u.buffer=this.buffer,u.view=this.view),u.offset=this.offset,u.markedOffset=this.markedOffset,u.limit=this.limit,u},c.compact=function(a,u){var p,f,E;if(a===void 0&&(a=this.offset),u===void 0&&(u=this.limit),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal end: Not an integer");if(u>>>=0,a<0||a>u||u>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+u+" <= "+this.buffer.byteLength)}return a===0&&u===this.buffer.byteLength?this:(p=u-a)===0?(this.buffer=d,this.view=null,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=0,this):(f=new ArrayBuffer(p),(E=new Uint8Array(f)).set(this.view.subarray(a,u)),this.buffer=f,this.view=E,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=p,this)},c.copy=function(a,u){if(a===void 0&&(a=this.offset),u===void 0&&(u=this.limit),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal end: Not an integer");if(u>>>=0,a<0||a>u||u>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+u+" <= "+this.buffer.byteLength)}if(a===u)return new T(0,this.littleEndian,this.noAssert);var p=u-a,f=new T(p,this.littleEndian,this.noAssert);return f.offset=0,f.limit=p,f.markedOffset>=0&&(f.markedOffset-=a),this.copyTo(f,0,a,u),f},c.copyTo=function(a,u,p,f){var E,m,y;if(!this.noAssert&&!T.isByteBuffer(a))throw TypeError("Illegal target: Not a ByteBuffer");if(u=(m=u===void 0)?a.offset:0|u,p=(E=p===void 0)?this.offset:0|p,f=f===void 0?this.limit:0|f,u<0||u>a.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+u+" <= "+a.buffer.byteLength);if(p<0||f>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+p+" <= "+this.buffer.byteLength);return(y=f-p)===0?a:(a.ensureCapacity(u+y),a.view.set(this.view.subarray(p,f),u),E&&(this.offset+=y),m&&(a.offset+=y),this)},c.ensureCapacity=function(a){var u=this.buffer.byteLength;return a>u?this.resize((u*=2)>a?u:a):this},c.fill=function(a,u,p){var f=u===void 0;if(f&&(u=this.offset),typeof a=="string"&&a.length>0&&(a=a.charCodeAt(0)),u===void 0&&(u=this.offset),p===void 0&&(p=this.limit),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal begin: Not an integer");if(u>>>=0,typeof p!="number"||p%1!=0)throw TypeError("Illegal end: Not an integer");if(p>>>=0,u<0||u>p||p>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+u+" <= "+p+" <= "+this.buffer.byteLength)}if(u>=p)return this;for(;p>u;)this.view[u++]=a;return f&&(this.offset=u),this},c.flip=function(){return this.limit=this.offset,this.offset=0,this},c.mark=function(a){if(a=a===void 0?this.offset:a,!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=a,this},c.order=function(a){if(!this.noAssert&&typeof a!="boolean")throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!a,this},c.LE=function(a){return this.littleEndian=a===void 0||!!a,this},c.BE=function(a){return this.littleEndian=a!==void 0&&!a,this},c.prepend=function(a,u,p){var f,E,m,y,N;if((typeof u=="number"||typeof u!="string")&&(p=u,u=void 0),(f=p===void 0)&&(p=this.offset),!this.noAssert){if(typeof p!="number"||p%1!=0)throw TypeError("Illegal offset: "+p+" (not an integer)");if((p>>>=0)<0||p+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+p+" (+0) <= "+this.buffer.byteLength)}return a instanceof T||(a=T.wrap(a,u)),(E=a.limit-a.offset)<=0||((m=E-p)>0?(y=new ArrayBuffer(this.buffer.byteLength+m),(N=new Uint8Array(y)).set(this.view.subarray(p,this.buffer.byteLength),E),this.buffer=y,this.view=N,this.offset+=m,this.markedOffset>=0&&(this.markedOffset+=m),this.limit+=m,p+=m):new Uint8Array(this.buffer),this.view.set(a.view.subarray(a.offset,a.limit),p-E),a.offset=a.limit,f&&(this.offset-=E)),this},c.prependTo=function(a,u){return a.prepend(this,u),this},c.printDebug=function(a){typeof a!="function"&&(a=console.log.bind(console)),a(this.toString()+`
-------------------------------------------------------------------
`+this.toDebug(!0))},c.remaining=function(){return this.limit-this.offset},c.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},c.resize=function(a){var u,p;if(!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal capacity: "+a+" (not an integer)");if((a|=0)<0)throw RangeError("Illegal capacity: 0 <= "+a)}return this.buffer.byteLength<a&&(u=new ArrayBuffer(a),(p=new Uint8Array(u)).set(this.view),this.buffer=u,this.view=p),this},c.reverse=function(a,u){if(a===void 0&&(a=this.offset),u===void 0&&(u=this.limit),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal end: Not an integer");if(u>>>=0,a<0||a>u||u>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+u+" <= "+this.buffer.byteLength)}return a===u||Array.prototype.reverse.call(this.view.subarray(a,u)),this},c.skip=function(a){if(!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0}var u=this.offset+a;if(!this.noAssert&&(u<0||u>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+a+" <= "+this.buffer.byteLength);return this.offset=u,this},c.slice=function(a,u){if(a===void 0&&(a=this.offset),u===void 0&&(u=this.limit),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal end: Not an integer");if(u>>>=0,a<0||a>u||u>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+u+" <= "+this.buffer.byteLength)}var p=this.clone();return p.offset=a,p.limit=u,p},c.toBuffer=function(a){var u,p=this.offset,f=this.limit;if(!this.noAssert){if(typeof p!="number"||p%1!=0)throw TypeError("Illegal offset: Not an integer");if(p>>>=0,typeof f!="number"||f%1!=0)throw TypeError("Illegal limit: Not an integer");if(f>>>=0,p<0||p>f||f>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+p+" <= "+f+" <= "+this.buffer.byteLength)}return a||p!==0||f!==this.buffer.byteLength?p===f?d:(u=new ArrayBuffer(f-p),new Uint8Array(u).set(new Uint8Array(this.buffer).subarray(p,f),0),u):this.buffer},c.toArrayBuffer=c.toBuffer,c.toString=function(a,u,p){if(a===void 0)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch(typeof a=="number"&&(p=u=a="utf8"),a){case"utf8":return this.toUTF8(u,p);case"base64":return this.toBase64(u,p);case"hex":return this.toHex(u,p);case"binary":return this.toBinary(u,p);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+a)}},v=function(){var a,u,p={},f=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],E=[];for(a=0,u=f.length;u>a;++a)E[f[a]]=a;return p.encode=function(m,y){for(var N,A;(N=m())!==null;)y(f[63&N>>2]),A=(3&N)<<4,(N=m())!==null?(y(f[63&((A|=15&N>>4)|15&N>>4)]),A=(15&N)<<2,(N=m())!==null?(y(f[63&(A|3&N>>6)]),y(f[63&N])):(y(f[63&A]),y(61))):(y(f[63&A]),y(61),y(61))},p.decode=function(m,y){function N(G){throw Error("Illegal character code: "+G)}for(var A,K,Y;(A=m())!==null;)if((K=E[A])===void 0&&N(A),(A=m())!==null&&((Y=E[A])===void 0&&N(A),y(K<<2>>>0|(48&Y)>>4),(A=m())!==null)){if((K=E[A])===void 0){if(A===61)break;N(A)}if(y((15&Y)<<4>>>0|(60&K)>>2),(A=m())!==null){if((Y=E[A])===void 0){if(A===61)break;N(A)}y((3&K)<<6>>>0|Y)}}},p.test=function(m){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(m)},p}(),c.toBase64=function(a,u){if(a===void 0&&(a=this.offset),u===void 0&&(u=this.limit),u|=0,(a|=0)<0||u>this.capacity||a>u)throw RangeError("begin, end");var p;return v.encode((function(){return u>a?this.view[a++]:null}).bind(this),p=s()),p()},T.fromBase64=function(a,u){if(typeof a!="string")throw TypeError("str");var p=new T(a.length/4*3,u),f=0;return v.decode(o(a),function(E){p.view[f++]=E}),p.limit=f,p},T.btoa=function(a){return T.fromBinary(a).toBase64()},T.atob=function(a){return T.fromBase64(a).toBinary()},c.toBinary=function(a,u){if(a===void 0&&(a=this.offset),u===void 0&&(u=this.limit),u|=0,(a|=0)<0||u>this.capacity()||a>u)throw RangeError("begin, end");if(a===u)return"";for(var p=[],f=[];u>a;)p.push(this.view[a++]),p.length>=1024&&(f.push(String.fromCharCode.apply(String,p)),p=[]);return f.join("")+String.fromCharCode.apply(String,p)},T.fromBinary=function(a,u){if(typeof a!="string")throw TypeError("str");for(var p,f=0,E=a.length,m=new T(E,u);E>f;){if((p=a.charCodeAt(f))>255)throw RangeError("illegal char code: "+p);m.view[f++]=p}return m.limit=E,m},c.toDebug=function(a){for(var u,p=-1,f=this.buffer.byteLength,E="",m="",y="";f>p;){if(p!==-1&&(E+=(u=this.view[p])<16?"0"+u.toString(16).toUpperCase():u.toString(16).toUpperCase(),a&&(m+=u>32&&u<127?String.fromCharCode(u):".")),++p,a&&p>0&&p%16==0&&p!==f){for(;E.length<51;)E+=" ";y+=E+m+`
`,E=m=""}E+=p===this.offset&&p===this.limit?p===this.markedOffset?"!":"|":p===this.offset?p===this.markedOffset?"[":"<":p===this.limit?p===this.markedOffset?"]":">":p===this.markedOffset?"'":a||p!==0&&p!==f?" ":""}if(a&&E!==" "){for(;E.length<51;)E+=" ";y+=E+m+`
`}return a?y:E},T.fromDebug=function(a,u,p){for(var f,E,m=a.length,y=new T(0|(m+1)/3,u,p),N=0,A=0,K=!1,Y=!1,G=!1,S=!1,k=!1;m>N;){switch(f=a.charAt(N++)){case"!":if(!p){if(Y||G||S){k=!0;break}Y=G=S=!0}y.offset=y.markedOffset=y.limit=A,K=!1;break;case"|":if(!p){if(Y||S){k=!0;break}Y=S=!0}y.offset=y.limit=A,K=!1;break;case"[":if(!p){if(Y||G){k=!0;break}Y=G=!0}y.offset=y.markedOffset=A,K=!1;break;case"<":if(!p){if(Y){k=!0;break}Y=!0}y.offset=A,K=!1;break;case"]":if(!p){if(S||G){k=!0;break}S=G=!0}y.limit=y.markedOffset=A,K=!1;break;case">":if(!p){if(S){k=!0;break}S=!0}y.limit=A,K=!1;break;case"'":if(!p){if(G){k=!0;break}G=!0}y.markedOffset=A,K=!1;break;case" ":K=!1;break;default:if(!p&&K){k=!0;break}if(E=parseInt(f+a.charAt(N++),16),!p&&(isNaN(E)||E<0||E>255))throw TypeError("Illegal str: Not a debug encoded string");y.view[A++]=E,K=!0}if(k)throw TypeError("Illegal str: Invalid symbol at "+N)}if(!p){if(!Y||!S)throw TypeError("Illegal str: Missing offset or limit");if(A<y.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+A+" < "+m)}return y},c.toHex=function(a,u){if(a=a===void 0?this.offset:a,u=u===void 0?this.limit:u,!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal end: Not an integer");if(u>>>=0,a<0||a>u||u>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+u+" <= "+this.buffer.byteLength)}for(var p,f=new Array(u-a);u>a;)(p=this.view[a++])<16?f.push("0",p.toString(16)):f.push(p.toString(16));return f.join("")},T.fromHex=function(a,u,p){var f,E,m,y,N;if(!p){if(typeof a!="string")throw TypeError("Illegal str: Not a string");if(a.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(E=a.length,m=new T(0|E/2,u),y=0,N=0;E>y;y+=2){if(f=parseInt(a.substring(y,y+2),16),!p&&(!isFinite(f)||f<0||f>255))throw TypeError("Illegal str: Contains non-hex characters");m.view[N++]=f}return m.limit=N,m},I=function(){var a={MAX_CODEPOINT:1114111,encodeUTF8:function(u,p){var f=null;for(typeof u=="number"&&(f=u,u=function(){return null});f!==null||(f=u())!==null;)f<128?p(127&f):f<2048?(p(192|31&f>>6),p(128|63&f)):f<65536?(p(224|15&f>>12),p(128|63&f>>6),p(128|63&f)):(p(240|7&f>>18),p(128|63&f>>12),p(128|63&f>>6),p(128|63&f)),f=null},decodeUTF8:function(u,p){for(var f,E,m,y,N=function(A){A=A.slice(0,A.indexOf(null));var K=Error(A.toString());throw K.name="TruncatedError",K.bytes=A,K};(f=u())!==null;)if(!(128&f))p(f);else if((224&f)==192)(E=u())===null&&N([f,E]),p((31&f)<<6|63&E);else if((240&f)==224)((E=u())===null||(m=u())===null)&&N([f,E,m]),p((15&f)<<12|(63&E)<<6|63&m);else{if((248&f)!=240)throw RangeError("Illegal starting byte: "+f);((E=u())===null||(m=u())===null||(y=u())===null)&&N([f,E,m,y]),p((7&f)<<18|(63&E)<<12|(63&m)<<6|63&y)}},UTF16toUTF8:function(u,p){for(var f,E=null;(f=E!==null?E:u())!==null;)f>=55296&&f<=57343&&(E=u())!==null&&E>=56320&&E<=57343?(p(1024*(f-55296)+E-56320+65536),E=null):p(f);E!==null&&p(E)},UTF8toUTF16:function(u,p){var f=null;for(typeof u=="number"&&(f=u,u=function(){return null});f!==null||(f=u())!==null;)f<=65535?p(f):(p(55296+((f-=65536)>>10)),p(f%1024+56320)),f=null},encodeUTF16toUTF8:function(u,p){a.UTF16toUTF8(u,function(f){a.encodeUTF8(f,p)})},decodeUTF8toUTF16:function(u,p){a.decodeUTF8(u,function(f){a.UTF8toUTF16(f,p)})},calculateCodePoint:function(u){return u<128?1:u<2048?2:u<65536?3:4},calculateUTF8:function(u){for(var p,f=0;(p=u())!==null;)f+=p<128?1:p<2048?2:p<65536?3:4;return f},calculateUTF16asUTF8:function(u){var p=0,f=0;return a.UTF16toUTF8(u,function(E){++p,f+=E<128?1:E<2048?2:E<65536?3:4}),[p,f]}};return a}(),c.toUTF8=function(a,u){if(a===void 0&&(a=this.offset),u===void 0&&(u=this.limit),!this.noAssert){if(typeof a!="number"||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,typeof u!="number"||u%1!=0)throw TypeError("Illegal end: Not an integer");if(u>>>=0,a<0||a>u||u>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+u+" <= "+this.buffer.byteLength)}var p;try{I.decodeUTF8toUTF16((function(){return u>a?this.view[a++]:null}).bind(this),p=s())}catch{if(a!==u)throw RangeError("Illegal range: Truncated data, "+a+" != "+u)}return p()},T.fromUTF8=function(a,u,p){if(!p&&typeof a!="string")throw TypeError("Illegal str: Not a string");var f=new T(I.calculateUTF16asUTF8(o(a),!0)[1],u,p),E=0;return I.encodeUTF16toUTF8(o(a),function(m){f.view[E++]=m}),f.limit=E,f},T}(n),r=function(i,o){var s,h,l={};return l.ByteBuffer=i,l.c=i,s=i,l.Long=o||null,l.VERSION="5.0.1",l.WIRE_TYPES={},l.WIRE_TYPES.VARINT=0,l.WIRE_TYPES.BITS64=1,l.WIRE_TYPES.LDELIM=2,l.WIRE_TYPES.STARTGROUP=3,l.WIRE_TYPES.ENDGROUP=4,l.WIRE_TYPES.BITS32=5,l.PACKABLE_WIRE_TYPES=[l.WIRE_TYPES.VARINT,l.WIRE_TYPES.BITS64,l.WIRE_TYPES.BITS32],l.TYPES={int32:{name:"int32",wireType:l.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:l.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:l.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:l.WIRE_TYPES.VARINT,defaultValue:l.Long?l.Long.ZERO:void 0},uint64:{name:"uint64",wireType:l.WIRE_TYPES.VARINT,defaultValue:l.Long?l.Long.UZERO:void 0},sint64:{name:"sint64",wireType:l.WIRE_TYPES.VARINT,defaultValue:l.Long?l.Long.ZERO:void 0},bool:{name:"bool",wireType:l.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:l.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:l.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:l.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:l.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:l.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:l.WIRE_TYPES.BITS64,defaultValue:l.Long?l.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:l.WIRE_TYPES.BITS64,defaultValue:l.Long?l.Long.ZERO:void 0},float:{name:"float",wireType:l.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:l.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:l.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:l.WIRE_TYPES.STARTGROUP,defaultValue:null}},l.MAP_KEY_TYPES=[l.TYPES.int32,l.TYPES.sint32,l.TYPES.sfixed32,l.TYPES.uint32,l.TYPES.fixed32,l.TYPES.int64,l.TYPES.sint64,l.TYPES.sfixed64,l.TYPES.uint64,l.TYPES.fixed64,l.TYPES.bool,l.TYPES.string,l.TYPES.bytes],l.ID_MIN=1,l.ID_MAX=536870911,l.convertFieldsToCamelCase=!1,l.populateAccessors=!0,l.populateDefaults=!0,l.Util=function(){var c={};return c.IS_NODE=!(typeof process!="object"||process+""!="[object process]"||process.browser),c.XHR=function(){var d,_=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],v=null;for(d=0;d<_.length;d++){try{v=_[d]()}catch{continue}break}if(!v)throw Error("XMLHttpRequest is not supported");return v},c.fetch=function(d,_){if(_&&typeof _!="function"&&(_=null),c.IS_NODE)if(_)g.readFile(d,function(I,T){_(I?null:""+T)});else try{return g.readFileSync(d)}catch{return null}else{var v=c.XHR();if(v.open("GET",d,!!_),v.setRequestHeader("Accept","text/plain"),typeof v.overrideMimeType=="function"&&v.overrideMimeType("text/plain"),!_)return v.send(null),v.status==200||v.status==0&&typeof v.responseText=="string"?v.responseText:null;if(v.onreadystatechange=function(){v.readyState==4&&(v.status==200||v.status==0&&typeof v.responseText=="string"?_(v.responseText):_(null))},v.readyState==4)return;v.send(null)}},c.toCamelCase=function(d){return d.replace(/_([a-zA-Z])/g,function(_,v){return v.toUpperCase()})},c}(),l.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},l.DotProto=function(c,d){function _(E,m){var y=-1,N=1;if(E.charAt(0)=="-"&&(N=-1,E=E.substring(1)),d.NUMBER_DEC.test(E))y=parseInt(E);else if(d.NUMBER_HEX.test(E))y=parseInt(E.substring(2),16);else{if(!d.NUMBER_OCT.test(E))throw Error("illegal id value: "+(N<0?"-":"")+E);y=parseInt(E.substring(1),8)}if(y=0|N*y,!m&&y<0)throw Error("illegal id value: "+(N<0?"-":"")+E);return y}function v(E){var m=1;if(E.charAt(0)=="-"&&(m=-1,E=E.substring(1)),d.NUMBER_DEC.test(E))return m*parseInt(E,10);if(d.NUMBER_HEX.test(E))return m*parseInt(E.substring(2),16);if(d.NUMBER_OCT.test(E))return m*parseInt(E.substring(1),8);if(E==="inf")return 1/0*m;if(E==="nan")return NaN;if(d.NUMBER_FLT.test(E))return m*parseFloat(E);throw Error("illegal number value: "+(m<0?"-":"")+E)}function I(E,m,y){E[m]===void 0?E[m]=y:(Array.isArray(E[m])||(E[m]=[E[m]]),E[m].push(y))}var T,a,u={},p=function(E){this.source=E+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},f=p.prototype;return f._readString=function(){var E,m=this._stringOpen==='"'?d.STRING_DQ:d.STRING_SQ;if(m.lastIndex=this.index-1,!(E=m.exec(this.source)))throw Error("unterminated string");return this.index=m.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,E[1]},f.next=function(){var E,m,y,N,A;if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(this._stringOpen!==null)return this._readString();do{for(E=!1;d.WHITESPACE.test(y=this.source.charAt(this.index));)if(y===`
`&&++this.line,++this.index===this.source.length)return null;if(this.source.charAt(this.index)==="/")if(++this.index,this.source.charAt(this.index)==="/"){for(;this.source.charAt(++this.index)!==`
`;)if(this.index==this.source.length)return null;++this.index,++this.line,E=!0}else{if((y=this.source.charAt(this.index))!=="*")return"/";do{if(y===`
`&&++this.line,++this.index===this.source.length)return null;m=y,y=this.source.charAt(this.index)}while(m!=="*"||y!=="/");++this.index,E=!0}}while(E);if(this.index===this.source.length)return null;if(N=this.index,d.DELIM.lastIndex=0,!d.DELIM.test(this.source.charAt(N++)))for(;N<this.source.length&&!d.DELIM.test(this.source.charAt(N));)++N;return((A=this.source.substring(this.index,this.index=N))==='"'||A==="'")&&(this._stringOpen=A),A},f.peek=function(){if(this.stack.length===0){var E=this.next();if(E===null)return null;this.stack.push(E)}return this.stack[0]},f.skip=function(E){var m=this.next();if(m!==E)throw Error("illegal '"+m+"', '"+E+"' expected")},f.omit=function(E){return this.peek()===E&&(this.next(),!0)},f.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},u.Tokenizer=p,T=function(E){this.tn=new p(E),this.proto3=!1},(a=T.prototype).parse=function(){var E,m={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},y=!0;try{for(;E=this.tn.next();)switch(E){case"package":if(!y||m.package!==null)throw Error("unexpected 'package'");if(E=this.tn.next(),!d.TYPEREF.test(E))throw Error("illegal package name: "+E);this.tn.skip(";"),m.package=E;break;case"import":if(!y)throw Error("unexpected 'import'");(E=this.tn.peek())==="public"&&this.tn.next(),E=this._readString(),this.tn.skip(";"),m.imports.push(E);break;case"syntax":if(!y)throw Error("unexpected 'syntax'");this.tn.skip("="),(m.syntax=this._readString())==="proto3"&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(m,null),y=!1;break;case"enum":this._parseEnum(m),y=!1;break;case"option":this._parseOption(m);break;case"service":this._parseService(m);break;case"extend":this._parseExtend(m);break;default:throw Error("unexpected '"+E+"'")}}catch(N){throw N.message="Parse error at line "+this.tn.line+": "+N.message,N}return delete m.name,m},T.parse=function(E){return new T(E).parse()},a._readString=function(){var E,m,y="";do{if((m=this.tn.next())!=="'"&&m!=='"')throw Error("illegal string delimiter: "+m);y+=this.tn.next(),this.tn.skip(m),E=this.tn.peek()}while(E==='"'||E==='"');return y},a._readValue=function(E){var m=this.tn.peek();if(m==='"'||m==="'")return this._readString();if(this.tn.next(),d.NUMBER.test(m))return v(m);if(d.BOOL.test(m))return m.toLowerCase()==="true";if(E&&d.TYPEREF.test(m))return m;throw Error("illegal value: "+m)},a._parseOption=function(E,m){var y,N=this.tn.next(),A=!1;if(N==="("&&(A=!0,N=this.tn.next()),!d.TYPEREF.test(N))throw Error("illegal option name: "+N);y=N,A&&(this.tn.skip(")"),y="("+y+")",N=this.tn.peek(),d.FQTYPEREF.test(N)&&(y+=N,this.tn.next())),this.tn.skip("="),this._parseOptionValue(E,y),m||this.tn.skip(";")},a._parseOptionValue=function(E,m){var y=this.tn.peek();if(y!=="{")I(E.options,m,this._readValue(!0));else for(this.tn.skip("{");(y=this.tn.next())!=="}";){if(!d.NAME.test(y))throw Error("illegal option name: "+m+"."+y);this.tn.omit(":")?I(E.options,m+"."+y,this._readValue(!0)):this._parseOptionValue(E,m+"."+y)}},a._parseService=function(E){var m,y=this.tn.next();if(!d.NAME.test(y))throw Error("illegal service name at line "+this.tn.line+": "+y);for(m={name:y,rpc:{},options:{}},this.tn.skip("{");(y=this.tn.next())!=="}";)if(y==="option")this._parseOption(m);else{if(y!=="rpc")throw Error("illegal service token: "+y);this._parseServiceRPC(m)}this.tn.omit(";"),E.services.push(m)},a._parseServiceRPC=function(E){var m,y,N="rpc",A=this.tn.next();if(!d.NAME.test(A))throw Error("illegal rpc service method name: "+A);if(m=A,y={request:null,response:null,request_stream:!1,response_stream:!1,options:{}},this.tn.skip("("),(A=this.tn.next()).toLowerCase()==="stream"&&(y.request_stream=!0,A=this.tn.next()),!d.TYPEREF.test(A))throw Error("illegal rpc service request type: "+A);if(y.request=A,this.tn.skip(")"),(A=this.tn.next()).toLowerCase()!=="returns")throw Error("illegal rpc service request type delimiter: "+A);if(this.tn.skip("("),(A=this.tn.next()).toLowerCase()==="stream"&&(y.response_stream=!0,A=this.tn.next()),y.response=A,this.tn.skip(")"),(A=this.tn.peek())==="{"){for(this.tn.next();(A=this.tn.next())!=="}";){if(A!=="option")throw Error("illegal rpc service token: "+A);this._parseOption(y)}this.tn.omit(";")}else this.tn.skip(";");E[N]===void 0&&(E[N]={}),E[N][m]=y},a._parseMessage=function(E,m){var y=!!m,N=this.tn.next(),A={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!d.NAME.test(N))throw Error("illegal "+(y?"group":"message")+" name: "+N);for(A.name=N,y&&(this.tn.skip("="),m.id=_(this.tn.next()),A.isGroup=!0),(N=this.tn.peek())==="["&&m&&this._parseFieldOptions(m),this.tn.skip("{");(N=this.tn.next())!=="}";)if(d.RULE.test(N))this._parseMessageField(A,N);else if(N==="oneof")this._parseMessageOneOf(A);else if(N==="enum")this._parseEnum(A);else if(N==="message")this._parseMessage(A);else if(N==="option")this._parseOption(A);else if(N==="service")this._parseService(A);else if(N==="extensions")A.extensions=this._parseExtensionRanges();else if(N==="reserved")this._parseIgnored();else if(N==="extend")this._parseExtend(A);else{if(!d.TYPEREF.test(N))throw Error("illegal message token: "+N);if(!this.proto3)throw Error("illegal field rule: "+N);this._parseMessageField(A,"optional",N)}return this.tn.omit(";"),E.messages.push(A),A},a._parseIgnored=function(){for(;this.tn.peek()!==";";)this.tn.next();this.tn.skip(";")},a._parseMessageField=function(E,m,y){var N,A,K;if(!d.RULE.test(m))throw Error("illegal message field rule: "+m);if(N={rule:m,type:"",name:"",options:{},id:0},m==="map"){if(y)throw Error("illegal type: "+y);if(this.tn.skip("<"),A=this.tn.next(),!d.TYPE.test(A)&&!d.TYPEREF.test(A))throw Error("illegal message field type: "+A);if(N.keytype=A,this.tn.skip(","),A=this.tn.next(),!d.TYPE.test(A)&&!d.TYPEREF.test(A))throw Error("illegal message field: "+A);if(N.type=A,this.tn.skip(">"),A=this.tn.next(),!d.NAME.test(A))throw Error("illegal message field name: "+A);N.name=A,this.tn.skip("="),N.id=_(this.tn.next()),(A=this.tn.peek())==="["&&this._parseFieldOptions(N),this.tn.skip(";")}else if((y=y!==void 0?y:this.tn.next())==="group"){if(K=this._parseMessage(E,N),!/^[A-Z]/.test(K.name))throw Error("illegal group name: "+K.name);N.type=K.name,N.name=K.name.toLowerCase(),this.tn.omit(";")}else{if(!d.TYPE.test(y)&&!d.TYPEREF.test(y))throw Error("illegal message field type: "+y);if(N.type=y,A=this.tn.next(),!d.NAME.test(A))throw Error("illegal message field name: "+A);N.name=A,this.tn.skip("="),N.id=_(this.tn.next()),(A=this.tn.peek())==="["&&this._parseFieldOptions(N),this.tn.skip(";")}return E.fields.push(N),N},a._parseMessageOneOf=function(E){var m,y,N,A=this.tn.next();if(!d.NAME.test(A))throw Error("illegal oneof name: "+A);for(y=A,N=[],this.tn.skip("{");(A=this.tn.next())!=="}";)(m=this._parseMessageField(E,"optional",A)).oneof=y,N.push(m.id);this.tn.omit(";"),E.oneofs[y]=N},a._parseFieldOptions=function(E){this.tn.skip("[");for(var m=!0;this.tn.peek()!=="]";)m||this.tn.skip(","),this._parseOption(E,!0),m=!1;this.tn.next()},a._parseEnum=function(E){var m,y={name:"",values:[],options:{}},N=this.tn.next();if(!d.NAME.test(N))throw Error("illegal name: "+N);for(y.name=N,this.tn.skip("{");(N=this.tn.next())!=="}";)if(N==="option")this._parseOption(y);else{if(!d.NAME.test(N))throw Error("illegal name: "+N);this.tn.skip("="),m={name:N,id:_(this.tn.next(),!0)},(N=this.tn.peek())==="["&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),y.values.push(m)}this.tn.omit(";"),E.enums.push(y)},a._parseExtensionRanges=function(){var E,m,y,N=[];do{for(m=[];;){switch(E=this.tn.next()){case"min":y=c.ID_MIN;break;case"max":y=c.ID_MAX;break;default:y=v(E)}if(m.push(y),m.length===2)break;if(this.tn.peek()!=="to"){m.push(y);break}this.tn.next()}N.push(m)}while(this.tn.omit(","));return this.tn.skip(";"),N},a._parseExtend=function(E){var m,y=this.tn.next();if(!d.TYPEREF.test(y))throw Error("illegal extend reference: "+y);for(m={ref:y,fields:[]},this.tn.skip("{");(y=this.tn.next())!=="}";)if(d.RULE.test(y))this._parseMessageField(m,y);else{if(!d.TYPEREF.test(y))throw Error("illegal extend token: "+y);if(!this.proto3)throw Error("illegal field rule: "+y);this._parseMessageField(m,"optional",y)}return this.tn.omit(";"),E.messages.push(m),m},a.toString=function(){return"Parser at line "+this.tn.line},u.Parser=T,u}(l,l.Lang),l.Reflect=function(c){function d(C,O){if(C&&typeof C.low=="number"&&typeof C.high=="number"&&typeof C.unsigned=="boolean"&&C.low==C.low&&C.high==C.high)return new c.Long(C.low,C.high,O===void 0?C.unsigned:O);if(typeof C=="string")return c.Long.fromString(C,O||!1,10);if(typeof C=="number")return c.Long.fromNumber(C,O||!1);throw Error("not convertible to Long")}function _(C,O){var U=O.readVarint32(),w=7&U,b=U>>>3;switch(w){case c.WIRE_TYPES.VARINT:do U=O.readUint8();while((128&U)==128);break;case c.WIRE_TYPES.BITS64:O.offset+=8;break;case c.WIRE_TYPES.LDELIM:U=O.readVarint32(),O.offset+=U;break;case c.WIRE_TYPES.STARTGROUP:_(b,O);break;case c.WIRE_TYPES.ENDGROUP:if(b===C)return!1;throw Error("Illegal GROUPEND after unknown group: "+b+" ("+C+" expected)");case c.WIRE_TYPES.BITS32:O.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+C+": "+w)}return!0}var v,I,T,a,u,p,f,E,m,y,N,A,K,Y,G,S,k={},j=function(C,O,U){this.builder=C,this.parent=O,this.name=U,this.className},tt=j.prototype;return tt.fqn=function(){for(var C=this.name,O=this;(O=O.parent)!=null;)C=O.name+"."+C;return C},tt.toString=function(C){return(C?this.className+" ":"")+this.fqn()},tt.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},k.T=j,v=function(C,O,U,w,b){j.call(this,C,O,U),this.className="Namespace",this.children=[],this.options=w||{},this.syntax=b||"proto2"},(I=v.prototype=Object.create(j.prototype)).getChildren=function(C){var O,U,w;if((C=C||null)==null)return this.children.slice();for(O=[],U=0,w=this.children.length;w>U;++U)this.children[U]instanceof C&&O.push(this.children[U]);return O},I.addChild=function(C){var O;if(O=this.getChild(C.name))if(O instanceof u.Field&&O.name!==O.originalName&&this.getChild(O.originalName)===null)O.name=O.originalName;else{if(!(C instanceof u.Field&&C.name!==C.originalName&&this.getChild(C.originalName)===null))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+C.name);C.name=C.originalName}this.children.push(C)},I.getChild=function(C){var O,U,w=typeof C=="number"?"id":"name";for(O=0,U=this.children.length;U>O;++O)if(this.children[O][w]===C)return this.children[O];return null},I.resolve=function(C,O){var U,w=typeof C=="string"?C.split("."):C,b=this,x=0;if(w[x]===""){for(;b.parent!==null;)b=b.parent;x++}do{do{if(!(b instanceof k.Namespace)){b=null;break}if(!((U=b.getChild(w[x]))&&U instanceof k.T&&(!O||U instanceof k.Namespace))){b=null;break}b=U,x++}while(x<w.length);if(b!=null)break;if(this.parent!==null)return this.parent.resolve(C,O)}while(b!=null);return b},I.qn=function(C){var O,U,w=[],b=C;do w.unshift(b.name),b=b.parent;while(b!==null);for(O=1;O<=w.length;O++)if(U=w.slice(w.length-O),C===this.resolve(U,C instanceof k.Namespace))return U.join(".");return C.fqn()},I.build=function(){var C,O,U,w={},b=this.children;for(O=0,U=b.length;U>O;++O)(C=b[O])instanceof v&&(w[C.name]=C.build());return Object.defineProperty&&Object.defineProperty(w,"$options",{value:this.buildOpt()}),w},I.buildOpt=function(){var C,O,U,w,b={},x=Object.keys(this.options);for(C=0,O=x.length;O>C;++C)U=x[C],w=this.options[x[C]],b[U]=w;return b},I.getOption=function(C){return C===void 0?this.options:this.options[C]!==void 0?this.options[C]:null},k.Namespace=v,T=function(C,O,U,w){if(this.type=C,this.resolvedType=O,this.isMapKey=U,this.syntax=w,U&&c.MAP_KEY_TYPES.indexOf(C)<0)throw Error("Invalid map key type: "+C.name)},a=T.prototype,T.defaultFieldValue=function(C){if(typeof C=="string"&&(C=c.TYPES[C]),C.defaultValue===void 0)throw Error("default value for type "+C.name+" is not supported");return C==c.TYPES.bytes?new s(0):C.defaultValue},a.verifyValue=function(C){var O,U,w,b=(function(x,H){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+x+" ("+H+")")}).bind(this);switch(this.type){case c.TYPES.int32:case c.TYPES.sint32:case c.TYPES.sfixed32:return(typeof C!="number"||C==C&&C%1!=0)&&b(typeof C,"not an integer"),C>4294967295?0|C:C;case c.TYPES.uint32:case c.TYPES.fixed32:return(typeof C!="number"||C==C&&C%1!=0)&&b(typeof C,"not an integer"),C<0?C>>>0:C;case c.TYPES.int64:case c.TYPES.sint64:case c.TYPES.sfixed64:if(c.Long)try{return d(C,!1)}catch(x){b(typeof C,x.message)}else b(typeof C,"requires Long.js");case c.TYPES.uint64:case c.TYPES.fixed64:if(c.Long)try{return d(C,!0)}catch(x){b(typeof C,x.message)}else b(typeof C,"requires Long.js");case c.TYPES.bool:return typeof C!="boolean"&&b(typeof C,"not a boolean"),C;case c.TYPES.float:case c.TYPES.double:return typeof C!="number"&&b(typeof C,"not a number"),C;case c.TYPES.string:return typeof C=="string"||C&&C instanceof String||b(typeof C,"not a string"),""+C;case c.TYPES.bytes:return i.isByteBuffer(C)?C:i.wrap(C);case c.TYPES.enum:for(O=this.resolvedType.getChildren(c.Reflect.Enum.Value),w=0;w<O.length;w++)if(O[w].name==C||O[w].id==C)return O[w].id;if(this.syntax==="proto3")return(typeof C!="number"||C==C&&C%1!=0)&&b(typeof C,"not an integer"),(C>4294967295||C<0)&&b(typeof C,"not in range for uint32"),C;b(C,"not a valid enum value");case c.TYPES.group:case c.TYPES.message:if(C&&typeof C=="object"||b(typeof C,"object expected"),C instanceof this.resolvedType.clazz)return C;if(C instanceof c.Builder.Message){for(w in U={},C)C.hasOwnProperty(w)&&(U[w]=C[w]);C=U}return new this.resolvedType.clazz(C)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+C+" (undefined type "+this.type+")")},a.calculateLength=function(C,O){if(O===null)return 0;var U;switch(this.type){case c.TYPES.int32:return O<0?s.calculateVarint64(O):s.calculateVarint32(O);case c.TYPES.uint32:return s.calculateVarint32(O);case c.TYPES.sint32:return s.calculateVarint32(s.zigZagEncode32(O));case c.TYPES.fixed32:case c.TYPES.sfixed32:case c.TYPES.float:return 4;case c.TYPES.int64:case c.TYPES.uint64:return s.calculateVarint64(O);case c.TYPES.sint64:return s.calculateVarint64(s.zigZagEncode64(O));case c.TYPES.fixed64:case c.TYPES.sfixed64:return 8;case c.TYPES.bool:return 1;case c.TYPES.enum:return s.calculateVarint32(O);case c.TYPES.double:return 8;case c.TYPES.string:return U=s.calculateUTF8Bytes(O),s.calculateVarint32(U)+U;case c.TYPES.bytes:if(O.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+O.remaining()+" bytes remaining");return s.calculateVarint32(O.remaining())+O.remaining();case c.TYPES.message:return U=this.resolvedType.calculate(O),s.calculateVarint32(U)+U;case c.TYPES.group:return(U=this.resolvedType.calculate(O))+s.calculateVarint32(C<<3|c.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+O+" (unknown type)")},a.encodeValue=function(C,O,U){var w,b;if(O===null)return U;switch(this.type){case c.TYPES.int32:O<0?U.writeVarint64(O):U.writeVarint32(O);break;case c.TYPES.uint32:U.writeVarint32(O);break;case c.TYPES.sint32:U.writeVarint32ZigZag(O);break;case c.TYPES.fixed32:U.writeUint32(O);break;case c.TYPES.sfixed32:U.writeInt32(O);break;case c.TYPES.int64:case c.TYPES.uint64:U.writeVarint64(O);break;case c.TYPES.sint64:U.writeVarint64ZigZag(O);break;case c.TYPES.fixed64:U.writeUint64(O);break;case c.TYPES.sfixed64:U.writeInt64(O);break;case c.TYPES.bool:typeof O=="string"?U.writeVarint32(O.toLowerCase()==="false"?0:!!O):U.writeVarint32(O?1:0);break;case c.TYPES.enum:U.writeVarint32(O);break;case c.TYPES.float:U.writeFloat32(O);break;case c.TYPES.double:U.writeFloat64(O);break;case c.TYPES.string:U.writeVString(O);break;case c.TYPES.bytes:if(O.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+O.remaining()+" bytes remaining");w=O.offset,U.writeVarint32(O.remaining()),U.append(O),O.offset=w;break;case c.TYPES.message:b=new s().LE(),this.resolvedType.encode(O,b),U.writeVarint32(b.offset),U.append(b.flip());break;case c.TYPES.group:this.resolvedType.encode(O,U),U.writeVarint32(C<<3|c.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+O+" (unknown type)")}return U},a.decode=function(C,O,U){if(O!=this.type.wireType)throw Error("Unexpected wire type for element");var w,b;switch(this.type){case c.TYPES.int32:return 0|C.readVarint32();case c.TYPES.uint32:return C.readVarint32()>>>0;case c.TYPES.sint32:return 0|C.readVarint32ZigZag();case c.TYPES.fixed32:return C.readUint32()>>>0;case c.TYPES.sfixed32:return 0|C.readInt32();case c.TYPES.int64:return C.readVarint64();case c.TYPES.uint64:return C.readVarint64().toUnsigned();case c.TYPES.sint64:return C.readVarint64ZigZag();case c.TYPES.fixed64:return C.readUint64();case c.TYPES.sfixed64:return C.readInt64();case c.TYPES.bool:return!!C.readVarint32();case c.TYPES.enum:return C.readVarint32();case c.TYPES.float:return C.readFloat();case c.TYPES.double:return C.readDouble();case c.TYPES.string:return C.readVString();case c.TYPES.bytes:if(b=C.readVarint32(),C.remaining()<b)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+b+" required but got only "+C.remaining());return(w=C.clone()).limit=w.offset+b,C.offset+=b,w;case c.TYPES.message:return b=C.readVarint32(),this.resolvedType.decode(C,b);case c.TYPES.group:return this.resolvedType.decode(C,-1,U)}throw Error("[INTERNAL] Illegal decode type")},a.valueFromString=function(C){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case c.TYPES.int32:case c.TYPES.sint32:case c.TYPES.sfixed32:case c.TYPES.uint32:case c.TYPES.fixed32:return this.verifyValue(parseInt(C));case c.TYPES.int64:case c.TYPES.sint64:case c.TYPES.sfixed64:case c.TYPES.uint64:case c.TYPES.fixed64:return this.verifyValue(C);case c.TYPES.bool:return C==="true";case c.TYPES.string:return this.verifyValue(C);case c.TYPES.bytes:return s.fromBinary(C)}},a.valueToString=function(C){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===c.TYPES.bytes?C.toString("binary"):C.toString()},k.Element=T,u=function(C,O,U,w,b,x){v.call(this,C,O,U,w,x),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!b,this._fields=null,this._fieldsById=null,this._fieldsByName=null},(p=u.prototype=Object.create(v.prototype)).build=function(C){var O,U,w,b;if(this.clazz&&!C)return this.clazz;for(O=function(x,H){function Q(D,W,z,$){var rt,ht,we,he,On,Nn,Qt;if(D===null||typeof D!="object")return $&&$ instanceof x.Reflect.Enum&&(rt=x.Reflect.Enum.getName($.object,D))!==null?rt:D;if(s.isByteBuffer(D))return W?D.toBase64():D.toBuffer();if(x.Long.isLong(D))return z?D.toString():x.Long.fromValue(D);if(Array.isArray(D))return ht=[],D.forEach(function(Ko,qo){ht[qo]=Q(Ko,W,z,$)}),ht;if(ht={},D instanceof x.Map){for(he=(we=D.entries()).next();!he.done;he=we.next())ht[D.keyElem.valueToString(he.value[0])]=Q(he.value[1],W,z,D.valueElem.resolvedType);return ht}for(Qt in On=D.$type,Nn=void 0,D)D.hasOwnProperty(Qt)&&(ht[Qt]=On&&(Nn=On.getChild(Qt))?Q(D[Qt],W,z,Nn.resolvedType):Q(D[Qt],W,z));return ht}var J,st,at=H.getChildren(x.Reflect.Message.Field),Tt=H.getChildren(x.Reflect.Message.OneOf),gt=function(D){var W,z,$,rt;for(x.Builder.Message.call(this),W=0,z=Tt.length;z>W;++W)this[Tt[W].name]=null;for(W=0,z=at.length;z>W;++W)this[($=at[W]).name]=$.repeated?[]:$.map?new x.Map($):null,!$.required&&H.syntax!=="proto3"||$.defaultValue===null||(this[$.name]=$.defaultValue);if(arguments.length>0)if(arguments.length!==1||D===null||typeof D!="object"||!(typeof D.encode!="function"||D instanceof gt)||Array.isArray(D)||D instanceof x.Map||s.isByteBuffer(D)||D instanceof ArrayBuffer||x.Long&&D instanceof x.Long)for(W=0,z=arguments.length;z>W;++W)(rt=arguments[W])!==void 0&&this.$set(at[W].name,rt);else this.$set(D)},et=gt.prototype=Object.create(x.Builder.Message.prototype);for(et.add=function(D,W,z){var $=H._fieldsByName[D];if(!z){if(!$)throw Error(this+"#"+D+" is undefined");if(!($ instanceof x.Reflect.Message.Field))throw Error(this+"#"+D+" is not a field: "+$.toString(!0));if(!$.repeated)throw Error(this+"#"+D+" is not a repeated field");W=$.verifyValue(W,!0)}return this[D]===null&&(this[D]=[]),this[D].push(W),this},et.$add=et.add,et.set=function(D,W,z){var $,rt,ht;if(D&&typeof D=="object"){for($ in z=W,D)D.hasOwnProperty($)&&(W=D[$])!==void 0&&this.$set($,W,z);return this}if(rt=H._fieldsByName[D],z)this[D]=W;else{if(!rt)throw Error(this+"#"+D+" is not a field: undefined");if(!(rt instanceof x.Reflect.Message.Field))throw Error(this+"#"+D+" is not a field: "+rt.toString(!0));this[rt.name]=W=rt.verifyValue(W)}return rt&&rt.oneof&&(ht=this[rt.oneof.name],W!==null?(ht!==null&&ht!==rt.name&&(this[ht]=null),this[rt.oneof.name]=rt.name):ht===D&&(this[rt.oneof.name]=null)),this},et.$set=et.set,et.get=function(D,W){if(W)return this[D];var z=H._fieldsByName[D];if(!(z&&z instanceof x.Reflect.Message.Field))throw Error(this+"#"+D+" is not a field: undefined");if(!(z instanceof x.Reflect.Message.Field))throw Error(this+"#"+D+" is not a field: "+z.toString(!0));return this[z.name]},et.$get=et.get,J=0;J<at.length;J++)(st=at[J])instanceof x.Reflect.Message.ExtensionField||H.builder.options.populateAccessors&&function(D){var W,z,$,rt=D.originalName.replace(/(_[a-zA-Z])/g,function(ht){return ht.toUpperCase().replace("_","")});rt=rt.substring(0,1).toUpperCase()+rt.substring(1),W=D.originalName.replace(/([A-Z])/g,function(ht){return"_"+ht}),z=function(ht,we){return this[D.name]=we?ht:D.verifyValue(ht),this},$=function(){return this[D.name]},H.getChild("set"+rt)===null&&(et["set"+rt]=z),H.getChild("set_"+W)===null&&(et["set_"+W]=z),H.getChild("get"+rt)===null&&(et["get"+rt]=$),H.getChild("get_"+W)===null&&(et["get_"+W]=$)}(st);return et.encode=function(D,W){var z,$;typeof D=="boolean"&&(W=D,D=void 0),z=!1,D||(D=new i,z=!0),$=D.littleEndian;try{return H.encode(this,D.LE(),W),(z?D.flip():D).LE($)}catch(rt){throw D.LE($),rt}},gt.encode=function(D,W,z){return new gt(D).encode(W,z)},et.calculate=function(){return H.calculate(this)},et.encodeDelimited=function(D){var W,z=!1;return D||(D=new s,z=!0),W=new s().LE(),H.encode(this,W).flip(),D.writeVarint32(W.remaining()),D.append(W),z?D.flip():D},et.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(D){throw D.encoded&&(D.encoded=D.encoded.toArrayBuffer()),D}},et.toArrayBuffer=et.encodeAB,et.encodeNB=function(){try{return this.encode().toBuffer()}catch(D){throw D.encoded&&(D.encoded=D.encoded.toBuffer()),D}},et.toBuffer=et.encodeNB,et.encode64=function(){try{return this.encode().toBase64()}catch(D){throw D.encoded&&(D.encoded=D.encoded.toBase64()),D}},et.toBase64=et.encode64,et.encodeHex=function(){try{return this.encode().toHex()}catch(D){throw D.encoded&&(D.encoded=D.encoded.toHex()),D}},et.toHex=et.encodeHex,et.toRaw=function(D,W){return Q(this,!!D,!!W,this.$type)},et.encodeJSON=function(){return JSON.stringify(Q(this,!0,!0,this.$type))},gt.decode=function(D,W){var z,$;typeof D=="string"&&(D=s.wrap(D,W||"base64")),z=(D=s.isByteBuffer(D)?D:s.wrap(D)).littleEndian;try{return $=H.decode(D.LE()),D.LE(z),$}catch(rt){throw D.LE(z),rt}},gt.decodeDelimited=function(D,W){var z,$,rt;if(typeof D=="string"&&(D=s.wrap(D,W||"base64")),(D=s.isByteBuffer(D)?D:s.wrap(D)).remaining()<1)return null;if(z=D.offset,$=D.readVarint32(),D.remaining()<$)return D.offset=z,null;try{return rt=H.decode(D.slice(D.offset,D.offset+$).LE()),D.offset+=$,rt}catch(ht){throw D.offset+=$,ht}},gt.decode64=function(D){return gt.decode(D,"base64")},gt.decodeHex=function(D){return gt.decode(D,"hex")},gt.decodeJSON=function(D){return new gt(JSON.parse(D))},et.toString=function(){return H.toString()},Object.defineProperty&&(Object.defineProperty(gt,"$options",{value:H.buildOpt()}),Object.defineProperty(et,"$options",{value:gt.$options}),Object.defineProperty(gt,"$type",{value:H}),Object.defineProperty(et,"$type",{value:H})),gt}(c,this),this._fields=[],this._fieldsById={},this._fieldsByName={},w=0,b=this.children.length;b>w;w++)if((U=this.children[w])instanceof N||U instanceof u||U instanceof Y){if(O.hasOwnProperty(U.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+U.toString(!0)+" cannot override static property '"+U.name+"'");O[U.name]=U.build()}else if(U instanceof u.Field)U.build(),this._fields.push(U),this._fieldsById[U.id]=U,this._fieldsByName[U.name]=U;else if(!(U instanceof u.OneOf||U instanceof K))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[w].toString(!0));return this.clazz=O},p.encode=function(C,O,U){var w,b,x,H,Q,J=null;for(x=0,H=this._fields.length;H>x;++x)b=C[(w=this._fields[x]).name],w.required&&b===null?J===null&&(J=w):w.encode(U?b:w.verifyValue(b),O,C);if(J!==null)throw(Q=Error("Missing at least one required field for "+this.toString(!0)+": "+J)).encoded=O,Q;return O},p.calculate=function(C){for(var O,U,w=0,b=0,x=this._fields.length;x>b;++b){if(U=C[(O=this._fields[b]).name],O.required&&U===null)throw Error("Missing at least one required field for "+this.toString(!0)+": "+O);w+=O.calculate(U,C)}return w},p.decode=function(C,O,U){var w,b,x,H,Q,J,st,at,Tt,gt,et,D;for(O=typeof O=="number"?O:-1,Q=C.offset,J=new this.clazz;C.offset<Q+O||O===-1&&C.remaining()>0;){if(x=(w=C.readVarint32())>>>3,(b=7&w)===c.WIRE_TYPES.ENDGROUP){if(x!==U)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+x+" ("+(U?U+" expected":"not a group")+")");break}if(H=this._fieldsById[x])H.repeated&&!H.options.packed?J[H.name].push(H.decode(b,C)):H.map?(at=H.decode(b,C),J[H.name].set(at[0],at[1])):(J[H.name]=H.decode(b,C),H.oneof&&((Tt=J[H.oneof.name])!==null&&Tt!==H.name&&(J[Tt]=null),J[H.oneof.name]=H.name));else switch(b){case c.WIRE_TYPES.VARINT:C.readVarint32();break;case c.WIRE_TYPES.BITS32:C.offset+=4;break;case c.WIRE_TYPES.BITS64:C.offset+=8;break;case c.WIRE_TYPES.LDELIM:st=C.readVarint32(),C.offset+=st;break;case c.WIRE_TYPES.STARTGROUP:for(;_(x,C););break;default:throw Error("Illegal wire type for unknown field "+x+" in "+this.toString(!0)+"#decode: "+b)}}for(gt=0,et=this._fields.length;et>gt;++gt)if(J[(H=this._fields[gt]).name]===null)if(this.syntax==="proto3")J[H.name]=H.defaultValue;else{if(H.required)throw(D=Error("Missing at least one required field for "+this.toString(!0)+": "+H.name)).decoded=J,D;c.populateDefaults&&H.defaultValue!==null&&(J[H.name]=H.defaultValue)}return J},k.Message=u,f=function(C,O,U,w,b,x,H,Q,J,st){j.call(this,C,O,x),this.className="Message.Field",this.required=U==="required",this.repeated=U==="repeated",this.map=U==="map",this.keyType=w||null,this.type=b,this.resolvedType=null,this.id=H,this.options=Q||{},this.defaultValue=null,this.oneof=J||null,this.syntax=st||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof u.ExtensionField||(this.name=c.Util.toCamelCase(this.name))},(E=f.prototype=Object.create(j.prototype)).build=function(){this.element=new T(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new T(this.keyType,void 0,!0,this.syntax)),this.syntax!=="proto3"||this.repeated||this.map?this.options.default!==void 0&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=T.defaultFieldValue(this.type)},E.verifyValue=function(C,O){var U,w,b;if(O=O||!1,U=(function(x,H){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+x+" ("+H+")")}).bind(this),C===null)return this.required&&U(typeof C,"required"),this.syntax==="proto3"&&this.type!==c.TYPES.message&&U(typeof C,"proto3 field without field presence cannot be null"),null;if(this.repeated&&!O){for(Array.isArray(C)||(C=[C]),b=[],w=0;w<C.length;w++)b.push(this.element.verifyValue(C[w]));return b}return this.map&&!O?C instanceof c.Map?C:(C instanceof Object||U(typeof C,"expected ProtoBuf.Map or raw object for map field"),new c.Map(this,C)):(!this.repeated&&Array.isArray(C)&&U(typeof C,"no array expected"),this.element.verifyValue(C))},E.hasWirePresence=function(C,O){if(this.syntax!=="proto3")return C!==null;if(this.oneof&&O[this.oneof.name]===this.name)return!0;switch(this.type){case c.TYPES.int32:case c.TYPES.sint32:case c.TYPES.sfixed32:case c.TYPES.uint32:case c.TYPES.fixed32:return C!==0;case c.TYPES.int64:case c.TYPES.sint64:case c.TYPES.sfixed64:case c.TYPES.uint64:case c.TYPES.fixed64:return C.low!==0||C.high!==0;case c.TYPES.bool:return C;case c.TYPES.float:case c.TYPES.double:return C!==0;case c.TYPES.string:return C.length>0;case c.TYPES.bytes:return C.remaining()>0;case c.TYPES.enum:return C!==0;case c.TYPES.message:return C!==null;default:return!0}},E.encode=function(C,O,U){var w,b,x,H,Q;if(this.type===null||typeof this.type!="object")throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(C===null||this.repeated&&C.length==0)return O;try{if(this.repeated)if(this.options.packed&&c.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(O.writeVarint32(this.id<<3|c.WIRE_TYPES.LDELIM),O.ensureCapacity(O.offset+=1),b=O.offset,w=0;w<C.length;w++)this.element.encodeValue(this.id,C[w],O);x=O.offset-b,(H=s.calculateVarint32(x))>1&&(Q=O.slice(b,O.offset),b+=H-1,O.offset=b,O.append(Q)),O.writeVarint32(x,b-H)}else for(w=0;w<C.length;w++)O.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,C[w],O);else this.map?C.forEach(function(J,st){var at=s.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,st)+s.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,J);O.writeVarint32(this.id<<3|c.WIRE_TYPES.LDELIM),O.writeVarint32(at),O.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,st,O),O.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,J,O)},this):this.hasWirePresence(C,U)&&(O.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,C,O))}catch(J){throw Error("Illegal value for "+this.toString(!0)+": "+C+" ("+J+")")}return O},E.calculate=function(C,O){var U,w,b;if(C=this.verifyValue(C),this.type===null||typeof this.type!="object")throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(C===null||this.repeated&&C.length==0)return 0;U=0;try{if(this.repeated)if(this.options.packed&&c.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(U+=s.calculateVarint32(this.id<<3|c.WIRE_TYPES.LDELIM),b=0,w=0;w<C.length;w++)b+=this.element.calculateLength(this.id,C[w]);U+=s.calculateVarint32(b),U+=b}else for(w=0;w<C.length;w++)U+=s.calculateVarint32(this.id<<3|this.type.wireType),U+=this.element.calculateLength(this.id,C[w]);else this.map?C.forEach(function(x,H){var Q=s.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,H)+s.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,x);U+=s.calculateVarint32(this.id<<3|c.WIRE_TYPES.LDELIM),U+=s.calculateVarint32(Q),U+=Q},this):this.hasWirePresence(C,O)&&(U+=s.calculateVarint32(this.id<<3|this.type.wireType),U+=this.element.calculateLength(this.id,C))}catch(x){throw Error("Illegal value for "+this.toString(!0)+": "+C+" ("+x+")")}return U},E.decode=function(C,O,U){var w,b,x,H,Q,J,st;if(!(!this.map&&C==this.type.wireType||!U&&this.repeated&&this.options.packed&&C==c.WIRE_TYPES.LDELIM||this.map&&C==c.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+C+" ("+this.type.wireType+" expected)");if(C==c.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&c.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!U){for(b=O.readVarint32(),b=O.offset+b,x=[];O.offset<b;)x.push(this.decode(this.type.wireType,O,!0));return x}if(this.map){if(H=T.defaultFieldValue(this.keyType),w=T.defaultFieldValue(this.type),b=O.readVarint32(),O.remaining()<b)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+b+" required but got only "+O.remaining());for((Q=O.clone()).limit=Q.offset+b,O.offset+=b;Q.remaining()>0;)if(C=7&(J=Q.readVarint32()),(st=J>>>3)===1)H=this.keyElement.decode(Q,C,st);else{if(st!==2)throw Error("Unexpected tag in map field key/value submessage");w=this.element.decode(Q,C,st)}return[H,w]}return this.element.decode(O,C,this.id)},k.Message.Field=f,m=function(C,O,U,w,b,x,H){f.call(this,C,O,U,null,w,b,x,H),this.extension},m.prototype=Object.create(f.prototype),k.Message.ExtensionField=m,y=function(C,O,U){j.call(this,C,O,U),this.fields=[]},k.Message.OneOf=y,N=function(C,O,U,w,b){v.call(this,C,O,U,w,b),this.className="Enum",this.object=null},N.getName=function(C,O){var U,w,b=Object.keys(C);for(w=0;w<b.length;++w)if(C[U=b[w]]===O)return U;return null},(N.prototype=Object.create(v.prototype)).build=function(C){var O,U,w,b;if(this.object&&!C)return this.object;for(O=new c.Builder.Enum,w=0,b=(U=this.getChildren(N.Value)).length;b>w;++w)O[U[w].name]=U[w].id;return Object.defineProperty&&Object.defineProperty(O,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=O},k.Enum=N,A=function(C,O,U,w){j.call(this,C,O,U),this.className="Enum.Value",this.id=w},A.prototype=Object.create(j.prototype),k.Enum.Value=A,K=function(C,O,U,w){j.call(this,C,O,U),this.field=w},K.prototype=Object.create(j.prototype),k.Extension=K,Y=function(C,O,U,w){v.call(this,C,O,U,w),this.className="Service",this.clazz=null},(Y.prototype=Object.create(v.prototype)).build=function(C){return this.clazz&&!C?this.clazz:this.clazz=function(O,U){var w,b=function(Q){O.Builder.Service.call(this),this.rpcImpl=Q||function(J,st,at){setTimeout(at.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},x=b.prototype=Object.create(O.Builder.Service.prototype),H=U.getChildren(O.Reflect.Service.RPCMethod);for(w=0;w<H.length;w++)(function(Q){x[Q.name]=function(J,st){try{try{J=Q.resolvedRequestType.clazz.decode(s.wrap(J))}catch(at){if(!(at instanceof TypeError))throw at}if(J===null||typeof J!="object")throw Error("Illegal arguments");J instanceof Q.resolvedRequestType.clazz||(J=new Q.resolvedRequestType.clazz(J)),this.rpcImpl(Q.fqn(),J,function(at,Tt){if(!at){try{Tt=Q.resolvedResponseType.clazz.decode(Tt)}catch{}return Tt&&Tt instanceof Q.resolvedResponseType.clazz?void st(null,Tt):void st(Error("Illegal response type received in service method "+U.name+"#"+Q.name))}st(at)})}catch(at){setTimeout(st.bind(this,at),0)}},b[Q.name]=function(J,st,at){new b(J)[Q.name](st,at)},Object.defineProperty&&(Object.defineProperty(b[Q.name],"$options",{value:Q.buildOpt()}),Object.defineProperty(x[Q.name],"$options",{value:b[Q.name].$options}))})(H[w]);return Object.defineProperty&&(Object.defineProperty(b,"$options",{value:U.buildOpt()}),Object.defineProperty(x,"$options",{value:b.$options}),Object.defineProperty(b,"$type",{value:U}),Object.defineProperty(x,"$type",{value:U})),b}(c,this)},k.Service=Y,G=function(C,O,U,w){j.call(this,C,O,U),this.className="Service.Method",this.options=w||{}},(G.prototype=Object.create(j.prototype)).buildOpt=I.buildOpt,k.Service.Method=G,S=function(C,O,U,w,b,x,H,Q){G.call(this,C,O,U,Q),this.className="Service.RPCMethod",this.requestName=w,this.responseName=b,this.requestStream=x,this.responseStream=H,this.resolvedRequestType=null,this.resolvedResponseType=null},S.prototype=Object.create(G.prototype),k.Service.RPCMethod=S,k}(l),l.Builder=function(c,d,_){function v(a){a.messages&&a.messages.forEach(function(u){u.syntax=a.syntax,v(u)}),a.enums&&a.enums.forEach(function(u){u.syntax=a.syntax})}var I=function(a){this.ns=new _.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=a||{}},T=I.prototype;return I.isMessage=function(a){return typeof a.name=="string"&&a.values===void 0&&a.rpc===void 0},I.isMessageField=function(a){return typeof a.rule=="string"&&typeof a.name=="string"&&typeof a.type=="string"&&a.id!==void 0},I.isEnum=function(a){return typeof a.name=="string"&&!(a.values===void 0||!Array.isArray(a.values)||a.values.length===0)},I.isService=function(a){return!(typeof a.name!="string"||typeof a.rpc!="object"||!a.rpc)},I.isExtend=function(a){return typeof a.ref=="string"},T.reset=function(){return this.ptr=this.ns,this},T.define=function(a){if(typeof a!="string"||!d.TYPEREF.test(a))throw Error("illegal namespace: "+a);return a.split(".").forEach(function(u){var p=this.ptr.getChild(u);p===null&&this.ptr.addChild(p=new _.Namespace(this,this.ptr,u)),this.ptr=p},this),this},T.create=function(a){var u,p,f,E,m;if(!a)return this;if(Array.isArray(a)){if(a.length===0)return this;a=a.slice()}else a=[a];for(u=[a];u.length>0;){if(a=u.pop(),!Array.isArray(a))throw Error("not a valid namespace: "+JSON.stringify(a));for(;a.length>0;){if(p=a.shift(),I.isMessage(p)){if(f=new _.Message(this,this.ptr,p.name,p.options,p.isGroup,p.syntax),E={},p.oneofs&&Object.keys(p.oneofs).forEach(function(y){f.addChild(E[y]=new _.Message.OneOf(this,f,y))},this),p.fields&&p.fields.forEach(function(y){if(f.getChild(0|y.id)!==null)throw Error("duplicate or invalid field id in "+f.name+": "+y.id);if(y.options&&typeof y.options!="object")throw Error("illegal field options in "+f.name+"#"+y.name);var N=null;if(typeof y.oneof=="string"&&!(N=E[y.oneof]))throw Error("illegal oneof in "+f.name+"#"+y.name+": "+y.oneof);y=new _.Message.Field(this,f,y.rule,y.keytype,y.type,y.name,y.id,y.options,N,p.syntax),N&&N.fields.push(y),f.addChild(y)},this),m=[],p.enums&&p.enums.forEach(function(y){m.push(y)}),p.messages&&p.messages.forEach(function(y){m.push(y)}),p.services&&p.services.forEach(function(y){m.push(y)}),p.extensions&&(f.extensions=typeof p.extensions[0]=="number"?[p.extensions]:p.extensions),this.ptr.addChild(f),m.length>0){u.push(a),a=m,m=null,this.ptr=f,f=null;continue}m=null}else if(I.isEnum(p))f=new _.Enum(this,this.ptr,p.name,p.options,p.syntax),p.values.forEach(function(y){f.addChild(new _.Enum.Value(this,f,y.name,y.id))},this),this.ptr.addChild(f);else if(I.isService(p))f=new _.Service(this,this.ptr,p.name,p.options),Object.keys(p.rpc).forEach(function(y){var N=p.rpc[y];f.addChild(new _.Service.RPCMethod(this,f,y,N.request,N.response,!!N.request_stream,!!N.response_stream,N.options))},this),this.ptr.addChild(f);else{if(!I.isExtend(p))throw Error("not a valid definition: "+JSON.stringify(p));if(f=this.ptr.resolve(p.ref,!0))p.fields.forEach(function(y){var N,A,K,Y;if(f.getChild(0|y.id)!==null)throw Error("duplicate extended field id in "+f.name+": "+y.id);if(f.extensions&&(N=!1,f.extensions.forEach(function(G){y.id>=G[0]&&y.id<=G[1]&&(N=!0)}),!N))throw Error("illegal extended field id in "+f.name+": "+y.id+" (not within valid ranges)");A=y.name,this.options.convertFieldsToCamelCase&&(A=c.Util.toCamelCase(A)),K=new _.Message.ExtensionField(this,f,y.rule,y.type,this.ptr.fqn()+"."+A,y.id,y.options),Y=new _.Extension(this,this.ptr,y.name,K),K.extension=Y,this.ptr.addChild(Y),f.addChild(K)},this);else if(!/\.?google\.protobuf\./.test(p.ref))throw Error("extended message "+p.ref+" is not defined")}p=null,f=null}a=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},T.import=function(a,u){var p,f,E,m,y,N,A,K,Y="/";if(typeof u=="string"){if(c.Util.IS_NODE,this.files[u]===!0)return this.reset();this.files[u]=!0}else if(typeof u=="object"){if(p=u.root,c.Util.IS_NODE,(p.indexOf("\\")>=0||u.file.indexOf("\\")>=0)&&(Y="\\"),f=p+Y+u.file,this.files[f]===!0)return this.reset();this.files[f]=!0}if(a.imports&&a.imports.length>0){for(m=!1,typeof u=="object"?(this.importRoot=u.root,m=!0,E=this.importRoot,u=u.file,(E.indexOf("\\")>=0||u.indexOf("\\")>=0)&&(Y="\\")):typeof u=="string"?this.importRoot?E=this.importRoot:u.indexOf("/")>=0?(E=u.replace(/\/[^\/]*$/,""))===""&&(E="/"):u.indexOf("\\")>=0?(E=u.replace(/\\[^\\]*$/,""),Y="\\"):E=".":E=null,y=0;y<a.imports.length;y++)if(typeof a.imports[y]=="string"){if(!E)throw Error("cannot determine import root");if((N=a.imports[y])==="google/protobuf/descriptor.proto"||(N=E+Y+N,this.files[N]===!0))continue;if(/\.proto$/i.test(N)&&!c.DotProto&&(N=N.replace(/\.proto$/,".json")),(A=c.Util.fetch(N))===null)throw Error("failed to import '"+N+"' in '"+u+"': file not found");/\.json$/i.test(N)?this.import(JSON.parse(A+""),N):this.import(c.DotProto.Parser.parse(A),N)}else u?/\.(\w+)$/.test(u)?this.import(a.imports[y],u.replace(/^(.+)\.(\w+)$/,function(G,S,k){return S+"_import"+y+"."+k})):this.import(a.imports[y],u+"_import"+y):this.import(a.imports[y]);m&&(this.importRoot=null)}return a.package&&this.define(a.package),a.syntax&&v(a),K=this.ptr,a.options&&Object.keys(a.options).forEach(function(G){K.options[G]=a.options[G]}),a.messages&&(this.create(a.messages),this.ptr=K),a.enums&&(this.create(a.enums),this.ptr=K),a.services&&(this.create(a.services),this.ptr=K),a.extends&&this.create(a.extends),this.reset()},T.resolveAll=function(){var a;if(this.ptr==null||typeof this.ptr.type=="object")return this;if(this.ptr instanceof _.Namespace)this.ptr.children.forEach(function(u){this.ptr=u,this.resolveAll()},this);else if(this.ptr instanceof _.Message.Field){if(d.TYPE.test(this.ptr.type))this.ptr.type=c.TYPES[this.ptr.type];else{if(!d.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(a=(this.ptr instanceof _.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=a,a instanceof _.Enum){if(this.ptr.type=c.TYPES.enum,this.ptr.syntax==="proto3"&&a.syntax!=="proto3")throw Error("proto3 message cannot reference proto2 enum")}else{if(!(a instanceof _.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=a.isGroup?c.TYPES.group:c.TYPES.message}}if(this.ptr.map){if(!d.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=c.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof c.Reflect.Service.Method){if(!(this.ptr instanceof c.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((a=this.ptr.parent.resolve(this.ptr.requestName,!0))&&a instanceof c.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=a,!((a=this.ptr.parent.resolve(this.ptr.responseName,!0))&&a instanceof c.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=a}else if(!(this.ptr instanceof c.Reflect.Message.OneOf||this.ptr instanceof c.Reflect.Extension||this.ptr instanceof c.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},T.build=function(a){var u,p,f;if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),this.result===null&&(this.result=this.ns.build()),!a)return this.result;for(u=typeof a=="string"?a.split("."):a,p=this.result,f=0;f<u.length;f++){if(!p[u[f]]){p=null;break}p=p[u[f]]}return p},T.lookup=function(a,u){return a?this.ns.resolve(a,u):this.ns},T.toString=function(){return"Builder"},I.Message=function(){},I.Enum=function(){},I.Service=function(){},I}(l,l.Lang,l.Reflect),l.Map=function(c,d){function _(T){var a=0;return{next:function(){return a<T.length?{done:!1,value:T[a++]}:{done:!0}}}}var v=function(T,a){var u,p,f,E;if(!T.map)throw Error("field is not a map");if(this.field=T,this.keyElem=new d.Element(T.keyType,null,!0,T.syntax),this.valueElem=new d.Element(T.type,T.resolvedType,!1,T.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),a)for(u=Object.keys(a),p=0;p<u.length;p++)f=this.keyElem.valueFromString(u[p]),E=this.valueElem.verifyValue(a[u[p]]),this.map[this.keyElem.valueToString(f)]={key:f,value:E}},I=v.prototype;return I.clear=function(){this.map={}},I.delete=function(T){var a=this.keyElem.valueToString(this.keyElem.verifyValue(T)),u=a in this.map;return delete this.map[a],u},I.entries=function(){var T,a,u=[],p=Object.keys(this.map);for(a=0;a<p.length;a++)u.push([(T=this.map[p[a]]).key,T.value]);return _(u)},I.keys=function(){var T,a=[],u=Object.keys(this.map);for(T=0;T<u.length;T++)a.push(this.map[u[T]].key);return _(a)},I.values=function(){var T,a=[],u=Object.keys(this.map);for(T=0;T<u.length;T++)a.push(this.map[u[T]].value);return _(a)},I.forEach=function(T,a){var u,p,f=Object.keys(this.map);for(p=0;p<f.length;p++)T.call(a,(u=this.map[f[p]]).value,u.key,this)},I.set=function(T,a){var u=this.keyElem.verifyValue(T),p=this.valueElem.verifyValue(a);return this.map[this.keyElem.valueToString(u)]={key:u,value:p},this},I.get=function(T){var a=this.keyElem.valueToString(this.keyElem.verifyValue(T));return a in this.map?this.map[a].value:void 0},I.has=function(T){return this.keyElem.valueToString(this.keyElem.verifyValue(T))in this.map},v}(0,l.Reflect),l.loadProto=function(c,d,_){return(typeof d=="string"||d&&typeof d.file=="string"&&typeof d.root=="string")&&(_=d,d=void 0),l.loadJson(l.DotProto.Parser.parse(c),d,_)},l.protoFromString=l.loadProto,l.loadProtoFile=function(c,d,_){if(d&&typeof d=="object"?(_=d,d=null):d&&typeof d=="function"||(d=null),d)return l.Util.fetch(typeof c=="string"?c:c.root+"/"+c.file,function(I){if(I!==null)try{d(null,l.loadProto(I,_,c))}catch(T){d(T)}else d(Error("Failed to fetch file"))});var v=l.Util.fetch(typeof c=="object"?c.root+"/"+c.file:c);return v===null?null:l.loadProto(v,_,c)},l.protoFromFile=l.loadProtoFile,l.newBuilder=function(c){return(c=c||{}).convertFieldsToCamelCase===void 0&&(c.convertFieldsToCamelCase=l.convertFieldsToCamelCase),c.populateAccessors===void 0&&(c.populateAccessors=l.populateAccessors),new l.Builder(c)},l.loadJson=function(c,d,_){return(typeof d=="string"||d&&typeof d.file=="string"&&typeof d.root=="string")&&(_=d,d=null),d&&typeof d=="object"||(d=l.newBuilder()),typeof c=="string"&&(c=JSON.parse(c)),d.import(c,_),d.resolveAll(),d},l.loadJsonFile=function(c,d,_){if(d&&typeof d=="object"?(_=d,d=null):d&&typeof d=="function"||(d=null),d)return l.Util.fetch(typeof c=="string"?c:c.root+"/"+c.file,function(I){if(I!==null)try{d(null,l.loadJson(JSON.parse(I),_,c))}catch(T){d(T)}else d(Error("Failed to fetch file"))});var v=l.Util.fetch(typeof c=="object"?c.root+"/"+c.file:c);return v===null?null:l.loadJson(JSON.parse(v),_,c)},h=t,l.loadProto(h,void 0,"").build("Modules").probuf}(e,n);return r}var ft,An,Gt,Hs=function(){function t(n,e,r){this.pbmaps=n,this.logger=r,this.pbModules=so(e)}return t.prototype.getModule=function(n){return new this.pbModules[n]},t.prototype.encode=function(n,e,r){var i=new this.pbModules[n];if(e)try{this.pbmaps[n].forEach(function(s){var h=e[s];h!==void 0&&i["set".concat(function(l,c,d){if(c===void 0||d===void 0)return l.toUpperCase();var _=l.slice(c,d);return l.replace(_,function(v){return v.toUpperCase()})}(s,0,1))](h)})}catch(s){var o="pbname: ".concat(n,", stack: ").concat(s.stack);this.logger?this.logger.error(P.L_PB_ENCODE_E,o):console==null||console.error(P.L_PB_ENCODE_E,o)}return r?i:i.toArrayBuffer()},t.prototype.decode=function(n,e){var r=this.pbModules[n].decode(e);return this.fixInt64Values(r)},t.prototype.fixInt64Values=function(n){var e=this;if(n instanceof Array)return n.map(function(o){return e.fixInt64Values(o)});if(!It(n))return n;if(n.low!==void 0&&n.high!==void 0&&Object.prototype.hasOwnProperty.call(n,"unsigned")){var r=n.low;return r<0&&(r+=4294967296),r=r.toString(16),parseInt(n.high.toString(16)+"00000000".replace(new RegExp("0{".concat(r.length,"}$")),r),16)}for(var i in n)n[i]=this.fixInt64Values(n[i]);return n},t}();(function(t){t[t.RMTP=1]="RMTP",t[t.TLS=2]="TLS",t[t.RPP=3]="RPP",t[t.QUIC=4]="QUIC",t[t.WS=5]="WS",t[t.WSS=6]="WSS",t[t.HTTP=11]="HTTP",t[t.HTTPS=12]="HTTPS"})(ft||(ft={})),function(t){t[t.BJ=1]="BJ",t[t.SG=2]="SG",t[t.NA=3]="NA"}(Gt||(Gt={})),(An={})[Gt.BJ]={naviUrlBase64:["bmF2LnJvbmctZWRnZS5jb20=","bmF2LWIucm9uZy1lZGdlLmNvbQ=="],logUrlBase64:[{addr:"Y29sbGVjdGlvbi5yb25nLWVkZ2UuY29t",protocol:ft.HTTPS,weight:-1}],miniCmpBase64:["d3Mucm9uZy1lZGdlLmNvbQ==","d3MtYi5yb25nLWVkZ2UuY29t"]},An[Gt.SG]={naviUrlBase64:["bmF2LnNnLWxpZ2h0LWVkZ2UuY29t","bmF2LWIuc2ctbGlnaHQtZWRnZS5jb20="],logUrlBase64:[{addr:"Y29sbGVjdGlvbi5yb25nLWVkZ2UuY29t",protocol:ft.HTTPS,weight:-1}],miniCmpBase64:["d3Muc2ctbGlnaHQtZWRnZS5jb20=","d3MtYi5zZy1saWdodC1lZGdlLmNvbQ=="]},An[Gt.NA]={naviUrlBase64:["bmF2LnVzLWxpZ2h0LWVkZ2UuY29t","bmF2LWIudXMtbGlnaHQtZWRnZS5jb20="],logUrlBase64:[{addr:"Y29sbGVjdGlvbi5yb25nLWVkZ2UuY29t",protocol:ft.HTTPS,weight:-1}],miniCmpBase64:["d3MudXMtbGlnaHQtZWRnZS5jb20=","d3MtYi51cy1saWdodC1lZGdlLmNvbQ=="]};var wn={naviUrlBase64:["MTI3LjAuMC4x"],logUrlBase64:[{addr:"MTI3LjAuMC4x",protocol:ft.HTTPS,weight:-1}],miniCmpBase64:["MTI3LjAuMC4x"]},De="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function bn(t){var n,e,r,i,o,s,h="",l=0;for(t=t.replace(/[^A-Za-z0-9+/=]/g,"");l<t.length;)n=De.indexOf(t.charAt(l++))<<2|(i=De.indexOf(t.charAt(l++)))>>4,e=(15&i)<<4|(o=De.indexOf(t.charAt(l++)))>>2,r=(3&o)<<6|(s=De.indexOf(t.charAt(l++))),h+=String.fromCharCode(n),o!==64&&(h+=String.fromCharCode(e)),s!==64&&(h+=String.fromCharCode(r));return h}function ki(t,n){return/^https?:/.test(t)?t:n===ft.HTTP?"http://".concat(t):"https://".concat(t)}var Ks=function(){function t(){this.initOption={}}return t.prototype.init=function(n){this.initOption=n},t.prototype.getNaviUrlList=function(n){var e,r=this.initOption||{},i=r.areaCode,o=r.navigators,s=(e=i,e===void 0&&(e=Gt.BJ),wn.naviUrlBase64).map(function(d){return bn(d)}),h=n.split("@")[1],l=h?h.split(";"):[],c=o&&o.length>0?vt(vt([],l,!0),o,!0):vt(vt([],l,!0),s,!0);return c.filter(function(d,_){return c.indexOf(d)===_}).map(function(d){return ki(d)})},t.prototype.getLogUrlPolicyList=function(n,e){var r,i=n||{},o=i.log,s=i.logPolicy,h=this.initOption||{},l=h.areaCode,c=h.logServerUrl,d=(r=l,r===void 0&&(r=Gt.BJ),wn.logUrlBase64).map(function(a){return Z(Z({},a),{addr:bn(a.addr)})}),_=[],v={level:1,itv:6,times:5};if(o)_.push.apply(_,o.addrs),Object.assign(v,o.policy);else if(s)try{var I=JSON.parse(s);_.push({addr:I.url,protocol:ft.HTTPS,weight:1}),v.level=I.level,v.itv=I.itv,v.times=I.times}catch{e.warn(P.L_REPORT_LOG_POLICY_E,JSON.stringify({policy:n.logPolicy}))}var T=c?vt([{addr:c,protocol:ft.HTTPS,weight:101}],_,!0):vt(vt([],_,!0),d,!0);return{policy:v,addrs:T.filter(function(a,u){return T.findIndex(function(p){return p.addr===a.addr&&p.protocol===a.protocol})===u}).map(function(a){return Z(Z({},a),{addr:ki(a.addr,a.protocol)})}).sort(function(a,u){return u.weight-a.weight})}},t.prototype.getMiniCmpUrlList=function(){var n,e,r=(e=(n=this.initOption)===null||n===void 0?void 0:n.areaCode,e===void 0&&(e=Gt.BJ),wn.miniCmpBase64).map(function(o){return bn(o)}),i=(this.initOption||{}).miniCMPProxy;return i&&i.length>0?i:r},t}(),Yt=new Ks,lr=mr(),qs=Date.now(),Mt=null,bt="RC_LOGS",Re="RC_CONF",qe=null,ao=function(t){return L(void 0,void 0,void 0,function(){var n;return M(this,function(e){switch(e.label){case 0:return[4,Mt];case 1:return(n=e.sent())?[4,new Promise(function(r){var i=n.db.transaction(bt,"readwrite").objectStore(bt),o=IDBKeyRange.lowerBound(Date.now()-t),s=i.getAllKeys(o);s.onsuccess=function(){var h=s.result,l=h.length;if(l>0){var c=i.delete(IDBKeyRange.bound(h[0],h[l-1]));c.onsuccess=r,c.onerror=r}},s.onerror=r})]:[2];case 2:return e.sent(),qe=setTimeout(function(){return ao(t)},6e5),[2]}})})},uo=function(t,n,e,r){r===void 0&&(r=168),Mt||(typeof window<"u"&&window&&window.indexedDB&&Es(e).type!=="IE"?Mt=new Promise(function(i){var o=window.indexedDB;o.databases&&o.databases().then(function(l){l.some(function(c){return c.name==="RC_ENGINE_DB"})&&o.deleteDatabase("RC_ENGINE_DB")});var s="RC_LOGS_".concat(t),h=o.open(s,1);h.onerror=function(l){n.error(P.L_LOGDB_OPEN_FAILED_E,l.target.error),i(null)},h.onsuccess=function(l){var c=l.target.result;c?(c.onclose=function(d){n.warn(P.L_LOGDB_CLOSED_S)},c.onerror=function(d){n.error(P.L_LOGDB_ERROR_E,d.target.error)},c.onabort=function(d){n.info(P.L_LOGDB_ABORT_S,d.target.error)},ao(3600*Math.max(24,Math.min(168,r))*1e3),i({appkey:t,db:c})):i(null)},h.onupgradeneeded=function(l){var c=l.target.result;c.objectStoreNames.contains(bt)&&c.deleteObjectStore(bt);var d=c.createObjectStore(bt,{autoIncrement:!0});d.createIndex("level","level",{unique:!1}),d.createIndex("time","time",{unique:!1}),(d=c.createObjectStore(Re,{keyPath:"key"})).createIndex("key","key",{unique:!0})}}):n.warn(P.L_UNSUPPORT_INDEXDB_O))},Ys=function(){return L(void 0,void 0,void 0,function(){var t;return M(this,function(n){switch(n.label){case 0:return Mt?(qe&&(clearTimeout(qe),qe=null),[4,Mt]):[2];case 1:return(t=n.sent())&&t.db.close(),Mt=null,[2]}})})},hr=[],Pn=!1,co=function(t){return L(void 0,void 0,void 0,function(){var n;return M(this,function(e){switch(e.label){case 0:return Pn||hr.length===0?[2]:(Pn=!0,n=hr.splice(0),[4,new Promise(function(r){var i=t.transaction(bt,"readwrite");i.oncomplete=r,i.onabort=r;var o=i.objectStore(bt);n.forEach(function(s){try{o.add(s)}catch{console==null||console.error("write log failed ->",s)}})})]);case 1:return e.sent(),Pn=!1,setTimeout(function(){return co(t)}),[2]}})})};function lo(t){return L(this,void 0,void 0,function(){var n;return M(this,function(e){switch(e.label){case 0:return[4,Mt];case 1:return(n=e.sent())?[2,new Promise(function(r){var i=n.db.transaction(Re,"readonly").objectStore(Re).get(t);i.onsuccess=function(o){var s;r({value:(s=i.result)===null||s===void 0?void 0:s.value,success:!0})},i.onerror=function(o){r({success:!1})}})]:[2,{success:!1}]}})})}var _t,Bi=0,ho=function(){return{setTimestamp4RealtimeLog:function(t){Bi=t},getTimestamp4RealtimeLog:function(){return Bi},getLogs:function(t,n,e,r){return L(this,void 0,void 0,function(){var i;return M(this,function(o){switch(o.label){case 0:return[4,Mt];case 1:return(i=o.sent())?[2,new Promise(function(s){var h=i.db.transaction(bt,"readonly").objectStore(bt),l=[],c=IDBKeyRange.bound(t,n),d=h.index("time").openCursor(c);d.onsuccess=function(_){var v=_.target.result;if(v){var I=v.value;I.level<=e&&(r?I.sessionId===lr:I.level>=0)&&l.push(I),v.continue()}else s({dbReady:!0,logs:l})},d.onerror=function(_){s({dbReady:!1,logs:[]})}})]:[2,{dbReady:!1,logs:[]}]}})})}}},dr="REPORT_SESSION",js=function(t,n){return L(void 0,void 0,void 0,function(){var e,r,i,o;return M(this,function(s){switch(s.label){case 0:return e="".concat(dr,"_").concat(t),[4,lo("".concat(dr,"_").concat(t))];case 1:return r=s.sent(),i=r.success,o=r.value,i?(n===(o==null?void 0:o.sessionId)||function(h,l){L(this,void 0,void 0,function(){var c,d;return M(this,function(_){switch(_.label){case 0:return[4,Mt];case 1:return(c=_.sent())?(d=c.db,d.transaction(Re,"readwrite").objectStore(Re).put({key:h,value:l}),[2,!0]):[2,!1]}})})}(e,{sessionId:n}),[2]):[2]}})})};(function(t){t[t.STATISTICS=-2]="STATISTICS",t[t.RECORD=-1]="RECORD",t[t.FATAL=0]="FATAL",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG"})(_t||(_t={}));var go=function(t){return[_t.DEBUG,_t.INFO,_t.WARN,_t.ERROR].some(function(n){return n===t})},Qs=0,Ws=function(){function t(n,e,r){this._appkey=n,this._id=e,this._type=r,this.outputLevel=_t.WARN,this.debug=this._log.bind(this,_t.DEBUG),this.info=this._log.bind(this,_t.INFO),this.warn=this._log.bind(this,_t.WARN),this.error=this._log.bind(this,_t.ERROR),this.__statistics=this._log.bind(this,_t.STATISTICS)}return t.prototype._stdout=function(n,e,r,i,o){if(!(n<=_t.FATAL)&&console&&!(n>this.outputLevel)){var s=["error","warn","info","debug"][n-1];console==null||console[s]("".concat(r,"[").concat(this._id,"][").concat(s.toUpperCase(),"]: ").concat(e," | ").concat(i," | ").concat(o))}},t.prototype.setOutputLevel=function(n){go(n)&&(this.outputLevel=n)},t.prototype._log=function(n,e,r,i){var o=new Date;/^[\w-]+$/.test(e)?(this._stdout(n,e,o.toISOString(),r,i),n!==_t.DEBUG&&this.flush({time:+o,sessionId:lr,type:this._type,loggerId:this._id,tag:e,level:n,content:r,traceId:i})):this._stdout(_t.ERROR,"L_LOG_TAG_INVALID_E",o.toISOString(),e,i)},t.prototype.createTraceId=function(){return"".concat(++Qs)},t.prototype.getSessionId=function(){return lr},t}(),gr=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return dt(n,t),n.prototype.flush=function(e){(function(r){L(void 0,void 0,void 0,function(){var i;return M(this,function(o){switch(o.label){case 0:return[4,Mt];case 1:return(i=o.sent())?(hr.push(r),co(i.db),[2]):[2]}})})})(e)},n}(Ws),Js=function(){function t(n,e,r,i,o){this.appkey=n,this.deviceId=e,this.deviceInfo=r,this.logDB=i,this.logger=o,this.userId="",this.timer=null,this.started=!1}return t.prototype.checkStart=function(n){return L(this,void 0,void 0,function(){var e,r,i;return M(this,function(o){return this.started?[2]:(this.userId=n.userId,n.logSwitch?(e=Yt.getLogUrlPolicyList(n,this.logger),r=e.policy,i=e.addrs,this.started=!0,i.length>0&&this.realtimeReport(i[0].addr,r.level,r.itv),[2]):[2])})})},t.prototype.realtimeReport=function(n,e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d,_,v,I,T,a,u=this;return M(this,function(p){switch(p.label){case 0:return i=Date.now(),o=this.logDB.getTimestamp4RealtimeLog()||qs,s=Math.max(i-5e3,o),h=this.logger.createTraceId(),this.logger.debug(P.L_REALTIME_LOG_T,JSON.stringify({startTime:o,endTime:s,level:e}),h),[4,this.logDB.getLogs(o,s,e,!0)];case 1:return l=p.sent(),c=l.dbReady,d=l.logs,c?[3,2]:(this.logger.warn(P.L_REALTIME_LOG_R,"db error",h),[3,5]);case 2:return d.length>0?(this.logger.info(P.L_REALTIME_LOG_O,JSON.stringify({count:d.length}),h),[4,this.compressLogs(d)]):[3,5];case 3:return _=p.sent(),v=_.success,I=_.data,v||this.logger.warn(P.L_REALTIME_LOG_O,"compress failed",h),this.logger.info(P.L_REALTIME_LOG_O,"compress done",h),T=en(n)?n:"https://".concat(n),T+="?version=".concat("5.8.2-enterprise.4","&appkey=").concat(this.appkey,"&userId=").concat(this.userId,"&deviceId=").concat(this.deviceId,"&deviceInfo=").concat(this.deviceInfo,"&platform=Web"),[4,this.send({url:T,body:I,method:"POST"})];case 4:a=p.sent().status,this.logger.info(P.L_REALTIME_LOG_R,JSON.stringify({status:a}),h),a===200&&this.logDB.setTimestamp4RealtimeLog(d[d.length-1].time+1),p.label=5;case 5:return this.started&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){return u.realtimeReport(n,e,r)},1e3*r)),[2]}})})},t.prototype.report=function(n,e,r,i,o,s){return L(this,void 0,void 0,function(){var h,l,c,d,_,v,I,T,a,u;return M(this,function(p){switch(p.label){case 0:return r.toLowerCase()!=="web"?[2]:(h=this.logger.createTraceId(),this.logger.info(P.L_REPORT_FULL_LOG_T,JSON.stringify({startTime:n,endTime:e,logId:o,messageUId:s}),h),[4,this.logDB.getLogs(n,e,_t.DEBUG,!1)]);case 1:return l=p.sent(),c=l.dbReady,d=l.logs,this.logger.info(P.L_REPORT_FULL_LOG_O,JSON.stringify({count:d.length}),h),_=en(i)?i:"https://".concat(i),_+="?version=".concat("5.8.2-enterprise.4","&appkey=").concat(this.appkey,"&userId=").concat(this.userId,"&deviceId=").concat(this.deviceId,"&deviceInfo=").concat(this.deviceInfo,"&platform=Web&logId=").concat(o),c?d.length>0?[4,this.compressLogs(d)]:[3,3]:[3,5];case 2:return I=p.sent(),T=I.success,a=I.data,v=T?a:"compress failed",[3,4];case 3:v="no data",p.label=4;case 4:return[3,6];case 5:v="no database",p.label=6;case 6:return this.logger.debug(P.L_REPORT_FULL_LOG_O,"compress done",h),[4,this.send({url:_,body:v,method:"POST"})];case 7:return u=p.sent().status,this.logger.info(P.L_REPORT_FULL_LOG_R,JSON.stringify({status:u}),h),[2]}})})},t.prototype.stop=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.started=!1},t}(),Xs=48,Zs=64,zs=80,$s=96,po="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",xi=po.length,fo=function(t){for(var n={},e=0;e<t.length-1;e++){var r=t.charAt(e)+t.charAt(e+1);n.hasOwnProperty(r)?n[r].push(e):n[r]=[e]}for(var i=[],o=[],s=function(){if(o.length>0){var T=o.join("");if(o=[],T.length>26){var a=Ve(T.length),u=String.fromCharCode(zs|a.length);i.push(u+a)}else{var p=String.fromCharCode($s|T.length);i.push(p)}i.push(T)}},h=0;h<t.length;){var l=ta(n,t,h);if(l.length<2)o.push(t.charAt(h++));else if(l.length<4)o.push(t.substr(h,l.length)),h+=l.length;else{var c=Ve(h-l.offset),d=Ve(l.length);if(c.length+d.length>=l.length)o.push(t.substr(h,l.length)),h+=l.length;else{s();var _=String.fromCharCode(Zs|c.length<<2|d.length);i.push(_+c+d),h+=l.length}}}s();var v=Ve(t.length),I=String.fromCharCode(Xs|v.length);return i.push(I+v),i.join("")},ta=function(t,n,e){var r={length:0,offset:-1};if(n.length,e>=n.length-1)return r;var i=t[n.charAt(e)+n.charAt(e+1)];if(i[0]===e)return r;for(var o=n.length-e,s=0,h=i.length;s<h;s++){var l=i[s],c=e-l;if(!(c>238327)){var d=Math.min(o,c);if(d<=r.length)break;if(!(r.length>2&&n.charAt(l+r.length-1)!==n.charAt(e+r.length-1))){for(var _=2,v=_;v<d&&n.charAt(l+v)===n.charAt(e+v);v++)_++;_>=r.length&&(r.length=_,r.offset=l)}}}return r},Ve=function(t){var n=[],e=0;do e=t%xi,n.push(po.charAt(e)),t=(t-e)/xi;while(t>0);return n.join("")},yr=function(t){var n="RCDeviceId",e=pn(t),r="",i=e.get(n);return i?r=i:(r=mr(),e.set(n,r)),r},Ir=function(t){if(t.tag!=="browser")return{type:t.tag,version:"UnKonw"};var n,e,r=navigator.userAgent,i={IE:/rv:([\d.]+)\) like Gecko|MSIE ([\d.]+)/,Edge:/Edge\/([\d.]+)/,Firefox:/Firefox\/([\d.]+)/,Opera:/(?:OPERA|OPR).([\d.]+)/,WeChat:/MicroMessenger\/([\d.]+)/,QQBrowser:/QQBrowser\/([\d.]+)/,Chrome:/Chrome\/([\d.]+)/,Safari:/Version\/([\d.]+).*Safari/,iOSChrome:/Mobile\/([\d.]+).*Safari/};for(var o in i)if(i.hasOwnProperty(o)){var s=r.match(i[o]);if(s){e=o,n=s[1]||s[2];break}}return{type:e||"UnKonw",version:n||"UnKonw"}},ea=function(t){var n=t.sessionId,e=t.level,r=t.loggerId,i=t.traceId,o=t.time,s=t.tag,h=t.type,l=t.content,c=e<0?l||"":JSON.stringify({content:l,traceId:i,from:r});return c='"'.concat(c.replace(/"/g,'""'),'"'),"".concat(n,",").concat(o,",").concat(h,",").concat(e,",").concat(s,",").concat(c,`
`)},na=function(t){function n(e,r,i,o){var s=this,h=yr(r),l=Ir(r),c="".concat(l.type,"|").concat(l.version,"|").concat(i.getSessionId());return(s=t.call(this,e,h,c,ho(),i)||this).runtime=r,s.clientReportLevel=o,go(s.clientReportLevel)||(s.clientReportLevel=void 0),s}return dt(n,t),n.prototype.send=function(e){return this.runtime.httpReq(e)},n.prototype.checkStart=function(e){return L(this,void 0,void 0,function(){return M(this,function(r){switch(r.label){case 0:return[4,js(e.userId,this.logger.getSessionId())];case 1:return r.sent(),[2,t.prototype.checkStart.call(this,e)]}})})},n.prototype.compressLogs=function(e){return L(this,void 0,void 0,function(){return M(this,function(r){return[2,{success:!0,data:fo(e.map(ea).join(""))}]})})},n.prototype.isReporter=function(){return L(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return[4,(r=this.userId,i=this.logger.getSessionId(),L(void 0,void 0,void 0,function(){var o,s,h;return M(this,function(l){switch(l.label){case 0:return[4,lo("".concat(dr,"_").concat(r))];case 1:return o=l.sent(),s=o.success,h=o.value,[2,s&&(h==null?void 0:h.sessionId)===i]}})}))];case 1:return[2,e.sent()]}var r,i})})},n.prototype.report=function(e,r,i,o,s,h){return L(this,void 0,void 0,function(){return M(this,function(l){switch(l.label){case 0:return[4,this.isReporter()];case 1:return l.sent()?[2,t.prototype.report.call(this,e,r,i,o,s,h)]:[2]}})})},n.prototype.realtimeReport=function(e,r,i){return L(this,void 0,void 0,function(){return M(this,function(o){return[2,t.prototype.realtimeReport.call(this,e,r,i)]})})},n}(Js),Dn=144e5;typeof window<"u"&&(window.__rongcloud_devtools__={logger:{get:function(t,n,e){return n===void 0&&(n=Date.now()-Dn),e===void 0&&(e=Date.now()),L(this,void 0,void 0,function(){var r,i;return M(this,function(o){switch(o.label){case 0:return n=n<0?Date.now()+n:n,(e=e<=0?Date.now():e)-n>Dn&&(n=e-Dn),(r=new gr(t,"RC-IM","IM")).debug(P.T,"get logs:  startTime ".concat(n,"  endTime ").concat(e)),uo(t,r,{tag:"browser"}),[4,ho().getLogs(n,e,_t.DEBUG,!1)];case 1:return i=o.sent().logs,r.debug(P.T,"get logs ".concat(i.length)),function(s,h){var l=h.map(function(v){var I=v.sessionId,T=v.time,a=v.type,u=v.level,p=v.tag,f=v.traceId,E=v.loggerId,m=v.content;return"".concat(I,",").concat(T,",").concat(a,",").concat(u,",").concat(p,",").concat(f,",").concat(E,',"').concat(m,`"
`)}),c=new Blob(l,{type:"text/csv"}),d=URL.createObjectURL(c),_=document.createElement("a");_.href=d,_.download="".concat(s,".csv"),document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(d)}("".concat(t,"-").concat(n,"-").concat(e),i),[2]}})})}}});var Xt,Zt,zt,Et,yt,jt,Se,_o=function(){function t(n){this._context=n}return t.prototype.__getContext=function(){return this._context},t.prototype.createCodec=function(n,e){return this._context.createCodec(n,e)},t.prototype.refetchNaviInfo=function(){return L(this,void 0,void 0,function(){return M(this,function(n){return[2,this._context.refetchNaviInfo()]})})},t.prototype.getNaviInfo=function(){return this._context.getNaviInfoFromCache()},t.prototype.getCoreVersion=function(){return"5.8.2-enterprise.4"},t.prototype.getAPIVersion=function(){return"5.8.2-enterprise.4"},t.prototype.getAppkey=function(){return this._context.appkey},t.prototype.getCurrentId=function(){return this._context.getCurrentUserId()},t.prototype.getConnectionStatus=function(){return this._context.getConnectionStatus()},t.prototype.getDeviceId=function(){return this._context.getDeviceId()},t.prototype.sendMessage=function(n,e,r){return this._context.sendMessage(n,e,r)},t.prototype.registerMessageType=function(n,e,r,i){i===void 0&&(i=[]),this._context.registerMessageType(n,e,r,i)},t.prototype.getServerTime=function(){return this._context.getServerTime()},t.prototype.getOSInfo=function(){return this._context.getOSInfo()},t.prototype.getProcessInfo=function(){return this._context.getProcessInfo()},t.prototype.getMainProcessInfo=function(){return this._context.getMainProcessInfo()},t.prototype.setCallInfo=function(n,e,r){return this._context.setCallInfo(n,e,r)},t.prototype.createLogger=function(n,e){return this._context.createLogger(n,e)},t}(),ra="pgMsgP",ia="chatMsg",oa="pcMsgP",sa="pbMsgP",aa={PRIVATE:"ppMsgS",GROUP:"pgMsgS",CHATROOM:"chatMsgS"},ua="delMsg",ca="joinChrm",Fi="joinChrmR",la="exitChrm",ha="setKV",da="delKV",ga="setKVS",pa="delKVS",Hi="qryRelationR",fa="delRelation",_a="setSeAtt",de={PRIVATE:"cleanPMsg",GROUP:"cleanGMsg",ULTRA_GROUP:"cleanGMsg",CUSTOMER_SERVICE:"cleanCMsg",SYSTEM:"cleanSMsg"},Ea="reqCall",va="pullKvMsg",Eo="qryPMsg",Ta="qryGMsg",vo="qryCHMsg",ma="qryCMsg",ya="qrySMsg",Ia=((Xt={}).ppMsgP=B.PRIVATE,Xt[ra]=B.GROUP,Xt[ia]=B.CHATROOM,Xt[oa]=B.CUSTOMER_SERVICE,Xt[sa]=B.SYSTEM,Xt),Ca=((Zt={})[B.PRIVATE]=Eo,Zt[B.GROUP]=Ta,Zt[B.CHATROOM]=vo,Zt[B.CUSTOMER_SERVICE]=ma,Zt[B.SYSTEM]=ya,Zt),Ra=((zt={})[B.PRIVATE]=de.PRIVATE,zt[B.GROUP]=de.GROUP,zt[B.ULTRA_GROUP]=de.ULTRA_GROUP,zt[B.CUSTOMER_SERVICE]=de.CUSTOMER_SERVICE,zt[B.SYSTEM]=de.SYSTEM,zt),Vn="1",Sa="0",Ge=1,Ki=2,qi=3;(function(t){t[t.AT_MOST_ONCE=0]="AT_MOST_ONCE",t[t.AT_LEAST_ONCE=1]="AT_LEAST_ONCE",t[t.EXACTLY_ONCE=2]="EXACTLY_ONCE",t[t.DEFAULT=3]="DEFAULT"})(Et||(Et={})),function(t){t[t.SYMMETRIC=0]="SYMMETRIC",t[t.CONNECT=1]="CONNECT",t[t.CONN_ACK=2]="CONN_ACK",t[t.PUBLISH=3]="PUBLISH",t[t.PUB_ACK=4]="PUB_ACK",t[t.QUERY=5]="QUERY",t[t.QUERY_ACK=6]="QUERY_ACK",t[t.QUERY_CONFIRM=7]="QUERY_CONFIRM",t[t.SUBSCRIBE=8]="SUBSCRIBE",t[t.SUB_ACK=9]="SUB_ACK",t[t.UNSUBSCRIBE=10]="UNSUBSCRIBE",t[t.UNSUB_ACK=11]="UNSUB_ACK",t[t.PING_REQ=12]="PING_REQ",t[t.PING_RESP=13]="PING_RESP",t[t.DISCONNECT=14]="DISCONNECT",t[t.RESERVER2=15]="RESERVER2"}(yt||(yt={})),function(t){t.PUB="pub",t.QUERY="qry"}(jt||(jt={})),function(t){t[t.V4=4]="V4",t[t.V3=3]="V3"}(Se||(Se={}));var pr,To=function(){function t(n,e,r,i){e===void 0&&(e=!1),r===void 0&&(r=Et.AT_LEAST_ONCE),i===void 0&&(i=!1),this._retain=!1,this.qos=Et.AT_LEAST_ONCE,this._dup=!1,this.syncMsg=!1,n&&n>0&&arguments.length===1?(this._retain=(1&n)>0,this.qos=(6&n)>>1,this._dup=(8&n)>0,this.type=n>>4&15,this.syncMsg=(8&n)==8):(this.type=n,this._retain=e,this.qos=r,this._dup=i)}return t.prototype.encode=function(){var n=this.type<<4;return n|=this._retain?1:0,n|=this.qos<<1,n|=this._dup?8:0},t}(),Ue=function(){function t(){}return t.writeUTF=function(n,e){for(var r=this._getBackAndByteSize(n),i=r.back,o=r.byteSize,s=0,h=i.length;s<h;s++)i[s]>255&&(i[s]&=255);return e?i:o<=255?[0,o].concat(i):[o>>8,255&o].concat(i)},t._getBackAndByteSize=function(n){var e=[],r=0;if(Lt(n))for(var i=0,o=n.length;i<o;i++){var s=n.charCodeAt(i);s>=0&&s<=127?(r+=1,e.push(s)):s>=128&&s<=2047?(r+=2,e.push(192|31&s>>6),e.push(128|63&s)):s>=2048&&s<=65535&&(r+=3,e.push(224|15&s>>12),e.push(128|63&s>>6),e.push(128|63&s))}return{byteSize:r,back:e}},t.readUTF=function(n){for(var e,r,i=[],o=-1,s=n,h="";++o<s.length;){var l=Number(s[o]);if(l===(127&l)||((240&l)==240?l=(l=(l=(l^=240)<<6|128^s[++o])<<6|128^s[++o])<<6|128^s[++o]:(224&l)==224?l=(l=(l^=224)<<6|128^s[++o])<<6|128^s[++o]:(192&l)==192&&(l=(l^=192)<<6|128^s[++o])),!Number.isFinite(l)||l<0||l>1114111||Math.floor(l)!==l)throw RangeError("Invalid code point: ".concat(l));l<=65535?i.push(l):(e=(l-=65536)>>10|55296,r=l%1024|56320,i.push(e,r)),(o+1===s.length||i.length>16384)&&(h+=String.fromCharCode.apply(null,i),i.length=0)}return h},t}(),Oa=function(){function t(n){this._position=0,this._poolLen=0,this._pool=n,this._poolLen=n.length}return t.prototype.check=function(){return this._position>=this._pool.length},t.prototype.read2Byte=function(){var n=this;if(n.check())return-1;for(var e="",r=0;r<2;r++){var i=n._pool[n._position++].toString(16);i.length===1&&(i="0".concat(i)),e+=i.toString()}return parseInt(e,16)},t.prototype.readInt=function(){var n=this;if(n.check())return-1;for(var e="",r=0;r<4;r++){var i=n._pool[n._position++].toString(16);i.length===1&&(i="0".concat(i)),e+=i.toString()}return parseInt(e,16)},t.prototype.readLong=function(){var n=this;if(n.check())return-1;for(var e="",r=0;r<8;r++){var i=n._pool[n._position++].toString(16);i.length===1&&(i="0".concat(i)),e+=i}return parseInt(e,16)},t.prototype.readByte=function(){if(this.check())return-1;var n=this._pool[this._position++];return n>255&&(n&=255),n},t.prototype.readUTF=function(){if(this.check())return"";var n=this.readByte()<<8|this.readByte(),e=this._position;this._position+=n;var r=this._pool.subarray(e,this._position);return Ue.readUTF(r)},t.prototype.readAll=function(){return this._pool.subarray(this._position,this._poolLen)},t}(),Na=function(){function t(){this._pool=[],this._position=0,this._writen=0}return t.prototype.write=function(n){return Object.prototype.toString.call(n).indexOf("Array")!==-1?this._pool=this._pool.concat(n):n>=0&&(n>255&&(n&=255),this._pool.push(n),this._writen++),n},t.prototype.writeArr=function(n){return this._pool=this._pool.concat(n),n},t.prototype.writeUTF=function(n){var e=Ue.writeUTF(n);this._pool=this._pool.concat(e),this._writen+=e.length},t.prototype.getBytesArray=function(){return this._pool},t}(),mo=function(t,n){return t&&n?"".concat(n,"_").concat(t):t||Date.now()},Ae=function(){function t(n){this.header=n,this.messageId=0,this.timestamp=0,this.syncMsg=!1,this.identifier=""}return t.prototype.getIdentifier=function(){var n=this.messageId,e=this.identifier;return mo(n,e)},t.prototype.read=function(n,e,r,i){this.readMessage(n,e,r,i)},t.prototype.readMessage=function(n,e,r,i){return{stream:e,length:r}},t}(),yo=function(){function t(n){this.lengthSize=0,this.messageId=0,this.topic="",this.targetId="",this.identifier="",this._header=new To(n,!1,Et.AT_MOST_ONCE,!1)}return t.prototype.getIdentifier=function(){var n=this.messageId,e=this.identifier;return mo(n,e)},t.prototype.write=function(n){var e=this.getHeaderFlag();n.write(e),this.writeMessage(n)},t.prototype.setHeaderQos=function(n){this._header.qos=n},t.prototype.getHeaderFlag=function(){return this._header.encode()},t.prototype.getLengthSize=function(){return this.lengthSize},t.prototype.getBufferData=function(){var n=new Na;this.write(n);var e=n.getBytesArray();return new Int8Array(e)},t}(),Io=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.status=null,e.userId=null,e.timestamp=0,e}return dt(n,t),n.prototype.readMessage=function(e,r,i,o){if(r.readByte(),this.status=+r.readByte(),i<=n.MESSAGE_LENGTH)return{stream:r,length:i};if(o===Se.V4){var s=r.readByte();1&s&&(this.userId=r.readUTF()),2&s&&r.readUTF(),4&s&&(this.timestamp=r.readLong()),8&s&&(this.messageId=r.read2Byte())}else{this.userId=r.readUTF();var h=r.readUTF();e.debug(P.O,"server sessionId -> ".concat(h)),this.timestamp=r.readLong()}return{stream:r,length:i}},n.MESSAGE_LENGTH=2,n}(Ae),Co=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.status=0,e}return dt(n,t),n.prototype.readMessage=function(e,r,i){return r.readByte(),this.status=+r.readByte(),{stream:r,length:i}},n.MESSAGE_LENGTH=2,n}(Ae),Ma=function(t){function n(){return t.call(this,yt.PING_REQ)||this}return dt(n,t),n.prototype.writeMessage=function(e){},n}(yo),Ro=function(t){function n(e){return t.call(this,e)||this}return dt(n,t),n}(Ae),Cr=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.messageId=0,e}return dt(n,t),n.prototype.readMessage=function(e,r,i){var o=256*r.readByte()+r.readByte();return this.messageId=parseInt(o.toString(),10),{stream:r,length:i}},n}(Ae),_n=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return dt(n,t),n.prototype.writeMessage=function(e){var r=this.messageId,i=255&r,o=(65280&r)>>8;e.write(o),e.write(i)},n}(yo),fr=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.topic="",e.targetId="",e.syncMsg=!1,e.identifier=jt.PUB,e}return dt(n,t),n.prototype.readMessage=function(e,r,i){return this.date=r.readInt(),this.topic=r.readUTF(),this.targetId=r.readUTF(),t.prototype.readMessage.call(this,e,r,i),this.data=r.readAll(),{stream:r,length:i}},n}(Cr),Ft=function(t){function n(e,r,i){var o=t.call(this,yt.PUBLISH)||this;return o.syncMsg=!1,o.identifier=jt.PUB,o.topic=e,o.data=Lt(r)?Ue.writeUTF(r):r,o.targetId=i,o}return dt(n,t),n.prototype.writeMessage=function(e){e.writeUTF(this.topic),e.writeUTF(this.targetId),t.prototype.writeMessage.call(this,e),e.write(this.data)},n}(_n),_r=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.status=0,e.date=0,e.millisecond=0,e.messageUId="",e.timestamp=0,e.identifier=jt.PUB,e.topic="",e.targetId="",e}return dt(n,t),n.prototype.readMessage=function(e,r,i){return t.prototype.readMessage.call(this,e,r,i),this.date=r.readInt(),this.status=256*r.readByte()+r.readByte(),this.millisecond=256*r.readByte()+r.readByte(),this.timestamp=1e3*this.date+this.millisecond,this.messageUId=r.readUTF(),{stream:r,length:i}},n}(Cr),La=function(t){function n(e){var r=t.call(this,yt.PUB_ACK)||this;return r.status=0,r.date=0,r.millisecond=0,r.messageUId="",r.timestamp=0,r.messageId=e,r}return dt(n,t),n.prototype.writeMessage=function(e){t.prototype.writeMessage.call(this,e)},n}(_n),X=function(t){function n(e,r,i){var o=t.call(this,yt.QUERY)||this;return o.identifier=jt.QUERY,o.topic=e,o.data=Lt(r)?Ue.writeUTF(r):r,o.targetId=i,o}return dt(n,t),n.prototype.writeMessage=function(e){e.writeUTF(this.topic),e.writeUTF(this.targetId),t.prototype.writeMessage.call(this,e),e.write(this.data)},n}(_n),Ua=function(t){function n(e){var r=t.call(this,yt.QUERY_CONFIRM)||this;return r.messageId=e,r}return dt(n,t),n}(_n),Ye=function(t){function n(){var e=t!==null&&t.apply(this,arguments)||this;return e.status=0,e.identifier=jt.QUERY,e.topic="",e.targetId="",e}return dt(n,t),n.prototype.readMessage=function(e,r,i){return t.prototype.readMessage.call(this,e,r,i),this.date=r.readInt(),this.status=256*r.readByte()+r.readByte(),this.data=r.readAll(),{stream:r,length:i}},n}(Cr),Aa=function(t,n,e){var r=new Uint8Array(n),i=new Oa(r),o=i.readByte(),s=function(h,l){var c,d=h.type;switch(d){case yt.CONN_ACK:c=new Io(h);break;case yt.PUBLISH:(c=new fr(h)).syncMsg=h.syncMsg;break;case yt.PUB_ACK:c=new _r(h);break;case yt.QUERY_ACK:c=new Ye(h);break;case yt.SUB_ACK:case yt.UNSUB_ACK:case yt.PING_RESP:c=new Ro(h);break;case yt.DISCONNECT:c=new Co(h);break;default:c=new Ae(h),l.error(P.O,"No support for deserializing ".concat(d," messages"))}return c}(new To(o),t);return s.read(t,i,r.length-1,e),s};(function(t){t[t.ppMsgP=1]="ppMsgP",t[t.ppMsgN=2]="ppMsgN",t[t.ppMsgS=3]="ppMsgS",t[t.pgMsgP=4]="pgMsgP",t[t.chatMsg=5]="chatMsg",t[t.pcMsgP=6]="pcMsgP",t[t.qryPMsg=7]="qryPMsg",t[t.qryGMsg=8]="qryGMsg",t[t.qryCHMsg=9]="qryCHMsg",t[t.qryCMsg=10]="qryCMsg",t[t.qrySMsg=11]="qrySMsg",t[t.recallMsg=12]="recallMsg",t[t.prMsgS=13]="prMsgS",t[t.pbMsgP=14]="pbMsgP",t[t.rrMsg=15]="rrMsg",t[t.rrList=16]="rrList",t[t.s_ntf=17]="s_ntf",t[t.s_msg=18]="s_msg",t[t.s_stat=19]="s_stat",t[t.s_cmd=20]="s_cmd",t[t.s_us=21]="s_us",t[t.pullUS=22]="pullUS",t[t.pgMsgS=23]="pgMsgS",t[t.chatMsgS=24]="chatMsgS",t[t.qrySessionsAtt=25]="qrySessionsAtt",t[t.pullMsg=26]="pullMsg",t[t.qrySessions=27]="qrySessions",t[t.delSessions=28]="delSessions",t[t.delMsg=29]="delMsg",t[t.updRRTime=30]="updRRTime",t[t.chrmPull=31]="chrmPull",t[t.joinChrm=32]="joinChrm",t[t.joinChrmR=33]="joinChrmR",t[t.exitChrm=34]="exitChrm",t[t.queryChrmI=35]="queryChrmI",t[t.setKV=36]="setKV",t[t.delKV=37]="delKV",t[t.pullKV=38]="pullKV",t[t.qryRelation=39]="qryRelation",t[t.delRelation=40]="delRelation",t[t.pullSeAtts=41]="pullSeAtts",t[t.setSeAtt=42]="setSeAtt",t[t.qnTkn=43]="qnTkn",t[t.qnUrl=44]="qnUrl",t[t.aliUrl=45]="aliUrl",t[t.s3Url=46]="s3Url",t[t.stcUrl=47]="stcUrl",t[t.minioUrl=48]="minioUrl",t[t.cleanPMsg=49]="cleanPMsg",t[t.cleanGMsg=50]="cleanGMsg",t[t.cleanCMsg=51]="cleanCMsg",t[t.cleanSMsg=52]="cleanSMsg",t[t.rtcPing=53]="rtcPing",t[t.rtc_ntf=54]="rtc_ntf",t[t.rtcSetOutData=55]="rtcSetOutData",t[t.rtcQryUserOutData=56]="rtcQryUserOutData",t[t.addSeTag=57]="addSeTag",t[t.delSeTag=58]="delSeTag",t[t.addTag=59]="addTag",t[t.delTag=60]="delTag",t[t.disTag=61]="disTag",t[t.reportsdk=62]="reportsdk",t[t.pullUgSes=63]="pullUgSes",t[t.pullUgMsg=64]="pullUgMsg",t[t.ugMsg=65]="ugMsg",t[t.qryUgMsg=66]="qryUgMsg",t[t.updUgRTime=67]="updUgRTime",t[t.upMsgEx=68]="upMsgEx",t[t.modifyMsg=69]="modifyMsg",t[t.qryMsgChange=70]="qryMsgChange",t[t.qryMsg=71]="qryMsg",t[t.operate=72]="operate",t[t.s_opNtf=73]="s_opNtf",t[t.ugUnpushQuery=74]="ugUnpushQuery",t[t.ugUnpushSet=75]="ugUnpushSet",t[t.setRtcRoomId=76]="setRtcRoomId",t[t.qryUgUal=77]="qryUgUal",t[t.s_pubCall=78]="s_pubCall"})(pr||(pr={}));var V=pr,Yi="outbox",ji="inbox",Qi="broadcastbox",$t=function(t,n,e){return[t,n,e].join("_")},wa=function(){function t(n,e){this._runtime=n,this._appkey=e,this._users={}}return t.prototype._getMemData=function(n){return this._users[n]=this._users[n]||{inboxTime:0,outboxTime:0,broadcastSyncTime:0},this._users[n]},t.prototype.setInboxTime=function(n,e){var r=this._getMemData(e);if(!(r.inboxTime>n)){r.inboxTime=n;var i=$t(ji,this._appkey,e);this._runtime.localStorage.setItem(i,n.toString())}},t.prototype.getInboxTime=function(n){var e=this._getMemData(n);if(e.inboxTime===0){var r=$t(ji,this._appkey,n);e.inboxTime=parseInt(this._runtime.localStorage.getItem(r),10)||0}return e.inboxTime},t.prototype.setBroadcastSyncTime=function(n,e){var r=this._getMemData(e);if(!(r.broadcastSyncTime>=n||ot(n))){r.broadcastSyncTime=n;var i=$t(Qi,this._appkey,e);this._runtime.localStorage.setItem(i,n.toString())}},t.prototype.getBroadcastSyncTime=function(n){var e=this._getMemData(n);if(!e||e.broadcastSyncTime===0){var r=$t(Qi,this._appkey,n);e.broadcastSyncTime=parseInt(this._runtime.localStorage.getItem(r),10)||1}return e.broadcastSyncTime},t.prototype.setOutboxTime=function(n,e){var r=this._getMemData(e);if(!(r.outboxTime>=n)){r.outboxTime=n;var i=$t(Yi,this._appkey,e);this._runtime.localStorage.setItem(i,n.toString())}},t.prototype.getOutboxTime=function(n){var e=this._getMemData(n);if(e.outboxTime===0){var r=$t(Yi,this._appkey,n);e.outboxTime=parseInt(this._runtime.localStorage.getItem(r),10)||0}return e.outboxTime},t}(),Gn={_caches:{},set:function(t,n){this._caches[t]=n},get:function(t){return this._caches[t]||0},clear:function(t){this._caches[t]=0}},ba=function(){function t(n,e,r){this.logger=n,this._kvCaches={},this._chatroomId=e,this._currentUserId=r}return t.prototype._add=function(n){var e=n.key;n.isDeleted=!1,this._kvCaches[e]=n},t.prototype._remove=function(n){var e=n.key,r=this._kvCaches[e];r&&(r.isDeleted=!0,this._kvCaches[e]=r)},t.prototype._setEntry=function(n,e){var r=n.key,i=n.type,o=n.isOverwrite,s=n.userId,h=this._getSetUserId(r),l=i===Ct.DELETE,c=h===s,d=!this._isExisted(r),_=l?this._remove:this._add;(e||o||c||d)&&_.call(this,n)},t.prototype.getValue=function(n){var e=this._kvCaches[n]||{};return e.isDeleted?null:e.value},t.prototype.getVersion=function(n){var e=this._kvCaches[n]||{};return e.isDeleted?null:e.version},t.prototype.getAllValue=function(){var n={};for(var e in this._kvCaches)this._kvCaches[e].isDeleted||(n[e]=this._kvCaches[e].value);return n},t.prototype._getSetUserId=function(n){return(this._kvCaches[n]||{}).userId},t.prototype._isExisted=function(n){var e=this._kvCaches[n]||{},r=e.value,i=e.isDeleted;return r&&!i},t.prototype.setEntries=function(n){var e=this,r=n.kvEntries,i=n.isFullUpdate;r=r||[],(i=i||!1)&&this.clear(),r.forEach(function(o){e._setEntry(o,i)})},t.prototype.clear=function(){this._kvCaches={}},t}(),Pa=function(){function t(n){this._pullQueue=[],this._isPulling=!1,this._storeCaches={},this._engine=n}return t.prototype._startPull=function(){return L(this,void 0,void 0,function(){var n,e,r,i,o,s,h;return M(this,function(l){switch(l.label){case 0:return this._isPulling||this._pullQueue.length===0?[2]:(this._isPulling=!0,n=this._pullQueue.splice(0,1)[0],e=n.chrmId,r=n.timestamp,(i=Gn.get(e))>r?(this._isPulling=!1,this._startPull(),[2]):[4,this._engine.pullChatroomEntry(e,i)]);case 1:return o=l.sent(),s=o.code,h=o.data,this._isPulling=!1,s===R.SUCCESS?(Gn.set(e,h.syncTime||0),this._startPull()):this._startPull(),[2]}})})},t.prototype.reset=function(n){Gn.clear(n);var e=this._storeCaches[n];e==null||e.clear()},t.prototype.pullEntry=function(n,e){this._pullQueue.push({chrmId:n,timestamp:e}),this._startPull()},t.prototype.setLocal=function(n,e,r){var i=this._storeCaches[n];re(i)||(i=new ba(this._engine.getInnerLogger(),n,r)),i.setEntries(e),this._storeCaches[n]=i},t.prototype.getValue=function(n,e){var r=this._storeCaches[n];return r?r.getValue(e):null},t.prototype.getVersion=function(n,e){var r=this._storeCaches[n];return r?r.getVersion(e):null},t.prototype.getAll=function(n){var e=this._storeCaches[n],r={};return e&&(r=e.getAllValue()),r},t}(),Da=function(){function t(n,e,r,i,o){this._runtime=n,this._appkey=e,this._userId=r,this._canJoinMulipleChrm=i,this.logger=o,this._sessionKey="",this._joinedChrmsInfo={},this._sessionKey="sync-chrm-".concat(this._appkey,"-").concat(this._userId)}return t.prototype.set=function(n,e){e===void 0&&(e=10),this._canJoinMulipleChrm||(this._joinedChrmsInfo={}),this._joinedChrmsInfo[n]=e,this._runtime.sessionStorage.setItem(this._sessionKey,JSON.stringify(this._joinedChrmsInfo))},t.prototype.get=function(){var n,e;try{e=this._runtime.sessionStorage.getItem(this._sessionKey),n=JSON.parse(e||"{}")}catch{this.logger.error(P.O,"parse rejoined chrm infos error -> ".concat(e)),n={}}return n},t.prototype.remove=function(n){delete this._joinedChrmsInfo[n],re(this._joinedChrmsInfo)?this._runtime.sessionStorage.setItem(this._sessionKey,JSON.stringify(this._joinedChrmsInfo)):this.clear()},t.prototype.clear=function(){this._joinedChrmsInfo={},this._runtime.sessionStorage.removeItem(this._sessionKey)},t}(),Wi="converStatusChanged",Va=function(){function t(n,e,r){this._eventEmitter=new ro,this._pullQueue=[],this._isPulling=!1,this._storagePullTimeKey="con-s-".concat(e,"-").concat(r),this._oldStorage=pn(n.runtime),this._storage=new Xe(n.runtime,this._storagePullTimeKey),this._appkey=e,this._currentUserId=r,this._engine=n,this.adaptOldStatus()}return t.prototype.adaptOldStatus=function(){try{if(this._storage.get(this._storagePullTimeKey))return;var n=this._oldStorage.get(this._storagePullTimeKey)||0;if(!n)return;this._storage.set(this._storagePullTimeKey,n),this._oldStorage.remove(this._storagePullTimeKey)}catch(e){this._engine.getInnerLogger().error(P.A_CALLBACK_E,"adaptOldStatus error: ".concat(e.message))}},t.prototype._set=function(n){var e=this;if(!ot(n)&&Array.isArray(n)){var r=this._storage.get(this._storagePullTimeKey)||0,i=n.length;n.forEach(function(o,s){var h=o.updatedTime||0;r=h>r?h:r,o.conversationType=o.type,e._eventEmitter.emit(Wi,{statusItem:o,isLastPull:s===i-1})}),this._storage.set(this._storagePullTimeKey,r)}},t.prototype._startPull=function(){return L(this,void 0,void 0,function(){var n,e,r,i;return M(this,function(o){switch(o.label){case 0:return this._isPulling||this._pullQueue.length===0?[2]:(this._isPulling=!0,n=this._pullQueue.splice(0,1)[0],[4,this._engine.pullConversationStatus(n)]);case 1:return e=o.sent(),r=e.code,i=e.data,r===R.SUCCESS?(this._isPulling=!1,this._set(i),this._startPull()):this._startPull(),[2]}})})},t.prototype.pull=function(n){var e=this._storage.get(this._storagePullTimeKey)||0;(n>e||n===0)&&(this._pullQueue.push(e),this._startPull())},t.prototype.watch=function(n){this._eventEmitter.on(Wi,function(e){n(e)})},t.prototype.setConversationUpdatedTime=function(n){var e=this._storage.get(this._storagePullTimeKey)||0;return n&&n>e?(this._storage.set(this._storagePullTimeKey,n),n):e},t.prototype.getConversationUpdatedTime=function(){return this._storage.get(this._storagePullTimeKey)||0},t}(),Vt={c:{keyName:"unreadMessageCount",defaultVal:0},hm:{keyName:"hasMentioned",defaultVal:!1},m:{keyName:"mentionedInfo",defaultVal:null},t:{keyName:"lastUnreadTime",defaultVal:0},lt:{keyName:"lastReadTime",defaultVal:0},nc:{keyName:"notificationStatus",defaultVal:2},nl:{keyName:"notificationLevel",defaultVal:0},to:{keyName:"isTop",defaultVal:!1},tg:{keyName:"tags",defaultVal:{}},mc:{keyName:"unreadMentionedCount",defaultVal:0},st:{keyName:"lastMessageSentTime",defaultVal:0}},je={};for(var Ji in Vt){var Ga=Vt[Ji].keyName;je[Ga]=Ji}var ge,ka=function(){function t(n,e,r,i){this._appkey=e,this._currentUserId=r,this.logger=i;var o="con-".concat(e,"-").concat(r);this.storage=new Xe(n,o),this._localStore=new Xe(n,"CONVER-".concat(e,"-").concat(r))}return t.prototype._getStoreKey=function(n,e,r){return"".concat(r,"_").concat(n,"_").concat(e)},t.prototype._getConOptionByKey=function(n){var e=(n=n||"").split("_");if(e.length>=2){var r=e.shift(),i=e.shift(),o=e.join("_");return{conversationType:Number(i),targetId:o,channelId:r}}return{conversationType:B.PRIVATE,targetId:"",channelId:""}},t.prototype._updateMentionedUserList=function(n,e,r){var i=this,o=n.conversationType,s=n.messageType,h=n.isMentioned,l=n.senderUserId;if(h&&o===B.GROUP&&((r.userIdList||[]).forEach(function(d){d===i._currentUserId&&e.indexOf(l)<0&&e.push(l)}),r.type===me.ALL&&e.indexOf(l)<0&&e.push(l)),s===nt.RECALL&&o===B.GROUP){var c=e.indexOf(l);c>=0&&e.splice(c,1)}return e},t.prototype.updateMentionedData=function(n){var e=n.conversationType,r=n.targetId,i=n.content,o=n.channelId,s=i.mentionedInfo;if(s){var h=this._getStoreKey(e,r,o),l=this._localStore.get(h)||{},c=je.mentionedInfo,d=je.hasMentioned,_=l[c]||{},v=_.userIdList||[];s={userIdList:v=this._updateMentionedUserList(n,v,s),type:(s==null?void 0:s.type)||_.type},v.length!==0?(l[c]=s,l[d]=!0):(delete l[c],delete l[d]),re(l)?this._localStore.set(h,l):this._localStore.remove(h)}},t.prototype._setLocal=function(n,e){if(n==="tags")for(var r in e)e[r].isTop||delete e[r].isTop;return e},t.prototype.set=function(n,e,r,i){var o=this._getStoreKey(n,e,i),s=this._localStore.get(o)||{};for(var h in r){var l=je[h],c=r[h];!ot(l)&&!ot(c)&&h!=="hasMentioned"&&h!=="MentionedInfo"&&(c===Vt[l].defaultVal||h==="tags"&&!re(c)?delete s[l]:s[l]=this._setLocal(h,c),s.c||(delete s.t,delete s.hm,delete s.m,delete s.mc))}var d=Object.keys(s);d.length===1&&d.includes("st")&&delete s.st,re(s)?this._localStore.set(o,s):this._localStore.remove(o)},t.prototype.get=function(n,e,r){r===void 0&&(r="");var i=this._getStoreKey(n,e,r),o=this._localStore.get(i)||{},s={};for(var h in Vt){var l=Vt[h],c=l.keyName,d=l.defaultVal;s[c]=o[h]||_e(d)}return s},t.prototype.getValue=function(n){var e=this._localStore.getValues()||{},r=[];for(var i in e){var o=this._getConOptionByKey(i),s={conversationType:o.conversationType,targetId:o.targetId,channelId:o.channelId},h=e[i];for(var l in h)if(Vt[l]){var c=Vt[l],d=c.keyName,_=c.defaultVal;s[d]=h[l]||_e(_)}s=n?n(s):s,r.push(s)}return r},t.prototype.getValueForTag=function(){var n=this._localStore.getValues()||{},e={};for(var r in n){var i=this._getConOptionByKey(r),o=i.conversationType,s=i.targetId,h={},l=n[r];for(var c in l){var d=Vt[c],_=d.keyName,v=d.defaultVal;h[_]=l[c]||_e(v)}for(var I in h.tags){ot(e[I])&&(e[I]=[]);var T=Z(Z({},h),{conversationType:o,targetId:s});delete T.tags,e[I].push(T)}}return e},t.prototype.adaptOldStore=function(){try{var n=this.storage.getValues();if(Object.keys(n).length===0)return;for(var e in n){var r="_".concat(e);this._localStore.set(r,n[e])}this.storage.clear()}catch(i){this.logger.error(P.O,"adaptOldStore error: ".concat(i.message))}},t.prototype.remove=function(n,e,r){var i=this._getStoreKey(n,e,r);this._localStore.remove(i)},t}(),Ba=[B.PRIVATE,B.GROUP,B.SYSTEM,B.PUBLIC_SERVICE,B.APP_PUBLIC_SERVICE],ke={CHANGED:"conversationChanged",CON_TAG_STATUS_CHANGED:"conTagStatusChanged"},Xi=1e3,xa=function(){function t(n,e,r,i,o){var s=this;this._updatedConversations={},this._conTagStatusChanged=!1,this._eventEmitter=new ro,this._draftMap={},this._recallMsgTimeMap={},this._appkey=e,this._loginUserId=r,this._store=new ka(n.runtime,e,r,n.getInnerLogger()),this._statusManager=new Va(n,e,r),this._statusManager.watch(function(l){var c=l.statusItem,d=l.isLastPull;s.addStatus(c,d)}),this._eventEmitter.on(ke.CHANGED,function(l){i(l)}),this._eventEmitter.on(ke.CON_TAG_STATUS_CHANGED,function(){o()});var h=this._store.getValue();h.length>Xi&&(h=h.sort(function(l,c){var d=l.lastMessageSentTime,_=d===void 0?0:d,v=c.lastMessageSentTime;return(v===void 0?0:v)-_}),h.splice(Xi,h.length).forEach(function(l){s._store.remove(l.conversationType,l.targetId,l.channelId)}))}return t.prototype._calcMsg=function(n,e,r,i){var o=!this._recallMsgTimeMap[n]||this._recallMsgTimeMap[n]&&!this._recallMsgTimeMap[n].find(function(h){return h===i.sentTime}),s=e>=i.sentTime;return r&&(s=r<i.sentTime),{isNotRead:s,isNotRepeadRecallSendTime:o}},t.prototype._calcUnreadCount=function(n,e){var r=n.content,i=n.messageType,o=n.sentTime,s=n.isCounted,h=n.messageDirection,l=n.senderUserId,c=h===Ot.SEND&&l===this._loginUserId,d=i===nt.RECALL,_=It(r),v=!1,I={},T=e.lastUnreadTime,a=e.lastReadTime,u=e.unreadMessageCount;if(T>o||c)return{hasChanged:v,localConversation:e,updateItems:I};if(s&&(e.unreadMessageCount=u+1,e.lastUnreadTime=o,v=!0),d&&_){var p="".concat(n.conversationType,"_").concat(n.channelId,"_").concat(n.targetId),f=this._calcMsg(p,T,a,r),E=f.isNotRead,m=f.isNotRepeadRecallSendTime;E&&u&&m&&(this._recallMsgTimeMap[p]||(this._recallMsgTimeMap[p]=[]),this._recallMsgTimeMap[p].push(r.sentTime),e.unreadMessageCount=u-1,v=!0)}return v&&(I.unreadMessageCount={val:e.unreadMessageCount||0,time:o}),{hasChanged:v,localConversation:e,updateItems:I}},t.prototype._calcMentionedInfo=function(n,e){var r=n.content,i=n.messageDirection,o=n.isMentioned,s=n.sentTime,h=i===Ot.SEND,l=It(r),c=!1,d={};return!h&&o&&l&&r.mentionedInfo&&(e.hasMentioned=!0,c=!0,d.hasMentioned={val:!0,time:s},d.mentionedInfo={val:r.mentionedInfo,time:s}),{hasChanged:c,localConversation:e,updateItems:d}},t.prototype._calcMentionedCount=function(n,e){var r=n.content,i=n.messageDirection,o=!1;if(n.isMentioned&&i===Ot.RECEIVE&&(r!=null&&r.mentionedInfo)){var s=r.mentionedInfo,h=s.type,l=s.userIdList;if(h===me.ALL||(l||[]).includes(this._loginUserId)){o=!0;var c=e.unreadMentionedCount||0;e.unreadMentionedCount=c+1}(l||[]).includes(this._loginUserId)&&(o=!0,c=e.unreadMentionedMeCount||0,e.unreadMentionedCount=c+1)}return{hasChanged:o,localConversation:e}},t.prototype._setUpdatedConversation=function(n){if(It(n)){var e=n.conversationType,r=n.targetId,i=n.channelId,o="".concat(e,"_").concat(r),s=this._store.get(e,r,i)||{};this._updatedConversations[o]=Object.assign(s,n)}},t.prototype._setConTagStatusChanged=function(n,e,r,i){var o=(this._store.get(n,e,i)||{}).tags||{};if(Object.keys(o).length===Object.keys(r).length){for(var s in o)if(!r[s]||!!o[s].isTop!=!!r[s].isTop)return void(this._conTagStatusChanged=!0)}else this._conTagStatusChanged=!0},t.prototype.addStatus=function(n,e){var r=n.conversationType,i=n.targetId,o=n.updatedTime,s=n.notificationStatus,h=n.notificationLevel,l=n.isTop,c=n.tags,d=n.channelId,_={},v={};if(r!==B.ULTRA_GROUP){ot(s)||(v.notificationStatus={time:o,val:s}),ot(h)||(v.notificationLevel={time:o,val:h}),ot(l)||(v.isTop={time:o,val:l}),ot(c)||(v.tags={time:o,val:c},c==null||c.forEach(function(T){_[T.tagId]={isTop:T.isTop}})),this._setConTagStatusChanged(r,i,_,d);var I=this._store.get(r,i,d).lastMessageSentTime||new Date().getTime();this._store.set(r,i,{notificationStatus:s,notificationLevel:h,isTop:l,tags:_,lastMessageSentTime:I},d),this._setUpdatedConversation({conversationType:r,targetId:i,updatedItems:v,channelId:d}),e&&this._notifyConversationChanged()}},t.prototype._notifyConversationChanged=function(){var n=[];for(var e in this._updatedConversations)n.push(this._updatedConversations[e]);n.length!==0&&(this._eventEmitter.emit(ke.CHANGED,n),this._updatedConversations={},this._conTagStatusChanged&&(this._eventEmitter.emit(ke.CON_TAG_STATUS_CHANGED),this._conTagStatusChanged=!1))},t.prototype.setConversationCacheByMessage=function(n,e){var r=this,i=n.conversationType,o=n.isPersited,s=n.targetId,h=n.channelId,l=n.sentTime;if(Ba.indexOf(i)>=0){var c=!1,d=this._store.get(i,s,h),_={};if(d.lastMessageSentTime=l,[this._calcUnreadCount,this._calcMentionedInfo,this._calcMentionedCount].forEach(function(T){var a=T.call(r,n,d),u=a.hasChanged,p=a.localConversation,f=a.updateItems;c=c||u,_=Z(Z({},_),f),d=_e(p)}),this._store.set(i,s,d,h),this._store.updateMentionedData(n),o){var v=this._store.get(i,s,h);v.updatedItems=Z({latestMessage:{time:n.sentTime,val:n}},_),v.latestMessage=n;var I=Object.assign(v,{conversationType:i,targetId:s,channelId:h});this._setUpdatedConversation(I)}(c||o)&&this._notifyConversationChanged()}},t.prototype.get=function(n,e,r){return r===void 0&&(r=""),this._store.get(n,e,r)},t.prototype.getAllUnreadCount=function(n,e,r){var i=this._store.getValue(),o=0;return i.forEach(function(s){var h=s.unreadMessageCount,l=s.notificationStatus,c=s.notificationLevel,d=s.conversationType;h=h||0,(r||c!==void 0&&c<=0||c===void 0&&l!==Rt.OPEN)&&(e.length>0?e.includes(Number(d))&&(o+=Number(h)):o+=Number(h))}),o},t.prototype.getTotalUnreadCountByLevels=function(n,e,r){var i=this._store.getValue(),o=0;return i.forEach(function(s){var h=s.unreadMessageCount,l=s.notificationLevel,c=l===void 0?0:l,d=s.conversationType,_=s.unreadMentionedCount;n.includes(d)&&(e.length===0||e.includes(c))&&(o+=(r?_:h)||0)}),o},t.prototype.getUnreadCountByTag=function(n,e){var r=this._store.getValueForTag()[n]||[],i=0;return r.forEach(function(o){var s=o.unreadMessageCount,h=o.notificationStatus,l=o.notificationLevel;(e||h!==1||l===-1||l===0)&&(s=s||0,i+=Number(s))}),i},t.prototype.getUnreadCount=function(n,e,r){return this._store.get(n,e,r).unreadMessageCount||0},t.prototype.clearUnreadCount=function(n,e,r,i){i===void 0&&(i=!0);var o=this._store.get(n,e,r);o.lastReadTime=o.lastUnreadTime,this._recallMsgTimeMap["".concat(n,"_").concat(r,"_").concat(e)]=[];var s=o.unreadMessageCount,h=o.hasMentioned,l={};if(s&&(o.unreadMessageCount=0,l.unreadMessageCount={val:0,time:Date.now()}),h&&(o.hasMentioned=!1,o.unreadMentionedCount=0,o.mentionedInfo=void 0,l.hasMentioned={val:!1,time:Date.now()},l.mentionedInfo={val:void 0,time:Date.now()}),this._store.set(n,e,o,r),i&&Object.keys(l).length!==0){var c=Object.assign(o,{conversationType:n,targetId:e,channelId:r,updatedItems:l});this._setUpdatedConversation(c),this._notifyConversationChanged()}},t.prototype.clearAllUnreadCount=function(){var n=this;this._store.getValue().forEach(function(e){e.unreadMessageCount&&(e.unreadMessageCount=0,e.lastReadTime=e.lastUnreadTime,n._recallMsgTimeMap={},n._store.set(e.conversationType,e.targetId,e,e.channelId))})},t.prototype.startPullConversationStatus=function(n){this._statusManager.pull(n)},t.prototype.setDraft=function(n,e,r,i){var o="".concat(n,"_").concat(e,"_").concat(i);this._draftMap[o]=r},t.prototype.getDraft=function(n,e,r){var i="".concat(n,"_").concat(e,"_").concat(r);return this._draftMap[i]},t.prototype.clearDraft=function(n,e,r){var i="".concat(n,"_").concat(e,"_").concat(r);delete this._draftMap[i]},t.prototype.addTagStatus=function(n,e,r,i){i===void 0&&(i="");var o=this._store.get(n,e,i),s=o.tags;s=Object.assign(s,r);var h=o.lastMessageSentTime||new Date().getTime();this._store.set(n,e,{tags:s,lastMessageSentTime:h},i)},t.prototype.deleteTagStatus=function(n,e,r,i){i===void 0&&(i="");var o=this._store.get(n,e,i).tags;r.forEach(function(s){delete o[s]}),this._store.set(n,e,{tags:o},i)},t.prototype.getConversationListForTag=function(){return this._store.getValueForTag()},t.prototype.getBlockConversationList=function(){return this._store.getValue().filter(function(n){return n.notificationStatus===Rt.OPEN||n.notificationLevel&&n.notificationLevel>0}).map(function(n){return{conversationType:n.conversationType,targetId:n.targetId,channelId:n.channelId,notificationLevel:n.notificationLevel||0,notificationStatus:n.notificationStatus||2}})},t.prototype.getTopConversationList=function(n,e){return(this._store.getValue()||{}).filter(function(r){return n.includes(r.conversationType)&&(ot(e)||e===r.channelId)&&r.isTop}).map(function(r){return{channelId:r.channelId,conversationType:r.conversationType,targetId:r.targetId,unreadMessageCount:r.unreadMessageCount||0,latestMessage:null,hasMentioned:r.hasMentioned||!1,mentionedInfo:r.mentionedInfo,notificationStatus:r.notificationStatus||0,notificationLevel:r.notificationLevel,isTop:r.isTop||!1,lastUnreadTime:r.lastUnreadTime||0,unreadMentionedCount:r.unreadMentionedCount||0}})},t.prototype.adaptOldStore=function(){this._store.adaptOldStore()},t.prototype.getUnreadMentionedCount=function(n,e,r){return r===void 0&&(r=""),this.get(n,e,r).unreadMentionedCount||0},t.prototype.getAllUnreadMentionedCount=function(){var n=this._store.getValue(),e=0;return n.forEach(function(r){var i=r.unreadMentionedCount;i=i||0,e+=Number(i)}),e},t.prototype.getAllConversationState=function(){return this._store.getValue().filter(function(n){return n.unreadMessageCount||n.unreadMentionedCount}).map(function(n){return{conversationType:n.conversationType,targetId:n.targetId,channelId:n.channelId,unreadCount:n.unreadMessageCount||0,unreadMentionedCount:n.unreadMentionedCount||0}})},t.prototype.getUnreadConversationList=function(n){return(this._store.getValue()||{}).filter(function(e){return n.includes(e.conversationType)&&e.unreadMessageCount&&e.unreadMessageCount>0}).map(function(e){return{channelId:e.channelId,conversationType:e.conversationType,targetId:e.targetId,unreadMessageCount:e.unreadMessageCount||0,latestMessage:null,hasMentioned:e.hasMentioned||!1,mentionedInfo:e.mentionedInfo,notificationStatus:e.notificationStatus||0,notificationLevel:e.notificationLevel,isTop:e.isTop||!1,lastUnreadTime:e.lastUnreadTime||0,unreadMentionedCount:e.unreadMentionedCount||0}})},t.prototype.setConversationUpdatedTime=function(n){return this._statusManager.setConversationUpdatedTime(n)},t.prototype.getConversationUpdatedTime=function(){return this._statusManager.getConversationUpdatedTime()},t}(),Fa=function(){function t(n,e,r,i){this._pullQueue=[],this._isPulling=!1,this._storageTagKey="tag-".concat(e,"-").concat(r),this._storagePullTimeKey="us-s-".concat(e,"-").concat(r),this._storage=pn(n.runtime),this._engine=n,this._tagWatcherFunc=i}return t.prototype._updateTag=function(n){var e=n.tags,r={};e.forEach(function(i){r[i.tagId]={tagName:i.tagName,createdTime:i.createdTime}}),this._storage.set(this._storageTagKey,r),this._tagWatcherFunc()},t.prototype.addTag=function(n,e){var r=this._storage.get(this._storageTagKey)||{};n.forEach(function(i){var o,s=((o=r[i.tagId])===null||o===void 0?void 0:o.createdTime)||i.createdTime||0;r[i.tagId]={tagName:i.tagName,createdTime:s}}),this._storage.set(this._storageTagKey,r),this._storage.set(this._storagePullTimeKey,e)},t.prototype.deleteTag=function(n,e){var r=this._storage.get(this._storageTagKey)||{};n.forEach(function(i){delete r[i]}),this._storage.set(this._storageTagKey,r),this._storage.set(this._storagePullTimeKey,e)},t.prototype.getTagsInfo=function(){return this._storage.get(this._storageTagKey)||{}},t.prototype.getTags=function(){var n=this._storage.get(this._storageTagKey)||{},e=[];for(var r in n)e.push({tagId:r,tagName:n[r].tagName,createdTime:n[r].createdTime,conversationCount:0});return e.sort(function(i,o){return(i.createdTime||0)-(o.createdTime||0)})},t.prototype.getTagById=function(n){var e=this._storage.get(this._storageTagKey)||{};return e[n]?{tagId:n,tagName:e[n].tagName,createdTime:e[n].createdTime,conversationCount:0}:null},t.prototype._startPull=function(){return L(this,void 0,void 0,function(){var n,e,r,i,o,s,h,l;return M(this,function(c){switch(c.label){case 0:return this._isPulling||this._pullQueue.length===0?[2]:(this._isPulling=!0,n=this._pullQueue.splice(0,1)[0],[4,this._engine.pullUserSettings(n)]);case 1:return e=c.sent(),r=e.code,i=e.data,r!==R.SUCCESS||ot(i)?(this._isPulling=!1,this._startPull()):(s=(o=i).settings,h=o.version,l=s.Tag,ot(l)||this._updateTag(l),this._storage.set(this._storagePullTimeKey,h),this._isPulling=!1,this._startPull()),[2]}})})},t.prototype.pullUserSettings=function(n){var e=this._storage.get(this._storagePullTimeKey)||0;(n>e||n===0)&&(this._pullQueue.push(e),this._startPull())},t.prototype.getVersion=function(){return this._storage.get(this._storagePullTimeKey)||0},t}(),kn=function(t){return t.replace(/@.+$/,"@")},Ha=function(){function t(n,e,r){this.appkey=n,this.logger=e,this.statisticLog=r,this.crtRequest=null,this._environment="default"}return t.prototype.getCatchKey=function(n){return n+(this._environment?"-".concat(this._environment):"")},t.prototype.request=function(n,e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l;return M(this,function(c){switch(c.label){case 0:return this.crtRequest?[2,this.crtRequest]:(this.crtRequest=this.sendRequest(n,e,r,i,o),[4,this.crtRequest]);case 1:return s=c.sent(),h=s.code,l=s.data,this.crtRequest=null,[2,{code:h,data:l}]}})})},t.prototype.sendRequest=function(n,e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_,v,I,T,a;return M(this,function(u){switch(u.label){case 0:return s=kn(n),!e&&(h=this.getNaviCache(s))&&(l=h.timestamp,c=h.naviInfo,r||Date.now()-l<to)?(this.logger.info(P.L_REQUEST_T,JSON.stringify({fromCache:!0,naviInfo:c}),i),d={bid:rn(),ptc:ye.NAVI,cod:R.SUCCESS,net:o==null?void 0:o.type,dur:0,spr:1,pr:c.type||0,hos:"",cache:ze.LOCAL,v:Ie.CURRENT,rsn:o==null?void 0:o.reason,cid:"".concat(o==null?void 0:o.uuid,"_").concat(o==null?void 0:o.retryCount),count:o==null?void 0:o.retryCount},this.statisticLog.__statistics(wt.IM_NAVI,JSON.stringify(d),i),[2,{code:R.SUCCESS,data:c}]):(_=Yt.getNaviUrlList(n),this.logger.info(P.L_GET_NAVI_T,JSON.stringify({token:n,uris:_}),i),[4,this.requestHandler(_,n,i,o)]);case 1:return v=u.sent(),I=v.code,T=v.data,I!==R.SUCCESS?(this.logger.warn(P.L_GET_NAVI_R,I,i),[2,{code:I}]):(a=T).code&&a.code!==200?(this.logger.warn(P.L_GET_NAVI_R,a.code,i),[2,{code:this.transHttpCode(a.code)}]):(this.logger.info(P.L_GET_NAVI_R,JSON.stringify({naviInfo:a}),i),this.setNaviCache(s,a),[2,{code:I,data:a}])}})})},t.prototype.requestHandler=function(n,e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c,d,_,v,I;return M(this,function(T){switch(T.label){case 0:o=0,s=n.length,T.label=1;case 1:return o<s?(h=o===n.length-1,l=this.useV2Navi()?this.httpRequestV2:this.httpRequest,c=Date.now(),[4,l.call(this,n[o],this.appkey,e,r,h)]):[3,4];case 2:if(d=T.sent(),_=d.code,v=d.data,I={bid:rn(),ptc:ye.NAVI,cod:_,net:i==null?void 0:i.type,dur:Date.now()-c,spr:1,pr:(v==null?void 0:v.type)||0,hos:n[o],cache:ze.REQUEST,v:Ie.CURRENT,rsn:i==null?void 0:i.reason,cid:"".concat(i==null?void 0:i.uuid,"_").concat(i==null?void 0:i.retryCount),count:i==null?void 0:i.retryCount},this.statisticLog.__statistics(wt.IM_NAVI,JSON.stringify(I),r),[R.SUCCESS,R.RC_CONN_TOKEN_INCORRECT,R.RC_LICENSE_EXPIRED].includes(_))return[2,{code:_,data:v}];T.label=3;case 3:return o+=1,[3,1];case 4:return[2,{code:R.RC_NAVI_REQ_FAILED}]}})})},t.prototype.transHttpCode=function(n){switch(n){case 401:case 403:return R.RC_CONN_TOKEN_INCORRECT;case 416:return R.RC_LICENSE_EXPIRED;default:return R.RC_NAVI_REQ_FAILED}},t.prototype.getNaviInfoFromCache=function(n){var e=this.getNaviCache(kn(n));return e?e.naviInfo:null},t.prototype.updateVoipCallInfo=function(n,e){var r=this.getNaviInfoFromCache(n);r&&this.setNaviCache(kn(n),Z(Z({},r),{voipCallInfo:e}))},t.prototype.getNaviV2RequestOption=function(n){var e,r=n.uri,i=n.token,o=n.platform,s=n.protocol;e="".concat(r,"/v2/navi.json?cloud=").concat(1);var h="token=".concat(encodeURIComponent(i),"&version=").concat("5.8.2-enterprise.4","&platfrom=").concat(o);return{method:"POST",headers:{"RC-Appkey":this.appkey,"Content-Type":"Application/x-www-form-urlencoded","RC-Negotiate":"conn=".concat(s,";rtc=4;log=2")},body:h,url:e,timeout:eo}},t.prototype.useV2Navi=function(){return!1},t}(),Zi=function(t){return["navi",t].join("_")},Be={},Ka=function(t){function n(e,r,i,o,s){s===void 0&&(s="default");var h=t.call(this,e,r,i)||this;return h.runtime=o,h.environment=s,h._environment=s,h}return dt(n,t),n.prototype.httpRequest=function(e,r,i,o,s){return L(this,void 0,void 0,function(){var h,l,c,d;return M(this,function(_){switch(_.label){case 0:return h="".concat(e,"/navi.js?appId=").concat(r,"&token=").concat(encodeURIComponent(i),"&callBack=x&v=").concat(no,"&r=").concat(Date.now(),"&env=").concat(this._environment),this.logger.debug(P.L_REQUEST_T,"req navi => ".concat(h),o),[4,this.runtime.httpReq({url:h,timeout:eo,dataType:"text"})];case 1:if((l=_.sent()).status!==200)return this.logger.debug(P.L_REQUEST_R,"request navi failed: ".concat(l.status),o),!this.runtime.useNavi&&s?(d={code:200,protocol:"https",server:"",voipCallInfo:"",kvStorage:0,openHttpDNS:!1,historyMsg:!1,chatroomMsg:!1,location:"",monitor:0,joinMChrm:!1,openMp:0,openUS:0,grpMsgLimit:0,isFormatted:0,gifSize:2048,logSwitch:0,logPolicy:"",compDays:0,msgAck:"",activeServer:"",qnAddr:"",extkitSwitch:0,alone:!1,voipServer:"",offlinelogserver:"",backupServer:Yt.getMiniCmpUrlList().join(",")},[2,{code:R.SUCCESS,data:d}]):[2,{code:this.transHttpCode(l.status)}];try{return(c=l.data.match(/{[\d\D]+}/)[0]).indexOf('{\\"code\\":')===0&&(c=JSON.parse('"'.concat(c,'"'))),(d=JSON.parse(c)).protocol=/^https/.test(h)?"https":"http",d.code&&d.code!==200?[2,{code:this.transHttpCode(d.code)}]:(this.runtime.useNavi||(d.server="",d.backupServer=Yt.getMiniCmpUrlList().join(","),d.logSwitch=0),[2,{code:R.SUCCESS,data:d}])}catch{this.logger.error(P.L_PARSE_NAVI_E,l.data,o)}return[2,{code:R.RC_NAVI_REQ_FAILED}]}})})},n.prototype.httpRequestV2=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return s=this.getNaviV2RequestOption({appkey:r,token:i,uri:e,platform:this.runtime.tag,protocol:(/^https/.test(e)?ft.WSS:ft.WS).toString()}),this.logger.debug(P.L_REQUEST_T,"req navi => ".concat(s.url),o),[4,this.runtime.httpReq(s)];case 1:if((h=_.sent()).status!==200)return this.logger.debug(P.L_REQUEST_R,"request navi failed: ".concat(h.status),o),[2,{code:this.transHttpCode(h.status)}];try{return l=h.data,(c=typeof l!="object"?JSON.parse(l):l).protocol=/^https/.test(s.url)?"https":"http",this.runtime.useNavi||(c.logSwitch=0,d=Yt.getMiniCmpUrlList(),c.serverAddr=d.map(function(v,I){return{addr:v,protocol:/^https/.test(s.url)?ft.WSS:ft.WS,weight:d.length-I}})),[2,{code:R.SUCCESS,data:c}]}catch{this.logger.error(P.L_PARSE_NAVI_E,h.data,o)}return[2,{code:R.RC_NAVI_REQ_FAILED}]}})})},n.prototype.getNaviCache=function(e){var r=this,i=this.getCatchKey(e);if(Be[i])return Be[i];var o,s=Zi(this.appkey),h=this.runtime.localStorage;try{var l=h.getItem(s);o=l?JSON.parse(l):[]}catch{o=[]}if(o.length===0)return null;var c=o.find(function(d){return d.token===e&&d.environment===r._environment})||null;return Be[i]=c,c},n.prototype.setNaviCache=function(e,r){var i,o=this,s=Zi(this.appkey),h=this.runtime.localStorage;try{var l=h.getItem(s);i=l?JSON.parse(l):[]}catch{i=[]}var c=Date.now();i.length>0&&(i=i.filter(function(_){return c-_.timestamp<to&&(e!==_.token||o._environment!==_.environment)}));var d={timestamp:c,naviInfo:r,token:e,environment:this._environment};i.push(d),h.setItem(s,JSON.stringify(i)),Be[this.getCatchKey(e)]=d},n}(Ha),Bn=function(t,n){return["send_msg",t,n].join("_")},qa=function(){function t(n,e){this._runtime=n,this._appkey=e,this._sendMessageMap={},this._userId=""}return t.prototype.init=function(n){this._userId=n;var e=Bn(this._appkey,n);this._sendMessageMap=this._getLocalInfo(e)},t.prototype._getLocalInfo=function(n){var e=this._runtime.localStorage.getItem(n);try{return e?JSON.parse(e):{}}catch{return{}}},t.prototype.setMessage=function(n,e){this._sendMessageMap[n]=e;var r=Bn(this._appkey,this._userId),i=this._getLocalInfo(r);i[n]=e,this._runtime.localStorage.setItem(r,JSON.stringify(i))},t.prototype.getSendMessageMap=function(){return this._sendMessageMap},t.prototype.removeByUID=function(n){delete this._sendMessageMap[n]},t.prototype.removeByTimestamp=function(n){var e=Bn(this._appkey,this._userId),r=this._getLocalInfo(e);Object.keys(r).forEach(function(i){r[i]<n&&delete r[i]}),this._runtime.localStorage.setItem(e,JSON.stringify(r))},t}();(ge={})[B.PRIVATE]=V.qryPMsg,ge[B.GROUP]=V.qryGMsg,ge[B.CHATROOM]=V.qryCHMsg,ge[B.CUSTOMER_SERVICE]=V.qryCMsg,ge[B.SYSTEM]=V.qrySMsg;var Ya=[V[V.recallMsg],V[V.ppMsgS],V[V.pgMsgS],V[V.ppMsgP],V[V.pgMsgP],V[V.chatMsg],V[V.pcMsgP],V[V.prMsgS],V[V.updUgRTime],V[V.pbMsgP]],ja=function(){function t(n,e,r){this.ULTRA_GROUP_CONVERSATION="ultragroupconversation";var i="".concat(this.ULTRA_GROUP_CONVERSATION,"-").concat(e,"-").concat(r);this._localStore=new Xe(n,i)}return t.prototype.set=function(n,e,r,i){var o=this._getStoreKey(n,e,i),s=this._localStore.get(o)||{};for(var h in r){var l=So[h],c=r[h];!ot(l)&&!ot(c)&&(c===Ee[l].defaultVal?delete s[l]:s[l]=c)}re(s)?this._localStore.set(o,s):this._localStore.remove(o)},t.prototype.get=function(n,e,r){r===void 0&&(r="");var i=this._getStoreKey(n,e,r),o=this._localStore.get(i)||{},s={};for(var h in Ee){var l=Ee[h],c=l.keyName,d=l.defaultVal;s[c]=o[h]||_e(d)}return s},t.prototype._getStoreKey=function(n,e,r){return"".concat(r,"_").concat(n,"_").concat(e)},t}(),Ee={nc:{keyName:"notificationStatus",defaultVal:2},nl:{keyName:"notificationLevel",defaultVal:0}},So={};for(var zi in Ee){var Qa=Ee[zi].keyName;So[Qa]=zi}var q,Wa=function(){function t(n,e,r){this._store=new ja(n.runtime,e,r)}return t.prototype.addUltraGroupStatus=function(n){var e=n.conversationType,r=n.targetId,i=n.notificationStatus,o=n.notificationLevel,s=n.channelId;e===B.ULTRA_GROUP&&this._store.set(e,r,{notificationStatus:i,notificationLevel:o},s)},t.prototype.get=function(n,e,r){return r===void 0&&(r=""),this._store.get(n,e,r)},t}(),Oe="UpStreamMessage",Rr="PushExtra",En="DownStreamMessage",ie="DownStreamMessages",Sr="SessionsAttQryInput",Oo="SessionsAttOutput",Or="SyncRequestMsg",Nr="ChrmPullMsg",on="NotifyMsg",Mr="HistoryMsgInput",oe="HistoryMsgOuput",sn="RelationQryInput",se="RelationsOutput",Qe="UnreadMsgInfo",Lr="DeleteSessionsInput",Ur="SessionInfo",No="DeleteSessionsOutput",Ar="RelationsInput",wr="DeleteMsgInput",br="CleanHisMsgInput",vn="SessionMsgReadInput",Pr="ChrmInput",Ne="ChrmOutput",Dr="QueryChatRoomInfoInput",Tn="QueryChatRoomInfoOutput",Vr="GetQNupTokenInput",Gr="GetQNupTokenOutput",kr="GetQNdownloadUrlInput",Br="GetDownloadUrlInput",xr="GetQNdownloadUrlOutput",Fr="GetDownloadUrlOutput",Ja="ChrmKVEntity",Hr="SetChrmKV",Kr="SetChrmKVS",Mo="DeleteChrmKVS",ae="ChrmKVOutput",qr="ChrmKVSOutput",Xa="ChrmKVSVersionEntity",Lo="ChrmKVSOutputEntity",Yr="QueryChrmKV",Uo="SetUserSettingInput",ue="SetUserSettingOutput",jr="PullUserSettingInput",mn="PullUserSettingOutput",yn="UserSettingNotification",Qr="SessionReq",In="SessionStates",an="SessionState",un="SessionStateItem",cn="SessionStateModifyReq",Wr="SessionStateModifyResp",Jr="GroupUnpushQuery",Xr="GroupUnpushSet",Zr="QryRemindListReq",zr="QryRemindListResp",$r="GroupUnpushResult",ln="GrpReadReceiptMsg",Ao="GrpReadReceiptQryReq",Cn="GrpReadReceiptQryResp",wo="GrpMsgReadUser",ti="SessionTagAddInput",ve="SessionTagItem",ei="SessionTagDelInput",ni="SessionDisTagReq",ri="ReportSDKInput",bo="ReportSDKOutput",ii="UltraGrpPullSes",oi="UltraGrpPullMsg",hn="MsgChangeReq",si="QueryMsgChange",Po="MsgChange",Rn="MsgChangeList",ai="MsgQuery",Za="MessageQueryInfo",Me="MsgQueryAck",ui="OperateStatus",Sn="OperateStatusNotify",Do="OperateInfo",Vo="OperateSummary",ci="SetRtcRoomIdInput",Go="SetRtcRoomIdOutput",li="CallInfoUpStream",hi="CallInfoDownStream",ko="KvInput",di="KvOutput";(q={})[Oe]=["sessionId","classname","content","pushText","userId","configFlag","clientUniqueId","appData","extraContent","pushExt","busChannel"],q[ie]=["list","syncTime","finished","broadcastSyncTime"],q[En]=["fromUserId","type","groupId","classname","content","dataTime","status","msgId","extraContent","pushContent","configFlag","pushExt","busChannel","extStatus","toUserId","groupUnpush"],q[Rr]=["title","templateIdNoUse","pushId","pushConfigs","templateId"],q[Sr]=["nothing"],q[Oo]=["inboxTime","sendboxTime","totalUnreadCount"],q[Or]=["syncTime","ispolling","isweb","isPullSend","isKeeping","sendBoxSyncTime","broadcastSyncTime"],q[Nr]=["syncTime","count"],q[on]=["type","time","chrmId"],q[Mr]=["targetId","time","count","order","busChannel"],q[oe]=["list","syncTime","hasMsg"],q[sn]=["type","count","startTime","order"],q[se]=["info","isFinished"],q[Qe]=["msgId","msgTime","remindType","className"],q[Lr]=["sessions"],q[Ur]=["type","channelId","busChannel"],q[No]=["nothing"],q[Ar]=["type","msg","count","busChannel","startTime","endTime"],q[wr]=["type","conversationId","msgs","busChannel"],q[br]=["targetId","dataTime","conversationType","busChannel"],q[vn]=["type","msgTime","channelId","busChannel"],q[Pr]=["nothing"],q[Ne]=["nothing","sessionId","joinTime"],q[Dr]=["count","order"],q[Tn]=["userTotalNums","userInfos"],q[Vr]=["type","key","httpMethod","queryString","url","ext"],q[kr]=["type","key","fileName"],q[Br]=["type","key","fileName","ext"],q[Gr]=["deadline","token","bosToken","bosDate","path","osskeyId","ossPolicy","ossSign","ossBucketName"],q[xr]=["downloadUrl"],q[Fr]=["downloadUrl"],q[Ja]=["key","value","status","timestamp","uid","version"],q[Hr]=["entry","bNotify","notification","type"],q[Kr]=["entry","bNotify","notification","type"],q[Mo]=["entry","bNotify","notification","type"],q[ae]=["entries","bFullUpdate","syncTime"],q[qr]=["timestamp","errorKeys","keysVersion"],q[Xa]=["version","key"],q[Lo]=["key","errorCode"],q[Yr]=["timestamp"],q[Uo]=["version","value"],q[ue]=["version","reserve"],q[jr]=["version","reserve"],q[mn]=["items","version"],q.UserSettingItem=["targetId","type","key","value","version","status","tags"],q[Qr]=["time"],q[In]=["version","state"],q[an]=["type","channelId","time","stateItem","busChannel"],q[un]=["sessionStateType","value","tags"],q[cn]=["version","state"],q[Wr]=["version"],q[Xr]=["busChannel","unpushLevel"],q[Zr]=["groupId","busChannel","msgTime","size"],q[Jr]=["busChannel"],q[$r]=["groupId","busChannel","unpushLevel"],q[ln]=["msgId","busChannel"],q[Ao]=["msgId","busChannel"],q[Cn]=["totalMemberNum","list"],q[wo]=["readTime","userId"],q[ti]=["version","tags"],q[ve]=["tagId","name","createdTime","isTop"],q[ei]=["version","tags"],q[ni]=["tagId"],q[yn]=["version","reserve"],q[ri]=["sdkInfo"],q[bo]=["nothing"],q[ii]=["syncTime","isEraseMsgContent"],q[oi]=["syncTime"],q[hn]=["fromUserId","targetId","type","busChannel","msgUID","msgTime","content"],q[si]=["syncTime"],q[Rn]=["list","syncTime","hasNext"],q[Po]=["targetId","type","time","changeType","msgUID","msgTime","busChannel","isAdmin","isDel","operatorId","subChangeType","busChannelType","isRemindMe","userGroupIds","remindType"],q[ai]=["targetId","type","query"],q[Za]=["msgTime","msgUID","busChannel"],q[Me]=["list"],q[ui]=["targetId","type","opType","busChannel"],q[Sn]=["type","notifyType","info","summary"],q[Do]=["targetId","busChannel","userId","opType","optime"],q[Vo]=["targetId","busChannel","count","opType"],q[ci]=["rtcRoomId"],q[Go]=["nothing"];var lt,At,Dt,pt,za=`
package Modules;
message probuf {
  message SetUserStatusOutput
  {
    optional int32 nothing=1;
  }

  message GetUserStatusInput
  {
    optional int32 nothing=1;
  }

  message GetUserStatusOutput
  {
    optional string status=1;
    optional string subUserId=2;
  }

  message SubUserStatusInput
  {
    repeated string userid =1;
  }

  message SubUserStatusOutput
  {
    optional int32 nothing=1;
  }
  message VoipDynamicInput
  {
    required int32  engineType = 1;
    required string channelName = 2;
    optional string channelExtra = 3;
  }

  message VoipDynamicOutput
  {
      required string dynamicKey=1;
  }
  message `.concat(on,` {
    required int32 type = 1;
    optional int64 time = 2;
    optional string chrmId=3;
  }
  message `).concat(Or,` {
    required int64 syncTime = 1;
    required bool ispolling = 2;
    optional bool isweb=3;
    optional bool isPullSend=4;
    optional bool isKeeping=5;
    optional int64 sendBoxSyncTime=6;
    optional int64 broadcastSyncTime=7;
  }
  message `).concat(Oe,` {
    required int32 sessionId = 1;
    required string classname = 2;
    required bytes content = 3;
    optional string pushText = 4;
    optional string appData = 5;
    repeated string userId = 6;
    optional int64 delMsgTime = 7;
    optional string delMsgId = 8;
    optional int32 configFlag = 9;
    optional int64 clientUniqueId = 10;
    optional string extraContent = 11;
    optional PushExtra pushExt = 12;
    optional string busChannel = 13; // 该消息所属会话的业务标识
    optional string systemId = 16; // 系统会话消息时需填该字段为 targetId, 其他类型无需传
  }
  message `).concat(Rr,` {
    optional string title = 1;
    optional int32  templateIdNoUse= 2;
    optional string pushId = 3;
    optional string pushConfigs = 4;
    optional string templateId = 5;
  }
  message `).concat(ie,` {
    repeated DownStreamMessage list = 1;
    required int64 syncTime = 2;
    optional bool finished = 3;
    optional int64 broadcastSyncTime = 4;
  }
  message `).concat(En,` {
    required string fromUserId = 1;
    required ChannelType type = 2;
    optional string groupId = 3;
    required string classname = 4;
    required bytes content = 5;
    required int64 dataTime = 6;
    required int64 status = 7;
    optional int64 extra = 8;
    optional string msgId = 9;
    optional int32 direction = 10;
    optional int32 plantform =11;
    optional int32 isRemoved = 12;
    optional string source = 13;
    optional int64 clientUniqueId = 14;
    optional string extraContent = 15;
    optional string pushContent = 16;
    optional int32 configFlag = 17;
    optional PushExtra pushExt = 18;
    optional string busChannel = 19; // 该消息所属会话的业务标识，限制20字符以内
    // 消息的扩展标记
    // 第0位,表示送达状态: 0x01 表示已送达;
    // 断档: 0x02 表示是否需要执行断档策略;
    // 消息修改: 0x04 拉取历史消息时表示该消息是否修改过
    // 0x08 每条消息携带的频道类型
    optional int64 extStatus = 20;
    repeated string toUserId = 21;  //指定接收者（限定群和讨论组）//增加聊天室定向成员
    optional int32 groupUnpush = 22; //群聊默认免打扰级别
  }
  enum ChannelType {
    PERSON = 1;
    PERSONS = 2;
    GROUP = 3;
    TEMPGROUP = 4;
    CUSTOMERSERVICE = 5;
    NOTIFY = 6;
    MC=7;
    MP=8;
    ULTRAGROUP = 10;
  }
  message CreateDiscussionInput {
    optional string name = 1;
  }
  message CreateDiscussionOutput {
    required string id = 1;
  }
  message ChannelInvitationInput {
    repeated string users = 1;
  }
  message LeaveChannelInput {
    required int32 nothing = 1;
  }
  message ChannelEvictionInput {
    required string user = 1;
  }
  message RenameChannelInput {
    required string name = 1;
  }
  message ChannelInfoInput {
    required int32 nothing = 1;
  }
  message ChannelInfoOutput {
    required ChannelType type = 1;
    required string channelId = 2;
    required string channelName = 3;
    required string adminUserId = 4;
    repeated string firstTenUserIds = 5;
    required int32 openStatus = 6;
  }
  message ChannelInfosInput {
    required int32 page = 1;
    optional int32 number = 2;
  }
  message ChannelInfosOutput {
    repeated ChannelInfoOutput channels = 1;
    required int32 total = 2;
  }
  message MemberInfo {
    required string userId = 1;
    required string userName = 2;
    required string userPortrait = 3;
    required string extension = 4;
  }
  message GroupMembersInput {
    required int32 page = 1;
    optional int32 number = 2;
  }
  message GroupMembersOutput {
    repeated MemberInfo members = 1;
    required int32 total = 2;
  }
  message GetUserInfoInput {
    required int32 nothing = 1;
  }
  message GetUserInfoOutput {
    required string userId = 1;
    required string userName = 2;
    required string userPortrait = 3;
  }
  message GetSessionIdInput {
    required int32 nothing = 1;
  }
  message GetSessionIdOutput {
    required int32 sessionId = 1;
  }
  enum FileType {
    image = `).concat(Wt.IMAGE,`;
    audio = `).concat(Wt.AUDIO,`;
    video = `).concat(Wt.VIDEO,`;
    file = `).concat(Wt.FILE,`;
    sight = `).concat(Wt.SIGHT,`;
    html = `).concat(Wt.COMBINE_HTML,`;
  }
  message `).concat(Vr,` {
    required FileType type = 1;
    optional string key = 2;
    optional string httpMethod = 3;
    optional string queryString = 4;
    optional string url = 5; // url, sdk 设置下载地址
    optional string ext = 6; // 扩展字段，SDK 与 服务自定义字段，格式 json
  }
  message `).concat(kr,` {
    required FileType type = 1;
    required string key = 2;
    optional string  fileName = 3;
  }
  message `).concat(Br,` {
    required FileType type = 1;
    required string key = 2;
    optional string fileName = 3;
    optional string ext = 4; // 扩展字段，SDK 与 服务自定义字段，格式 json
   }
  message `).concat(Gr,` {
    required int64 deadline = 1;
    required string token = 2;
    optional string bosToken = 3;
    optional string bosDate = 4;
    optional string path = 5;
    optional string osskeyId = 6;
    optional string ossPolicy = 7;
    optional string ossSign = 8;
    optional string ossBucketName = 9;
    optional string s3Credential = 10;
    optional string s3Algorithm = 11;
    optional string s3Date = 12;
    optional string s3Policy = 13;
    optional string s3Signature = 14;
    optional string s3BucketName = 15;
    optional string stcAuthorization = 16;
    optional string stcContentSha256 = 17;
    optional string stcDate = 18;
    optional string stcBucketName = 19;

    // 兼容 minio 协议
    optional string minioAuthorization = 20;
    optional string minioContentSha256 = 21;
    optional string minioDate = 22;
    optional string minioBucketName = 23;

    optional string downloadAuthInfo = 24;    // 下载鉴权信息，格式为 Json 格式
  }
  message `).concat(xr,` {
    required string downloadUrl = 1;
  }
  message `).concat(Fr,` {
    required string downloadUrl = 1;
  }
  message Add2BlackListInput {
    required string userId = 1;
  }
  message RemoveFromBlackListInput {
    required string userId = 1;
  }
  message QueryBlackListInput {
    required int32 nothing = 1;
  }
  message QueryBlackListOutput {
    repeated string userIds = 1;
  }
  message BlackListStatusInput {
    required string userId = 1;
  }
  message BlockPushInput {
    required string blockeeId = 1;
  }
  message ModifyPermissionInput {
    required int32 openStatus = 1;
  }
  message GroupInput {
    repeated GroupInfo groupInfo = 1;
  }
  message GroupOutput {
    required int32 nothing = 1;
  }
  message GroupInfo {
    required string id = 1;
    required string name = 2;
  }
  message GroupHashInput {
    required string userId = 1;
    required string groupHashCode = 2;
  }
  message GroupHashOutput {
    required GroupHashType result = 1;
  }
  enum GroupHashType {
    group_success = 0x00;
    group_failure = 0x01;
  }
  message `).concat(Pr,` {
    required int32 nothing = 1;
  }
  message `).concat(Ne,` {
    required int32 nothing = 1;
    optional string sessionId = 2;
    optional int64 joinTime = 3;
  }
  message `).concat(Nr,` {
    required int64 syncTime = 1;
    required int32 count = 2;
  }

  message ChrmPullMsgNew
  {
    required int32 count = 1;
    required int64 syncTime = 2;
    optional string chrmId=3;
  }
  message `).concat(sn,`
  {
    optional ChannelType type = 1;
    optional int32 count = 2;
    optional int64 startTime = 3;
    optional int32 order = 4;
  }
  message `).concat(Ar,`
  {
    required ChannelType type = 1;
    optional DownStreamMessage msg =2;
    optional int32 count = 3;
    repeated string busChannel = 4;
    optional int64 startTime = 5;
    optional int64 endTime = 6;
  }
  message `).concat(se,`
  {
    repeated RelationInfo info = 1;
    optional bool isFinished = 2;//是否结束
  }
  message RelationInfo
  {
    required ChannelType type = 1;
    required string userId = 2;
    optional DownStreamMessage msg =3;
    optional int64 readMsgTime= 4;
    optional int64 unreadCount= 5;
    optional string busChannel = 6;//该消息所属会话的业务标识
    optional int64 versionTime = 7;//会话项变更时间戳，注意:非排序时间戳
    optional int64 remindCount = 8;//被@的未读数
    optional int32 busChannelType = 9; // 0: 公有频道; 1: 私有频道;
    optional `).concat(Qe,` msgInfo = 10; // 新增 首条未读消息信息，可为空
    optional int32 remindMeCount = 11; //@ 我的未读数
  }
  message `).concat(Qe,` //未读消息摘要信息
  {
    required string msgId = 1;  //消息唯一标示
    required int64 msgTime= 2;//消息时间
    optional int32 remindType= 3;//@类型。查询会话时无此字段。查询未读@列表时返回
    optional string className = 4; //消息类型
  }
  message `).concat(Zr,` // 新增 查询未读@列表入参
  {
    required string groupId =  1; // 群 ID
    optional string busChannel = 2; // 频道(channelId,可以为空)
    optional int64 msgTime = 3; // 消息时间戳
    optional int32 size = 4; // 单页长度，默认20，最大20
  }
  message `).concat(zr,` //查询未读@列表出参
  {
    repeated `).concat(Qe,` msgInfo = 1;  //未读@消息摘要列表
  }
  message RelationInfoReadTime
  {
    required ChannelType type = 1;
    required int64 readMsgTime= 2;
    required string targetId = 3;
  }
  message `).concat(br,`
  {
      required string targetId = 1;
      required int64 dataTime = 2;
      optional int32 conversationType= 3;
      optional string busChannel = 4; //该消息所属会话的业务标识，限制20字符以内
  }
  message HistoryMessageInput
  {
    required string targetId = 1;
    required int64 dataTime =2;
    required int32 size  = 3;
  }

  message HistoryMessagesOuput
  {
    repeated DownStreamMessage list = 1;
    required int64 syncTime = 2;
    required int32 hasMsg = 3;
  }
  message `).concat(Dr,`
  {
    required int32 count= 1;
    optional int32 order= 2;
  }

  message `).concat(Tn,`
  {
    optional int32 userTotalNums = 1;
    repeated ChrmMember userInfos = 2;
  }
  message ChrmMember
  {
    required int64 time = 1;
    required string id = 2;
  }
  message MPFollowInput
  {
    required string id = 1;
  }

  message MPFollowOutput
  {
    required int32 nothing = 1;
    optional MpInfo info =2;
  }

  message MCFollowOutput
  {
    required int32 nothing = 1;
    optional MpInfo info =2;
  }

  message MpInfo
  {
    required string mpid=1;
    required string name = 2;
    required string type = 3;
    required int64 time=4;
    optional string portraitUrl=5;
    optional string extra =6;
  }

  message SearchMpInput
  {
    required int32 type=1;
    required string id=2;
  }

  message SearchMpOutput
  {
    required int32 nothing=1;
    repeated MpInfo info = 2;
  }

  message PullMpInput
  {
    required int64 time=1;
    required string mpid=2;
  }

  message PullMpOutput
  {
    required int32 status=1;
    repeated MpInfo info = 2;
  }
  message `).concat(Mr,`
  {
    optional string targetId = 1;
    optional int64 time = 2;
    optional int32 count  = 3;
    optional int32 order = 4;
    optional string busChannel = 5; //该消息所属会话的业务标识，限制20字符以内
  }

  message `).concat(oe,`
  {
    repeated DownStreamMessage list=1;
    required int64 syncTime=2;
    required int32 hasMsg=3;
  }
  message `).concat(Sr,`{
    required int32 nothing = 1;
  }
  message `).concat(Oo,`{
    required int64 inboxTime = 1;
    required int64 sendboxTime = 2;
    required int64 totalUnreadCount = 3;
  }
  message `).concat(vn,`
  {
    required ChannelType type = 1;
    required int64 msgTime = 2;
    required string channelId = 3;
    optional string busChannel = 4;//该消息所属会话的业务标识
  }
  message SessionMsgReadOutput
  {
    optional int32 nothing=1;
  }
  message `).concat(Lr,`
  {
    repeated SessionInfo sessions = 1;
  }
  message `).concat(Ur,`
  {
    required ChannelType type = 1;
    required string channelId = 2;
    optional string busChannel = 3;//所属会话业务标识
  }
  message `).concat(No,`
  {
    optional int32 nothing=1;
  }
  message `).concat(wr,`
  {
    optional ChannelType type = 1;
    optional string conversationId = 2;
    repeated DeleteMsg msgs = 3;
    optional string busChannel = 4; //该消息所属会话的业务标识，限制20字符以内
  }
  message DeleteMsg
  {
    optional string msgId = 1;
    optional int64 msgDataTime = 2;
    optional int32 direct = 3;
  }
  message ChrmKVEntity {
    required string key = 1;
    required string value = 2;
    optional int32 status = 3;
    optional int64 timestamp = 4;
    optional string uid = 5;
    optional int64 version = 6;
  }
  message `).concat(Hr,` {
    required ChrmKVEntity entry = 1;
    optional bool bNotify = 2;
    optional UpStreamMessage notification = 3;
    optional ChannelType type = 4;
  }
  message `).concat(Kr,` {
    repeated ChrmKVEntity entry = 1;
    optional bool bNotify = 2;
    optional UpStreamMessage notification = 3;
    optional ChannelType type = 4;
  }
  message `).concat(Mo,` {
    repeated ChrmKVEntity entry = 1;
    optional bool bNotify = 2;
    optional UpStreamMessage notification = 3;
    optional ChannelType type = 4;
  }
  message `).concat(ae,` {
    repeated ChrmKVEntity entries = 1;
    optional bool bFullUpdate = 2;
    optional int64 syncTime = 3;
  }
  message ChrmKVSVersionEntity {
    optional int64 version = 1;
    optional string key = 2;
  }

  message `).concat(qr,` {
    repeated ChrmKVSOutputEntity errorKeys = 1;
    repeated ChrmKVSVersionEntity keysVersion = 2;
  }
  message `).concat(Lo,`
  {
    optional string key = 1;
    optional int32 errorCode = 2;
  }
  message `).concat(Yr,` {
    required int64 timestamp = 1;
  }
  message `).concat(Uo,` {
    required int64 version=1;
    required string value=2;
  }
  message `).concat(ue,` {
    required int64 version=1;
    required bool reserve=2;
  }
  message `).concat(jr,` {
    required int64 version=1;
    optional bool reserve=2;
  }
  message `).concat(mn,` {
    repeated UserSettingItem items = 1;
    required int64 version=2;
  }
  message UserSettingItem {
    required string targetId= 1;
    required ChannelType type = 2;
    required string key = 4;
    required bytes value = 5;
    required int64 version=6;
    required int32 status=7;
    repeated SessionTagItem tags= 8;
  }
  message `).concat(Qr,` {
    required int64 time = 1;
  }
  message `).concat(In,` {
    required int64 version=1;
    repeated SessionState state= 2;
  }
  message `).concat(an,` {
    required ChannelType type = 1;
    required string channelId = 2;
    optional int64 time = 3;
    repeated SessionStateItem stateItem = 4;
    optional string busChannel = 5;//该消息所属会话的业务标识
  }
  message `).concat(un,` {
    required SessionStateType sessionStateType = 1;
    required string value = 2;
    repeated SessionTagItem tags = 3;
  }
  enum SessionStateType {
    IsSilent = 1;
    IsTop = 2;
    Tags = 3;
  }
  message `).concat(cn,` {
    required int64 version=1;
    repeated SessionState state= 2;
  }
  message `).concat(Jr,` {
    optional string busChannel = 1;
  }
  message `).concat(Xr,`{
    optional string busChannel = 1;
    required int32 unpushLevel = 2;
  }
  message `).concat($r,` {
    required string groupId = 1;
    optional string busChannel = 2;
    required int32 unpushLevel = 3;
  }
  message `).concat(Wr,` {
    required int64 version=1;
  }
  message `).concat(ln,` {
    repeated string msgId=1; //已读消息ID
    optional string channelId = 2; // 该消息所属会话的业务标识
  }
  message `).concat(Ao,` {
    repeated string msgId=1; //已读消息ID
    optional string channelId = 2; // 该消息所属会话的业务标识
  }
  message `).concat(Cn,` {
    required int32 totalMemberNum = 1;//群内总人数
    repeated GrpMsgReadUser list = 2;//已读用户列表（list复类型）
  }
  message `).concat(wo,` {
    required int64 readTime = 1;//已读时间
    required string userId = 2;//已读用户id
  }
  message `).concat(ti,` {
    required int64 version=1;
    repeated SessionTagItem tags=2;
  }
  message `).concat(ve,` {
    required string tagId=1;
    optional string name=2;
    optional int64 createdTime=3;
    optional bool isTop=4;
  }
  message `).concat(ei,` {
    required int64 version=1;
    repeated SessionTagItem tags=2;
  }
  message `).concat(ni,` {
    repeated string tagId=1;
  }
  message `).concat(yn,` {
    required int64 version=1;
    required bool reserve=2;
  }
  message `).concat(ri,` {
    required string sdkInfo=1; // 用户集成的 sdk 信息,json 格式 {"web-rtc": "4.0.3.7"}
  }
  message `).concat(bo,`
  {
    optional int32 nothing=1; //占位
  }
  message `).concat(ii,`
  {
      required int64 syncTime = 1;//同步时间戳
      optional bool isEraseMsgContent = 2;//拉取会话时，是否屏蔽掉消息内容
  }
  message `).concat(oi,`
  {
    required int64 syncTime = 1;//同步时间戳
  }
  message  `).concat(hn,`
  {
    required string fromUserId = 1;//（谁发的）
    required string targetId = 2;// 目标Id(超级群Id)
    required ChannelType type = 3;//发送类型如：（P2P,GROUP,ULTRAGROUP）
    required string msgUID = 4; // 扩展消息的内容体
    required int64 msgTime = 5; //原始消息时间
    optional string busChannel = 6; // 该消息所属会话的业务标识，限制20字符以内
    optional string content = 7; // 即extraContent消息扩展内容,下表格说明
  }
  message `).concat(si,`  //查询入参
  {
    required int64 syncTime = 1;//同步时间戳
  }
  message `).concat(Rn,`  //应答结果
  {
    repeated MsgChange list = 1; //变更
    required int64 syncTime = 2; //同步时间(用于下次同步入参)
    optional bool  hasNext = 3 ;
  }
  message `).concat(Po,`  //变更详情
  {
    required string targetId = 1; //  目标Id(超级群Id)
    required ChannelType type = 2; //  会话类型
    required int64 time = 3;  // 变更时间
    required int32 changeType = 4;  // 消息变更类型(1:扩展,2:修改,3:撤回,4:频道变更,5:用户组变更)
    required string msgUID  = 5;  // 消息ID
    required int64 msgTime = 6;  //  消息时间
    optional string busChannel = 7; // 频道ID
    optional bool isAdmin = 8; //是否为管理员，默认为 0, 设为 1 时, IMKit 收到此条消息后，小灰条默认显示为“管理员 撤回了一条消息”。
    optional bool isDel = 9; //默认为 0 撤回该条消息同时，用户端将该条消息删除并替换为一条小灰条撤回提示消息；为 1 时，该条消息删除后，不替换为小灰条提示消息。
    optional string operatorId = 10; // 消息变更的操作人 Id; subChangeType 为 5 时，operatorId 表示被踢出超级群私有频道白名单的用户
    // subChangeType 的意义由 changeType 的值来决定
    // 当 changeType 为 4 时;
    //  1: 删除频道;
    //  2: 公有频道变为私有频道;
    //  3: 私有频道变为公有频道;
    //  4: 私有频道成员变更-加入, SDK 不通知业务层;
    //  5: 私有频道成员变更-退出;
    //  6: 公有频道变为私有频道，当前用户不在白名单中;
    // 当 changeType 为 5 时;
    //  1: 删除用户组 (通知到 用户组下所有用户)
    //  2: 用户组增加用户 (仅通知到该用户)
    //  3: 用户组删除用户 (仅通知到该用户)
    //  4: 频道绑定用户组 (通知到 用户组下所有用户)
    //  5: 频道解绑用户组 (通知到 用户组下所有用户)
    optional int32 subChangeType = 11;
    optional int32 busChannelType = 12; // 0:公有频道; 1:私有频道
    optional bool isRemindMe = 13;// 是否为@我的消息, 消息撤回时, 该字段有意义, 用于客户端计算是否未读数总数-1,未读@消息数-1  -- server 暂未支持
    repeated string userGroupIds = 14; //用户组id列表,用于用户组增删成员或频道绑定解绑用户组的通知中
    optional int32 remindType = 15; // @类型：0非@我消息，1@所有人消息，2@我单人的消息
  }
  message `).concat(ai,`  //请求
  {
    required string targetId = 1; //  目标Id(超级群Id)
    required ChannelType type = 2; //  会话类型
    repeated MessageQueryInfo query = 3; //
  }
  message MessageQueryInfo
  {
    required int64 msgTime = 1;  // 消息时间
    required string msgUID  = 2;  // 消息ID
    optional string busChannel = 3; // 频道ID
  }
  message `).concat(Me,`  //应答
  {
    repeated DownStreamMessage list = 1;//消息
  }
  message `).concat(ui,`  //客户端发送
  {
    optional string targetId =  1;// targetId
    optional ChannelType type = 2;//发送会话类型如：（P2P,GROUP） 
    optional int32 opType = 3;  //0 , 正在输入, 1 正在XXX  
    optional string busChannel = 4; // 频道(channelId,可以为空)
  }
  message `).concat(Sn,`  //服务端发送
  {
      optional ChannelType type = 1;//发送会话类型如（P2P,GROUP） 
      optional int64 notifyType = 2; //0x1 表示明细, 0x2 表示汇总 0x3 表示明细+汇总
      repeated OperateInfo info = 3 ; //明细列表 当notifyType 为 1和3时,有效
      repeated OperateSummary summary = 4 ; //汇总列表, 当notifyType 为2和3 时,有效
  }
  message `).concat(Do,` {
    // XX 正在做什么
    optional string targetId = 1; // 超级群Id  会话id
    optional string busChannel = 2; // 频道(channelId,可以为空)
    optional string userId = 3; // userId
    optional int32 opType = 4;  //0 , 正在输入, 1 正在XX 
    optional int64 optime = 5;  //服务端收到用户操作的上行时间. 
  }
      
  message `).concat(Vo,` {
    // 几个人 正在干什么
    optional string targetId = 1; // 超级群Id  会话id
    optional string busChannel = 2; // 频道(channelId,可以为空)
    optional int32 count  = 3; // 操作人数
    optional int32 opType = 4; //0, 正在输入, 1 正在XX 
  }

  message `).concat(ci,`
  {
    required string  rtcRoomId= 1;  //rtc房间ID;
  }
  message `).concat(Go,`
  {
    required int32 nothing = 1;   //用于占位
  }
  message `).concat(li,`
  {
    required string key= 1;  //业务方法关健字(如：ringCall)
    required string dataContent=2;  //业务数据json字符串
  }
  message `).concat(hi,`
  {
    required string key= 1;  //业务方法关健字(如：ringCall)
    required string dataContent=2;  //业务数据json字符串
    required int64 maxTime=3;//时间戳,这个下行直发的时候带上
  }
  message `).concat(ko,`
  {
    required int64 syncTime = 1; //同步时间戳
  }
  message `).concat(di,`
  {
    required int64 maxTime = 1; //最大时间戳
    repeated KvInfo info = 2; //kv对象
  }
  
  message KvInfo{
    required string key =1; //健名
    required string value =2; //健值
  }
}
`),We=function(t,n,e,r,i,o){var s=i?Object.keys(i).map(function(l){return t.encode(F.RtcValueInfo,{key:l,value:i[l]},!0)}):void 0,h=o?Object.keys(o).map(function(l){return t.encode(F.RtcValueInfo,{key:l,value:o[l]},!0)}):void 0;return t.encode(F.RtcInput,{roomType:n,broadcastType:e,joinType:r,innerDatas:s,outerDatas:h})},xe=function(t,n){var e=t.decode(F.RtcUserListOutput,n),r=e.users,i=e.token,o=e.sessionId,s=e.roomInfo,h=e.entries,l=e.offlineKickTime,c={};return mt(r,function(d){var _=d.userId,v=d.userData,I={};mt(v,function(T){var a=T.key,u=T.value;I[a]=u}),c[_]=I}),{users:c,token:i,sessionId:o,roomInfo:s,kvEntries:h,offlineKickTime:l}};(function(t){t[t.ACCEPTED=0]="ACCEPTED",t[t.UNACCEPTABLE_PROTOCOL_VERSION=1]="UNACCEPTABLE_PROTOCOL_VERSION",t[t.IDENTIFIER_REJECTED=2]="IDENTIFIER_REJECTED",t[t.SERVER_UNAVAILABLE=3]="SERVER_UNAVAILABLE",t[t.TOKEN_INCORRECT=4]="TOKEN_INCORRECT",t[t.NOT_AUTHORIZED=5]="NOT_AUTHORIZED",t[t.REDIRECT=6]="REDIRECT",t[t.PACKAGE_ERROR=7]="PACKAGE_ERROR",t[t.APP_BLOCK_OR_DELETE=8]="APP_BLOCK_OR_DELETE",t[t.BLOCK=9]="BLOCK",t[t.TOKEN_EXPIRE=10]="TOKEN_EXPIRE",t[t.DEVICE_ERROR=11]="DEVICE_ERROR",t[t.HOSTNAME_ERROR=12]="HOSTNAME_ERROR",t[t.HASOHTERSAMECLIENTONLINE=13]="HASOHTERSAMECLIENTONLINE",t[t.OUT_OF_LIMIT=14]="OUT_OF_LIMIT",t[t.IN_OTHER_CLUSTER=15]="IN_OTHER_CLUSTER",t[t.APP_AUTH_NOT_PASS=16]="APP_AUTH_NOT_PASS",t[t.OTP_USED=17]="OTP_USED",t[t.PLATFORM_ERROR=18]="PLATFORM_ERROR",t[t.ACCOUNT_CANCELLATION=19]="ACCOUNT_CANCELLATION",t[t.LICENSE_EXPIRED=20]="LICENSE_EXPIRED"})(lt||(lt={})),function(t){t[t.OTHER_DEVICE_LOGIN=1]="OTHER_DEVICE_LOGIN",t[t.BLOCK=2]="BLOCK",t[t.BLOCK_NEW=5]="BLOCK_NEW",t[t.REDIRECT_NEW=6]="REDIRECT_NEW",t[t.TOKEN_EXPIRED=7]="TOKEN_EXPIRED",t[t.ILLEGAL_PROTOCOL_VERSION=8]="ILLEGAL_PROTOCOL_VERSION",t[t.ACCOUNT_CANCELLATION=9]="ACCOUNT_CANCELLATION"}(At||(At={}));var it,$a=((Dt={})[At.OTHER_DEVICE_LOGIN]=R.RC_DISCONN_KICK,Dt[At.BLOCK]=R.RC_DISCONN_EXCEPTION,Dt[At.BLOCK_NEW]=R.RC_DISCONN_EXCEPTION,Dt[At.REDIRECT_NEW]=R.RC_CONN_REDIRECTED,Dt[At.TOKEN_EXPIRED]=R.RC_CONN_TOKEN_EXPIRED,Dt[At.ILLEGAL_PROTOCOL_VERSION]=R.RC_CONN_PROTO_VERSION_ERROR,Dt[At.ACCOUNT_CANCELLATION]=R.RC_ACCOUNT_CANCELLATION,Dt),tu=((pt={})[lt.ACCEPTED]=R.SUCCESS,pt[lt.UNACCEPTABLE_PROTOCOL_VERSION]=R.RC_CONN_PROTO_VERSION_ERROR,pt[lt.IDENTIFIER_REJECTED]=R.RC_CONN_IDENTIFIER_REJECTED,pt[lt.SERVER_UNAVAILABLE]=R.RC_CONN_SERVER_UNAVAILABLE,pt[lt.TOKEN_INCORRECT]=R.RC_CONN_TOKEN_INCORRECT,pt[lt.NOT_AUTHORIZED]=R.RC_CONN_NOT_AUTHRORIZED,pt[lt.REDIRECT]=R.RC_CONN_REDIRECTED,pt[lt.PACKAGE_ERROR]=R.RC_CONN_PACKAGE_NAME_INVALID,pt[lt.APP_BLOCK_OR_DELETE]=R.RC_CONN_APP_BLOCKED_OR_DELETED,pt[lt.BLOCK]=R.RC_CONN_USER_BLOCKED,pt[lt.TOKEN_EXPIRE]=R.RC_CONN_TOKEN_EXPIRED,pt[lt.DEVICE_ERROR]=R.RC_CONN_DEVICE_ERROR,pt[lt.HOSTNAME_ERROR]=R.RC_CONN_HOSTNAME_ERROR,pt[lt.HASOHTERSAMECLIENTONLINE]=R.RC_DISCONN_SAME_CLIENT_ON_LINE,pt[lt.OUT_OF_LIMIT]=R.RC_LISCENSE_COUNT_OUT_OF_LIMIT,pt[lt.IN_OTHER_CLUSTER]=R.RC_CONN_WRONG_CLUSTER,pt[lt.APP_AUTH_NOT_PASS]=R.RC_APP_AUTH_NOT_PASS,pt[lt.OTP_USED]=R.RC_OTP_USED,pt[lt.PLATFORM_ERROR]=R.RC_PLATFORM_ERROR,pt[lt.ACCOUNT_CANCELLATION]=R.RC_ACCOUNT_CANCELLATION,pt[lt.LICENSE_EXPIRED]=R.RC_LICENSE_EXPIRED,pt),xn=function(t){return t===R.RC_CONN_REDIRECTED};(function(t){t[t.CONNECTED=0]="CONNECTED",t[t.CONNECTING=1]="CONNECTING",t[t.DISCONNECTED=2]="DISCONNECTED",t[t.SUSPENDED=3]="SUSPENDED"})(it||(it={}));var dn,eu=function(){function t(n,e,r,i,o){this.appkey=n,this.navi=e,this.logger=r,this.statisticLog=i,this.listener=o,this.token="",this.curCmpUrl="",this.reconnectKick=!1,this._connectDurSwitch=!1,this.retryCount=0,this.uuid="",this.reason=0,this.connectedTime=0,this._network={status:!0,type:ar.UNKONWN},this._checkAliveTimer=null,this._crtConnectionStatus=it.DISCONNECTED,this._crtUserId="",this._openCallPlus=!1,this._crtConnectionTask=null,this.reconnectTimer=null,this._failedCount=0,this.ALLOW_FAILED_TIMES=2}return t.prototype.getToken=function(){return this.token},t.prototype.getCurrentUserId=function(){return this._crtUserId},t.prototype.setConnectionStatus=function(n,e){if(this._crtConnectionStatus!==n){if(this._crtConnectionStatus=n,this._connectDurSwitch&&n!==it.CONNECTED&&n!==it.CONNECTING){var r={bid:rn(),cod:e,net:this.getNetwork().type,dur:Date.now()-this.connectedTime,cid:"".concat(this.uuid,"_").concat(this.retryCount)};this.statisticLog.__statistics(wt.IM_CONNECTION_DURATION,JSON.stringify(r)),this._connectDurSwitch=!1}switch(n){case it.CONNECTED:this.logger.info(P.L_CONNECT_S,n),this.checkAlive(),this.listener.onConnected();break;case it.CONNECTING:this.logger.warn(P.L_CONNECT_S,"status: ".concat(n,", code: ").concat(e)),this.listener.onConnecting();break;case it.SUSPENDED:this.logger.warn(P.L_CONNECT_S,"status: ".concat(n,", code: ").concat(e)),xn(e)&&this.clearCmpWeightCache(),this._checkAliveTimer&&clearTimeout(this._checkAliveTimer),this.listener.onSuspend(e);break;default:this.logger.warn(P.L_CONNECT_S,"status: ".concat(n,", code: ").concat(e)),this.clearCmpWeightCache(),this._checkAliveTimer&&clearTimeout(this._checkAliveTimer),this.listener.onDisconnected(e)}}},t.prototype.getConnectionStatus=function(){return this._crtConnectionStatus},t.prototype.setNetwork=function(n,e){if(!e){var r={cid:"".concat(this.uuid,"_").concat(this.retryCount),cn:n.type,on:this._network.type};this.statisticLog.__statistics(wt.IM_NETWORK_CHANGE,JSON.stringify(r))}this._network=n},t.prototype.getNetwork=function(){return this._network},t.prototype.connect=function(n,e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l;return M(this,function(c){switch(c.label){case 0:return this._crtConnectionStatus===it.CONNECTED?[2,{code:R.SUCCESS,data:this._crtUserId}]:this._crtConnectionTask?[2,this._crtConnectionTask]:(this._openCallPlus=r,this.retryCount=0,this.uuid=Tr(),this.token=n,this.reconnectKick=e,this.setConnectionStatus(it.CONNECTING),o={cid:"".concat(this.uuid,"_").concat(this.retryCount),reason:ee.CONNECT,net:this.getNetwork().type,spr:1},this.statisticLog.__statistics(wt.IM_STATS_CS,JSON.stringify(o),i),[4,this.try2Connect(n,e,!1,i)]);case 1:return s=c.sent(),h=s.code,l=s.data,h!==R.SUCCESS?(this.setConnectionStatus(it.DISCONNECTED,h),[2,{code:h}]):(this.setConnectionStatus(it.CONNECTED),[2,{code:h,data:l}])}})})},t.prototype.try2Connect=function(n,e,r,i){return L(this,void 0,void 0,function(){var o,s,h;return M(this,function(l){switch(l.label){case 0:return this._crtConnectionTask?[2,this._crtConnectionTask]:(this._crtConnectionTask=this.createConnectionTask(n,e,r,i),[4,this._crtConnectionTask]);case 1:return o=l.sent(),s=o.code,h=o.data,this._crtConnectionTask=null,[2,{code:s,data:h}]}})})},t.prototype.createConnectionTask=function(n,e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c,d,_,v,I=this;return M(this,function(T){switch(T.label){case 0:return o={retryCount:this.retryCount,uuid:this.uuid,type:this.getNetwork().type,reason:this.reason},[4,this.navi.request(n,r,!1,i,o)];case 1:return s=T.sent(),h=s.code,l=s.data,h!==R.SUCCESS?[2,{code:h}]:(c=l,this.logger.info(P.L_CONNECT_T,JSON.stringify({token:n,reconnectKickEnable:e}),i),[4,this.connectWithToken(n.replace(/@.+$/,"@"),c,e,i)]);case 2:return d=T.sent(),_=d.code,v=d.data,xn(_)?(this.logger.warn(P.L_CONNECT_R,"redirect code: ".concat(_),i),this.clearCmpWeightCache(),[2,this.createConnectionTask(n,e,!0,i)]):[R.RC_TCP_RESET,R.RC_CONN_ACK_TIMEOUT,R.RC_TCP_DISCONNECTED_NO_RMTP].includes(_)&&this.cmpWeightCache&&this.cmpWeightCache.length>0?(this.updateCmpWeight(this.curCmpUrl,!1),this.logger.warn(P.L_CONNECT_R,"cmp ack timeout, code: ".concat(_),i),this.setConnectionStatus(it.SUSPENDED,_),this.setConnectionStatus(it.CONNECTING),this.cmpWeightCache.length===1?[2,new Promise(function(a){setTimeout(function(){a(I.createConnectionTask(n,e,!1,i))},5e3)})]:[2,this.createConnectionTask(n,e,!1,i)]):_!==R.SUCCESS?(this.logger.warn(P.L_CONNECT_R,"code: ".concat(_),i),[2,{code:_}]):(this.logger.info(P.L_CONNECT_R,"userId: ".concat(v),i),this._connectDurSwitch=!0,this._crtUserId=v,[2,{code:_,data:v}])}})})},t.prototype.setReconnectReason=function(n){switch(n){case R.TIMEOUT:return void(this.reason=ee.TIMEOUT);case R.RC_CONN_REDIRECTED:return void(this.reason=ee.REDIRECTED);default:this.reason=ee.RECONNECT}},t.prototype.try2Reconnect=function(n,e){return L(this,void 0,void 0,function(){var r,i,o=this;return M(this,function(s){return r=this.logger.createTraceId(),this.logger.debug(P.T,"try2Reconnect -> ignoreNaviCache: ".concat(n,", reason: ").concat(e),r),this.stopReconnectTimer(),i=function(){return L(o,void 0,void 0,function(){var h,l;return M(this,function(c){switch(c.label){case 0:return this._crtConnectionStatus!==it.SUSPENDED?[2]:(this.setConnectionStatus(it.CONNECTING,e),this.setReconnectReason(e),this.retryCount+=1,h={cid:"".concat(this.uuid,"_").concat(this.retryCount),reason:this.reason,net:this.getNetwork().type,spr:1},this.statisticLog.__statistics(wt.IM_STATS_CS,JSON.stringify(h)),[4,this.try2Connect(this.token,!0,n,r)]);case 1:return l=c.sent().code,this.reconnectTimer=null,l===R.SUCCESS?(this.setConnectionStatus(it.CONNECTED),[2]):[R.SERVER_UNAVAILABLE,R.TIMEOUT,R.RC_SOCKET_DISCONNECTED,R.RC_SOCKET_NOT_CREATED,R.RC_CONN_ACK_TIMEOUT,R.RC_TCP_RESET,R.RC_NAVI_REQ_FAILED,R.RC_NETWORK_DOWN].includes(l)?(this._crtConnectionStatus!==it.CONNECTING||(this.setConnectionStatus(it.SUSPENDED,l),this.reconnectTimer=setTimeout(i,5e3)),[2]):(this.setConnectionStatus(it.DISCONNECTED,l),[2])}})})},i(),[2]})})},t.prototype.onDisconnectByServer=function(n,e){var r=this;return xn(n)?(this.setConnectionStatus(it.SUSPENDED,n),void this.try2Reconnect(!0,n)):n===R.RC_UDP_DISCONNECTED?(this.setConnectionStatus(it.SUSPENDED,n),void setTimeout(function(){r.try2Reconnect(!0,n)},1e3*(e||0))):void this.setConnectionStatus(it.DISCONNECTED,n)},t.prototype.onDisconenctUnusual=function(n){this.setConnectionStatus(it.SUSPENDED,n),this.try2Reconnect(!1,n)},t.prototype.checkAlive=function(){return L(this,void 0,void 0,function(){var n,e,r=this;return M(this,function(i){switch(i.label){case 0:return this._crtConnectionStatus!==it.CONNECTED?(this._failedCount=0,this.logger.debug(P.L_CHECK_ALIVE_IM_S,"stop ping because of no connection"),[2]):(n=this.logger.createTraceId(),this.logger.info(P.L_CHECK_ALIVE_IM_T,null,n),[4,this.sendPing(15e3)]);case 1:return(e=i.sent())===R.SUCCESS?(this.logger.info(P.L_CHECK_ALIVE_IM_R,e,n),this._failedCount=0,this._checkAliveTimer=setTimeout(function(){return r.checkAlive()},15e3),[2]):this._crtConnectionStatus!==it.CONNECTED?[2]:(this._failedCount+=1,this.logger.info(P.L_CHECK_ALIVE_IM_R,"code: ".concat(e,", count: ").concat(this._failedCount),n),this._failedCount<this.ALLOW_FAILED_TIMES?[2,this.checkAlive()]:(this._failedCount=0,this.logger.warn(P.L_CHECK_ALIVE_IM_S,"ping timeout, close connection to reconnect!"),this.close(!0,!1),this.setConnectionStatus(it.SUSPENDED,R.RC_PING_EXCEED_LIMIT),this.try2Reconnect(!1,R.RC_PING_EXCEED_LIMIT),[2]))}})})},t.prototype.disconnect=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return this.stopReconnectTimer(),this._crtConnectionTask?[4,this._crtConnectionTask]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.setConnectionStatus(it.DISCONNECTED,2),this.close(!1,n),[2]}})})},t.prototype.stopReconnectTimer=function(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)},t.prototype.getCmpList=function(n,e){if(this.cmpWeightCache&&this.cmpWeightCache.length>0)return vt([],this.cmpWeightCache,!0);var r=n.server,i=n.backupServer,o=n.serverAddr,s=n.protocol,h=n.openTLS;if(o)return this.cmpWeightCache=vt([],o,!0),vt([],o,!0);var l=[],c=[];return r&&c.push(r),i==null||i.split(",").forEach(function(d){c.indexOf(d)<0&&c.push(d)}),c.forEach(function(d,_){var v;v=e?h===1?ft.TLS:ft.RMTP:s==="http"?ft.WS:ft.WSS,l.push({addr:d,protocol:v,weight:r.length-_,race:!1})}),this.cmpWeightCache=l,vt([],l,!0)},t.prototype.updateCmpWeight=function(n,e,r){if(this.cmpWeightCache){var i=this.cmpWeightCache.find(function(h){return r?h.addr===n&&h.protocol===ft.QUIC:h.addr===n});if(i)if(e){var o=Math.max.apply(Math,this.cmpWeightCache.map(function(h){return h.weight}));i.weight!==o&&(i.weight=o+1)}else{var s=Math.min.apply(Math,this.cmpWeightCache.map(function(h){return h.weight}));i.weight!==s&&(i.weight=s-1)}}},t.prototype.clearCmpWeightCache=function(){this.cmpWeightCache=void 0},t}(),nu=function(){function t(n){this.logger=n,this._codec=t.createPBCodec()}return t.createPBCodec=function(){var n=so(za);return n.getModule=function(e){var r=new n[e];return r.getArrayData=function(){var i=r.toArrayBuffer();return i=wi(i)?[].slice.call(new Int8Array(i)):i},r},n},t.prototype.decodeByPBName=function(n,e,r){var i,o=this,s=n,h=((i={})[ie]=o._formatSyncMessages,i[En]=o._formatReceivedMessage,i[Oe]=o._formatSentMessage,i[oe]=o._formatHistoryMessages,i[se]=o._formatConversationList,i[Tn]=o._formatChatRoomInfos,i[ae]=o._formatChatRoomKVList,i[mn]=o._formatUserSetting,i[In]=o._formatConversationStatus,i[Cn]=o._formatGrpReadReceiptQryResp,i[ue]=o._formatSetUserSettingOutput,i[yn]=o._formatUserSettingNotification,i[Rn]=o._formatUltraMsgChangeList,i[Sn]=o._formatUltraOperateStatusNotifyList,i[Me]=o._formatUltraMsgList,i[zr]=o._formatUltraGroupUnreadMentionedList,i[Ne]=o._formatChrmKVVersion,i[di]=o._formatCallKVInfo,i[hi]=o._fromatCallInfoDownStream,i)[e];try{s=n.length>0&&o._codec[e].decode(n),It(s)&&(s=function(l){for(var c in l)It(l[c])&&(l[c]=ut(l[c]));return l}(s)),tn(h)&&(s=h.call(this,s,r))}catch{this.logger.error(P.L_PB_DECODE_E,e)}return s},t.prototype._readBytes=function(n){var e=n.offset,r=n.buffer,i=n.limit;if(e)try{var o=wi(r)?new Uint8Array(r):r;return Ue.readUTF(o.subarray(e,i))}catch(s){this.logger.error(P.O,s==null?void 0:s.stack)}return n},t.prototype._formatBytes=function(n){if(!n)return n;var e=this._readBytes(n);try{e=e&&JSON.parse(e)}catch(r){this.logger.error(P.O,r==null?void 0:r.stack)}return e||n},t.prototype._formatSyncMessages=function(n,e){e=e||{};var r=this,i=n.list,o=n.syncTime,s=n.finished;return(ot(s)||s===null)&&(n.finished=!0),n.syncTime=ut(o),n.list=Pe(i,function(h){return r._formatReceivedMessage(h,e)}),n},t.prototype._getUtfContent=function(n){if(n.user){var e=n.user,r=e.portrait,i=e.portraitUri,o=r||i;o&&(n.user.portrait=n.user.portraitUri=o)}return n},t.prototype._setExpansion=function(n){var e;return n&&(e=function(r){var i={},o=JSON.parse(r);return mt(o,function(s,h){i[h]=s.v}),i}(n)),e},t.prototype._setPushConfig=function(n,e){var r=n.pushContent,i=n.pushExt,o=n.configFlag,s={};return i&&(s=ds(e,i.pushConfigs,i.pushId)),Z(Z({},s),{pushTitle:i==null?void 0:i.title,pushContent:r,pushData:"",disablePushTitle:!!o&&!!(4&o),forceShowDetailContent:!!o&&!!(8&o),templateId:i==null?void 0:i.templateId})},t.prototype._formatReceivedMessage=function(n,e){if(!n)return n;var r=this,i=e||{},o=i.currentUserId,s=i.connectedTime,h=n.content,l=n.fromUserId,c=n.type,d=n.groupId,_=n.status,v=n.dataTime,I=n.extraContent,T=n.configFlag,a=n.extStatus,u=n.clientUniqueId,p=n.busChannel,f=n.msgId,E=n.classname,m=n.direction||Ot.RECEIVE,y=function(at){var Tt=Yn.READ;return{isPersited:!!(16&at),isCounted:!!(32&at),isMentioned:!!(64&at),disableNotification:!!(512&at),receivedStatus:Tt=2&at?Yn.RETRIEVED:Tt,canIncludeExpansion:!!(1024&at)}}(_),N=y.isPersited,A=y.isCounted,K=y.isMentioned,Y=y.disableNotification,G=y.receivedStatus,S=y.canIncludeExpansion,k=!!(2&(a||0)),j=!!(4&(a||0)),tt=8&(a||0)?kt.PRIVATE:kt.PUBLIC,C=[B.GROUP,B.CHATROOM,B.RTC_ROOM,B.ULTRA_GROUP].indexOf(c)>-1?d:l,O=l,U=Ot.RECEIVE;m===Ot.SEND&&(O=o,U=Ot.SEND);var w=ut(v),b=w<s,x=c===B.CHATROOM,H=r._setExpansion(I),Q=r._formatBytes(h);Q=r._getUtfContent(Q);var J=r._setPushConfig(n,this.logger);x&&l===o&&(U=Ot.SEND);var st={conversationType:c,targetId:C,senderUserId:O,messageType:E,messageUId:f,isPersited:N,isCounted:A,isMentioned:K,sentTime:w,messageDirection:U,receivedTime:ne.getTime(),disableNotification:Y,receivedStatus:G,canIncludeExpansion:S,content:Q,expansion:H,configFlag:T,pushConfig:J,channelId:p||"",isInterrupt:k,isModifyMessage:j,messageId:ut(u)||0,sentStatus:ce.SENT};return c!==B.ULTRA_GROUP?(st.isOffLineMessage=b,st):(st.channelType=tt,st)},t.prototype._formatSentMessage=function(n,e){var r=this,i=n.content,o=n.classname,s=n.sessionId,h=n.msgId,l=n.extraContent,c=n.pushExt,d=n.pushContent,_=n.configFlag,v=n.extStatus,I=n.clientUniqueId,T=n.systemId,a=e.signal,u=e.currentUserId,p=a.date,f=a.topic,E=a.targetId,m=!!(2&(v||0)),y=function(U){return{isPersited:!!(1&U),isCounted:!!(2&U),disableNotification:!!(32&U),canIncludeExpansion:!!(64&U)}}(s),N=y.isPersited,A=y.isCounted,K=y.disableNotification,Y=y.canIncludeExpansion,G=Ia[f]||B.PRIVATE,S=fs(aa,f),k=r._formatBytes(i),j=T||E;o===nt.RECALL&&(G=k.conversationType||G,j=k.targetId||E);var tt=r._setExpansion(l),C=r._setPushConfig(n,this.logger),O=Z(Z({},C),{pushTitle:c==null?void 0:c.title,pushContent:d,pushData:d,disablePushTitle:!!_&&!!(4&_),forceShowDetailContent:!!_&&!!(8&_),templateId:c==null?void 0:c.templateId});return{conversationType:G,targetId:j,messageType:o,messageUId:h,isPersited:N,isCounted:A,isStatusMessage:S,senderUserId:u,content:r._formatBytes(i),sentTime:1e3*p,receivedTime:ne.getTime(),messageDirection:Ot.SEND,isOffLineMessage:!1,disableNotification:K,canIncludeExpansion:Y,expansion:tt,pushConfig:O,channelId:n.busChannel||"",isInterrupt:m,messageId:ut(I)||0}},t.prototype._formatHistoryMessages=function(n,e){var r=this,i=e.conversation||{},o=n.list,s=n.hasMsg,h=i.targetId,l=ut(n.syncTime),c=[];return mt(o,function(d){var _=r._formatReceivedMessage(d,e);i.conversationType===B.ULTRA_GROUP?_.targetId=d.groupId||i.targetId:_.targetId=h,c.push(_)},{isReverse:!0}),{syncTime:l,list:c,hasMore:!!s}},t.prototype._formatUltraMsgChangeList=function(n){var e=n.list,r=n.syncTime,i=n.hasNext;return{syncTime:r,list:e&&e.map(function(o){var s=o.targetId,h=o.type,l=o.time,c=o.changeType,d=o.msgUID,_=o.msgTime,v=o.busChannel,I=o.isAdmin,T=o.isDel,a=o.operatorId,u=o.subChangeType,p=o.userGroupIds,f=o.busChannelType,E=o.remindType;return{targetId:s,conversationType:h,changeType:c,messageUId:d,changeTime:ut(l),sendTime:ut(_),channelId:v||"",isAdmin:I,isDel:T,operatorId:a,subChangeType:u,userGroupIds:p,busChannelType:f,mentionedType:E}}),hasNext:i}},t.prototype._formatUltraOperateStatusNotifyList=function(n){var e=n.type,r=n.notifyType,i=n.info,o=n.summary,s=[],h=[],l=(2&r)==2,c=(1&r)==1;return c&&Array.isArray(i)&&i.forEach(function(d){var _=d.targetId,v=d.busChannel,I=d.userId,T=d.opType,a=d.optime,u=ut(a);s.push({targetId:_,channelId:v,userId:I,operationType:T,operationTime:u})}),l&&Array.isArray(o)&&o.forEach(function(d){var _=d.targetId,v=d.busChannel,I=d.count,T=d.opType;h.push({targetId:_,channelId:v,count:I,operationType:T})}),{conversationType:e,info:s,summary:h,hasInfo:c,hasSummary:l}},t.prototype._formatUltraMsgList=function(n,e){var r=this,i=n.list;return{list:i&&i.map(function(o){return r._formatReceivedMessage(o,e)})}},t.prototype._formatUltraGroupUnreadMentionedList=function(n){var e=n.msgInfo;return(e===void 0?[]:e).map(function(r){return{messageUId:r.msgId,senTtime:ut(r.msgTime),mentionedType:r.remindType,messageType:r.className||""}})},t.prototype._getUltraGroupConversationInfo=function(n,e){var r=e.versionTime,i=e.unreadCount,o=e.remindCount,s=e.busChannelType,h=e.msgInfo,l=e.remindMeCount;return n.versionTime=ut(r)||0,n.unreadMessageCount=this._getUnreadCount(ut(i)||0),n.unreadMentionedCount=this._getUnreadCount(ut(o)||0),n.unreadMentionedMeCount=this._getUnreadCount(ut(l)||0),n.channelType=s||kt.PUBLIC,n.lastReadTime=0,h&&(n.firstUnreadMessage={sentTime:ut(h.msgTime)},n.lastReadTime=ut(h.msgTime)-1),n},t.prototype._getUnreadCount=function(n){return n>999?999:n},t.prototype._formatConversationList=function(n,e){var r=this,i=this,o=n.info,s=e.afterDecode,h={list:(o=Pe(o,function(l){var c=l.msg,d=l.userId,_=l.type,v=l.unreadCount,I=l.busChannel,T=null;c&&((T=i._formatReceivedMessage(c,e)).targetId=d);var a={targetId:d,conversationType:_,unreadMessageCount:ut(v)||0,latestMessage:T||{},channelId:I||""};return _===B.ULTRA_GROUP&&(a=r._getUltraGroupConversationInfo(a,l)),(s==null?void 0:s(a))||a}))||[]};return((e==null?void 0:e.conversationType)||B.NONE)===B.ULTRA_GROUP&&(h.isFinished=n.isFinished),h},t.prototype._formatSetUserSettingOutput=function(n){return n},t.prototype._formatChatRoomInfos=function(n){var e=n.userTotalNums,r=n.userInfos;return{userCount:e,userInfos:Pe(r,function(i){var o=i.id,s=i.time;return{id:o,time:ut(s)}})}},t.prototype._formatChatRoomKVList=function(n){var e=n.entries,r=n.bFullUpdate,i=n.syncTime;return e=Pe(e=e||[],function(o){var s=o.key,h=o.value,l=o.status,c=o.timestamp,d=o.uid,_=o.version,v=function(I){return{isAutoDelete:!!(1&I),isOverwrite:!!(2&I),type:4&I?Ct.DELETE:Ct.UPDATE}}(l);return{key:s,value:h,isAutoDelete:v.isAutoDelete,isOverwrite:v.isOverwrite,type:v.type,userId:d,timestamp:ut(c),version:ut(_)}}),{kvEntries:e,isFullUpdate:r,syncTime:i}},t.prototype._formatUserSetting=function(n){var e=this,r=n.items,i=n.version,o={};return mt(r||[],function(s){var h=s.key,l=s.version,c=s.value;s.version=ut(l),s.value=e._readBytes(c),h==="Tag"&&s.tags.forEach(function(d){d.createdTime=ut(d.createdTime),d.tagName=d.name}),o[h]=s}),{settings:o,version:i}},t.prototype._formatConversationStatus=function(n){var e=n.state,r=[];return mt(e,function(i){var o=i.type,s=i.channelId,h=i.time,l=i.stateItem,c=i.busChannel,d=Rt.CLOSE,_=Ht.NOT_SET,v=!1,I=[];mt(l,function(T){var a=T.sessionStateType,u=T.value,p=T.tags;switch(a){case Ge:d=u===Vn?Rt.OPEN:Rt.CLOSE,_=Number(u)||Ht.NOT_SET;break;case Ki:v=u===Vn;break;case qi:I=p}}),r.push({conversationType:o,type:o,targetId:s,notificationStatus:d,notificationLevel:_,isTop:v,updatedTime:ut(h),tags:I,channelId:c||""})}),r},t.prototype._formatGrpReadReceiptQryResp=function(n){var e=n.totalMemberNum,r=n.list;return r.forEach(function(i){i.readTime=ut(i.readTime)}),{totalMemberCount:e,list:r}},t.prototype._formatUserSettingNotification=function(n){return n},t.prototype._formatChrmKVVersion=function(n){return n},t.prototype._formatRTCJoinedUserInfo=function(n){return(n.info||[]).map(function(e){return{deviceId:e.deviceId,roomId:e.roomId,joinTime:ut(e.joinTime)}})},t.prototype._formatCallKVInfo=function(n){return n},t.prototype._fromatCallInfoDownStream=function(n){return n},t.prototype.encodeServerConfParams=function(){var n=this._codec.getModule(Sr);return n.setNothing(1),n.getArrayData()},t.prototype._updateMentionedInfo=function(n,e,r){var i,o,s;return{userIdList:((i=n.mentionedInfo)===null||i===void 0?void 0:i.userIdList)||e,type:((o=n.mentionedInfo)===null||o===void 0?void 0:o.type)||r||me.ALL,mentionedContent:((s=n.mentionedInfo)===null||s===void 0?void 0:s.mentionedContent)||""}},t.prototype._calculateFlag=function(n){var e=n.isFilerWhiteBlacklist,r=n.isVoipPush,i=n.pushConfig||{},o=0;return o|=r?1:0,o|=e?2:0,o|=i.disablePushTitle?4:0,o|=i.forceShowDetailContent?8:0},t.prototype._getPushExtraModule=function(n){var e=n.pushTitle,r=n.iOSConfig,i=n.androidConfig,o=n.templateId,s=o===void 0?"":o,h=this._codec.getModule(Rr);if(e&&h.setTitle(e),r||i){var l=hs(r,i);h.setPushConfigs(l)}return i!=null&&i.notificationId&&h.setPushId(i==null?void 0:i.notificationId),h.setTemplateId(s),h},t.prototype._getUpMsgModule=function(n,e){var r=e.messageType,i=e.isMentioned,o=e.mentionedType,s=e.content,h=e.directionalUserIdList,l=e.canIncludeExpansion,c=e.expansion,d=e.pushConfig,_=e.channelId,v=e.pushData,I=v===void 0?"":v,T=e.mentionedUserIdList,a=T===void 0?[]:T,u=e.pushContent,p=u===void 0?"":u,f=e.messageId,E=f===void 0?0:f,m=n.conversationType,y=n.targetId,N=this._codec.getModule(Oe),A=function(O){var U=O.isStatusMessage,w=O.isPersited,b=O.isCounted;U&&(w=b=!1);var x=0;return w&&(x|=1),b&&(x|=2),O.isMentioned&&(x|=4),O.disableNotification&&(x|=32),O.canIncludeExpansion&&(x|=64),x}(e),K=d||{},Y=K.pushContent,G=Y===void 0?p:Y,S=K.pushData,k=S===void 0?I:S;N.setSessionId(A),i&&s&&(s.mentionedInfo=this._updateMentionedInfo(s,a,o)),G&&N.setPushText(G),k&&N.setAppData(k),h&&N.setUserId(h);var j=this._calculateFlag(e);if(N.setConfigFlag(j),N.setClassname(r),s.user&&s.user.portraitUri&&(s.user.portrait=s.user.portraitUri),N.setContent(JSON.stringify(s)),l&&c){var tt={};mt(c,function(O,U){tt[U]={v:O}}),N.setExtraContent(JSON.stringify(tt))}if(d){var C=this._getPushExtraModule(d);N.setPushExt(C)}return N.setClientUniqueId(E),ot(_)||N.setBusChannel(_),m===B.SYSTEM&&N.setSystemId(y),N},t.prototype.encodeUpMsg=function(n,e){return this._getUpMsgModule(n,e).getArrayData()},t.prototype.encodeSyncMsg=function(n){var e=n.sendboxTime,r=n.inboxTime,i=n.broadcastSyncTime,o=this._codec.getModule(Or);return o.setIspolling(!1),o.setIsPullSend(!0),o.setSendBoxSyncTime(e),o.setSyncTime(r),o.setBroadcastSyncTime(i),o.getArrayData()},t.prototype.encodeChrmSyncMsg=function(n,e){n=n||0,e=e||0;var r=this._codec.getModule(Nr);return r.setCount(e),r.setSyncTime(n),r.getArrayData()},t.prototype.encodeGetHistoryMsg=function(n,e){var r=e.count,i=e.order,o=e.timestamp,s=e.channelId,h=this._codec.getModule(Mr);return h.setTargetId(n),h.setTime(o),h.setCount(r),h.setOrder(i),h.setBusChannel(s||""),h.getArrayData()},t.prototype.encodeSuperSyncMsg=function(n){var e=this._codec.getModule(oi);return e.setSyncTime(n),e.getArrayData()},t.prototype.encodeGetConversationList=function(n){var e=(n=n||{}).count,r=n.startTime,i=this._codec.getModule(sn);return i.setType(1),i.setCount(e),i.setStartTime(r),i.getArrayData()},t.prototype.encodeOldConversationList=function(n){var e=(n=n||{}).count,r=n.type,i=n.startTime,o=n.order;e=e||0,i=i||0,o=o||0;var s=this._codec.getModule(sn);return s.setType(r),s.setCount(e),s.setStartTime(i),s.setOrder(o),s.getArrayData()},t.prototype.encodeRemoveOldConversationList=function(n){var e=(n=n||{}).conversationType,r=n.channelId,i=this._codec.getModule(Ar);return i.setType(e),r&&i.setBusChannel([r]),i.getArrayData()},t.prototype.encodeRemoveConversationList=function(n){var e=this,r=this._codec.getModule(Lr),i=[];return mt(n,function(o){var s=o.conversationType,h=o.targetId,l=e._codec.getModule(Ur);l.setType(s),l.setChannelId(h),i.push(l)}),r.setSessions(i),r.getArrayData()},t.prototype.encodeDeleteMessages=function(n,e,r,i){var o=this._codec.getModule(wr),s=[];return mt(r,function(h){s.push({msgId:h.messageUId,msgDataTime:h.sentTime,direct:h.messageDirection})}),o.setType(n),o.setConversationId(e),o.setMsgs(s),o.setBusChannel(i),o.getArrayData()},t.prototype.encodeClearMessages=function(n,e,r,i){var o=this._codec.getModule(br);return e=e||new Date().getTime(),o.setDataTime(e),o.setTargetId(n),o.setBusChannel(r),o.setConversationType(i),o.getArrayData()},t.prototype.encodeClearUnreadCount=function(n,e){var r=n.conversationType,i=n.targetId,o=n.channelId,s=e.timestamp,h=this._codec.getModule(vn);return s=s||+new Date,h.setType(r),h.setChannelId(i),h.setMsgTime(s),h.setBusChannel(o),h.getArrayData()},t.prototype.encodeExpandUltraMessage=function(n,e){var r=n.targetId,i=n.conversationType,o=n.channelId,s=n.messageUId,h=n.sendTime,l=n.keys,c={mid:s,put:n.expansion,del:l,clear:n.removeAll?1:0},d=this._codec.getModule(hn);return d.setFromUserId(e),d.setTargetId(r),d.setType(i),d.setBusChannel(o||""),d.setMsgUID(s),d.setMsgTime(h),d.setContent(JSON.stringify(c)),d.getArrayData()},t.prototype.encodemodifyMessage=function(n,e){var r=n.targetId,i=n.conversationType,o=n.channelId,s=n.messageUId,h=n.sendTime,l=n.content,c=this._codec.getModule(hn);return c.setFromUserId(e),c.setTargetId(r),c.setType(i),c.setBusChannel(o||""),c.setMsgUID(s),c.setMsgTime(h),c.setContent(JSON.stringify(l)),c.getArrayData()},t.prototype.encodeQueryMsgChange=function(n){var e=this._codec.getModule(si);return e.setSyncTime(n),e.getArrayData()},t.prototype.encodeMsgQuery=function(n){var e=n.targetId,r=n.conversationType,i=n.messages,o=this._codec.getModule(ai),s=i.map(function(h){return{msgTime:h.sendTime,msgUID:h.messageUId,busChannel:h.channelId}});return o.setTargetId(e),o.setType(r),o.setQuery(s),o.getArrayData()},t.prototype.encodeUnreadMentionedMsgQuery=function(n){var e=n.targetId,r=n.channelId,i=n.sentTime,o=n.count,s=this._codec.getModule(Zr);return s.setGroupId(e),s.setBusChannel(r),s.setMsgTime(i),s.setSize(o),s.getArrayData()},t.prototype.encodeOperateStatus=function(n,e,r,i){var o=this._codec.getModule(ui);return o.setTargetId(n),o.setType(e),o.setBusChannel(r),o.setOpType(i),o.getArrayData()},t.prototype.encodeJoinOrQuitChatRoom=function(){var n=this._codec.getModule(Pr);return n.setNothing(1),n.getArrayData()},t.prototype.encodeGetChatRoomInfo=function(n,e){var r=this._codec.getModule(Dr);return r.setCount(n),r.setOrder(e),r.getArrayData()},t.prototype.encodeSetUltraGroupDefaultNotificationLevel=function(n,e){var r=this._codec.getModule(Xr);return r.setUnpushLevel(n),r.setBusChannel(e),r.getArrayData()},t.prototype.encodeGetUltraGroupDefaultNotificationLevel=function(n){var e=this._codec.getModule(Jr);return e.setBusChannel(n),e.getArrayData()},t.prototype.encodeGetFileToken=function(n,e,r,i,o,s){var h=this._codec.getModule(Vr);return h.setType(n),h.setKey(e),h.setHttpMethod(r),h.setQueryString(i),h.setUrl(o),h.setExt(s),h.getArrayData()},t.prototype.encodeGetFileUrl=function(n,e,r,i,o){var s=this._codec.getModule(n);return s.setType(e),s.setKey(r),s.setExt(o),i&&s.setFileName(i),s.getArrayData()},t.prototype.encodeModifyChatRoomKV=function(n,e,r){var i=this._codec.getModule(Hr),o=e.key,s=e.value,h=e.notificationExtra,l=e.isSendNotification,c=e.type,d=e.timestamp,_=c||Ct.UPDATE,v=Gi(e,_),I={key:o,value:s||"",uid:r,version:d};if(ot(v)||(I.status=v),i.setEntry(I),l){var T={conversationType:B.CHATROOM,targetId:n},a={key:o,value:s,extra:h,type:_},u=this._getUpMsgModule(T,{messageType:nt.CHRM_KV_NOTIFY,content:a,isPersited:!1,isCounted:!1});i.setNotification(u),i.setBNotify(!0),i.setType(B.CHATROOM)}return i.getArrayData()},t.prototype.encodeModifyChatRoomKVS=function(n,e,r){var i=this._codec.getModule(Kr),o=e.entries,s=e.type||Ct.UPDATE,h=Gi(e,s),l=[];return o.forEach(function(c){var d={key:c.key,value:c.value||"",uid:r,version:c.timestamp};ot(h)||(d.status=h),l.push(d)}),i.setEntry(l),i.getArrayData()},t.prototype.encodePullChatRoomKV=function(n){var e=this._codec.getModule(Yr);return e.setTimestamp(n),e.getArrayData()},t.prototype.encodePullUserSetting=function(n){var e=this._codec.getModule(jr);return e.setVersion(n),e.getArrayData()},t.prototype.encodeGetConversationStatus=function(n){var e=this._codec.getModule(Qr);return e.setTime(n),e.getArrayData()},t.prototype.encodeSetConversationStatus=function(n,e){var r=this,i=this._codec.getModule(cn),o=ne.getTime(),s=[];return mt(n,function(h){var l=r._codec.getModule(an),c=h.conversationType,d=h.targetId,_=h.notificationStatus,v=h.isTop,I=h.channelId,T=h.notificationLevel,a=[];l.setType(c),l.setChannelId(d),l.setTime(o),l.setBusChannel(I);var u=_===Rt.OPEN,p={};ot(_)||(p[Ge]=u),ot(T)||(p[Ge]=T),ot(v)||(p[Ki]=v),mt(p,function(f,E){if(!ot(f)){var m=r._codec.getModule(un);f=f?Vn:Sa,ot(T)||Number(E)!==Ge||(f=String(T)),m.setSessionStateType(Number(E)),m.setValue(f),a.push(m)}}),l.setStateItem(a),s.push(l)}),i.setVersion(e||o),i.setState(s),i.getArrayData()},t.prototype.encodeReadReceipt=function(n,e){var r=this._codec.getModule(ln);return r.setMsgId(n),e&&r.setChannelId(e),r.getArrayData()},t.prototype.encodeCreateTag=function(n,e){var r=this,i=this._codec.getModule(ti),o=[];return n.forEach(function(s){var h=r._codec.getModule(ve);h.setTagId(s.tagId),h.setName(s.tagName),o.push(h)}),i.setTags(o),i.setVersion(e),i.getArrayData()},t.prototype.encodeMessageReader=function(n,e){var r=this._codec.getModule(ln);return r.setMsgId(n),e&&r.setChannelId(e),r.getArrayData()},t.prototype.encodeRemoveTag=function(n,e){var r=this,i=this._codec.getModule(ei),o=[];return n.forEach(function(s){var h=r._codec.getModule(ve);h.setTagId(s),o.push(h)}),i.setTags(o),i.setVersion(e),i.getArrayData()},t.prototype.encodeDisConversationTag=function(n){var e=this._codec.getModule(ni);return e.setTagId(n),e.getArrayData()},t.prototype.encodeUpdateConversationTag=function(n,e){var r=this,i=this._codec.getModule(cn),o=[];return e.forEach(function(s){var h=r._codec.getModule(an),l=r._codec.getModule(un),c=[];n.forEach(function(d){var _=r._codec.getModule(ve);_.setTagId(d.tagId),ot(d.isTop)||_.setIsTop(d.isTop),c.push(_)}),l.setSessionStateType(qi),l.setValue(JSON.stringify(c)),l.setTags(c),h.setType(s.conversationType),h.setChannelId(s.targetId),h.setTime(Date.now()),h.setStateItem([l]),o.push(h)}),i.setState(o),i.setVersion(ne.getTime()),i.getArrayData()},t.prototype.encodeReportSDKInfo=function(n){var e=this._codec.getModule(ri);return e.setSdkInfo(n),e.getArrayData()},t.prototype.encodeUltraGroup=function(n,e){var r=this._codec.getModule(ii);return r.setSyncTime(n),r.setIsEraseMsgContent(e),r.getArrayData()},t.prototype.encodebindRTCRoomForChatroom=function(n){var e=this._codec.getModule(ci);return e.setRtcRoomId(n.rtcRoomId),e.getArrayData()},t.prototype.encodeSetCallInfo=function(n,e){var r=this._codec.getModule(li);return r.setKey(n),r.setDataContent(e),r.getArrayData()},t.prototype.encodePullKVMsg=function(n){var e=this._codec.getModule(ko);return e.setSyncTime(n),e.getArrayData()},t}(),ru=function(t){function n(e,r,i,o,s,h){var l=t.call(this,e,r,i,o,h)||this;return l.runtime=s,l.wsListener=h,l._socket=null,l._connectedTime=0,l._socketIndex=0,l._localConnectedTime=0,l._idCount=0,l._generateMessageId=function(){return l._idCount>=65535&&(l._idCount=0),++l._idCount},l._messageIds={},l._syncMessageIds={},l.codec=new nu(l.logger),l}return dt(n,t),n.prototype.getConnectedTime=function(){return this._connectedTime},n.prototype.getLocalConnectedTime=function(){return this._localConnectedTime},n.prototype.getCrtServerTime=function(){return Date.now()-this._localConnectedTime+this._connectedTime},n.prototype.connectWithToken=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_,v,I,T;return M(this,function(a){switch(a.label){case 0:if(s=r.openAnti,h=r.type,l=this.getCmpList(r),(c=l.filter(function(u,p){return l.findIndex(function(f){return f.addr===u.addr})===p}).sort(function(u,p){return u.weight>p.weight?-1:1})).length===0)return this.logger.error(P.L_NAVI_CONF_E,"no service available",o),[2,{code:R.SERVER_UNAVAILABLE}];d=s===1?Se.V4:Se.V3,_=function(u){var p,f,E,m,y,N,A,K,Y,G,S;return M(this,function(k){switch(k.label){case 0:return p=c[u],f=p.protocol,E=p.addr,m=p.weight,y=function(j,tt,C,O,U,w,b){var x=Ir(U),H=x.type,Q=x.version,J=U.tag==="browser"?"|".concat(H,"|").concat(Q):"||",st=b?"&protocolVer=".concat(b):"";return"".concat(j,"://").concat(tt,"/websocket?appId=").concat(C,"&token=").concat(encodeURIComponent(O),"&sdkVer=").concat(no,"&pid=").concat(w,"&apiVer=").concat(U.isFromUniapp?"uniapp":U.tag+encodeURIComponent(J)).concat(U.connectPlatform?"&platform=".concat(U.connectPlatform):"").concat(st)}(f===ft.WS?"ws":"wss",E,v.appkey,e,v.runtime,"",d),N=Date.now(),[4,v.connectWebSocket(y,d,o)];case 1:return A=k.sent(),K=A.code,Y=A.data,G=v.cmpWeightCache.findIndex(function(j){return j.addr===E}),S={bid:rn(),ptc:ye.WS,cod:K,net:v.getNetwork().type,dur:Date.now()-N,spr:1,pr:h||0,hos:E,idx:G,rct:v.retryCount?$e.RECONNECT:$e.CONNECT,cid:"".concat(v.uuid,"_").concat(v.retryCount),v:Ie.CURRENT,rsn:v.reason,count:v.retryCount,weight:m},v.statisticLog.__statistics(wt.IM_WEBSOCKET,JSON.stringify(S),o),K===R.RC_SOCKET_DISCONNECTED||K===R.TIMEOUT?[2,"continue"]:K!==R.SUCCESS?[2,{value:{code:K}}]:(v._localConnectedTime=Math.floor((Date.now()+N)/2),v._socket=Y.socket,v.updateCmpWeight(c[u].addr,!0),v.curCmpUrl=c[u].addr,[2,{value:{code:K,data:Y.userId}}])}})},v=this,I=0,a.label=1;case 1:return I<c.length?[5,_(I)]:[3,4];case 2:if(typeof(T=a.sent())=="object")return[2,T.value];a.label=3;case 3:return I+=1,[3,1];case 4:return[2,{code:R.SERVER_UNAVAILABLE}]}})})},n.prototype.connectWebSocket=function(e,r,i){return L(this,void 0,void 0,function(){var o=this;return M(this,function(s){return this.logger.info(P.T,"connect start: ".concat(e),i),[2,new Promise(function(h){var l=o.runtime.createWebSocket(e);o._socketIndex=l.id;var c=setTimeout(function(){o.logger.info(P.T,"connect timeout: ".concat(e),i),h({code:R.TIMEOUT}),l&&l.close()},5e3);l.onOpen(function(){clearTimeout(c),o.logger.info(P.T,"socket open",i)}),l.onMessage(function(d){if(o._socketIndex===l.id){if(Object.prototype.toString.call(d)==="[object ArrayBuffer]"){var _,v=Aa(o.logger,d,r);if(v instanceof Io){var I=v.status;if(I!==lt.ACCEPTED)return o.logger.info(P.T,"connect failed: ".concat(I),i),void h({code:(_=I,tu[_])});o.logger.info(P.T,"connect success",i);var T=v.timestamp,a=v.userId,u=v.messageId;return o._connectedTime=T,o._idCount=u,void h({code:R.SUCCESS,data:{userId:a,socket:l}})}if(v instanceof Co){var p=v.status;return o.logger.info(P.T,"recv disconnect signal -> status: ".concat(p)),void o.onRecvDisconnect(p,l)}o._onReceiveSignal(v)}}else o.logger.warn(P.L_WEBSOCKET_DISACCORD_E,JSON.stringify({msg:"WebSocket id disaccord",_socketIndex:o._socketIndex,curSocketId:l.id}))}),l.onClose(function(){o.logger.info(P.T,"socket close",i);var d=R.RC_SOCKET_DISCONNECTED;h({code:d}),o.onSocketEnd(l,d)}),l.onError(function(d){o.logger.info(P.T,"socket error",i);var _=R.RC_SOCKET_DISCONNECTED;h({code:_}),o.onSocketEnd(l,_)})})]})})},n.prototype._qosNeedAck=function(e,r){e.header&&e.header.qos!==Et.AT_MOST_ONCE&&(e instanceof fr&&!e.syncMsg&&(this.logger.debug(P.O,"send pubAck -> ".concat(r," ").concat(e.topic)),this.sendOnly(new La(r))),e instanceof Ye&&(this.logger.debug(P.O,"send queryCon -> ".concat(r," ").concat(e.topic)),this.sendOnly(new Ua(r))))},n.prototype._publishReader=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h=this;return M(this,function(l){switch(l.label){case 0:return i=e.syncMsg,o=e.topic,this.logger.debug(P.O,"recv PublishReader -> messageId: ".concat(r," ").concat(o)),o===cr?[2]:!i||function(c){return[V.ppMsgS,V.pgMsgS,V.chatMsgS].map(function(d){return V[d]}).indexOf(c)>=0}(o)?(this.wsListener.signal(e),[2]):[4,new Promise(function(c){h._syncMessageIds[r]=c})];case 1:return s=l.sent(),delete this._syncMessageIds[r],this.wsListener.signal(e,s),[2]}})})},n.prototype._onReceiveSignal=function(e){return L(this,void 0,void 0,function(){var r,i,o;return M(this,function(s){switch(s.label){case 0:return r=e.messageId,e instanceof Ro&&this._pingResolve?(this._pingResolve(R.SUCCESS),this._pingResolve=void 0,[2]):(this._qosNeedAck(e,r),r>0&&(e instanceof _r||e instanceof Ye)&&(this.logger.debug(P.O,"recv ack -> messageId: ".concat(r," ").concat(e.topic)),(i=this._messageIds[r])&&(i(e),delete this._messageIds[r]),(o=this._syncMessageIds[r])&&(delete this._syncMessageIds[r],o(e))),e instanceof fr?[4,this._publishReader(e,r)]:[3,2]);case 1:s.sent(),s.label=2;case 2:return[2]}})})},n.prototype.onRecvDisconnect=function(e,r){this._socket&&this._socket===r&&(this._socket=null,this.clearResolves(),this.onDisconnectByServer(function(i){return $a[i]}(e)))},n.prototype.onSocketEnd=function(e,r){this._socket&&this._socket===e&&(this._socket=null,this.clearResolves(),this.onDisconenctUnusual(r),this._pingResolve&&(this._pingResolve(r),this._pingResolve=void 0))},n.prototype.clearResolves=function(){for(var e in this._messageIds){var r=this._messageIds[e];delete this._messageIds[e],r(R.RC_SOCKET_DISCONNECTED)}},n.prototype.sendPing=function(e){var r=this;return new Promise(function(i){r._pingResolve=i,setTimeout(function(){return i(R.TIMEOUT)},e),r.sendOnly(new Ma)})},n.prototype.sendOnly=function(e){this._socket&&((e instanceof Ft||e instanceof X)&&(e.messageId=this._generateMessageId()),this._socket.send(e.getBufferData().buffer))},n.prototype.send=function(e,r,i,o){return o===void 0&&(o=3e4),L(this,void 0,void 0,function(){var s,h,l,c,d=this;return M(this,function(_){switch(_.label){case 0:return this._socket?(s=this._generateMessageId(),e.messageId=s,this._socket.send(e.getBufferData().buffer),[4,new Promise(function(v){d._messageIds[s]=v,setTimeout(function(){d._messageIds[s]&&delete d._messageIds[s],v()},o)})]):[2,{code:R.RC_NET_CHANNEL_INVALID}];case 1:return(h=_.sent())?h instanceof Ye||h instanceof _r?(l=r&&h.data&&[R.SUCCESS,R.CHATROOM_KV_STORE_NOT_ALL_SUCCESS].indexOf(h.status)>=0,c=l?this.codec.decodeByPBName(h.data,r,i):h,h.status!==0?(this.logger.warn(P.O,"send failed -> message: ".concat(s,", respPBName: ").concat(r,", status: ").concat(h.status)),[2,{code:h.status,data:r&&h.data?c:null}]):[2,{code:R.SUCCESS,data:c}]):[2,{code:h}]:(this.logger.warn(P.O,"send timeout -> message: ".concat(s,", respPBName: ").concat(r,", timeout: ").concat(o)),[2,{code:R.TIMEOUT}])}})})},n.prototype.close=function(e){this._socket&&(this._socket.close(),this._socket=null),this.clearResolves()},n}(eu);(function(t){t[t.STATISTICS=-2]="STATISTICS",t[t.RECORD=-1]="RECORD"})(dn||(dn={}));var Pt=null,Le="RC_CONF",Te="RC_STATISTICS",Je=null,Bo=function(t){return L(void 0,void 0,void 0,function(){var n;return M(this,function(e){switch(e.label){case 0:return[4,Pt];case 1:return(n=e.sent())?[4,new Promise(function(r){var i=n.db.transaction(Te,"readwrite").objectStore(Te),o=IDBKeyRange.lowerBound(Date.now()-t),s=i.getAllKeys(o);s.onsuccess=function(){var h=s.result,l=h.length;if(l>0){var c=i.delete(IDBKeyRange.bound(h[0],h[l-1]));c.onsuccess=r,c.onerror=r}},s.onerror=r})]:[2];case 2:return e.sent(),Je=setTimeout(function(){return Bo(t)},6e5),[2]}})})},iu=function(t,n,e){e===void 0&&(e=168),Pt||(typeof window<"u"&&window&&window.indexedDB?Pt=new Promise(function(r){var i=window.indexedDB;i.databases&&i.databases().then(function(h){h.some(function(l){return l.name==="RC_ENGINE_DB"})&&i.deleteDatabase("RC_ENGINE_DB")});var o="RC_STATISTIC_".concat(t),s=i.open(o,2);s.onerror=function(h){n.error(P.L_LOGDB_OPEN_FAILED_E,h.target.error),r(null)},s.onsuccess=function(h){var l=h.target.result;l?(l.onclose=function(c){n.warn(P.L_LOGDB_CLOSED_S)},l.onerror=function(c){n.error(P.L_LOGDB_ERROR_E,c.target.error)},l.onabort=function(c){n.info(P.L_LOGDB_ABORT_S,c.target.error)},Bo(3600*Math.max(24,Math.min(168,e))*1e3),r({appkey:t,db:l})):r(null)},s.onupgradeneeded=function(h){var l=h.target.result;l.objectStoreNames.contains(Te)&&l.deleteObjectStore(Te);var c=l.createObjectStore(Te,{autoIncrement:!0});c.createIndex("level","level",{unique:!1}),c.createIndex("time","time",{unique:!1}),(c=l.createObjectStore(Le,{keyPath:"key"})).createIndex("key","key",{unique:!0})}}):n.warn(P.L_UNSUPPORT_INDEXDB_O))},ou=function(){return L(void 0,void 0,void 0,function(){var t;return M(this,function(n){switch(n.label){case 0:return Pt?(Je&&(clearTimeout(Je),Je=null),[4,Pt]):[2];case 1:return(t=n.sent())&&t.db.close(),Pt=null,[2]}})})};function xo(t){return L(this,void 0,void 0,function(){var n;return M(this,function(e){switch(e.label){case 0:return[4,Pt];case 1:return(n=e.sent())?[2,new Promise(function(r){var i=n.db.transaction(Le,"readonly").objectStore(Le).get(t);i.onsuccess=function(o){var s;r({value:(s=i.result)===null||s===void 0?void 0:s.value,success:!0})},i.onerror=function(o){r({success:!1})}})]:[2,{success:!1}]}})})}var Er="REPORT_SESSION",su=function(t,n){return L(void 0,void 0,void 0,function(){var e,r,i,o;return M(this,function(s){switch(s.label){case 0:return e="".concat(Er,"_").concat(t),[4,xo("".concat(Er,"_").concat(t))];case 1:return r=s.sent(),i=r.success,o=r.value,i?(n===(o==null?void 0:o.sessionId)||function(h,l){L(this,void 0,void 0,function(){var c,d;return M(this,function(_){switch(_.label){case 0:return[4,Pt];case 1:return(c=_.sent())?(d=c.db,d.transaction(Le,"readwrite").objectStore(Le).put({key:h,value:l}),[2,!0]):[2,!1]}})})}(e,{sessionId:n}),[2]):[2]}})})},Fo=function(){return Pt},au=function(t){var n=t.sessionId,e=t.level,r=t.loggerId,i=t.traceId,o=t.time,s=t.tag,h=t.type,l=t.content,c=e<0?l||"":JSON.stringify({content:l,traceId:i,from:r});return c='"'.concat(c.replace(/"/g,'""'),'"'),"".concat(n,",").concat(o,",").concat(h,",").concat(e,",").concat(s,",").concat(c,`
`)},Fn=mr(),uu=Date.now(),cu=0,lu=function(){function t(n,e,r){this._appkey=n,this._id=e,this._type=r,this.__statistics=this._writer.bind(this,dn.STATISTICS)}return t.prototype._writer=function(n,e,r,i){var o=new Date;/^[\w-]+$/.test(e)&&this.flush({time:+o,sessionId:Fn,type:this._type,loggerId:this._id,tag:e,level:n,content:r,traceId:i})},t.prototype.createTraceId=function(){return"".concat(Fn,"-").concat(++cu)},t.prototype.getSessionId=function(){return Fn},t}(),hu=function(){function t(n,e,r,i,o,s){s===void 0&&(s=o),this.appkey=n,this.deviceId=e,this.deviceInfo=r,this.statisticDB=i,this.logger=o,this.reportClass=s,this.userId="",this.timer=null,this.started=!1}return t.prototype.checkStart=function(n){return L(this,void 0,void 0,function(){var e,r,i;return M(this,function(o){return this.started?[2]:(this.userId=n.userId,n.logSwitch?(e=Yt.getLogUrlPolicyList(n,this.logger),r=e.policy,i=e.addrs,this.started=!0,i.length>0&&this.realtimeReport(i[0].addr,r.level,r.itv),[2]):[2])})})},t.prototype.realtimeReport=function(n,e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d,_,v,I,T,a,u=this;return M(this,function(p){switch(p.label){case 0:return i=Date.now(),o=this.statisticDB.getTimestamp4RealtimeLog()||uu,s=Math.max(i-5e3,o),h=this.reportClass.createTraceId(),this.logger.debug(P.L_REALTIME_LOG_T,JSON.stringify({startTime:o,endTime:s,level:e}),h),[4,this.statisticDB.getStatistics(o,s,e,!0)];case 1:return l=p.sent(),c=l.dbReady,d=l.logs,c?[3,2]:(this.logger.warn(P.L_REALTIME_LOG_R,"db error",h),[3,5]);case 2:return d.length>0?(this.logger.info(P.L_REALTIME_LOG_O,JSON.stringify({count:d.length}),h),[4,this.compressStatistics(d)]):[3,5];case 3:return _=p.sent(),v=_.success,I=_.data,v||this.logger.warn(P.L_REALTIME_LOG_O,"compress failed",h),this.logger.info(P.L_REALTIME_LOG_O,"compress done",h),T=en(n)?n:"https://".concat(n),T+="?version=".concat("5.8.2-enterprise.4","&appkey=").concat(this.appkey,"&userId=").concat(this.userId,"&deviceId=").concat(this.deviceId,"&deviceInfo=").concat(this.deviceInfo,"&platform=Web"),[4,this.send({url:T,body:I,method:"POST"})];case 4:a=p.sent().status,this.logger.info(P.L_REALTIME_LOG_R,JSON.stringify({status:a}),h),a===200&&this.statisticDB.setTimestamp4RealtimeLog(d[d.length-1].time+1),p.label=5;case 5:return this.started&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){return u.realtimeReport(n,e,r)},1e3*r)),[2]}})})},t.prototype.report=function(n,e,r,i,o,s){return L(this,void 0,void 0,function(){var h,l,c,d,_,v,I,T,a,u;return M(this,function(p){switch(p.label){case 0:return r.toLowerCase()!=="web"?[2]:(h=this.reportClass.createTraceId(),this.logger.info(P.L_REPORT_FULL_LOG_T,JSON.stringify({startTime:n,endTime:e,logId:o,messageUId:s}),h),[4,this.statisticDB.getStatistics(n,e,dn.STATISTICS,!1)]);case 1:return l=p.sent(),c=l.dbReady,d=l.logs,this.logger.info(P.L_REPORT_FULL_LOG_O,JSON.stringify({count:d.length}),h),_=en(i)?i:"https://".concat(i),_+="?version=".concat("5.8.2-enterprise.4","&appkey=").concat(this.appkey,"&userId=").concat(this.userId,"&deviceId=").concat(this.deviceId,"&deviceInfo=").concat(this.deviceInfo,"&platform=Web&logId=").concat(o),c?d.length>0?[4,this.compressStatistics(d)]:[3,3]:[3,5];case 2:return I=p.sent(),T=I.success,a=I.data,v=T?a:"compress failed",[3,4];case 3:v="no data",p.label=4;case 4:return[3,6];case 5:v="no database",p.label=6;case 6:return this.logger.debug(P.L_REPORT_FULL_LOG_O,"compress done",h),[4,this.send({url:_,body:v,method:"POST"})];case 7:return u=p.sent().status,this.logger.info(P.L_REPORT_FULL_LOG_R,JSON.stringify({status:u}),h),[2]}})})},t.prototype.stop=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.started=!1},t}(),gn="RC_STATISTICS",du=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return dt(n,t),n.prototype.flush=function(e){gu(e)},n}(lu),Hn=!1,vr=[],Ho=function(t){return L(void 0,void 0,void 0,function(){var n;return M(this,function(e){switch(e.label){case 0:return Hn||vr.length===0?[2]:(Hn=!0,n=vr.splice(0),[4,new Promise(function(r){var i=t.transaction(gn,"readwrite");i.oncomplete=r,i.onabort=r;var o=i.objectStore(gn);n.forEach(function(s){try{o.add(s)}catch{console==null||console.error("write log failed ->",s)}})})]);case 1:return e.sent(),Hn=!1,setTimeout(function(){return Ho(t)}),[2]}})})},gu=function(t){return L(void 0,void 0,void 0,function(){var n;return M(this,function(e){switch(e.label){case 0:return[4,Fo()];case 1:return(n=e.sent())?(vr.push(t),Ho(n.db),[2]):[2]}})})},$i=0,pu=function(){return{setTimestamp4RealtimeLog:function(t){$i=t},getTimestamp4RealtimeLog:function(){return $i},getStatistics:function(t,n){return L(this,void 0,void 0,function(){var e;return M(this,function(r){switch(r.label){case 0:return[4,Fo()];case 1:return(e=r.sent())?[2,new Promise(function(i){var o=e.db.transaction(gn,"readonly").objectStore(gn),s=[],h=IDBKeyRange.bound(t,n),l=o.index("time").openCursor(h);l.onsuccess=function(c){var d=c.target.result;if(d){var _=d.value;s.push(_),d.continue()}else i({dbReady:!0,logs:s})},l.onerror=function(c){i({dbReady:!1,logs:[]})}})]:[2,{dbReady:!1,logs:[]}]}})})}}},fu=function(t){function n(e,r,i,o){var s=this,h=yr(r),l=Ir(r),c="".concat(l.type,"|").concat(l.version,"|").concat(o.getSessionId());return(s=t.call(this,e,h,c,pu(),i,o)||this).runtime=r,s}return dt(n,t),n.prototype.send=function(e){return this.runtime.httpReq(e)},n.prototype.checkStart=function(e){return L(this,void 0,void 0,function(){return M(this,function(r){switch(r.label){case 0:return[4,su(e.userId,this.reportClass.getSessionId())];case 1:return r.sent(),[2,t.prototype.checkStart.call(this,e)]}})})},n.prototype.compressStatistics=function(e){return L(this,void 0,void 0,function(){return M(this,function(r){return[2,{success:!0,data:fo(e.map(au).join(""))}]})})},n.prototype.isReporter=function(){return L(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return[4,(r=this.userId,i=this.reportClass.getSessionId(),L(void 0,void 0,void 0,function(){var o,s,h;return M(this,function(l){switch(l.label){case 0:return[4,xo("".concat(Er,"_").concat(r))];case 1:return o=l.sent(),s=o.success,h=o.value,[2,s&&(h==null?void 0:h.sessionId)===i]}})}))];case 1:return[2,e.sent()]}var r,i})})},n.prototype.report=function(e,r,i,o,s,h){return L(this,void 0,void 0,function(){return M(this,function(l){switch(l.label){case 0:return[4,this.isReporter()];case 1:return l.sent()?[2,t.prototype.report.call(this,e,r,i,o,s,h)]:[2]}})})},n.prototype.realtimeReport=function(e,r,i){return L(this,void 0,void 0,function(){return M(this,function(o){return[2,t.prototype.realtimeReport.call(this,e,r,i)]})})},n}(hu),Fe=function(t,n,e,r,i,o,s){return{conversationType:t,targetId:n,senderUserId:o,messageDirection:Ot.SEND,isCounted:!!e.isCounted,isMentioned:!!e.isMentioned,content:e.content,messageType:e.messageType,isOffLineMessage:!1,isPersited:!!e.isPersited,messageUId:r,sentTime:i,receivedTime:0,disableNotification:!!e.disableNotification,isStatusMessage:!!e.isStatusMessage,canIncludeExpansion:!!e.canIncludeExpansion,expansion:e.canIncludeExpansion?e.expansion:null,receivedStatus:Yn.UNREAD,pushConfig:e.pushConfig,channelId:e.channelId,isInterrupt:e.isInterrupt,messageId:s||0,sentStatus:ce.SENT}},He=function(t){return t.sort(function(n,e){var r,i,o=((r=n.latestMessage)===null||r===void 0?void 0:r.sentTime)||0;return(((i=e.latestMessage)===null||i===void 0?void 0:i.sentTime)||0)-o}),t},_u=function(t){function n(e,r,i,o){var s=t.call(this,e,r,i,o,new gr(o.appkey,"RC-E","IM"),new du(o.appkey,"RC-E","IM"))||this;s._customMessageType={},s._reconnectTimer=-1,s._pullOfflineFinished=!1,s.currentUserId="",s._openCallPlus=!1,s._pullingMsg=!1,s._pullQueue=[],s._chrmsQueue={},s._latestSyncTimestamp=0,s._intervalTimer=-1,s._latestPullKVMsgTimestamp=0,s._intervalTimerForChrmPull=-1,s._lastSyncUltraMsgTimeStamp=0,s._lastSyncUltraMsgLocalTimeStamp=0,s._ultraGroupTimer=-1,s._isUltraPulling=!1,s._ultraGroupTimeQue=[],s._isUltraGroupListExist=!1,s._ultraGroupMap={},s._ultraMsgMap={},s._pullUltraChangeMessageQue=[],s._isPullingUltraChangeMessage=!1,s._lastPullingUltraChangeMessageTime=0;var h=o.appkey,l=o.logOutputLevel,c=o.logExpireTime,d=o.navigators,_=o.areaCode,v=o.logServerUrl,I=o.miniCMPProxy,T=o.environment;return s._environment=T||"default",s.logger.setOutputLevel(l),uo(h,s.logger,e,c),s.reporter=new na(h,s.runtime,s.logger,s._options.__reportLogLevel),s.navi=new Ka(h,s.logger,s.statisticLog,e,T),iu(h,s.logger,c),s.reporterStatistic=new fu(h,s.runtime,s.logger,s.statisticLog),s._letterbox=new wa(e,h),s._sendMessageStore=new qa(e,h),s._chrmEntryHandler=new Pa(s),s._connMgr=new ru(h,s.navi,s.logger,s.statisticLog,s.runtime,{signal:s._signalHandler.bind(s),onConnected:s.onConnected.bind(s),onDisconnected:s.onDisconnected.bind(s),onConnecting:s._watcher.onConnecting,onSuspend:s._watcher.onSuspend}),Yt.init({areaCode:_,navigators:d,logServerUrl:v,miniCMPProxy:I}),s}return dt(n,t),n.prototype.onConnected=function(){var e=this.navi.getNaviInfoFromCache(this._connMgr.getToken()),r=this._connMgr.getCurrentUserId();this.currentUserId=r,this._pullOfflineFinished=!1,this._joinedChrmManager||(this._joinedChrmManager=new Da(this.runtime,this._appkey,this.currentUserId,e.joinMChrm,this.logger)),this._conversationManager||(this._conversationManager=new xa(this,this._appkey,this.currentUserId,this._watcher.conversation,this._watcher.conversationTag)),this._ultraGroupManager||(this._ultraGroupManager=new Wa(this,this._appkey,this.currentUserId)),this._userSettingManager||(this._userSettingManager=new Fa(this,this._appkey,this.currentUserId,this._watcher.tag)),this._watcher.onConnected(),this._conversationManager.startPullConversationStatus(0),this._conversationManager.adaptOldStore(),this._userSettingManager.pullUserSettings(0),this._sendMessageStore.init(this.currentUserId),this._rejoinChrm(),this._startSyncInterval(),this._openCallPlus&&this._syncCallPullKVMsg(),e.ugMsg===1&&this._notificationOnline(),this.reporter.checkStart(e),this.reporterStatistic.checkStart(e)},n.prototype.onDisconnected=function(e){this._resetMemoryState(),this._watcher.onDisconnected(e)},n.prototype.createLogger=function(e,r){return new gr(this._appkey,e,r)},n.prototype.refetchNaviInfo=function(){return this.navi.request(this._connMgr.getToken(),!0,!0,this.logger.createTraceId())},n.prototype.getNaviInfoFromCache=function(){return this.navi.getNaviInfoFromCache(this._connMgr.getToken())},n.prototype.getConnectedTime=function(){return this._connMgr.getConnectedTime()},n.prototype.getConnectionStatus=function(){return this._connMgr.getConnectionStatus()},n.prototype.connect=function(e,r,i,o){return L(this,void 0,void 0,function(){return M(this,function(s){return this._openCallPlus=i,[2,this._connMgr.connect(e,r,i,o)]})})},n.prototype._signalHandler=function(e,r){var i=e.syncMsg,o=e.topic;if(i)this._receiveSyncMsg(e,r);else{var s=this.logger.createTraceId();this.logger.debug(P.L_RECV_RMTP_O,o,s);var h=V[o];if(h)switch(h){case V.s_ntf:this._pullMsg(e);break;case V.s_msg:this._receiveMsg(e);break;case V.s_cmd:this._receiveStateNotify(e);break;case V.s_us:this._receiveSettingNotify(e);break;case V.rtc_ntf:this._receiveRtcKv(e.data);break;case V.s_opNtf:this._pullOperateStatusNotify(e);break;case V.s_pubCall:this._pubCallInfo(e)}else this.logger.error(P.L_RECV_RMTP_E,o,s)}},n.prototype._receiveStateNotify=function(e){var r=this._connMgr.codec.decodeByPBName(e.data,on),i=r.time,o=r.type,s=r.chrmId;switch(o){case 2:this._chrmEntryHandler.pullEntry(s,i);break;case 3:this._conversationManager.startPullConversationStatus(i);break;case 4:this._chrmEntryHandler.reset(s),this._watcher.chatroom({chatroomDestroyed:e.targetId});break;case 6:this._ultraGroupTimeQue.push(i),this._syncUltraMsg(this._lastSyncUltraMsgTimeStamp);break;case 7:this._pullUltraChangeMessageQue.push(i),this._pullUltraChangeMessageList(this._lastPullingUltraChangeMessageTime)}},n.prototype._receiveSettingNotify=function(e){var r=this._connMgr.codec.decodeByPBName(e.data,yn).version;this._userSettingManager.pullUserSettings(r)},n.prototype._receiveMessageExpansion=function(e){var r=e.content,i=r.put,o=r.del,s=r.mid;i&&this._watcher.expansion({updatedExpansion:{messageUId:s,expansion:i}}),o&&this._watcher.expansion({deletedExpansion:{messageUId:s,deletedKeys:o}})},n.prototype._clearUltraGroupUnreadCount=function(e,r){var i=this._connMgr.codec.decodeByPBName(e.data,vn),o=i.channelId,s=i.busChannel,h=i.msgTime,l=this._ultraGroupMap["".concat(s,"_").concat(o)];l&&(l.unreadMessageCount=0,l.unreadMentionedCount=0,l.unreadMentionedMeCount=0,l.firstUnreadMessage&&(l.firstUnreadMessage=null),l.lastReadTime=h,this._watcher.conversation(xt([l]))),r&&(this._ultraMsgMap[r.messageUId]=r.timestamp)},n.prototype._receiveSyncMsg=function(e,r){if(Ya.includes(e.topic))if(e.topic!==V[V.updUgRTime]){var i=this._connMgr.codec.decodeByPBName(e.data,Oe,{currentUserId:this.currentUserId,signal:e});((i=this._handleMsgProperties(i)).conversationType!==B.CHATROOM||this._chrmsQueue[i.targetId])&&(this._pullingMsg?this._pullQueue.push((r==null?void 0:r.timestamp)||i.sentTime):(r&&(i.sentTime=r.timestamp,i.messageUId=r.messageUId,this._sendMessageStore.setMessage(r.messageUId,r.timestamp)),this.logger.info(P.L_RECV_MULTI_SYNC_MSG_O,JSON.stringify({messageUId:i.messageUId,messgeId:i.messageId,sentTime:i.sentTime})),i.messageType!==nt.EXPANSION_NOTIFY?((i.messageType===nt.SYNC_READ_STATUS||i.messageType===nt.READ_RECEIPT&&i.senderUserId===this.currentUserId)&&this._conversationManager.clearUnreadCount(i.conversationType,i.targetId,i.channelId),this._conversationManager.setConversationCacheByMessage(i,!0),this._batchMessage([i])):this._receiveMessageExpansion(i)))}else this._clearUltraGroupUnreadCount(e,r)},n.prototype._batchMessage=function(e){for(var r=this,i=[],o=[],s=e.length-1;s>=0;s-=1){var h=e[s];h.messageType!==nt.LOG_COMMAND||h.senderUserId!=="rongcloudsystem"?i.unshift(h):o.unshift(h)}this._watcher.batchMessage(i),o.length!==0&&o.forEach(function(l){var c=l.content,d=c.startTime,_=c.endTime,v=c.platform,I=c.logId,T=c.uri;r.reporter.report(parseInt(d,10),parseInt(_,10),v,T,I,l.messageUId)})},n.prototype._pubCallInfo=function(e){var r=this._connMgr.codec.decodeByPBName(e.data,hi),i=r.key,o=r.dataContent,s=r.maxTime;this._latestPullKVMsgTimestamp=s,this._watcher.callInfo(JSON.stringify({list:[{key:i,value:o}]}))},n.prototype._pullMsg=function(e){var r=this._connMgr.codec.decodeByPBName(e.data,on),i=r.type,o=r.chrmId,s=r.time;if(this.logger.info(P.L_RECV_S_NTF_O,"type: ".concat(i,", chrmId: ").concat(i,", time: ").concat(s)),i===2){var h=this._chrmsQueue[o];if(!h)return;h.queue.push(s),this._pullChrmMsg(o)}else this._pullQueue.push(s),this._syncMsg()},n.prototype._startSyncInterval=function(){var e=this;this._stopSyncInterval(),this._intervalTimer=setInterval(function(){Date.now()-e._latestSyncTimestamp>=18e4&&e._syncMsg()},3e4),this._latestSyncTimestamp=Date.now(),this._syncMsg()},n.prototype._stopSyncInterval=function(){this._intervalTimer!==-1&&(clearInterval(this._intervalTimer),this._intervalTimer=-1)},n.prototype._syncCallPullKVMsg=function(){return L(this,void 0,void 0,function(){var e,r,i,o,s;return M(this,function(h){switch(h.label){case 0:return this._isConnected?(e=this._connMgr.codec.encodePullKVMsg(this._latestPullKVMsgTimestamp),r=new X(va,e,this.currentUserId),[4,this._connMgr.send(r,di)]):[2];case 1:return i=h.sent(),o=i.code,s=i.data,o===R.SUCCESS&&s?(this._latestPullKVMsgTimestamp=s.maxTime,this._watcher.callInfo(JSON.stringify({list:s.info})),[2]):[2]}})})},Object.defineProperty(n.prototype,"_isConnected",{get:function(){return this._connMgr.getConnectionStatus()===it.CONNECTED},enumerable:!1,configurable:!0}),n.prototype._messageProcessor=function(e){var r=this,i=0,o=[],s=[];return e.forEach(function(h){if(o.push(h.messageUId),h.messageDirection===Ot.SEND&&(i=Math.max(h.sentTime,i),r._sendMessageStore.getSendMessageMap()[h.messageUId]))return void r._sendMessageStore.removeByUID(h.messageUId);if(h.messageType!==nt.DELIVERED&&h.messageType!==nt.DELIVERED_MSG)if(h.messageType!==nt.EXPANSION_NOTIFY){if(h.messageType!==nt.SYNC_READ_STATUS||h.senderUserId===r.currentUserId){(h.messageType===nt.SYNC_READ_STATUS||h.messageType===nt.READ_RECEIPT&&h.senderUserId===r.currentUserId)&&r._conversationManager.clearUnreadCount(h.conversationType,h.targetId,h.channelId);var l=r._handleMsgProperties(h);r._conversationManager.setConversationCacheByMessage(l,!0),s.push(l)}}else r._receiveMessageExpansion(h)}),{newOutboxTime:i,messageUIds:o,messages:s}},n.prototype._syncMsg=function(){return L(this,void 0,void 0,function(){var e,r,i,o,s,h,l,c,d,_,v,I,T,a,u,p,f,E,m,y;return M(this,function(N){switch(N.label){case 0:return this._pullingMsg?[2]:this._isConnected?(this._pullingMsg=!0,e=this._letterbox.getOutboxTime(this.currentUserId),r=this._letterbox.getInboxTime(this.currentUserId),i=this._letterbox.getBroadcastSyncTime(this.currentUserId),o=this._connMgr.codec.encodeSyncMsg({sendboxTime:e,inboxTime:r,broadcastSyncTime:i}),s=new X(V[V.pullMsg],o,this.currentUserId),h=this.logger.createTraceId(),this.logger.info(P.L_PULL_MSG_T,JSON.stringify({outboxTime:e,inboxTime:r,broadcastSyncTime:i}),h),[4,this._connMgr.send(s,ie,{connectedTime:this._connMgr.getConnectedTime(),currentUserId:this.currentUserId})]):(this._pullingMsg=!1,[2]);case 1:return l=N.sent(),c=l.code,d=l.data,this._latestSyncTimestamp=Date.now(),c!==R.SUCCESS||!d||ot(d.finished)||ot(d.list)||ot(d.syncTime)?(this.logger.warn(P.L_PULL_MSG_R,JSON.stringify({code:c,timestamp:this._latestSyncTimestamp}),h),this._pullingMsg=!1,[2]):(_=d.list,v=d.finished,I=d.syncTime,T=d.broadcastSyncTime,a=T===void 0?1:T,this.logger.info(P.L_PULL_MSG_R,JSON.stringify({syncTime:I,finished:v,messages:_.map(function(A){return{messageUId:A.messageUId,messageId:A.messageId,sentTime:A.sentTime}})}),h),u=this._messageProcessor(_),p=u.newOutboxTime,f=u.messageUIds,E=u.messages,this._batchMessage(E),this._letterbox.setInboxTime(I,this.currentUserId),this._letterbox.setOutboxTime(p,this.currentUserId),this._letterbox.setBroadcastSyncTime(a,this.currentUserId),this._sendMessageStore.removeByTimestamp(p),this._pullingMsg=!1,m=this._pullQueue.filter(function(A){return A>I}),this._pullQueue.length=0,(y=this._pullQueue).push.apply(y,m),v&&!this._pullOfflineFinished&&(this._pullOfflineFinished=!0,this._watcher.pullFinished()),this.logger.info(P.L_PULL_MSG_R,JSON.stringify({code:c,messageUIds:f.join(","),timestamp:this._latestSyncTimestamp,hasmore:!v,tmpPullQueue:m}),h),v?(this._pullQueue.length>0&&(this._pullQueue.length=0,this._syncMsg()),[2]):(this._syncMsg(),[2]))}})})},n.prototype._receiveMsg=function(e){if(this._isConnected){var r=this._connMgr.codec.decodeByPBName(e.data,En,{currentUserId:this.currentUserId,connectedTime:this._connMgr.getConnectedTime()});if(r=this._handleMsgProperties(r),this.logger.info(P.L_RECV_S_MSG_O,JSON.stringify({messageUId:r.messageUId,messgeId:r.messageId,sentTime:r.sentTime})),r.messageType!==nt.DELIVERED&&r.messageType!==nt.DELIVERED_MSG){if(r.conversationType!==B.RTC_ROOM){if(this._pullingMsg)return;if(this._pullQueue.length>0)return void this._syncMsg()}r.senderUserId===this.currentUserId&&this._sendMessageStore.setMessage(r.messageUId,r.sentTime),r.isStatusMessage||r.senderUserId===this.currentUserId||this._letterbox.setInboxTime(r.sentTime,this.currentUserId),r.messageType!==nt.EXPANSION_NOTIFY?r.messageType===nt.SYNC_READ_STATUS&&r.senderUserId!==this.currentUserId||(this._conversationManager.setConversationCacheByMessage(r,!0),this._batchMessage([r])):this._receiveMessageExpansion(r)}}},n.prototype._handleMsgProperties=function(e,r){r===void 0&&(r=!1);var i,o=e.messageType,s=e.isStatusMessage,h=e.isCounted,l=h!==void 0&&h,c=e.isPersited,d=c!==void 0&&c,_=o in pi,v=o in this._customMessageType;if(i=_?Z(Z({},pi[o]),{isStatusMessage:Wo.includes(o)}):v?this._customMessageType[o]:{isCounted:l,isPersited:d,isStatusMessage:!1},Object.assign(e,i),r&&!ot(s)&&(e.isStatusMessage=s),!r){var I=e.content.user;if(I){var T=I.portrait,a=I.portraitUri,u=T||a;u&&(I.portrait=I.portraitUri=u)}}return e},n.prototype._fixDownstreamData=function(e,r,i){return e&&r.list.length===2&&(r.hasMore=!0,i===0?r.list.shift():r.list.pop()),r},n.prototype.getHistoryMessage=function(e,r,i,o,s,h,l,c){var d;return h===void 0&&(h=""),L(this,void 0,void 0,function(){var _,v,I,T,a,u,p,f,E,m;return M(this,function(y){switch(y.label){case 0:return v=(_=this).currentUserId,I=_._connMgr,T=Ca[e]||Eo,a=o===1&&i===0,I?(u=I.codec.encodeGetHistoryMsg(r,{timestamp:i,count:a?2:o,order:s,channelId:h}),this.logger.info(P.L_GET_HISTORY_MSG_T,JSON.stringify({targetId:r,conversationType:e,channelId:h,timestamp:i,count:o,order:s}),c),[4,I.send(new X(T,u,v),oe,{currentUserId:v,connectedTime:I.getConnectedTime(),conversation:{targetId:r}})]):[3,2];case 1:return p=y.sent(),(f=p.code)===R.SUCCESS&&u?(E=p.data,E=this._fixDownstreamData(a,E,s),m=[],(d=E.list)===null||d===void 0||d.forEach(function(N){N&&m.push(N.messageUId)}),this.logger.info(P.L_GET_HISTORY_MSG_R,JSON.stringify({code:f,messageUIds:m.join(",")}),c),[2,{code:f,data:{list:E.list,hasMore:E.hasMore}}]):(this.logger.warn(P.L_GET_HISTORY_MSG_R,JSON.stringify({code:f,messageUIds:""}),c),[2,{code:f}]);case 2:return[2,{code:R.RC_NET_CHANNEL_INVALID}]}})})},n.prototype.reportSDKInfo=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return this._isConnected?(i=(r=this).currentUserId,o=r._connMgr,s=this.logger.createTraceId(),h=JSON.stringify(e),this.logger.debug(P.L_VER_REPORT_T,h,s),l=o.codec.encodeReportSDKInfo(h),c=new X(V[V.reportsdk],l,i),[4,o.send(c)]):[2];case 1:return(d=_.sent().code)!==R.SUCCESS&&this.logger.warn(P.L_VER_REPORT_R,d,s),[2]}})})},n.prototype.deleteRemoteMessage=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_;return M(this,function(v){switch(v.label){case 0:return this._isConnected?(h=(s=this).currentUserId,l=s._connMgr,c=l.codec.encodeDeleteMessages(e,r,i,o),d=new X(ua,c,h),[4,l.send(d)]):[2,R.RC_NET_UNAVAILABLE];case 1:return _=v.sent(),[2,_.code]}})})},n.prototype.deleteRemoteMessageByTimestamp=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_,v;return M(this,function(I){switch(I.label){case 0:return this._isConnected?(h=(s=this).currentUserId,l=s._connMgr,c=l.codec.encodeClearMessages(r,i,o,e),d=Ra[e],_=new X(d,c,h),[4,l.send(_)]):[2,R.RC_NET_UNAVAILABLE];case 1:return v=I.sent(),[2,v.code]}})})},n.prototype.getConversationList=function(e,r,i,o,s){return e===void 0&&(e=300),L(this,void 0,void 0,function(){var h,l,c,d,_,v,I,T,a=this;return M(this,function(u){switch(u.label){case 0:return this._isConnected?(l=(h=this).currentUserId,c=h._connMgr,r=r||B.PRIVATE,d=c.codec.encodeOldConversationList({count:e,type:r,startTime:i,order:o}),_=new X(Hi,d,l),[4,c.send(_,se,{currentUserId:l,connectedTime:c.getConnectedTime(),afterDecode:function(p){var f=p.conversationType,E=p.targetId,m=p.channelId,y=a._conversationManager.get(f,E,m);return Object.assign(p,y),p}})]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return v=u.sent(),I=v.code,T=v.data,I!==R.SUCCESS?[2,{code:I}]:[2,{code:I,data:T==null?void 0:T.list}]}})})},n.prototype.removeConversation=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l;return M(this,function(c){switch(c.label){case 0:return this._isConnected?(o=this._connMgr,s=o.codec.encodeRemoveOldConversationList({conversationType:e,channelId:i,targetId:r}),h=new X(fa,s,r),[4,o.send(h)]):[2,R.RC_NET_UNAVAILABLE];case 1:return l=c.sent(),[2,l.code]}})})},n.prototype.getConversation=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return e!==B.ULTRA_GROUP?[3,1]:(o=this._ultraGroupMap["".concat(i,"_").concat(r)])?[3,3]:[2,{code:R.CONVER_GET_ERROR}];case 1:return(s=this._conversationManager.get(e,r,i))?[4,this.getHistoryMessage(e,r,0,1,0)]:[2,{code:R.CONVER_GET_ERROR}];case 2:if(h=_.sent(),l=h.code,c=h.data,l!==R.SUCCESS)return[2,{code:R.CONVER_GET_ERROR}];d=(c==null?void 0:c.list[0])||null,o={conversationType:e,targetId:r,channelId:i,unreadMessageCount:s.unreadMessageCount||0,latestMessage:d,notificationStatus:s.notificationStatus||Rt.CLOSE,notificationLevel:s.notificationLevel||Ht.NOT_SET,isTop:s.isTop||!1,lastUnreadTime:s.lastUnreadTime||0,unreadMentionedCount:s.unreadMentionedCount||0},_.label=3;case 3:return[2,{code:R.SUCCESS,data:o}]}})})},n.prototype.getAllConversationUnreadCount=function(e,r,i){var o=this._conversationManager.getAllUnreadCount(e,r,i);return Promise.resolve({code:R.SUCCESS,data:o})},n.prototype.getTotalUnreadCountByLevels=function(e,r,i){i===void 0&&(i=!1);var o=0;if(e.includes(B.ULTRA_GROUP)){if(!this._isUltraGroupListExist)return Promise.resolve({code:R.METHOD_NOT_AVAILABLE});for(var s in this._ultraGroupMap){var h=this._ultraGroupMap[s];(r.length===0||r.includes(h.notificationLevel))&&(o+=i?h.unreadMentionedCount:h.unreadMessageCount)}}return o+=this._conversationManager.getTotalUnreadCountByLevels(e,r,i),Promise.resolve({code:R.SUCCESS,data:o})},n.prototype.getConversationUnreadCount=function(e,r,i){var o,s;return e===B.ULTRA_GROUP?(s=((o=this._ultraGroupMap["".concat(i,"_").concat(r)])===null||o===void 0?void 0:o.unreadMessageCount)||0,s=this._getUnreadCount(s)):s=this._conversationManager.getUnreadCount(e,r,i),Promise.resolve({code:R.SUCCESS,data:s})},n.prototype.clearConversationUnreadCount=function(e,r,i){return this._conversationManager.clearUnreadCount(e,r,i,!1),Promise.resolve(R.SUCCESS)},n.prototype.clearAllUnreadCount=function(){return this._conversationManager.clearAllUnreadCount(),Promise.resolve(R.SUCCESS)},n.prototype.getFirstUnreadMessage=function(e,r){throw new Error("Method not implemented.")},n.prototype.saveConversationMessageDraft=function(e,r,i,o){return this._conversationManager.setDraft(e,r,i,o),Promise.resolve(R.SUCCESS)},n.prototype.getConversationMessageDraft=function(e,r,i){var o=this._conversationManager.getDraft(e,r,i);return Promise.resolve({code:R.SUCCESS,data:o})},n.prototype.clearConversationMessageDraft=function(e,r,i){return this._conversationManager.clearDraft(e,r,i),Promise.resolve(R.SUCCESS)},n.prototype.pullConversationStatus=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d,_,v=this;return M(this,function(I){switch(I.label){case 0:return this._isConnected?(i=(r=this)._connMgr,o=r.currentUserId,s=i.codec.encodeGetConversationStatus(e),h=new X(V[V.pullSeAtts],s,o),[4,i.send(h,In)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return l=I.sent(),c=l.code,d=l.data,this.logger.info(P.L_PULL_CONVERSATION_S,JSON.stringify({timestamp:e,userId:o})),c!==R.SUCCESS?[2,{code:c}]:(_=[],Array.isArray(d)&&d.forEach(function(T){var a=T.conversationType,u=T.updatedTime;u&&v._conversationManager.setConversationUpdatedTime(u),a===B.ULTRA_GROUP?v._setUltraConversationStatus(T):_.push(T)}),[2,{code:c,data:_}])}})})},n.prototype._setUltraConversationStatus=function(e){var r=e.targetId,i=e.notificationStatus,o=e.notificationLevel,s=e.channelId,h=e.isTop,l=this._ultraGroupMap["".concat(s,"_").concat(r)];return l&&o!==void 0&&(l.notificationLevel=o,this._ultraGroupManager.addUltraGroupStatus(l)),l&&i!==void 0&&(l.notificationStatus=i,this._ultraGroupManager.addUltraGroupStatus(l)),l&&h!==void 0&&(l.isTop=h),l},n.prototype.batchSetConversationStatus=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d,_,v,I,T,a=this;return M(this,function(u){switch(u.label){case 0:return this._isConnected?(i=(r=this).currentUserId,o=r._connMgr,s=this._conversationManager.getConversationUpdatedTime(),h=o.codec.encodeSetConversationStatus(e,s),l=new X(_a,h,i),[4,o.send(l,Wr)]):[2,R.RC_NET_UNAVAILABLE];case 1:return c=u.sent(),d=c.code,_=c.data,d!==R.SUCCESS?[2,d]:(v=_,this._conversationManager.setConversationUpdatedTime(v.version),I=[],e.forEach(function(p){if(p.conversationType!==B.ULTRA_GROUP)a._conversationManager.addStatus(Z(Z({},p),{updatedTime:v.version}),!0);else{var f=a._setUltraConversationStatus(p);f&&I.push(f)}}),I.length>0&&(T=xt(I),T=He(T),this._watcher.conversation(T)),[2,d])}})})},n.prototype._joinChrm=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_,v,I,T;return M(this,function(a){switch(a.label){case 0:return this._isConnected?(s=this._connMgr,h=s.codec.encodeJoinOrQuitChatRoom(),c=new X(l=i?Fi:ca,h,e),this.logger.info(P.L_JOIN_CHATROOM_T,JSON.stringify({chatroomId:e,count:r,topic:l}),o),[4,s.send(c,Ne)]):[2,R.RC_NET_UNAVAILABLE];case 1:return d=a.sent(),_=d.code,v=d.data,I=_===R.SUCCESS?"info":"warn",this.logger[I](P.L_JOIN_CHATROOM_R,JSON.stringify({code:_,timestamp:new Date().getTime()}),o),_===R.SUCCESS&&(T=v.joinTime,this._chrmsQueue[e]||(this._chrmsQueue[e]={pulling:!1,queue:[],timestamp:0}),this._pullChrmMsg(e,r,T),this.getNaviInfoFromCache().kvStorage&&this._chrmEntryHandler.pullEntry(e,0),this._joinedChrmManager.set(e,r),this._startSyncIntervalForChrmPull()),[2,_]}})})},n.prototype._rejoinChrm=function(){return L(this,void 0,void 0,function(){var e,r,i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:for(i in e=this._joinedChrmManager.get(),r=[],e)r.push(i);o=0,d.label=1;case 1:return o<r.length?(s=r[o],this.logger.info(P.L_REJOIN_CHATROOM_T,JSON.stringify({chatroomId:s,count:e[s]||10,topic:Fi})),h=this.logger.createTraceId(),[4,this._joinChrm(s,e[s]||10,!0,h)]):[3,4];case 2:if(l=d.sent(),c=l===R.SUCCESS?"info":"warn",this.logger[c](P.L_REJOIN_CHATROOM_R,JSON.stringify({code:l,timestamp:new Date().getTime()}),h),l===R.SUCCESS)return this._watcher.chatroom({rejoinedRoom:{chatroomId:s,count:e[s]}}),[2];l===R.RC_CHATROOM_USER_KICKED&&(this._joinedChrmManager.remove(s),delete this._chrmsQueue[s]),this._watcher.chatroom({rejoinedRoom:{chatroomId:s,errorCode:l}}),d.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},n.prototype._pullChrmMsg=function(e,r,i){return r===void 0&&(r=10),i===void 0&&(i=0),L(this,void 0,void 0,function(){var o,s,h,l,c,d,_,v,I,T,a,u,p;return M(this,function(f){switch(f.label){case 0:return this._isConnected?(o=this._chrmsQueue[e],s=o.pulling,h=o.timestamp,s?[2]:(o.pulling=!0,l=this._connMgr.codec.encodeChrmSyncMsg(i?0:h,r),c=new X(V[V.chrmPull],l,e),this.logger.info(P.L_PULL_CHATROOM_MSG_T,JSON.stringify({chatroomId:e,timestamp:h})),[4,this._connMgr.send(c,ie,{connectedTime:this._connMgr.getConnectedTime(),currentUserId:this.currentUserId})])):[2];case 1:return d=f.sent(),_=d.code,v=d.data,o.pulling=!1,_===R.SUCCESS&&v?(I=v.list,T=v.syncTime,a=v.finished,o.timestamp=i?Math.max(T,i):T,o.queue=o.queue.filter(function(E){return E>T}),u=[],p=[],I.forEach(function(E){E.sentTime<h||(u.push(E.messageUId),p.push(E))}),this._batchMessage(p),this.logger.info(P.L_PULL_CHATROOM_MSG_R,JSON.stringify({code:_,timestamp:h,messageUIds:u.join(",")})),(!a||o.queue.length>0)&&this._pullChrmMsg(e),[2]):(this.logger.warn(P.L_PULL_CHATROOM_MSG_R,JSON.stringify({code:_,timestamp:h,messageUIds:""})),[2])}})})},n.prototype.joinChatroom=function(e,r,i){return L(this,void 0,void 0,function(){return M(this,function(o){return[2,this._joinChrm(e,r,!1,i)]})})},n.prototype.joinExistChatroom=function(e,r,i){return L(this,void 0,void 0,function(){return M(this,function(o){return[2,this._joinChrm(e,r,!0,i)]})})},n.prototype.quitChatroom=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h;return M(this,function(l){switch(l.label){case 0:return this._isConnected?(r=this._connMgr,i=r.codec.encodeJoinOrQuitChatRoom(),o=new X(la,i,e),[4,r.send(o)]):[2,R.RC_NET_UNAVAILABLE];case 1:return s=l.sent(),(h=s.code)===R.SUCCESS&&(delete this._chrmsQueue[e],this._chrmEntryHandler.reset(e),this._joinedChrmManager.remove(e)),[2,h]}})})},n.prototype.getChatroomInfo=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return this._isConnected?(o=this._connMgr,s=o.codec.encodeGetChatRoomInfo(r,i),h=new X(V[V.queryChrmI],s,e),[4,o.send(h,Tn)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return l=_.sent(),c=l.code,d=l.data,c!==R.SUCCESS?[2,{code:c}]:[2,{code:c,data:d}]}})})},n.prototype.getChatroomHistoryMessages=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_;return M(this,function(v){switch(v.label){case 0:return this._isConnected?(s=this._connMgr,h=s.codec.encodeGetHistoryMsg(e,{timestamp:r,count:i,order:o}),l=new X(vo,h,e),[4,s.send(l,oe,{conversation:{targetId:e}})]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return c=v.sent(),d=c.code,_=c.data,d!==R.SUCCESS?[2,{code:d}]:[2,{code:d,data:{list:_.list,hasMore:_.hasMore}}]}})})},n.prototype._modifyChatroomKV=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d,_,v;return M(this,function(I){switch(I.label){case 0:return this._isConnected?(o=(i=this)._connMgr,s=i.currentUserId,h=this._chrmEntryHandler.getVersion(e,r.key),r.version=h??this.getServerTime(),l=o.codec.encodeModifyChatRoomKV(e,r,s),c=r.type===Ct.UPDATE?ha:da,d=new X(c,l,e),[4,o.send(d,Ne)]):[2,R.RC_NET_UNAVAILABLE];case 1:return _=I.sent(),(v=_.code)===R.SUCCESS?(this._chrmEntryHandler.setLocal(e,{kvEntries:[r],syncTime:this.getServerTime()},s),[2,v]):[2,v]}})})},n.prototype._chatroomKVStoreNotAllSuccess=function(e,r){var i=r.data,o=e;return i&&Array.isArray(i.errorKeys)&&i.errorKeys.forEach(function(s){var h=o.findIndex(function(l){return s.key===l.key});h!==-1&&o.splice(h,1)}),o},n.prototype._modifyChatroomKVS=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d,_,v,I,T,a,u=this;return M(this,function(p){switch(p.label){case 0:return this._isConnected?(o=(i=this)._connMgr,s=i.currentUserId,r.entries.forEach(function(f){var E=u._chrmEntryHandler.getVersion(e,f.key);f.version=E??u.getServerTime()}),h=o.codec.encodeModifyChatRoomKVS(e,r,s),l=r.type===Ct.UPDATE?ga:pa,c=new X(l,h,e),[4,o.send(c,qr)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return d=p.sent(),_=d.code,[R.SUCCESS,R.CHATROOM_KV_STORE_NOT_ALL_SUCCESS].indexOf(_)!==-1&&(I=[],delete(T=Z({},r)).entries,r.entries.forEach(function(f){I.push(Z(Z({},f),T))}),_===R.CHATROOM_KV_STORE_NOT_ALL_SUCCESS&&(a=d.data,v=a.errorKeys,I=this._chatroomKVStoreNotAllSuccess(I,d)),this._chrmEntryHandler.setLocal(e,{kvEntries:I,syncTime:new Date().getTime()},s)),[2,{code:_,data:v}]}})})},n.prototype.setChatroomEntry=function(e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return r.type=Ct.UPDATE,r.userId=r.userId||this.currentUserId,[2,this._modifyChatroomKV(e,r)]})})},n.prototype.setChatroomEntries=function(e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return r.type=Ct.UPDATE,r.userId=r.userId||this.currentUserId,[2,this._modifyChatroomKVS(e,r)]})})},n.prototype.forceSetChatroomEntry=function(e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return r.type=Ct.UPDATE,r.isOverwrite=!0,r.userId=r.userId||this.currentUserId,[2,this._modifyChatroomKV(e,r)]})})},n.prototype.removeChatroomEntry=function(e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return r.type=Ct.DELETE,r.userId=r.userId||this.currentUserId,[2,this._modifyChatroomKV(e,r)]})})},n.prototype.removeChatroomEntries=function(e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return r.type=Ct.DELETE,r.userId=r.userId||this.currentUserId,[2,this._modifyChatroomKVS(e,r)]})})},n.prototype.forceRemoveChatroomEntry=function(e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return r.type=Ct.DELETE,r.isOverwrite=!0,r.userId=r.userId||this.currentUserId,[2,this._modifyChatroomKV(e,r)]})})},n.prototype.getChatroomEntry=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return(i=this._chrmEntryHandler.getValue(e,r))?[2,{code:R.SUCCESS,data:i}]:this._isConnected?(o=this._connMgr,s=o.codec.encodePullChatRoomKV(0),h=new X(V[V.pullKV],s,e),[4,o.send(h,ae)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return l=_.sent(),(c=l.data)&&c.kvEntries&&c.kvEntries.length&&(d=c.kvEntries.find(function(v){return v.key===r}),d!==void 0)?[2,{code:R.SUCCESS,data:d==null?void 0:d.value}]:[2,{code:R.CHATROOM_KEY_NOT_EXIST}]}})})},n.prototype.getAllChatroomEntry=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l;return M(this,function(c){switch(c.label){case 0:return(r=this._chrmEntryHandler.getAll(e))&&Object.keys(r).length?[2,{code:R.SUCCESS,data:r}]:this._isConnected?(i=this._connMgr,r={},o=i.codec.encodePullChatRoomKV(0),s=new X(V[V.pullKV],o,e),[4,i.send(s,ae)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return h=c.sent(),(l=h.data)&&l.kvEntries&&l.kvEntries.length&&l.kvEntries.forEach(function(d){d.key&&(r[d.key]=d.value||"")}),[2,{code:R.SUCCESS,data:r}]}})})},n.prototype.pullChatroomEntry=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d,_,v,I,T,a=this;return M(this,function(u){switch(u.label){case 0:return this._isConnected?(o=(i=this)._connMgr,s=i.currentUserId,h=o.codec.encodePullChatRoomKV(r),l=new X(V[V.pullKV],h,e),this.logger.info(P.L_PULL_CHATROOM_KV_T,JSON.stringify({chatroomId:e,timestamp:r})),[4,o.send(l,ae)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return c=u.sent(),d=c.code,_=c.data,v=d===R.SUCCESS?"info":"warn",this.logger[v](P.L_PULL_CHATROOM_KV_R,JSON.stringify({code:d,timestamp:r})),d===R.SUCCESS&&_?(I=_.kvEntries,T=[],I.length>0&&(I.forEach(function(p){var f=p.key,E=p.value,m=p.type,y=p.timestamp,N=p.userId;a._chrmEntryHandler.getValue(e,f)===E&&N===a.getCurrentUserId()||T.push({key:f,value:E,type:m,timestamp:y,chatroomId:e})}),this._chrmEntryHandler.setLocal(e,_,s),T.length>0&&this._watcher.chatroom({updatedEntries:T})),[2,{code:d,data:_}]):[2,{code:d}]}})})},n.prototype._startSyncIntervalForChrmPull=function(){var e=this;this._stopSyncIntervalForChrmPull(),this._intervalTimerForChrmPull=setInterval(function(){var r=Object.keys(e._chrmsQueue);r.length!==0&&e._isConnected?r.forEach(function(i){e._pullChrmMsg(i),e.getNaviInfoFromCache().kvStorage&&e._chrmEntryHandler.pullEntry(i,0)}):e._stopSyncIntervalForChrmPull()},Qo)},n.prototype._stopSyncIntervalForChrmPull=function(){typeof this._intervalTimerForChrmPull!="number"&&(clearInterval(this._intervalTimerForChrmPull),this._intervalTimerForChrmPull=-1)},n.prototype.sendMessage=function(e,r,i,o,s){return L(this,void 0,void 0,function(){var h,l,c,d,_,v,I,T,a,u,p;return M(this,function(f){switch(f.label){case 0:return this._isConnected?(i=function(E,m){var y=E.messageType;if(y==="RC:SRSMsg"&&Object.assign(E,{directionalUserIdList:[m]}),y===nt.READ_RECEIPT_RESPONSE&&E.content.receiptMessageDic)for(var N in E.directionalUserIdList=[],E.content.receiptMessageDic)E.directionalUserIdList.push(N);return E}(i,this.currentUserId),i=this._handleMsgProperties(i,!0),h=!![B.PRIVATE,B.GROUP].includes(e)&&i.isStatusMessage,l=h?function(E){var m;return(m={},m[B.PRIVATE]=V.ppMsgS,m[B.GROUP]=V.pgMsgS,m)[E]}(e):function(E){var m;return(m={},m[B.PRIVATE]=V.ppMsgP,m[B.GROUP]=V.pgMsgP,m[B.CHATROOM]=V.chatMsg,m[B.CUSTOMER_SERVICE]=V.pcMsgP,m[B.RTC_ROOM]=V.prMsgS,m[B.SYSTEM]=V.pbMsgP,m)[E]}(e)||V.ppMsgP,h&&(i.isPersited=!1,i.isCounted=!1),c=i.messageId?i.messageId:Di(),i.messageId=c,d=this._connMgr.codec.encodeUpMsg({conversationType:e,targetId:r},i),(_=new Ft(V[l],d,e===B.SYSTEM?this.currentUserId:r)).setHeaderQos(Et.AT_LEAST_ONCE),h?(this._connMgr.sendOnly(_),[2,{code:R.SUCCESS,data:Fe(e,r,Z({},i),"",0,this.currentUserId,c)}]):(v=this._connMgr.getCrtServerTime(),I=Fe(e,r,Z({},i),"",v,this.currentUserId,c),o==null||o(c),this.logger.info(P.L_SEND_MSG_T,JSON.stringify({messageType:i.messageType,conversationType:e,targetId:r,channelId:i.channelId}),s),[4,this._connMgr.send(_)])):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return T=f.sent(),a=T.code,u=T.data,a!==R.SUCCESS?(this.logger.warn(P.L_SEND_MSG_R,JSON.stringify({code:a,messageUId:I.messageUId,messageId:I.messageId}),s),I.sentStatus=ce.FAILED,[2,{code:a,data:I}]):(this.logger.info(P.L_SEND_MSG_R,JSON.stringify({code:a,messageUId:u==null?void 0:u.messageUId,messageId:u==null?void 0:u.messageId}),s),p=u,this._sendMessageStore.setMessage(p.messageUId,p.timestamp),I.sentTime=p.timestamp,I.messageUId=p.messageUId,this._conversationManager.setConversationCacheByMessage(I,!0),[2,{code:R.SUCCESS,data:I}])}})})},n.prototype.recallMsg=function(e,r,i,o,s){var h;return L(this,void 0,void 0,function(){var l,c,d,_,v,I,T,a,u,p,f,E,m;return M(this,function(y){switch(y.label){case 0:return this._isConnected?(l=s.user,c=s.extra,d=s.isDelete,_={conversationType:e,targetId:r,messageUId:i,sentTime:o,channelId:s.channelId||"",isDelete:d||!1},l&&(_.user=l),c&&(_.extra=c),v={content:_,messageType:"RC:RcCmd",disableNotification:s==null?void 0:s.disableNotification,pushConfig:s==null?void 0:s.pushConfig,pushContent:((h=s.pushConfig)===null||h===void 0?void 0:h.pushContent)||s.pushContent||"",channelId:s.channelId},I=V[V.recallMsg],T=this._connMgr.codec.encodeUpMsg({conversationType:e,targetId:r},v),(a=new Ft(I,T,this.currentUserId)).setHeaderQos(Et.AT_LEAST_ONCE),[4,this._connMgr.send(a)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return u=y.sent(),p=u.code,f=u.data,e===B.ULTRA_GROUP&&this.logger.debug(P.L_RECALL_ULTRA_MSG_S,JSON.stringify({code:p,conversationType:e,targetId:r,channelId:s.channelId})),p!==R.SUCCESS?[2,{code:p}]:(E=f,e===B.ULTRA_GROUP?(this._ultraMsgMap[E.messageUId]=E.timestamp,this._updateUltraGroupWhenRecallMsg(r,s.channelId||"",i),[2,{code:R.SUCCESS}]):(this._sendMessageStore.setMessage(E.messageUId,E.timestamp),m=Fe(e,r,Z(Z({},v),{isPersited:!0}),E.messageUId,E.timestamp,this.currentUserId),this._conversationManager.setConversationCacheByMessage(m,!0),[2,{code:R.SUCCESS,data:m}]))}})})},n.prototype.sendReadReceiptMessage=function(e,r,i){return L(this,void 0,void 0,function(){var o,s;return M(this,function(h){return this._isConnected?(o=this._connMgr.codec.encodeReadReceipt(r,i),s=new X(V[V.rrMsg],o,e),[2,this._connMgr.send(s)]):[2,{code:R.RC_NET_UNAVAILABLE}]})})},n.prototype.getMessageReader=function(e,r,i){return L(this,void 0,void 0,function(){var o,s;return M(this,function(h){return this._isConnected?(o=this._connMgr.codec.encodeMessageReader(r,i),s=new X(V[V.rrList],o,e),[2,this._connMgr.send(s,Cn)]):[2,{code:R.RC_NET_UNAVAILABLE}]})})},n.prototype.pullUserSettings=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h;return M(this,function(l){switch(l.label){case 0:return this._isConnected?(r=this._connMgr.codec.encodePullUserSetting(e),i=new X(V[V.pullUS],r,this.currentUserId),[4,this._connMgr.send(i,mn)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return o=l.sent(),s=o.code,h=o.data,s===R.SUCCESS&&this._naviChangeHandler(h),[2,{code:s,data:h}]}})})},n.prototype._naviChangeHandler=function(e){var r;if(e){var i=e.settings,o=(r=i==null?void 0:i.VoipInfo)===null||r===void 0?void 0:r.value;if(o){var s=this._connMgr.getToken();this.navi.updateVoipCallInfo(s,o);var h=this.navi.getNaviInfoFromCache(s);this._watcher.onNaviDataChange(Z({},h))}}else this.logger.warn(P.L_NOTIFY_NAVI_CHANGE_E,JSON.stringify({data:e}))},n.prototype.getFileToken=function(e,r,i,o,s){return L(this,void 0,void 0,function(){var h,l,c,d,_,v,I,T,a;return M(this,function(u){switch(u.label){case 0:return this._isConnected?(h=o&&o!=="uploads"?r||"":ls(e,r),l=this.getNaviInfoFromCache(),c=Vi(l,this.logger),d={uploadDomain:c,env:this._environment},_=this._connMgr.codec.encodeGetFileToken(e,h,i||"",o||"",s||"",JSON.stringify(d)),v=new X(V[V.qnTkn],_,this.currentUserId),[4,this._connMgr.send(v,Gr)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return I=u.sent(),T=I.code,a=I.data,a=Z(Z({},a),{fileName:h,downloadAuthInfo:a.downloadAuthInfo?JSON.parse(a.downloadAuthInfo):null}),T===R.SUCCESS?[2,{code:T,data:a}]:[2,{code:T}]}})})},n.prototype.getFileUrl=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_,v,I,T,a,u;return M(this,function(p){switch(p.label){case 0:return this._isConnected?(s="",h="",l="",c="",r===te.QINIU?(h=kr,l=xr):(h=Br,l=Fr),r===te.QINIU?s=V[V.qnUrl]:r===te.AWS?s=V[V.s3Url]:r===te.STC?s=V[V.stcUrl]:r===te.MINIO?(s=V[V.minioUrl],c=Vi(this.getNaviInfoFromCache(),this.logger)):s=V[V.aliUrl],d={url:c},_=this._connMgr.codec.encodeGetFileUrl(h,e,i,o,JSON.stringify(d)),v=new X(s,_,this.currentUserId),[4,this._connMgr.send(v,l)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return I=p.sent(),T=I.code,a=I.data,u=a,T===R.SUCCESS?[2,{code:T,data:u}]:[2,{code:T}]}})})},n.prototype.disconnect=function(){return L(this,void 0,void 0,function(){return M(this,function(e){switch(e.label){case 0:return this.reporter.stop(),this.reporterStatistic.stop(),[4,this._connMgr.disconnect()];case 1:return e.sent(),this._resetMemoryState(),[2]}})})},n.prototype._resetMemoryState=function(){this._reconnectTimer!==-1&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=-1),this._pullQueue.length=0,this._stopSyncInterval(),this.resetUltraGroupData(),this._joinedChrmManager&&(this._joinedChrmManager.clear(),delete this._joinedChrmManager),this._conversationManager&&delete this._conversationManager,this._ultraGroupManager&&delete this._ultraGroupManager,this._userSettingManager&&delete this._userSettingManager,this._chrmsQueue={}},n.prototype.resetUltraGroupData=function(){this._stopUltraSyncInterval(),this._lastSyncUltraMsgTimeStamp=0,this._lastSyncUltraMsgLocalTimeStamp=0,this._isUltraPulling=!1,this._ultraGroupTimeQue=[],this._isUltraGroupListExist=!1,this._ultraGroupMap={}},n.prototype.registerMessageType=function(e,r,i,o,s){this._customMessageType[e]={isPersited:r,isCounted:i,isStatusMessage:s}},n.prototype.getServerTime=function(){return this._connMgr.getCrtServerTime()},n.prototype.getCurrentUserId=function(){return this.currentUserId},n.prototype.createTag=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return this._isConnected?(r=this._userSettingManager.getVersion(),i=this._connMgr.codec.encodeCreateTag([e],r),o=new X(V[V.addSeTag],i,this.currentUserId),[4,this._connMgr.send(o,ue)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return s=d.sent(),h=s.code,l=s.data,h!==R.SUCCESS?[2,{code:h}]:(c=l.version,this._userSettingManager.addTag([Z(Z({},e),{createdTime:c})],c),[2,{code:R.SUCCESS}])}})})},n.prototype.removeTag=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return this._isConnected?(r=this._userSettingManager.getVersion(),i=this._connMgr.codec.encodeRemoveTag([e],r),o=new X(V[V.delSeTag],i,this.currentUserId),[4,this._connMgr.send(o,ue)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return s=d.sent(),h=s.code,l=s.data,h!==R.SUCCESS?[2,{code:h}]:(c=l.version,this._userSettingManager.deleteTag([e],c),[2,{code:R.SUCCESS}])}})})},n.prototype.updateTag=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return this._isConnected?(r=this._userSettingManager.getVersion(),i=this._connMgr.codec.encodeCreateTag([e],r),o=new X(V[V.addSeTag],i,this.currentUserId),[4,this._connMgr.send(o,ue)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return s=d.sent(),h=s.code,l=s.data,h!==R.SUCCESS?[2,{code:h}]:(c=l.version,this._userSettingManager.addTag([e],c),[2,{code:R.SUCCESS}])}})})},n.prototype.getTagList=function(){return L(this,void 0,void 0,function(){var e,r;return M(this,function(i){return e=this._userSettingManager.getTags(),r=this._conversationManager.getConversationListForTag(),e.forEach(function(o){o.conversationCount=r[o.tagId]?r[o.tagId].length:0}),[2,{code:R.SUCCESS,data:e}]})})},n.prototype.addTagForConversations=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l=this;return M(this,function(c){switch(c.label){case 0:return this._isConnected?this._userSettingManager.getTagById(e)?(i=this._connMgr.codec.encodeUpdateConversationTag([{tagId:e}],r),o=new X(V[V.addTag],i,this.currentUserId),[4,this._connMgr.send(o)]):[2,{code:R.TAG_NOT_EXIST}]:[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return(s=c.sent().code)!==R.SUCCESS?[2,{code:s}]:((h={})[e]={},r.forEach(function(d){l._conversationManager.addTagStatus(d.conversationType,d.targetId,h,d.channelId)}),[2,{code:R.SUCCESS}])}})})},n.prototype.removeTagForConversations=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h=this;return M(this,function(l){switch(l.label){case 0:return this._isConnected?(i=this._connMgr.codec.encodeUpdateConversationTag([{tagId:e}],r),o=new X(V[V.delTag],i,this.currentUserId),[4,this._connMgr.send(o)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return(s=l.sent().code)!==R.SUCCESS?[2,{code:s}]:(r.forEach(function(c){h._conversationManager.deleteTagStatus(c.conversationType,c.targetId,[e],c.channelId)}),[2,{code:R.SUCCESS}])}})})},n.prototype.removeTagsForConversation=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return this._isConnected?(i=e.conversationType,o=e.targetId,s=e.channelId,h=r.map(function(v){return{tagId:v}}),l=this._connMgr.codec.encodeUpdateConversationTag(h,[e]),c=new X(V[V.delTag],l,this.currentUserId),[4,this._connMgr.send(c)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return(d=_.sent().code)!==R.SUCCESS?[2,{code:d}]:(this._conversationManager.deleteTagStatus(i,o,r,s),[2,{code:R.SUCCESS}])}})})},n.prototype.getConversationListByTag=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c,d,_,v,I;return M(this,function(T){switch(T.label){case 0:return this._isConnected?(s=(o=this).currentUserId,h=o._connMgr,l=h.codec.encodeOldConversationList({count:i,type:B.PRIVATE,startTime:r}),c=new X(Hi,l,s),[4,h.send(c,se,{currentUserId:s,connectedTime:h.getConnectedTime()})]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return d=T.sent(),_=d.code,v=d.data,_!==R.SUCCESS?[2,{code:_}]:(I=this._conversationHasTagFilter(e,v==null?void 0:v.list),[2,{code:_,data:I}])}})})},n.prototype._conversationHasTagFilter=function(e,r){var i=this,o=[],s=[];function h(l,c){return l.latestMessage&&c.latestMessage?l.latestMessage.sentTime-c.latestMessage.sentTime:0}return r.forEach(function(l){var c=l.conversationType,d=l.targetId,_=l.channelId,v=i._conversationManager.get(c,d,_),I=v.hasMentioned,T=v.mentionedInfo,a=v.lastUnreadTime,u=v.notificationStatus,p=v.isTop,f=v.tags,E=v.unreadMessageCount,m=f&&f[e];if(m){var y=Z(Z({},l),{hasMentioned:I,mentionedInfo:T,lastUnreadTime:a,notificationStatus:u,isTop:p,unreadMessageCount:E});m.isTop?o.push(Z(Z({},y),{isTopInTag:!0})):s.push(Z(Z({},y),{isTopInTag:!1}))}}),o.sort(h),s.sort(h),vt(vt([],o,!0),s,!0)},n.prototype.getUnreadCountByTag=function(e,r){return L(this,void 0,void 0,function(){var i;return M(this,function(o){return this._isConnected?(i=this._conversationManager.getUnreadCountByTag(e,r),[2,{code:R.SUCCESS,data:i}]):[2,{code:R.RC_NET_UNAVAILABLE}]})})},n.prototype.setConversationStatusInTag=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c,d,_,v,I,T;return M(this,function(a){switch(a.label){case 0:return this._isConnected?(o=r.targetId,s=r.conversationType,h=r.channelId,l=i.isTop,c=[{tagId:e,isTop:l}],(d=this._conversationManager.get(s,o,h)).tags&&Object.hasOwnProperty.call(d.tags,e)?(_=this._connMgr.codec.encodeUpdateConversationTag(c,[r]),v=new X(V[V.addTag],_,this.currentUserId),[4,this._connMgr.send(v)]):[2,{code:R.NO_TAG_IN_CONVER}]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return(I=a.sent().code)!==R.SUCCESS?[2,{code:I}]:((T={})[e]={},l&&(T[e].isTop=!0),this._conversationManager.addTagStatus(s,o,T,h),[2,{code:R.SUCCESS}])}})})},n.prototype.getTagsForConversation=function(e){var r;return L(this,void 0,void 0,function(){var i,o,s,h;return M(this,function(l){if(!this._isConnected)return[2,{code:R.RC_NET_UNAVAILABLE}];if(i=this._conversationManager.get(e.conversationType,e.targetId,e.channelId),o=this._userSettingManager.getTagsInfo(),s=[],i.tags)for(h in i.tags)s.push({tagId:h,tagName:(r=o[h])===null||r===void 0?void 0:r.tagName});return[2,{code:R.SUCCESS,data:s}]})})},n.prototype.getBlockConversationList=function(){var e=this._conversationManager.getBlockConversationList();return Promise.resolve({code:R.SUCCESS,data:e})},n.prototype.getTopConversationList=function(e,r){var i=this._conversationManager.getTopConversationList(e,r);return Promise.resolve({code:R.SUCCESS,data:i})},n.prototype.getUnreadConversationList=function(e){return L(this,void 0,void 0,function(){var r;return M(this,function(i){return r=this._conversationManager.getUnreadConversationList(e),[2,Promise.resolve({code:R.SUCCESS,data:r})]})})},n.prototype.getUnreadMentionedCount=function(e){var r,i;return i=e.conversationType===B.ULTRA_GROUP?((r=this._ultraGroupMap["".concat(e.channelId,"_").concat(e.targetId)])===null||r===void 0?void 0:r.unreadMentionedCount)||0:this._conversationManager.getUnreadMentionedCount(e.conversationType,e.targetId,e.channelId),i=this._getUnreadCount(i),Promise.resolve({code:R.SUCCESS,data:i})},n.prototype.getAllUnreadMentionedCount=function(){var e=this._conversationManager.getAllUnreadMentionedCount();return Promise.resolve({code:R.SUCCESS,data:e})},n.prototype.getConversationNotificationLevel=function(e,r,i){if(!this._isUltraGroupListExist&&e===B.ULTRA_GROUP)return Promise.resolve({code:R.METHOD_NOT_AVAILABLE});var o;if(!(o=e===B.ULTRA_GROUP?this._ultraGroupManager.get(B.ULTRA_GROUP,r,i):this._conversationManager.get(e,r,i)))return Promise.resolve({code:R.SUCCESS,data:Ht.NOT_SET});var s=o.notificationLevel;return ot(o.notificationLevel)&&!ot(o.notificationStatus)&&(s=Rt.OPEN===o.notificationStatus?1:0),Promise.resolve({code:R.SUCCESS,data:s})},n.prototype.getConversationNotificationStatus=function(e,r,i){var o;return(o=e===B.ULTRA_GROUP?this._ultraGroupManager.get(B.ULTRA_GROUP,r,i):this._conversationManager.get(e,r,i))?Promise.resolve({code:R.SUCCESS,data:o.notificationStatus}):Promise.resolve({code:R.SUCCESS,data:Rt.CLOSE})},n.prototype.getRemoteHistoryMessages=function(e,r,i,o,s,h){return this.getHistoryMessage(e,r,i,o,s,h)},n.prototype.getUltraGroupList=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h=this;return M(this,function(l){return r=e.targetId,i=e.channelType,this._isUltraGroupListExist?(o=(o=Object.values(this._ultraGroupMap).filter(function(c){return!(c.targetId!==r&&r||c.channelType!==i&&Ce(i))})).map(function(c){var d=c.unreadMessageCount,_=c.unreadMentionedCount,v=c.unreadMentionedMeCount;return d=h._getUnreadCount(d),_=h._getUnreadCount(_),v=h._getUnreadCount(v),Z(Z({},c),{unreadMessageCount:d,unreadMentionedCount:_,unreadMentionedMeCount:v})}),o=He(o),s=xt(o),[2,{code:R.SUCCESS,data:s}]):[2,{code:R.METHOD_NOT_AVAILABLE}]})})},n.prototype._getUnreadCount=function(e){return e>999?999:e},n.prototype.getBlockUltraGroupList=function(){if(!this._isUltraGroupListExist)return Promise.resolve({code:R.METHOD_NOT_AVAILABLE});var e=Object.values(this._ultraGroupMap),r=[];return e.forEach(function(i){(i.notificationStatus===Rt.OPEN||i.notificationLevel>0)&&r.push({conversationType:B.ULTRA_GROUP,targetId:i.targetId,channelId:i.channelId})}),Promise.resolve({code:R.SUCCESS,data:r})},n.prototype.getTopUltraGroupList=function(){if(!this._isUltraGroupListExist)return Promise.resolve({code:R.METHOD_NOT_AVAILABLE});var e=Object.values(this._ultraGroupMap),r=[];return e.forEach(function(i){i.isTop===!0&&r.push({conversationType:B.ULTRA_GROUP,targetId:i.targetId,channelId:i.channelId})}),Promise.resolve({code:R.SUCCESS,data:r})},n.prototype.getUltraGroupUnreadMentionedCountByTargetId=function(e,r){if(!this._isUltraGroupListExist)return Promise.resolve({code:R.METHOD_NOT_AVAILABLE});var i=0;for(var o in this._ultraGroupMap)o.match(/_.*/g)[0].substring(1)!==e||r&&r.length!==0&&!r.includes(this._ultraGroupMap[o].notificationLevel)||(i+=this._ultraGroupMap[o].unreadMentionedCount);return i=this._getUnreadCount(i),Promise.resolve({code:R.SUCCESS,data:i})},n.prototype.getUltraGroupUnreadCountByTargetId=function(e,r){var i=0;for(var o in this._ultraGroupMap){var s=this._ultraGroupMap[o];s.targetId!==e||r&&r.length!==0&&!r.includes(this._ultraGroupMap[o].notificationLevel)||(i+=s.unreadMessageCount||0)}return i=this._getUnreadCount(i),Promise.resolve({code:R.SUCCESS,data:i})},n.prototype.getUltraGroupUnreadInfoList=function(e){var r=this;if(!this._isUltraGroupListExist)return Promise.resolve({code:R.METHOD_NOT_AVAILABLE});var i=[];return Object.keys(this._ultraGroupMap).forEach(function(o){var s=r._ultraGroupMap[o];e.includes(s.targetId)&&i.push({type:s.conversationType,targetId:s.targetId,channelId:s.channelId,unreadMessageCount:r._getUnreadCount(s.unreadMessageCount),mentionedCount:r._getUnreadCount(s.unreadMentionedCount),mentionedMeCount:r._getUnreadCount(s.unreadMentionedMeCount),notificationLevel:s.notificationLevel})}),Promise.resolve({code:R.SUCCESS,data:i})},n.prototype.getAllUltraGroupUnreadCount=function(e){if(e===void 0&&(e=!1),!this._isUltraGroupListExist)return Promise.resolve({code:R.METHOD_NOT_AVAILABLE});var r=0;for(var i in this._ultraGroupMap)r+=e?this._ultraGroupMap[i].unreadMentionedCount||0:this._ultraGroupMap[i].unreadMessageCount||0;return r=this._getUnreadCount(r),Promise.resolve({code:R.SUCCESS,data:r})},n.prototype.clearUltraUnreadcount=function(e,r){return r===void 0&&(r=""),L(this,void 0,void 0,function(){var i,o,s,h,l;return M(this,function(c){switch(c.label){case 0:return this._isUltraGroupListExist?this._isConnected?(i=this.getServerTime(),o=this._connMgr.codec.encodeClearUnreadCount({conversationType:B.ULTRA_GROUP,targetId:e,channelId:r},{timestamp:i}),(s=new Ft(V[V.updUgRTime],o,this.currentUserId)).setHeaderQos(Et.AT_LEAST_ONCE),[4,this._connMgr.send(s)]):[2,R.RC_NET_UNAVAILABLE]:[2,Promise.resolve(R.METHOD_NOT_AVAILABLE)];case 1:return(h=c.sent().code)===R.SUCCESS&&((l=this._ultraGroupMap["".concat(r,"_").concat(e)])&&(l.unreadMessageCount=0,l.unreadMentionedCount=0,l.unreadMentionedMeCount=0,l.lastReadTime=i),l.firstUnreadMessage&&(l.firstUnreadMessage=null)),[2,h]}})})},n.prototype._getUltraGroupList=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d,_,v,I,T,a,u=this;return M(this,function(p){switch(p.label){case 0:return this._isConnected?(r=this._connMgr.codec.encodeUltraGroup(e,!1),i=new X(V[V.pullUgSes],r,this.currentUserId),[4,this._connMgr.send(i,se,{currentUserId:this.currentUserId,conversationType:B.ULTRA_GROUP})]):[2];case 1:return o=p.sent(),s=o.code,h=o.data,s===R.SUCCESS&&h?(c=h.list,d=h.isFinished,c.forEach(function(f){f.notificationStatus=Rt.CLOSE,f.notificationLevel=Ht.NOT_SET,f.isTop=!1,u._ultraGroupMap["".concat(f.channelId,"_").concat(f.targetId)]=f,u._ultraGroupManager.addUltraGroupStatus(f)}),d!==!1?[3,2]:(_=c.length>0&&c[c.length-1].versionTime||0,this._getUltraGroupList(_),[3,4])):(this.logger.warn(P.L_ULTRA_SYNC_DONE_S,"Pull ultra group conversation failured, code: ".concat(s,", try again")),l=setTimeout(function(){u._getUltraGroupList(e),clearTimeout(l)},3e3),[2]);case 2:return this.logger.info(P.L_ULTRA_SYNC_DONE_S,"Pull ultra group conversation success"),[4,this.pullConversationStatus(0)];case 3:v=p.sent(),I=v.code,T=v.data,I!==R.SUCCESS&&this.logger.warn(P.O,"pullConversationStatus fail code: ".concat(I,", data: ").concat(T)),a=Object.values(this._ultraGroupMap),a=He(a),this._isUltraGroupListExist=!0,this._watcher.ultraGroupEnable(xt(a)),this._syncUltraMsg(this._lastSyncUltraMsgTimeStamp),p.label=4;case 4:return[2]}})})},n.prototype._startUltraSyncInterval=function(){var e=this,r=function(){e._ultraGroupTimer=setTimeout(function(){Date.now()-e._lastSyncUltraMsgLocalTimeStamp>=18e4&&e._syncUltraMsg(e._lastSyncUltraMsgTimeStamp),e._stopUltraSyncInterval(),r()},3e4)};this._lastSyncUltraMsgLocalTimeStamp=Date.now(),r()},n.prototype._stopUltraSyncInterval=function(){this._ultraGroupTimer!==-1&&(clearTimeout(this._ultraGroupTimer),this._ultraGroupTimer=-1)},n.prototype._notificationOnline=function(){return L(this,void 0,void 0,function(){var e,r,i,o=this;return M(this,function(s){switch(s.label){case 0:return this._isConnected?[4,this._fetchUltraMsg(0)]:[2];case 1:return e=s.sent(),r=e.code,i=e.data,r===R.SUCCESS&&i?(this.logger.info(P.L_NOTIFY_ULTRA_ONLINE_S,"Notify ultra group online success."),this._getUltraGroupList(0),this._ultraGroupTimer===-1&&this._startUltraSyncInterval(),[2]):(this.logger.warn(P.L_NOTIFY_ULTRA_ONLINE_S,"Notify ultra group online failured, try again."),setTimeout(function(){o._notificationOnline()},3e3),[2])}})})},n.prototype._fetchUltraMsg=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d,_;return M(this,function(v){switch(v.label){case 0:return r=this._connMgr.codec.encodeSuperSyncMsg(e),i=new X(V[V.pullUgMsg],r,this.currentUserId),o=this.logger.createTraceId(),this.logger.info(P.L_PULL_ULTRA_MSG_T,JSON.stringify({timestamp:e}),o),[4,this._connMgr.send(i,ie,{currentUserId:this.currentUserId,conversation:{conversationType:B.ULTRA_GROUP}})];case 1:return s=v.sent(),h=s.code,l=s.data,h===R.SUCCESS&&l?(c=l.list,d=l.syncTime,_=c.map(function(I){return I.messageUId}).join(","),this.logger.info(P.L_PULL_ULTRA_MSG_R,JSON.stringify({code:h,messageUIds:_,timestamp:e,syncTime:d}),o)):this.logger.warn(P.L_PULL_ULTRA_MSG_R,JSON.stringify({code:h,timestamp:e}),o),[2,{code:h,data:l}]}})})},n.prototype._getUltraGroup=function(e,r,i){var o,s,h,l=e.targetId,c=e.messageType,d=e.channelId,_=e.isCounted,v=e.channelType,I=e.sentTime,T=e.senderUserId,a=e.content,u=e.isMentioned,p=this._ultraGroupMap["".concat(d,"_").concat(l)],f=p||{conversationType:B.ULTRA_GROUP,targetId:l,channelId:d,unreadMessageCount:0,unreadMentionedCount:0,unreadMentionedMeCount:0,notificationStatus:Rt.CLOSE,notificationLevel:Ht.NOT_SET,isTop:!1};return _&&T!==this.currentUserId&&c!==nt.RECALL&&(f.unreadMessageCount+=1,f.unreadMentionedCount+=r,f.firstUnreadMessage||(f.firstUnreadMessage={sentTime:I}),u&&((o=a==null?void 0:a.mentionedInfo)===null||o===void 0?void 0:o.type)!==me.ALL&&(!((h=(s=a==null?void 0:a.mentionedInfo)===null||s===void 0?void 0:s.userIdList)===null||h===void 0)&&h.includes(this.currentUserId))&&(f.unreadMentionedMeCount+=1)),f.versionTime=i,f.latestMessage=e,f.channelType=v,p||(this._ultraGroupMap["".concat(d,"_").concat(l)]=f),f},n.prototype._syncUltraMsg=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d,_,v=this;return M(this,function(I){switch(I.label){case 0:return!this._isConnected||this._isUltraPulling?[2]:(this._isUltraPulling=!0,[4,this._fetchUltraMsg(e)]);case 1:return r=I.sent(),i=r.code,o=r.data,this._lastSyncUltraMsgLocalTimeStamp=Date.now(),this._isUltraPulling=!1,i===R.SUCCESS&&o?(s=o.list,h=o.syncTime,l=o.finished,c={},d=[],s.forEach(function(T){var a,u,p,f=T.targetId,E=T.content,m=T.messageUId,y=T.channelId,N=T.isMentioned;if(v._ultraMsgMap[m])delete v._ultraMsgMap[m];else{var A=0;N&&(((a=E==null?void 0:E.mentionedInfo)===null||a===void 0?void 0:a.type)===me.ALL||!((p=(u=E==null?void 0:E.mentionedInfo)===null||u===void 0?void 0:u.userIdList)===null||p===void 0)&&p.includes(v.currentUserId))&&(A=1);var K=v._getUltraGroup(T,A,h);c["".concat(y,"_").concat(f)]=K,v._ultraGroupManager.addUltraGroupStatus(K),d.push(T)}}),Object.keys(c).length>0&&(this.logger.debug(P.O,"notice ultragroups"),_=Object.values(c),_=He(_),this._watcher.conversation(xt(_))),this.logger.debug(P.O,"notice ultragroup message"),this._batchMessage(d),this._ultraGroupTimeQue=this._ultraGroupTimeQue.filter(function(T){return T>h}),this._lastSyncUltraMsgTimeStamp=h,l?(this._ultraGroupTimeQue.length>0&&(this._ultraGroupTimeQue.length=0,this._syncUltraMsg(h)),[2]):(this._syncUltraMsg(h),[2])):[2]}})})},n.prototype.sendUltraMessage=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_,v,I,T,a,u;return M(this,function(p){switch(p.label){case 0:return this._isConnected?(r.messageType==="RC:SRSMsg"&&this.logger.warn(P.O,"ultra group -> direction message convert to message"),r=this._handleMsgProperties(r,!0),s=r.messageId?r.messageId:Di(),r.messageId=s,h=this._connMgr.codec.encodeUpMsg({conversationType:B.ULTRA_GROUP,targetId:e},r),(l=new Ft(V[V.ugMsg],h,e)).setHeaderQos(Et.AT_LEAST_ONCE),c=this._connMgr.getCrtServerTime(),d=Fe(B.ULTRA_GROUP,e,Z({},r),"",c,this.currentUserId,s),i&&i(s),this.logger.info(P.L_SEND_MSG_T,JSON.stringify({messageType:r.messageType,conversationType:B.ULTRA_GROUP,targetId:e,channelId:r.channelId}),o),[4,this._connMgr.send(l)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return _=p.sent(),v=_.code,I=_.data,v!==R.SUCCESS?(this.logger.warn(P.L_SEND_MSG_R,JSON.stringify({code:v,messageUId:d.messageUId,messageId:d.messageId}),o),d.sentStatus=ce.FAILED,[2,{code:v,data:d}]):(this.logger.info(P.L_SEND_MSG_R,JSON.stringify({code:v,messageUId:I==null?void 0:I.messageUId,messageId:I==null?void 0:I.messageId}),o),T=I,d.sentTime=T.timestamp,d.messageUId=T.messageUId,this._ultraMsgMap[T.messageUId]=T.timestamp,a=r.channelId||"",(u=this._ultraGroupMap["".concat(a,"_").concat(e)])?(u.latestMessage=d,Ce(u.channelType)&&(d.channelType=u.channelType)):(u={conversationType:B.ULTRA_GROUP,targetId:e,channelId:a,unreadMessageCount:0,unreadMentionedCount:0,versionTime:d.sentTime,latestMessage:d,notificationStatus:Rt.CLOSE,notificationLevel:Ht.NOT_SET,isTop:!1},this._ultraGroupMap["".concat(a,"_").concat(e)]=u,this._ultraGroupManager.addUltraGroupStatus(u)),this._watcher.conversation(xt([u])),[2,{code:v,data:d}])}})})},n.prototype.sendUltraGroupTypingStatus=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return this._isConnected?(i=e.conversationType,o=e.channelId,s=e.targetId,h=this._connMgr.codec.encodeOperateStatus(s,i,o||"",r||0),(l=new Ft(V[V.operate],h,s)).setHeaderQos(Et.AT_LEAST_ONCE),[4,this._connMgr.send(l)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return(c=d.sent().code)!==R.SUCCESS?[2,{code:c,msg:R[c]}]:[2,{code:c}]}})})},n.prototype.getUltraGroupMessageListByMessageUId=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return this._isConnected?e.messages&&e.messages.length<1||e.messages&&e.messages.length>20?[2,{code:R.MSG_LIMIT_ERROR}]:(r={},e.messages.forEach(function(_){r[_.messageUId]=void 0}),i=this._connMgr.codec.encodeMsgQuery(e),(o=new X(V[V.qryMsg],i,this.currentUserId)).setHeaderQos(Et.AT_LEAST_ONCE),[4,this._connMgr.send(o,Me,{connectedTime:this._connMgr.getConnectedTime(),currentUserId:this.currentUserId})]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return s=d.sent(),h=s.code,l=s.data,h!==R.SUCCESS?[2,{code:h,msg:R[h]}]:(c=(l||{}).list,Array.isArray(c)&&c.forEach(function(_){var v=_.messageUId;r[v]=_}),[2,{code:0,data:r}])}})})},n.prototype._pullOperateStatusNotify=function(e){if(this._isConnected){var r=this._connMgr.codec.decodeByPBName(e.data,Sn),i=r.conversationType,o=r.info,s=r.summary;this.logger.debug(P.O,"s_opNtf -> type: ".concat(i,", info: ").concat(o,", summary: ").concat(s)),this._watcher.operateStatus(r)}},n.prototype.expandUltraMessage=function(e){return L(this,void 0,void 0,function(){var r,i,o;return M(this,function(s){switch(s.label){case 0:return this._isConnected?(r=this._connMgr.codec.encodeExpandUltraMessage(e,this.currentUserId),(i=new X(V[V.upMsgEx],r,e.targetId)).setHeaderQos(Et.AT_LEAST_ONCE),[4,this._connMgr.send(i)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return(o=s.sent().code)!==R.SUCCESS?[2,{code:o,msg:R[o]}]:[2,{code:o}]}})})},n.prototype.modifyMessage=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l;return M(this,function(c){switch(c.label){case 0:return this._isConnected?(r=this._connMgr.codec.encodemodifyMessage(e,this.currentUserId),(i=new X(V[V.modifyMsg],r,e.targetId)).setHeaderQos(Et.AT_LEAST_ONCE),[4,this._connMgr.send(i)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return o=c.sent(),s=o.code,h=o.data,s!==R.SUCCESS?[2,{code:s,msg:R[s]}]:(l=h,this._ultraMsgMap[l.messageUId]=l.timestamp,[2,{code:s}])}})})},n.prototype._pullUltraChangeMessageList=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d,_,v;return M(this,function(I){switch(I.label){case 0:return this._isConnected?this._isPullingUltraChangeMessage?[2]:(this._isPullingUltraChangeMessage=!0,r=this._connMgr.codec.encodeQueryMsgChange(e),(i=new X(V[V.qryMsgChange],r,this.currentUserId)).setHeaderQos(Et.AT_LEAST_ONCE),[4,this._connMgr.send(i,Rn)]):[2];case 1:return o=I.sent(),s=o.code,h=o.data,this._isPullingUltraChangeMessage=!1,s===R.SUCCESS&&h?(l=h.hasNext,c=h.list,d=(h==null?void 0:h.syncTime)||0,this._handleUltraChangeList(c),_=this._pullUltraChangeMessageQue.filter(function(T){return T>d}),this._pullUltraChangeMessageQue.length=0,(v=this._pullUltraChangeMessageQue).push.apply(v,_),l?this._pullUltraChangeMessageList(d):this._lastPullingUltraChangeMessageTime=d,[2]):[2]}})})},n.prototype._handleUltraChangeList=function(e){var r={};e.forEach(function(c){var d=c.changeType;r[d]||(r[d]=[]),r[d].push(c)});var i=Ut.CHANNEL_CHANGE,o=Ut.MSG_RECALL,s=Ut.MSG_EXPANSION,h=Ut.MSG_MODIFY,l=Ut.USER_GROUP_CHANGE;r[i]&&this._handleUltraChannelChange(r[i]),r[o]&&this._handleMsgRecall(r[o]),r[s]&&this._handleMsgUpdate(r[s]),r[h]&&this._handleMsgUpdate(r[h]),r[l]&&this._handleUserGroupStatus(r[l])},n.prototype._handleUltraChannelChange=function(e){var r=this,i=[],o=[],s=[];e.forEach(function(h){var l=h.subChangeType,c=h.targetId,d=h.channelId,_=h.sendTime,v=h.operatorId,I="".concat(d,"_").concat(c),T=r._ultraGroupMap[I];if(T){var a=Kt.PUBLIC_TO_PRIVATE,u=Kt.PRIVATE_TO_PUBLIC,p=Kt.PUBLIC_TO_PRIVATE_USER_NOT_IN,f=Kt.CHANNEL_DELETE,E=Kt.CHANNEL_USER_KICKED;switch(l){case u:T.channelType=kt.PUBLIC,i.push({targetId:c,channelId:d,changeType:pe.PRIVATE_TO_PUBLIC,channelType:T.channelType});break;case a:T.channelType=kt.PRIVATE,i.push({targetId:c,channelId:d,changeType:pe.PUBLIC_TO_PRIVATE,channelType:T.channelType});break;case p:i.push({targetId:c,channelId:d,changeType:pe.PUBLIC_TO_PRIVATE_USER_NOT_IN,channelType:T.channelType}),delete r._ultraGroupMap[I];break;case f:o.push({targetId:c,channelId:d,channelType:T.channelType,deleteTime:_}),delete r._ultraGroupMap[I];break;case E:s.push({targetId:c,channelId:d,userId:v,channelType:kt.PRIVATE}),v===r.currentUserId&&delete r._ultraGroupMap[I]}}}),i.length>0&&this._watcher.ultraGroupChannelChangeType(i),o.length>0&&this._watcher.ultraGroupChannelDelete(o),s.length>0&&this._watcher.ultraGroupChannelUserKicked(s)},n.prototype._handleMsgRecall=function(e){var r=this,i=[];e.forEach(function(o){var s=o.targetId,h=o.channelId,l=o.messageUId,c=o.sendTime,d=o.conversationType,_=o.operatorId,v=o.mentionedType;r._updateUltraGroupWhenRecallMsg(s,h,l,c,v),i.push({targetId:s,conversationType:d,sentTime:c,messageUId:l,senderUserId:_,channelId:h,content:{conversationType:d,targetId:s,messageUId:l,channelId:h},messageDirection:1,messageType:nt.RECALL,isOffLineMessage:!1,receivedTime:Date.now(),isPersited:!1,isCounted:!1,isMentioned:!1,disableNotification:!1,isStatusMessage:!1,canIncludeExpansion:!1,expansion:null,receivedStatus:0})}),this._watcher.ultraGroupMessageRecalled(i)},n.prototype._handleMsgUpdate=function(e){var r={};for(var i in e.forEach(function(l){var c=l.targetId,d=l.conversationType,_=l.sendTime,v=l.messageUId,I=l.channelId,T="".concat(d,"_").concat(c);r[T]||(r[T]=[]),r[T].push({messageUId:v,channelId:I,sendTime:_})}),r){var o=i.split("_"),s=o.shift(),h=o.join("_");this._pullUltraMessageList(e[0].changeType,{targetId:h,conversationType:Number(s),messages:vt([],r[i],!0)})}},n.prototype._pullUltraMessageList=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d,_=this;return M(this,function(v){switch(v.label){case 0:return this._isConnected?(i=this._connMgr.codec.encodeMsgQuery(r),(o=new X(V[V.qryMsg],i,this.currentUserId)).setHeaderQos(Et.AT_LEAST_ONCE),[4,this._connMgr.send(o,Me,{connectedTime:this._connMgr.getConnectedTime(),currentUserId:this.currentUserId})]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return s=v.sent(),h=s.code,l=s.data,h!==R.SUCCESS?[2,{code:h,msg:R[h]}]:(c=(l||{}).list,d=[],Array.isArray(c)&&c.forEach(function(I){var T=I.targetId,a=I.channelId,u=I.messageUId,p=_._ultraGroupMap["".concat(a,"_").concat(T)];p&&p.latestMessage.messageUId===u&&(p.latestMessage=I),d.push(I)}),e===Ut.MSG_EXPANSION&&this._watcher.ultraGroupMessageExpansionUpdated(d),e===Ut.MSG_MODIFY&&this._watcher.ultraGroupMessageModified(d),[2])}})})},n.prototype._handleUserGroupStatus=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d,_,v,I;return M(this,function(T){return r=qt.REMOVE_USER_GROUP,i=qt.JOIN_USER_GROUP,o=qt.EXIT_USER_GROUP,s=qt.CHANNEL_BIND_USER_GROUP,h=qt.CHANNEL_UNBIND_USER_GROUP,l=[],c=[],d=[],_=[],v=[],e.forEach(function(a){var u=a.conversationType,p=a.targetId,f=a.userGroupIds,E=a.busChannelType,m=a.channelId;switch(a.subChangeType){case r:l.push({conversation:{conversationType:u,targetId:p},userGroupIds:f});break;case i:c.push({conversation:{conversationType:u,targetId:p},userGroupIds:f});break;case o:d.push({conversation:{conversationType:u,targetId:p},userGroupIds:f});break;case s:_.push({conversation:{conversationType:u,targetId:p,channelId:m},channelType:E,userGroupIds:f});break;case h:v.push({conversation:{conversationType:u,targetId:p,channelId:m},channelType:E,userGroupIds:f})}}),I={},l.length>0&&(I.userGroupDisband=l),c.length>0&&(I.userAdded=c),d.length>0&&(I.userRemoved=d),_.length>0&&(I.userGroupBindChannel=_),v.length>0&&(I.userGroupUnBindChannel=v),this._watcher.userGroupStatus(I),[2]})})},n.prototype.getUltraHistoryMsg=function(e,r,i){var o;return L(this,void 0,void 0,function(){var s,h,l,c,d,_;return M(this,function(v){switch(v.label){case 0:return this._isConnected?(s=this._connMgr.codec.encodeGetHistoryMsg(e,r),h=new X(V[V.qryUgMsg],s,this.currentUserId),this.logger.info(P.L_GET_HISTORY_MSG_T,JSON.stringify({targetId:e,conversationType:B.ULTRA_GROUP,channelId:r.channelId,timestamp:r==null?void 0:r.timestamp,count:r==null?void 0:r.count}),i),[4,this._connMgr.send(h,oe,{currentUserId:this.currentUserId,conversation:{conversationType:B.ULTRA_GROUP,targetId:e}})]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return l=v.sent(),c=l.code,d=l.data,c===R.SUCCESS&&d?(_=[],(o=d.list)===null||o===void 0||o.forEach(function(I){I&&_.push(I.messageUId)}),this.logger.info(P.L_GET_HISTORY_MSG_R,JSON.stringify({code:c,messageUIds:_.join(",")}),i),[2,{code:c,data:d}]):(this.logger.warn(P.L_GET_HISTORY_MSG_R,JSON.stringify({code:c,messageUIds:""}),i),[2,{code:c}])}})})},n.prototype.setUltraGroupDefaultNotificationLevel=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l;return M(this,function(c){switch(c.label){case 0:return this._isUltraGroupListExist?this._isConnected?(o=this._connMgr.codec.encodeSetUltraGroupDefaultNotificationLevel(r,i),s=new X(V[V.ugUnpushSet],o,e),[4,this._connMgr.send(s)]):[2,{code:R.RC_NET_UNAVAILABLE}]:[2,Promise.resolve({code:R.METHOD_NOT_AVAILABLE})];case 1:return h=c.sent(),l=h.code,R.SUCCESS,[2,{code:l}]}})})},n.prototype.getUltraGroupDefaultNotificationLevel=function(e,r){return L(this,void 0,void 0,function(){var i,o,s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return this._isUltraGroupListExist?this._isConnected?(i=this._connMgr,o=i.codec.encodeGetUltraGroupDefaultNotificationLevel(r),s=new X(V[V.ugUnpushQuery],o,e),[4,i.send(s,$r)]):[2,{code:R.RC_NET_UNAVAILABLE}]:[2,Promise.resolve({code:R.METHOD_NOT_AVAILABLE})];case 1:return h=_.sent(),l=h.code,c=h.data,l===R.SUCCESS&&c?(d=c.unpushLevel,[2,{code:l,data:d}]):[2,{code:l}]}})})},n.prototype._updateUltraGroupWhenRecallMsg=function(e,r,i,o,s){var h="".concat(r,"_").concat(e);if(this._ultraGroupMap[h]){var l=this._ultraGroupMap[h],c=l.latestMessage,d=l.lastReadTime;c&&c.messageUId===i&&(l.latestMessage=null),o&&d<o&&l.unreadMessageCount>0&&(--l.unreadMessageCount,(s===fe.ALL||s===fe.ME)&&l.unreadMentionedCount>0&&--l.unreadMentionedCount,s===fe.ME&&l.unreadMentionedCount>0&&--l.unreadMentionedMeCount,this._watcher.conversation(xt([l])))}},n.prototype.getAllConversationState=function(){return Promise.resolve({code:R.SUCCESS,data:this._conversationManager.getAllConversationState()})},n.prototype.getUltraGroupUnreadMentionedMessages=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h;return M(this,function(l){switch(l.label){case 0:return this._isConnected?this._isUltraGroupListExist?(r=this._connMgr.codec.encodeUnreadMentionedMsgQuery(e),i=new X(V[V.qryUgUal],r,this.currentUserId),[4,this._connMgr.send(i,zr)]):[2,Promise.resolve({code:R.METHOD_NOT_AVAILABLE})]:[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return o=l.sent(),s=o.code,h=o.data,s===R.SUCCESS&&h?[2,{code:s,data:h}]:[2,{code:s}]}})})},n.prototype.getUltraGroupFirstUnreadMessageTimestamp=function(e){return L(this,void 0,void 0,function(){var r,i,o,s;return M(this,function(h){return this._isConnected?this._isUltraGroupListExist?(r=e.targetId,i=e.channelId,o=this._ultraGroupMap["".concat(i,"_").concat(r)]||{},s=o.firstUnreadMessage||null,[2,{code:R.SUCCESS,data:s}]):[2,Promise.resolve({code:R.METHOD_NOT_AVAILABLE})]:[2,{code:R.RC_NET_UNAVAILABLE}]})})},n.prototype.bindRTCRoomForChatroom=function(e){return L(this,void 0,void 0,function(){var r,i,o,s;return M(this,function(h){switch(h.label){case 0:return this._isConnected?(r=e.chatRoomId,i=this._connMgr.codec.encodebindRTCRoomForChatroom(e),o=new X(V[V.setRtcRoomId],i,r),[4,this._connMgr.send(o)]):[2,R.RC_NET_UNAVAILABLE];case 1:return s=h.sent(),[2,s.code]}})})},n.prototype.rtcSignaling=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return this._isConnected?(s=o instanceof ArrayBuffer?Array.prototype.slice.call(new Int8Array(o)):o,h=i?new X(r,s,e):new Ft(r,s,e),[4,this._connMgr.send(h)]):[2,{code:R.RC_NET_UNAVAILABLE}];case 1:return l=_.sent(),c=l.code,d=l.data,[2,{code:c,buffer:d==null?void 0:d.data}]}})})},n.prototype.rtcPing=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return o=We(this.rtcCodec,r,i),[4,this.rtcSignaling(e,V[V.rtcPing],!0,o)];case 1:return s=d.sent(),h=s.code,l=s.buffer,h!==R.SUCCESS?[2,{code:h}]:((c=this.rtcCodec.decode(F.RtcOutput,l)).version=ut(c.version),[2,{code:h,data:c}])}})})},n.prototype.getDeviceId=function(){return yr(this.runtime)},n.prototype.getOSInfo=function(){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,{code:R.NOT_SUPPORT}]})})},n.prototype.getProcessInfo=function(){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,{code:R.NOT_SUPPORT}]})})},n.prototype.getMainProcessInfo=function(){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,{code:R.NOT_SUPPORT}]})})},n.prototype.destroy=function(){Ys(),ou()},n.prototype.callExtra=function(e){return Promise.resolve({code:R.EXTRA_METHOD_UNDEFINED})},n.prototype.getConversationListWithAllChannel=function(){throw new Error("Method not implemented.")},n.prototype.getConversationListWithAllChannelByPage=function(e,r){throw new Error("Method not implemented.")},n.prototype.getConversationsByPage=function(e,r,i,o,s){throw new Error("Method not implemented.")},n.prototype.getHistoryMessagesByObjectNames=function(e,r,i,o,s,h,l){throw new Error("Method not implemented.")},n.prototype.clearConversations=function(){throw new Error("Method not implemented.")},n.prototype.setUserStatusListener=function(e,r){throw new Error("Method not implemented.")},n.prototype.setUserStatus=function(e){throw new Error("Method not implemented.")},n.prototype.subscribeUserStatus=function(e){throw new Error("Method not implemented.")},n.prototype.getUserStatus=function(e){throw new Error("Method not implemented.")},n.prototype.addToBlacklist=function(e){return Promise.resolve(R.NOT_SUPPORT)},n.prototype.removeFromBlacklist=function(e){return Promise.resolve(R.NOT_SUPPORT)},n.prototype.getBlacklist=function(){return Promise.resolve({code:R.NOT_SUPPORT})},n.prototype.getBlacklistStatus=function(e){return Promise.resolve({code:R.NOT_SUPPORT})},n.prototype.insertMessage=function(e,r,i){throw new Error("Method not implemented.")},n.prototype.batchInsertMessage=function(e,r){throw new Error("Method not implemented.")},n.prototype.getMessageCount=function(e,r,i){throw new Error("Method not implemented.")},n.prototype.deleteMessages=function(e){throw new Error("Method not implemented.")},n.prototype.deleteMessagesByTimestamp=function(e,r,i,o,s){throw new Error("Method not implemented.")},n.prototype.clearMessages=function(e,r,i){throw new Error("Method not implemented.")},n.prototype.getMessage=function(e){throw new Error("Method not implemented.")},n.prototype.setMessageContent=function(e,r,i){throw new Error("Method not implemented.")},n.prototype.setMessageSearchField=function(e,r,i){throw new Error("Method not implemented.")},n.prototype.searchConversationByContent=function(e,r,i,o){throw new Error("Method not implemented.")},n.prototype.searchConversationByContentWithAllChannel=function(e,r,i){throw new Error("Method not implemented.")},n.prototype.searchMessageByContent=function(e,r,i,o,s,h){throw new Error("Method not implemented.")},n.prototype.searchMessagesByUser=function(e,r,i,o,s,h){throw new Error("Method not implemented.")},n.prototype.searchMessageByContentWithAllChannel=function(e,r,i,o,s){throw new Error("Method not implemented.")},n.prototype.searchMessageByContentInTimeRangeWithAllChannel=function(e,r,i,o,s,h,l){throw new Error("Method not implemented.")},n.prototype.getUnreadMentionedMessages=function(e,r){throw new Error("Method not implemented.")},n.prototype.setMessageSentStatus=function(e,r){throw new Error("Method not implemented.")},n.prototype.updateMessageReceiptStatus=function(e,r,i,o){throw new Error("Method not implemented.")},n.prototype.setMessageReceivedStatus=function(e,r){throw new Error("Method not implemented.")},n.prototype.clearData=function(){throw new Error("Method not implemented.")},n.prototype.clearUnreadCountByTimestamp=function(e,r,i,o){throw new Error("Method not implemented.")},n.prototype.setCallInfo=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return(o=this._connMgr)?(s=o.codec.encodeSetCallInfo(r,i),[4,o.send(new X(Ea,s,e),li)]):[3,2];case 1:return h=d.sent(),l=h.code,c=h.data,l===R.SUCCESS&&c?[2,Promise.resolve({code:l,data:{key:c.key,value:c.dataContent}})]:[2,Promise.resolve({code:l})];case 2:return[2,Promise.resolve({code:R.RC_NET_CHANNEL_INVALID})]}})})},n.prototype.getGroupMessageDeliverList=function(e,r,i){throw new Error("Method not implemented.")},n.prototype.getPrivateMessageDeliverTime=function(e,r){throw new Error("Method not implemented.")},n.prototype.setCheckDuplicateMessage=function(e){throw new Error("Method not implemented.")},n.prototype.setProxy=function(e){return Promise.resolve({code:R.NOT_SUPPORT})},n.prototype.getProxy=function(){return Promise.resolve({code:R.NOT_SUPPORT})},n.prototype.testProxy=function(e,r){return Promise.resolve({status:R.NOT_SUPPORT})},n.prototype.setNetwork=function(e,r){this._connMgr.setNetwork(e,r)},n}(Fs),Eu=function(t){function n(){return t!==null&&t.apply(this,arguments)||this}return dt(n,t),n.prototype.joinRTCRoom=function(e,r,i,o,s,h){return L(this,void 0,void 0,function(){var l,c,d,_,v;return M(this,function(I){switch(I.label){case 0:return l=We(this._context.rtcCodec,r,i,o,s,h),[4,this.rtcSignaling(e,vs,!0,l)];case 1:return c=I.sent(),d=c.code,_=c.buffer,d===R.SUCCESS&&_&&(v=xe(this._context.rtcCodec,_)),[2,{code:d,data:v}]}})})},n.prototype.quitRTCRoom=function(e){return L(this,void 0,void 0,function(){var r;return M(this,function(i){switch(i.label){case 0:return r=this._context.rtcCodec.encode(F.SetUserStatusInput,{status:0}),[4,this.rtcSignaling(e,Ts,!0,r)];case 1:return[2,i.sent().code]}})})},n.prototype.rtcPing=function(e,r,i){return L(this,void 0,void 0,function(){return M(this,function(o){switch(o.label){case 0:return[4,this._context.rtcPing(e,r,i)];case 1:return[2,o.sent().code]}})})},n.prototype.rtcPingResVersion=function(e,r,i){return this._context.rtcPing(e,r,i)},n.prototype.getRTCRoomInfo=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h;return M(this,function(l){switch(l.label){case 0:return r=this._context.rtcCodec.encode(F.RtcQueryListInput,{order:2}),[4,this.rtcSignaling(e,ms,!0,r)];case 1:return i=l.sent(),o=i.code,s=i.buffer,o===R.SUCCESS&&s&&(h=this._context.rtcCodec.decode(F.RtcRoomInfoOutput,s)),[2,{code:o,data:h}]}})})},n.prototype.getRTCUserInfoList=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l;return M(this,function(c){switch(c.label){case 0:return r=this._context.rtcCodec.encode(F.RtcQueryListInput,{order:2}),[4,this.rtcSignaling(e,ys,!0,r)];case 1:return i=c.sent(),o=i.code,s=i.buffer,o===R.SUCCESS&&s&&(l=xe(this._context.rtcCodec,s),h={users:l.users}),[2,{code:o,data:h}]}})})},n.prototype.getRTCUserInfo=function(e){throw new Error("Method not implemented.")},n.prototype.setRTCUserInfo=function(e,r,i){return L(this,void 0,void 0,function(){var o;return M(this,function(s){switch(s.label){case 0:return o=this._context.rtcCodec.encode(F.RtcValueInfo,{key:r,value:i}),[4,this.rtcSignaling(e,Is,!0,o)];case 1:return[2,s.sent().code]}})})},n.prototype.removeRTCUserInfo=function(e,r){return L(this,void 0,void 0,function(){var i;return M(this,function(o){switch(o.label){case 0:return i=this._context.rtcCodec.encode(F.RtcKeyDeleteInput,{key:r}),[4,this.rtcSignaling(e,Cs,!1,i)];case 1:return[2,o.sent().code]}})})},n.prototype.setRTCData=function(e,r,i,o,s,h){return L(this,void 0,void 0,function(){var l;return M(this,function(c){switch(c.label){case 0:return l=this._context.rtcCodec.encode(F.RtcSetDataInput,{interior:o,target:s,key:r,value:i,objectName:h==null?void 0:h.name,content:h==null?void 0:h.content}),[4,this.rtcSignaling(e,Rs,!1,l)];case 1:return[2,c.sent().code]}})})},n.prototype.setRTCTotalRes=function(e,r,i,o,s){return s===void 0&&(s=""),L(this,void 0,void 0,function(){var h,l;return M(this,function(c){switch(c.label){case 0:return h={objectName:o,content:this._context.rtcCodec.encode(F.RtcValueInfo,{key:r.name,value:r.content},!0),valueInfo:[this._context.rtcCodec.encode(F.RtcValueInfo,{key:"uris",value:i},!0),this._context.rtcCodec.encode(F.RtcValueInfo,{key:"mcu_uris",value:s},!0)]},l=this._context.rtcCodec.encode(F.RtcUserSetDataInput,h),[4,this.rtcSignaling(e,cr,!0,l)];case 1:return[2,c.sent().code]}})})},n.prototype.setRTCCDNUris=function(e,r,i){return L(this,void 0,void 0,function(){var o;return M(this,function(s){switch(s.label){case 0:return o=this._context.rtcCodec.encode(F.RtcUserSetDataInput,{objectName:r,valueInfo:this._context.rtcCodec.encode(F.RtcValueInfo,{key:"cdn_uris",value:i},!0)}),[4,this.rtcSignaling(e,cr,!0,o)];case 1:return[2,s.sent().code]}})})},n.prototype.getRTCData=function(e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_;return M(this,function(v){switch(v.label){case 0:return s=this._context.rtcCodec.encode(F.RtcDataInput,{interior:i,target:o,key:r}),[4,this.rtcSignaling(e,Ss,!0,s)];case 1:return h=v.sent(),l=h.code,c=h.buffer,l===R.SUCCESS&&c?(d=this._context.rtcCodec.decode(F.RtcQryOutput,c).outInfo,_={},d.forEach(function(I){_[I.key]=I.value}),[2,{code:l,data:_}]):[2,{code:l}]}})})},n.prototype.removeRTCData=function(e,r,i,o,s){return L(this,void 0,void 0,function(){var h;return M(this,function(l){switch(l.label){case 0:return h=this._context.rtcCodec.encode(F.RtcDataInput,{interior:i,target:o,key:r,objectName:s==null?void 0:s.name,content:s==null?void 0:s.content}),[4,this.rtcSignaling(e,Os,!1,h)];case 1:return[2,l.sent().code]}})})},n.prototype.setRTCOutData=function(e,r,i,o){return L(this,void 0,void 0,function(){return M(this,function(s){throw new Error("JSEngine's method not implemented.")})})},n.prototype.getRTCOutData=function(e,r){return L(this,void 0,void 0,function(){return M(this,function(i){throw new Error("JSEngine's method not implemented.")})})},n.prototype.getRTCToken=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return o=We(this._context.rtcCodec,r,i),[4,this.rtcSignaling(e,Ns,!0,o)];case 1:return s=d.sent(),h=s.code,l=s.buffer,h===R.SUCCESS&&l?(c=this._context.rtcCodec.decode(F.RtcTokenOutput,l).rtcToken,[2,{code:h,data:{rtcToken:c}}]):[2,{code:h}]}})})},n.prototype.setRTCState=function(e,r){return L(this,void 0,void 0,function(){var i;return M(this,function(o){switch(o.label){case 0:return i=this._context.rtcCodec.encode(F.MCFollowInput,{state:r}),[4,this.rtcSignaling(e,Ms,!0,i)];case 1:return[2,o.sent().code]}})})},n.prototype.getRTCUserList=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h;return M(this,function(l){switch(l.label){case 0:return r=this._context.rtcCodec.encode(F.RtcQueryListInput,{order:2}),[4,this.rtcSignaling(e,Ls,!0,r)];case 1:return i=l.sent(),o=i.code,s=i.buffer,o===R.SUCCESS&&s?(h=xe(this._context.rtcCodec,s),[2,{code:o,data:h}]):[2,{code:o}]}})})},n.prototype.joinLivingRoomAsAudience=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c,d,_;return M(this,function(v){switch(v.label){case 0:return o=We(this._context.rtcCodec,r,i),[4,this.rtcSignaling(e,Us,!0,o)];case 1:return s=v.sent(),h=s.code,l=s.buffer,h===R.SUCCESS&&l?(c=this._context.rtcCodec.decode(F.RtcViewerJoinedOutput,l),d=c.rtcToken,_=c.entries,[2,{code:h,data:{token:d,kvEntries:_}}]):[2,{code:h}]}})})},n.prototype.quitLivingRoomAsAudience=function(e){return L(this,void 0,void 0,function(){var r,i;return M(this,function(o){switch(o.label){case 0:return r=this._context.rtcCodec.encode(F.SetUserStatusInput,{status:0}),[4,this.rtcSignaling(e,As,!0,r)];case 1:return i=o.sent().code,this._context.rtcKVManager.reset(),[2,i]}})})},n.prototype.rtcIdentityChange=function(e,r,i){return L(this,void 0,void 0,function(){var o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return o=this._context.rtcCodec.encode(F.RtcInput,{roomType:ir.LIVE,broadcastType:i,identityChangeType:r,needSysChatroom:!1}),[4,this.rtcSignaling(e,bs,!0,o)];case 1:return s=d.sent(),h=s.code,l=s.buffer,h===R.SUCCESS&&l?(c=xe(this._context.rtcCodec,l),[2,{code:h,data:c}]):[2,{code:h}]}})})},n.prototype.requestRoomPK=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d;return M(this,function(_){switch(_.label){case 0:return r=e.invitedRoomId,i=e.invitedUserId,o=e.inviteSessionId,s=e.inviteTimeout,h=e.inviteInfo,l=e.roomId,c=this._context.rtcCodec.encode(F.RtcInviteInput,{invitedRoomId:r,invitedUserId:i,inviteSessionId:o,timeoutTime:s,inviteInfo:h}),[4,this.rtcSignaling(l,Ps,!0,c)];case 1:return d=_.sent().code,this._context.rtcKVManager.reset(),[2,d]}})})},n.prototype.cancelRoomPK=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return r=e.invitedRoomId,i=e.invitedUserId,o=e.inviteSessionId,s=e.inviteInfo,h=e.roomId,l=this._context.rtcCodec.encode(F.RtcCancelInviteInput,{invitedRoomId:r,invitedUserId:i,inviteSessionId:o,inviteInfo:s}),[4,this.rtcSignaling(h,Ds,!0,l)];case 1:return c=d.sent().code,this._context.rtcKVManager.reset(),[2,c]}})})},n.prototype.responseRoomPK=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c,d,_,v;return M(this,function(I){switch(I.label){case 0:return r=e.inviteUserId,i=e.inviteRoomId,o=e.inviteSessionId,s=e.content,h=e.key,l=e.value,c=e.agree,d=e.roomId,_=this._context.rtcCodec.encode(F.RtcInviteAnswerInput,{inviteUserId:r,inviteRoomId:i,inviteSessionId:o,content:s,key:h,value:l,answerCode:c?1:0}),[4,this.rtcSignaling(d,Vs,!0,_)];case 1:return v=I.sent().code,this._context.rtcKVManager.reset(),[2,v]}})})},n.prototype.endRoomPK=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h,l,c;return M(this,function(d){switch(d.label){case 0:return r=e.endRoomId,i=e.sessionId,o=e.content,s=e.keys,h=e.roomId,l=this._context.rtcCodec.encode(F.RtcEndInviteInput,{inviteRoomId:r,inviteSessionId:i,inviteContent:o,inviteRoomKeys:s}),[4,this.rtcSignaling(h,Gs,!0,l)];case 1:return c=d.sent().code,this._context.rtcKVManager.reset(),[2,c]}})})},n.prototype.registerRTCSignalListener=function(e){this._context.registerRTCSignalingListener(e)},n.prototype.rtcSignaling=function(e,r,i,o){return this._context.rtcSignaling(e,r,i,o)},n.prototype.getRTCJoinedUserInfo=function(e){return L(this,void 0,void 0,function(){var r,i,o,s,h;return M(this,function(l){switch(l.label){case 0:return r=this._context.rtcCodec.encode(F.RtcQueryUserJoinedInput,{userId:e}),[4,this.rtcSignaling("",ks,!0,r)];case 1:return i=l.sent(),o=i.code,s=i.buffer,o===R.SUCCESS&&s?(h=this._context.rtcCodec.decode(F.RtcQueryUserJoinedOutput,s).info||[],[2,{code:o,data:h.map(function(c){return{deviceId:c.deviceId,roomId:c.roomId,joinTime:ut(c.joinTime)}})}]):[2,{code:o}]}})})},n}(_o);function Kn(t){return Z({},t)}var Ou=function(){function t(n,e){var r,i;this._runtime=n,this._token="",this._pluginContextQueue=[],this._pluginInstanseMap={},this._versionInfo={},this._typingInfo={},this._compatibleMessageProccessor=((r={})[nt.CHATROOM_JOIN]=this._processChatrormMessage.bind(this),r[nt.CHATROOM_LEFT]=this._processChatrormMessage.bind(this),r[nt.CHATROOM_MERGE_CHANGE]=this._processChrmMemChangeMessage.bind(this),r[nt.TYPING_STATUS]=this._processTypingStatusMessage.bind(this),r[nt.INTERCEPT]=this._processInterceptMessage.bind(this),r[nt.CHATROOM_SYNC_MSG]=this._processChrmSyncMessage.bind(this),r[nt.CHATROOM_MERGE_BLOCK]=this._processChrmMemBlockMessage.bind(this),r[nt.CHATROOM_MERGE_BAN]=this._processChrmMemBanMessage.bind(this),r),this._messageProccessor=((i={})[nt.READ_RECEIPT]=this._processReadReceiptMessage.bind(this),i[nt.READ_RECEIPT_REQUEST]=this._processReadReceiptRequestMessage.bind(this),i[nt.READ_RECEIPT_RESPONSE]=this._processReadReceiptResponseMessage.bind(this),i),this._watcher={message:void 0,batchMessage:void 0,conversationState:void 0,chatroomState:void 0,connection:void 0,expansion:void 0,tag:void 0,conversationTagChanged:void 0,pullFinished:void 0,readReceiptReceived:void 0,messageReceiptRequest:void 0,messageReceiptResponse:void 0,typingState:void 0,messageBlocked:void 0,ultraGroupEnable:void 0,operateStatus:void 0,ultraGroupMessageExpansionUpdated:void 0,ultraGroupMessageModified:void 0,ultraGroupMessageRecalled:void 0,messageDelivered:void 0,groupMessageDeliveredStatus:void 0,ultraGroupChannelChangeType:void 0,ultraGroupChannelUserKicked:void 0,ultraGroupChannelDelete:void 0,userGroupStatus:void 0},this._typingInternalTimer=-1,this._typingExpireTime=2e3,this._typingChangedList=[],this._registerMessageSearchPropsMapping={},this.getChatRoomHistoryMessages=this.getChatroomHistoryMessages,this._options=Z({},e),this.appkey=this._options.appkey,this._options.typingExpireTime&&(this._options.typingExpireTime<2e3?this._typingExpireTime=2e3:this._options.typingExpireTime>6e3?this._typingExpireTime=6e3:this._typingExpireTime=this._options.typingExpireTime),this._options.navigators=this._options.navigators.map(function(s){return s.replace(/\/$/g,"")});var o={onConnected:this._onConnectionStatusChange.bind(this,it.CONNECTED),onConnecting:this._onConnectionStatusChange.bind(this,it.CONNECTING),onSuspend:this._onConnectionStatusChange.bind(this,it.SUSPENDED),onDisconnected:this._onConnectionStatusChange.bind(this,it.DISCONNECTED),batchMessage:this._batchMessageReceiver.bind(this),chatroom:this._chatroomInfoListener.bind(this),conversation:this._conversationInfoListener.bind(this),expansion:this._expansionInfoListener.bind(this),tag:this._tagListener.bind(this),conversationTag:this._conversationTagListener.bind(this),onRTCDataChange:this._rtcDataChange.bind(this),pullFinished:this._pullFinishedListener.bind(this),ultraGroupEnable:this._ultraGroupEnableListener.bind(this),operateStatus:this._operateStatusListener.bind(this),ultraGroupMessageExpansionUpdated:this._ultraGroupMessageExpansionUpdatedListener.bind(this),ultraGroupMessageModified:this._ultraGroupMessageModifiedListener.bind(this),ultraGroupMessageRecalled:this._ultraGroupMessageRecalledListener.bind(this),messageDelivered:this._messageDeliveredListerer.bind(this),groupMessageDeliveredStatus:this._groupMessageDeliveredStatusListerer.bind(this),callInfo:this._callInfoListener.bind(this),ultraGroupChannelChangeType:this._ultraGroupChannelChangeTypeListener.bind(this),ultraGroupChannelUserKicked:this._ultraGroupChannelUserKickedListener.bind(this),ultraGroupChannelDelete:this._ultraGroupChannelDeleteListener.bind(this),onNaviDataChange:this._naviDataChange.bind(this),userGroupStatus:this._userGroupStatusListener.bind(this)};this.rtcCodec=this.createCodec(Bs,xs),this._engine=_s()?new RCCppEngine(n,this.rtcCodec,o,this._options):new _u(n,this.rtcCodec,o,this._options),this.logger=this._engine.getInnerLogger(),this.rtcKVManager=new oo(this._engine)}return t.init=function(n,e){if(this._context)return this._context.logger.warn(P.A_INIT_REPEAT_O),this._context;this._context=new t(n,e),this._context.logger.info(P.L_INIT_O,JSON.stringify({appkey:e.appkey,navigators:e.navigators,typingExpireTime:e.typingExpireTime})),this._context.logger.warn(P.L_IMSDK_VER_O,JSON.stringify({commitId:"6d681dbc4c78eb23bb4ea2400eeadea4e5901f92",version:"5.8.2-enterprise.4"}));var r=this._context._engine;return n.setNetworkStatusListener(r.setNetwork.bind(r)),this._context},t.destroy=function(){return L(this,void 0,void 0,function(){return M(this,function(n){switch(n.label){case 0:return this._context?(this._context.logger.info(P.L_DESTROY_O),[4,this._context._destroy()]):[2];case 1:return n.sent(),this._context=void 0,[2]}})})},t.prototype.createCodec=function(n,e){return new Hs(n,e)},t.prototype.install=function(n,e){var r=this.logger.createTraceId();if(this.logger.info(P.L_INSTALL_PLUGIN_T,JSON.stringify({tag:n.tag}),r),this._pluginInstanseMap[n.tag])return this.logger.warn(P.L_INSTALL_PLUGIN_R,"repeat install",r),this._pluginInstanseMap[n.tag];var i=n.tag==="RCRTC"?new Eu(this):new _o(this),o=null;try{if(!n.verify(this._runtime))return null;o=n.setup(i,this._runtime,e)}catch(s){this.logger.error(P.L_INSTALL_PLUGIN_R,s==null?void 0:s.stack,r)}return["RCRTC","RCCall"].includes(n.tag)&&n.version&&n.name&&(this._versionInfo[n.name]=n.version),o&&(this._pluginContextQueue.push(i),this._pluginInstanseMap[n.tag]=o),o},t.prototype._onConnectionStatusChange=function(n,e){var r,i;this.logger.warn(P.A_CONNECT_S,"status: ".concat(n,", code: ").concat(e)),(i=(r=this._watcher).connection)===null||i===void 0||i.call(r,n,e),this._pluginContextQueue.forEach(function(o){var s;(s=o.onconnectionstatechange)===null||s===void 0||s.call(o,n,e)})},t.prototype._processChatrormMessage=function(n){var e;if(typeof this._watcher.chatroomState=="function")return this._watcher.chatroomState({userChange:{users:(e={},e[n.senderUserId]=n.messageType==="RC:ChrmQuitNtf"?vi.QUIT:vi.JOIN,e),chatroomId:n.targetId}}),!0},t.prototype._processChrmMemChangeMessage=function(n){if(typeof this._watcher.chatroomState=="function"){var e={};Array.isArray(n.content.userList)&&n.content.userList.forEach(function(r){e[r.userId]=r.status}),this._watcher.chatroomState({userChange:{users:e,chatroomId:n.targetId}})}return!0},t.prototype._processTypingStatusMessage=function(n){if(this._addTypingInfo(Kn(n)),this._watcher.typingState)return!0},t.prototype._processInterceptMessage=function(n){var e={conversationType:n.conversationType,targetId:n.targetId,channelId:n.channelId||"",blockType:n.content.interceptType,blockedMessageUId:n.content.msgUId,extra:n.content.extra};if(n.conversationType===B.ULTRA_GROUP){var r=n.content.sourceType;if(e.sourceType=r,(r===Ze.MSG_EXPANSION||r===Ze.MSG_MODIFY)&&n.content.sourceContent)try{e.sourceContent=JSON.parse(n.content.sourceContent)}catch(i){this.logger.warn(P.L_CALLBACK_E,JSON.stringify({source:"message.content.sourceContent",msg:i.message}))}}return this._MessageBlockedListener(e),!0},t.prototype._processChrmSyncMessage=function(n){return typeof this._watcher.chatroomState=="function"&&this._watcher.chatroomState({chatroomNotifyMultiLoginSync:{chatroomId:n.content.chatroomId,status:n.content.status,reason:n.content.reason,time:n.content.time,extra:n.content.extra||null}}),!0},t.prototype._processChrmMemBlockMessage=function(n){return typeof this._watcher.chatroomState=="function"&&this._watcher.chatroomState({chatroomNotifyBlock:{chatroomId:n.content.chatroomId,operateType:n.content.operateType,durationTime:n.content.durationTime,operateTime:n.content.operateTime,userIdList:n.content.userList,extra:n.content.extra||null}}),!0},t.prototype._processChrmMemBanMessage=function(n){return typeof this._watcher.chatroomState=="function"&&this._watcher.chatroomState({chatroomNotifyBan:{chatroomId:n.content.chatroomId,banType:n.content.operateType,durationTime:n.content.durationTime,operateTime:n.content.operateTime,userIdList:n.content.userList,extra:n.content.extra||null}}),!0},t.prototype._processReadReceiptMessage=function(n){typeof this._watcher.readReceiptReceived=="function"&&this._watcher.readReceiptReceived({conversationType:n.conversationType,targetId:n.targetId,channelId:n.channelId},n.content.messageUId,n.content.lastMessageSendTime)},t.prototype._processReadReceiptRequestMessage=function(n){typeof this._watcher.messageReceiptRequest=="function"&&this._watcher.messageReceiptRequest({conversationType:n.conversationType,targetId:n.targetId,channelId:n.channelId},n.content.messageUId,n.senderUserId)},t.prototype._processReadReceiptResponseMessage=function(n){var e,r=(e=n.content)===null||e===void 0?void 0:e.receiptMessageDic,i=this._engine.getCurrentUserId();r&&Array.isArray(r[i])&&typeof this._watcher.messageReceiptResponse=="function"&&this._watcher.messageReceiptResponse({conversationType:n.conversationType,targetId:n.targetId,channelId:n.channelId},n.senderUserId,r[i])},t.prototype._messageReceiver=function(n,e,r){var i,o,s,h,l=this;if(!(!((o=(i=this._compatibleMessageProccessor)[n.messageType])===null||o===void 0)&&o.call(i,n))&&!this._pluginContextQueue.some(function(c){if(!c.onmessage)return!1;try{return c.onmessage(Kn(n))}catch(d){return l.logger.error(P.A_MSG_LISTENER_E,d==null?void 0:d.stack),!1}})){if((h=(s=this._watcher).message)===null||h===void 0||h.call(s,Kn(n),e,r),!this._messageProccessor[n.messageType])return n;this._messageProccessor[n.messageType](n)}},t.prototype._batchMessageReceiver=function(n,e,r){var i=this,o=[];n.forEach(function(s){var h=i._messageReceiver(s,e,r);h&&o.push(h)}),o.length&&this._watcher.batchMessage&&(this.logger.debug(P.L_BATCH_MESSAGE_O,o.map(function(s){return s.messageUId}).join(",")),this._watcher.batchMessage(o))},t.prototype._chatroomInfoListener=function(n){var e,r;(r=(e=this._watcher).chatroomState)===null||r===void 0||r.call(e,n)},t.prototype._conversationInfoListener=function(n){var e,r;(r=(e=this._watcher).conversationState)===null||r===void 0||r.call(e,n)},t.prototype._expansionInfoListener=function(n){var e,r;(r=(e=this._watcher).expansion)===null||r===void 0||r.call(e,n)},t.prototype._tagListener=function(){var n,e;(e=(n=this._watcher).tag)===null||e===void 0||e.call(n)},t.prototype._conversationTagListener=function(){var n,e;(e=(n=this._watcher).conversationTagChanged)===null||e===void 0||e.call(n)},t.prototype._typingStatusListener=function(n){var e,r;(r=(e=this._watcher).typingState)===null||r===void 0||r.call(e,n)},t.prototype._pullFinishedListener=function(){var n,e;(e=(n=this._watcher).pullFinished)===null||e===void 0||e.call(n)},t.prototype._MessageBlockedListener=function(n){var e,r;(r=(e=this._watcher).messageBlocked)===null||r===void 0||r.call(e,n)},t.prototype._messageDeliveredListerer=function(n){var e,r;(r=(e=this._watcher).messageDelivered)===null||r===void 0||r.call(e,n)},t.prototype._groupMessageDeliveredStatusListerer=function(n){var e,r;(r=(e=this._watcher).groupMessageDeliveredStatus)===null||r===void 0||r.call(e,n)},t.prototype._callInfoListener=function(n){var e=this;this._pluginContextQueue.forEach(function(r){try{r.onCallInfo&&r.onCallInfo(n)}catch(i){e.logger.warn(P.L_CALLBACK_E,i==null?void 0:i.stack)}})},t.prototype._ultraGroupEnableListener=function(n){var e,r;(r=(e=this._watcher).ultraGroupEnable)===null||r===void 0||r.call(e,n)},t.prototype._operateStatusListener=function(n){var e,r;(r=(e=this._watcher).operateStatus)===null||r===void 0||r.call(e,n)},t.prototype._ultraGroupMessageExpansionUpdatedListener=function(n){var e,r;(r=(e=this._watcher).ultraGroupMessageExpansionUpdated)===null||r===void 0||r.call(e,n)},t.prototype._ultraGroupMessageModifiedListener=function(n){var e,r;(r=(e=this._watcher).ultraGroupMessageModified)===null||r===void 0||r.call(e,n)},t.prototype._ultraGroupMessageRecalledListener=function(n){var e,r;(r=(e=this._watcher).ultraGroupMessageRecalled)===null||r===void 0||r.call(e,n)},t.prototype._ultraGroupChannelChangeTypeListener=function(n){var e,r;(r=(e=this._watcher).ultraGroupChannelChangeType)===null||r===void 0||r.call(e,n)},t.prototype._ultraGroupChannelUserKickedListener=function(n){var e,r;(r=(e=this._watcher).ultraGroupChannelUserKicked)===null||r===void 0||r.call(e,n)},t.prototype._ultraGroupChannelDeleteListener=function(n){var e,r;(r=(e=this._watcher).ultraGroupChannelDelete)===null||r===void 0||r.call(e,n)},t.prototype._userGroupStatusListener=function(n){var e,r;(r=(e=this._watcher).userGroupStatus)===null||r===void 0||r.call(e,n)},t.prototype._rtcDataChange=function(n,e){this._pluginContextQueue.forEach(function(r){var i;(i=r.onrtcdatachange)===null||i===void 0||i.call(r,n,e)})},t.prototype._naviDataChange=function(n){this._pluginContextQueue.forEach(function(e){var r;(r=e.onnavidatachange)===null||r===void 0||r.call(e,n)})},t.prototype.assignWatcher=function(n){var e=this;Object.keys(this._watcher).forEach(function(r){if(Object.prototype.hasOwnProperty.call(n,r)){var i=n[r];e._watcher[r]=tn(i)||It(i)?i:void 0}})},t.prototype._resetWatcher=function(){var n=this;Object.keys(this._watcher).forEach(function(e){n._watcher[e]=void 0})},t.prototype._addTypingInfo=function(n){var e=n.senderUserId,r=n.conversationType,i=n.targetId,o=n.content,s=n.channelId,h=o.typingContentType,l=s||"",c="".concat(r,"#").concat(i,"#").concat(l);this._typingInfo[c]||(this._typingInfo[c]=[]);var d=this._typingInfo[c].findIndex(function(_){return _.userId===e});d>=0&&this._typingInfo[c][d].messageType===h?this._typingInfo[c][d].timestamp=Date.now():(d>=0&&this._typingInfo[c].splice(d,1),this._typingInfo[c].push({userId:e,messageType:h,timestamp:Date.now()}),this._typingChangedList.includes(c)||this._typingChangedList.push(c),this._startCheckTypingInfo())},t.prototype._startCheckTypingInfo=function(){var n=this;this._typingInternalTimer===-1&&Object.keys(this._typingInfo).length!==0&&(this._typingInternalTimer=setInterval(function(){for(var e in n._typingInfo){var r=n._typingInfo[e].length;n._typingInfo[e]=n._typingInfo[e].filter(function(i){return Date.now()-i.timestamp<n._typingExpireTime}),n._typingInfo[e].length===r||n._typingChangedList.includes(e)||n._typingChangedList.push(e),n._typingInfo[e].length===0&&delete n._typingInfo[e]}n._notifyTypingChanged()},500))},t.prototype._notifyTypingChanged=function(){var n=this;if(this._typingChangedList.length>0){var e=this._typingChangedList.map(function(r){return{conversationType:Number(r.split("#")[0]),targetId:r.split("#")[1],channelId:r.split("#")[2],list:n._typingInfo[r]||[]}});this._typingStatusListener(e),this._typingChangedList=[]}Object.keys(this._typingInfo).length===0&&(clearInterval(this._typingInternalTimer),this._typingInternalTimer=-1)},t.prototype.getConnectedTime=function(){return this._engine.getConnectedTime()},t.prototype.getServerTime=function(){return this._engine.getServerTime()},t.prototype.getDeviceId=function(){return this._engine.getDeviceId()},t.prototype.getCurrentUserId=function(){return this._engine.getCurrentUserId()},t.prototype.getConnectionStatus=function(){return this._engine.getConnectionStatus()},Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),t.prototype.refetchNaviInfo=function(){return L(this,void 0,void 0,function(){return M(this,function(n){return[2,this._engine.refetchNaviInfo()]})})},t.prototype.connect=function(n,e,r){var i,o;return L(this,void 0,void 0,function(){var s,h,l,c,d,_;return M(this,function(v){switch(v.label){case 0:return this._token=n,[4,this._runtime.getNetworkType()];case 1:return s=v.sent(),this._engine.setNetwork({status:!0,type:s},!0),h=!!this._pluginInstanseMap.RCCallPlus,[4,this._engine.connect(n,e,h,r)];case 2:return l=v.sent(),c=l.code,d=l.data,c!==R.SUCCESS?[2,{code:c}]:(this._engine.getNaviInfoFromCache().type!==1&&(_=io.getInfo(),(o=(i=this._engine).reportSDKInfo)===null||o===void 0||o.call(i,_)),[2,{code:c,userId:d}])}})})},t.prototype.disconnect=function(n){return L(this,void 0,void 0,function(){var e=this;return M(this,function(r){switch(r.label){case 0:return clearInterval(this._typingInternalTimer),this._typingInternalTimer=-1,this._typingInfo={},[4,this._engine.disconnect(n)];case 1:return r.sent(),this._pluginContextQueue.forEach(function(i){if(i.ondisconnect)try{i.ondisconnect()}catch(o){e.logger.error(P.L_CALLBACK_E,o==null?void 0:o.stack)}}),[2,Promise.resolve()]}})})},t.prototype.reconnect=function(n){return this.connect(this.token,!!n,this.logger.createTraceId())},t.prototype._getTokenWithoutNavi=function(){return this._token.replace(/@.+$/,"@")},t.prototype.getNaviInfoFromCache=function(){return this._engine.getNaviInfoFromCache()},t.prototype.registerMessageType=function(n,e,r,i,o){i===void 0&&(i=[]),o===void 0&&(o=!1),fn(i)&&i.length>0&&(this._registerMessageSearchPropsMapping[n]=i),this._engine.registerMessageType(n,e,r,i,o)},t.prototype.registerRTCSignalingListener=function(n){this._engine.registerRTCSignalingListener(n)},t.prototype.checkSearchPropsMsg=function(n,e){var r=this._registerMessageSearchPropsMapping[n],i={};return r&&It(e)&&Object.keys(e).forEach(function(o){if(r.includes(o)){var s=e[o];Ce(s)&&(s>-Math.pow(2,64)&&s<Math.pow(2,64)&&Number.isInteger(s)||(i[o]=s))}}),Object.keys(i).length>0?{msg:JSON.stringify(i),code:R.SEARCH_PROPS_LIMIT_ERROR}:{code:R.SUCCESS}},t.prototype.sendMessage=function(n,e,r,i,o){var s=this.checkSearchPropsMsg(r.messageType,r.content),h=s.code,l=s.msg;if(h!==R.SUCCESS)return Promise.resolve({code:h,msg:l});if(n===B.SYSTEM&&r.messageType!==nt.SYNC_READ_STATUS)return Promise.resolve({code:R.SYS_CONVERSATION_NOT_SUPPORT_MESSAGE});if(n!==B.ULTRA_GROUP){var c=this.getNaviInfoFromCache();if(((c==null?void 0:c.grpRRVer)||0)===1&&r.messageType===nt.READ_RECEIPT_RESPONSE)return Promise.resolve({code:R.READ_RECEIPT_ERROR})}var d=r.canIncludeExpansion,_=d!==void 0&&d,v=r.expansion;if(_){var I=Ln(v),T=I.isIllgalEx,a=I.isExKeyOrValLengthExceedLimit;if(I.isExceedLimit||a)return Promise.resolve({code:R.EXPANSION_LIMIT_EXCEET});if(T)return Promise.resolve({code:R.BIZ_ERROR_INVALID_PARAMETER})}var u,p,f=JSON.stringify(r.content);return u=f,p===void 0&&(p="utf-8"),(p==="utf-16"?Zo(u):zo(u))>jo?Promise.resolve({code:R.RC_MSG_CONTENT_EXCEED_LIMIT}):n===B.ULTRA_GROUP?this._engine.sendUltraMessage(e,r,i,o):this._engine.sendMessage(n,e,r,i,o)},t.prototype.sendExpansionMessage=function(n){return L(this,void 0,void 0,function(){var e,r,i,o,s,h,l,c,d,_,v;return M(this,function(I){switch(I.label){case 0:return e=n.channelId,r=n.conversationType,i=n.targetId,o=n.messageUId,s=n.keys,h=n.expansion,l=n.removeAll,n.canIncludeExpansion?(c=Ln(h),d=c.isIllgalEx,_=c.isExKeyOrValLengthExceedLimit,c.isExceedLimit||_?[2,Promise.resolve({code:R.EXPANSION_LIMIT_EXCEET})]:d?[2,Promise.resolve({code:R.BIZ_ERROR_INVALID_PARAMETER})]:(v={mid:o},h&&(v.put=h),s&&(v.del=s),l&&(v.removeAll=1),[4,this._engine.sendMessage(r,i,{content:v,messageType:nt.EXPANSION_NOTIFY,channelId:e})])):[2,{code:R.MESSAGE_KV_NOT_SUPPORT}];case 1:return[2,{code:I.sent().code}]}})})},t.prototype.sendReadReceiptMessage=function(n,e,r){return L(this,void 0,void 0,function(){var i;return M(this,function(o){return i=this.getNaviInfoFromCache(),((i==null?void 0:i.grpRRVer)||0)===0?[2,{code:R.READ_RECEIPT_ERROR,msg:"The read receipt switch is not on, please call the sendMessage method!"}]:[2,this._engine.sendReadReceiptMessage(n,e,r)]})})},t.prototype.getMessageReader=function(n,e,r){return L(this,void 0,void 0,function(){var i;return M(this,function(o){return i=this.getNaviInfoFromCache(),((i==null?void 0:i.grpRRVer)||0)===0?[2,{code:R.READ_RECEIPT_ERROR}]:[2,this._engine.getMessageReader(n,e,r)]})})},t.prototype._destroy=function(){return L(this,void 0,void 0,function(){var n=this;return M(this,function(e){switch(e.label){case 0:return this._resetWatcher(),this._engine.destroy(),this._runtime.removeNetworkStatusListener(),[4,this.disconnect()];case 1:return e.sent(),this._pluginContextQueue.forEach(function(r){if(r.ondestroy)try{r.ondestroy()}catch(i){n.logger.error(P.L_CALLBACK_E,i==null?void 0:i.stack)}}),this._pluginContextQueue.length=0,this._pluginInstanseMap={},[2]}})})},t.prototype.getHistoryMessage=function(n,e,r,i,o,s,h,l){if(r===void 0&&(r=0),i===void 0&&(i=20),o===void 0&&(o=0),s===void 0&&(s=""),h===void 0&&(h=""),n===B.ULTRA_GROUP){var c={timestamp:r,count:i,order:o,channelId:s};return this._engine.getUltraHistoryMsg(e,c,l)}return this._engine.getHistoryMessage(n,e,r,i,o,s,h||"",l)},t.prototype.getHistoryMessagesByObjectNames=function(n,e,r,i,o,s,h){return this._engine.getHistoryMessagesByObjectNames(n,e,r,i,o,s,h)},t.prototype.getConversationList=function(n,e,r,i,o){if(n===void 0&&(n=300),o===void 0&&(o=""),e===B.ULTRA_GROUP){var s=R.METHOD_NOT_SUPPORT;return Promise.resolve({code:s,msg:R[s]})}return this._engine.getConversationList(n,e,r,i,o)},t.prototype.getConversationsByPage=function(n,e,r,i,o){return this._engine.getConversationsByPage(n,e,r,i,o)},t.prototype.getConversation=function(n,e,r){return this._engine.getConversation(n,e,r)},t.prototype.removeConversation=function(n,e,r){return r===void 0&&(r=""),n===B.ULTRA_GROUP?Promise.resolve(R.METHOD_NOT_SUPPORT):this._engine.removeConversation(n,e,r)},t.prototype.getUltraGroupList=function(n){return this._engine.getUltraGroupList(n)},t.prototype.getBlockUltraGroupList=function(){return this._engine.getBlockUltraGroupList()},t.prototype.getTopUltraGroupList=function(){return this._engine.getTopUltraGroupList()},t.prototype.clearUnreadCount=function(n,e,r){return r===void 0&&(r=""),n===B.ULTRA_GROUP?this._engine.clearUltraUnreadcount(e,r):this._engine.clearConversationUnreadCount(n,e,r)},t.prototype.clearAllUnreadCount=function(){return this._engine.clearAllUnreadCount()},t.prototype.getUnreadCount=function(n,e,r){return r===void 0&&(r=""),this._engine.getConversationUnreadCount(n,e,r)},t.prototype.getTotalUnreadCount=function(n,e,r){if(e&&e.includes(B.ULTRA_GROUP)){var i=R.METHOD_NOT_SUPPORT;return Promise.resolve({code:i,msg:R[i]})}return this._engine.getAllConversationUnreadCount(n,e&&e.length>0?e:[B.PRIVATE,B.GROUP,B.SYSTEM,B.PUBLIC_SERVICE],!!r)},t.prototype.getTotalUnreadCountByLevels=function(n,e,r){return this._engine.getTotalUnreadCountByLevels(n,e,r)},t.prototype.getFirstUnreadMessage=function(n,e,r){return r===void 0&&(r=""),this._engine.getFirstUnreadMessage(n,e,r)},t.prototype.setConversationNotificationLevel=function(n,e,r,i){return i===void 0&&(i=""),L(this,void 0,void 0,function(){var o;return M(this,function(s){return o=[{conversationType:n,targetId:e,notificationLevel:r,channelId:i}],[2,this._engine.batchSetConversationStatus(o)]})})},t.prototype.setConversationStatus=function(n,e,r,i,o,s){if(o===void 0&&(o=""),s===void 0&&(s=!0),n===B.ULTRA_GROUP&&r!==void 0)return Promise.resolve(R.METHOD_NOT_SUPPORT);var h=[{conversationType:n,targetId:e,isTop:r,notificationStatus:i,channelId:o,isUpdateTime:s}];return this._engine.batchSetConversationStatus(h)},t.prototype.saveConversationMessageDraft=function(n,e,r,i){return i===void 0&&(i=""),this._engine.saveConversationMessageDraft(n,e,r,i)},t.prototype.getConversationMessageDraft=function(n,e,r){return r===void 0&&(r=""),this._engine.getConversationMessageDraft(n,e,r)},t.prototype.clearConversationMessageDraft=function(n,e,r){return r===void 0&&(r=""),this._engine.clearConversationMessageDraft(n,e,r)},t.prototype.recallMessage=function(n,e,r,i,o){return this._engine.recallMsg(n,e,r,i,o)},t.prototype.deleteRemoteMessage=function(n,e,r,i){return i===void 0&&(i=""),n===B.ULTRA_GROUP?Promise.resolve(R.METHOD_NOT_SUPPORT):this._engine.deleteRemoteMessage(n,e,r,i)},t.prototype.deleteRemoteMessageByTimestamp=function(n,e,r,i){return i===void 0&&(i=""),this._engine.deleteRemoteMessageByTimestamp(n,e,r,i)},t.prototype.joinChatroom=function(n,e,r){return e===void 0&&(e=10),this._engine.joinChatroom(n,e,r)},t.prototype.joinExistChatroom=function(n,e,r){return e===void 0&&(e=10),this._engine.joinExistChatroom(n,e,r)},t.prototype.quitChatroom=function(n){return this._engine.quitChatroom(n)},t.prototype.getChatroomInfo=function(n,e,r){return e===void 0&&(e=0),r===void 0&&(r=0),this._engine.getChatroomInfo(n,e,r)},t.prototype.setChatroomEntry=function(n,e){var r=e.key,i=e.value;return Jt(r)&&Un(i)?this._engine.setChatroomEntry(n,e):Promise.resolve(R.BIZ_ERROR_INVALID_PARAMETER)},t.prototype.setChatroomEntries=function(n,e){for(var r=0;r<e.entries.length;r++){var i=e.entries[r],o=i.key,s=i.value;if(!Jt(o)||!Un(s))return Promise.resolve({code:R.BIZ_ERROR_INVALID_PARAMETER})}var h=Z(Z({},e),{isOverwrite:e.isForce});return this._engine.setChatroomEntries(n,h)},t.prototype.forceSetChatroomEntry=function(n,e){var r=e.key,i=e.value;return Jt(r)&&Un(i)?this._engine.forceSetChatroomEntry(n,e):Promise.resolve(R.BIZ_ERROR_INVALID_PARAMETER)},t.prototype.removeChatroomEntry=function(n,e){var r=e.key;return Jt(r)?this._engine.removeChatroomEntry(n,e):Promise.resolve(R.BIZ_ERROR_INVALID_PARAMETER)},t.prototype.removeChatroomEntries=function(n,e){for(var r=0;r<e.entries.length;r++){var i=e.entries[r].key;if(!Jt(i))return Promise.resolve({code:R.BIZ_ERROR_INVALID_PARAMETER})}return this._engine.removeChatroomEntries(n,e)},t.prototype.forceRemoveChatroomEntry=function(n,e){var r=e.key;return Jt(r)?this._engine.forceRemoveChatroomEntry(n,e):Promise.resolve(R.BIZ_ERROR_INVALID_PARAMETER)},t.prototype.getChatroomEntry=function(n,e){return this._engine.getChatroomEntry(n,e)},t.prototype.getAllChatroomEntries=function(n){return this._engine.getAllChatroomEntry(n)},t.prototype.getChatroomHistoryMessages=function(n,e,r,i){return e===void 0&&(e=20),r===void 0&&(r=0),i===void 0&&(i=0),this._engine.getChatroomHistoryMessages(n,i,e,r)},t.prototype.getFileToken=function(n,e,r,i,o){return L(this,void 0,void 0,function(){var s,h,l,c,d,_,v;return M(this,function(I){switch(I.label){case 0:return s=this.getNaviInfoFromCache(),h=(s==null?void 0:s.bosAddr)||"",l=(s==null?void 0:s.uploadServer)||"",c=(s==null?void 0:s.ossConfig)||"",[4,this._engine.getFileToken(n,e,r,i,o)];case 1:return d=I.sent(),_=d.code,v=d.data,_===R.SUCCESS&&v?[2,Promise.resolve(Object.assign(v,{bos:h,qiniu:l,ossConfig:c}))]:[2,Promise.reject(_)]}})})},t.prototype.getFileUrl=function(n,e,r,i,o){return o===void 0&&(o=te.QINIU),L(this,void 0,void 0,function(){var s,h,l;return M(this,function(c){switch(c.label){case 0:return i!=null&&i.isBosRes?[2,Promise.resolve(i)]:[4,this._engine.getFileUrl(n,o,e,r)];case 1:return s=c.sent(),h=s.code,l=s.data,h===R.SUCCESS?[2,Promise.resolve(l)]:[2,Promise.reject(h)]}})})},t.prototype.createTag=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.createTag(n)]})})},t.prototype.removeTag=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.removeTag(n)]})})},t.prototype.updateTag=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.updateTag(n)]})})},t.prototype.getTagList=function(){return L(this,void 0,void 0,function(){return M(this,function(n){return[2,this._engine.getTagList()]})})},t.prototype.addTagForConversations=function(n,e){return L(this,void 0,void 0,function(){return M(this,function(r){return e.length>1e3?[2,Promise.reject(R.CONVER_OUT_LIMIT_ERROR)]:[2,this._engine.addTagForConversations(n,e)]})})},t.prototype.removeTagForConversations=function(n,e){return L(this,void 0,void 0,function(){return M(this,function(r){return[2,this._engine.removeTagForConversations(n,e)]})})},t.prototype.removeTagsForConversation=function(n,e){return L(this,void 0,void 0,function(){return M(this,function(r){return[2,this._engine.removeTagsForConversation(n,e)]})})},t.prototype.getConversationListByTag=function(n,e,r,i){return L(this,void 0,void 0,function(){return M(this,function(o){return[2,this._engine.getConversationListByTag(n,e,r,i)]})})},t.prototype.getUnreadCountByTag=function(n,e){return L(this,void 0,void 0,function(){return M(this,function(r){return[2,this._engine.getUnreadCountByTag(n,e)]})})},t.prototype.setConversationStatusInTag=function(n,e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return[2,this._engine.setConversationStatusInTag(n,e,r)]})})},t.prototype.getTagsForConversation=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.getTagsForConversation(n)]})})},t.prototype.getBlockConversationList=function(){return this._engine.getBlockConversationList()},t.prototype.getTopConversationList=function(n,e){return n&&n.length!==0||(n=[B.PRIVATE,B.CHATROOM,B.GROUP,B.SYSTEM,B.APP_PUBLIC_SERVICE,B.PUBLIC_SERVICE]),this._engine.getTopConversationList(n,e)},t.prototype.getUnreadConversationList=function(n){return n&&n.length!==0||(n=[B.PRIVATE,B.CHATROOM,B.GROUP,B.SYSTEM,B.APP_PUBLIC_SERVICE,B.PUBLIC_SERVICE]),this._engine.getUnreadConversationList(n)},t.prototype.getUnreadMentionedCount=function(n){return this._engine.getUnreadMentionedCount(n)},t.prototype.getAllUnreadMentionedCount=function(){return this._engine.getAllUnreadMentionedCount()},t.prototype.sendUltraGroupTypingStatus=function(n){if(n.conversationType!==B.ULTRA_GROUP){var e=R.METHOD_ONLY_SUPPORT_ULTRA_GROUP;return Promise.resolve({code:e,msg:R[e]})}return this._engine.sendUltraGroupTypingStatus(n)},t.prototype.getUltraGroupMessageListByMessageUId=function(n){return this._engine.getUltraGroupMessageListByMessageUId(n)},t.prototype.expandUltraMessage=function(n){return L(this,void 0,void 0,function(){var e,r,i,o,s,h,l;return M(this,function(c){switch(c.label){case 0:return e=n.conversationType,r=n.expansion,i=n.canIncludeExpansion,e!==B.ULTRA_GROUP?[2,{code:o=R.METHOD_ONLY_SUPPORT_ULTRA_GROUP,msg:R[o]}]:i?(s=Ln(r),h=s.isIllgalEx,l=s.isExKeyOrValLengthExceedLimit,s.isExceedLimit||l?[2,{code:R.EXPANSION_LIMIT_EXCEET}]:h?[2,{code:R.BIZ_ERROR_INVALID_PARAMETER}]:[4,this._engine.expandUltraMessage(n)]):[2,{code:R.MESSAGE_KV_NOT_SUPPORT}];case 1:return[2,{code:c.sent().code}]}})})},t.prototype.modifyMessage=function(n){return L(this,void 0,void 0,function(){var e;return M(this,function(r){switch(r.label){case 0:return n.conversationType!==B.ULTRA_GROUP?[2,{code:e=R.METHOD_ONLY_SUPPORT_ULTRA_GROUP,msg:R[e]}]:[4,this._engine.modifyMessage(n)];case 1:return[2,{code:r.sent().code}]}})})},t.prototype.getUltraGroupUnreadMentionedCountByTargetId=function(n,e){return this._engine.getUltraGroupUnreadMentionedCountByTargetId(n,e)},t.prototype.getUltraGroupUnreadCountByTargetId=function(n,e){return this._engine.getUltraGroupUnreadCountByTargetId(n,e)},t.prototype.getAllUltraGroupUnreadCount=function(n){return n===void 0&&(n=!1),this._engine.getAllUltraGroupUnreadCount(n)},t.prototype.getAllConversationState=function(){return this._engine.getAllConversationState()},t.prototype.getUltraGroupUnreadMentionedMessages=function(n){return this._engine.getUltraGroupUnreadMentionedMessages(n)},t.prototype.getUltraGroupFirstUnreadMessageTimestamp=function(n){return this._engine.getUltraGroupFirstUnreadMessageTimestamp(n)},t.prototype.getUltraGroupUnreadInfoList=function(n){return this._engine.getUltraGroupUnreadInfoList(n)},t.prototype.callExtra=function(n){for(var e,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return(e=this._engine).callExtra.apply(e,vt([n],r,!1))},t.prototype.getOSInfo=function(){return this._engine.getOSInfo()},t.prototype.getProcessInfo=function(){return this._engine.getProcessInfo()},t.prototype.getMainProcessInfo=function(){return this._engine.getMainProcessInfo()},t.prototype.setCallInfo=function(n,e,r){return this._engine.setCallInfo(n,e,r)},t.prototype.getGroupMessageDeliverList=function(n,e,r){return r===void 0&&(r=""),this._engine.getGroupMessageDeliverList(n,e,r)},t.prototype.getPrivateMessageDeliverTime=function(n,e){return e===void 0&&(e=""),this._engine.getPrivateMessageDeliverTime(n,e)},t.prototype.clearConversations=function(n,e){return L(this,void 0,void 0,function(){return M(this,function(r){return[2,this._engine.clearConversations(n,e)]})})},t.prototype.setUserStatusListener=function(n,e){var r=this;return this._engine.setUserStatusListener(n,function(i){try{e(i)}catch(o){r.logger.error(P.L_CALLBACK_E,o==null?void 0:o.stack)}})},t.prototype.addToBlacklist=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.addToBlacklist(n)]})})},t.prototype.removeFromBlacklist=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.removeFromBlacklist(n)]})})},t.prototype.getBlacklist=function(){return L(this,void 0,void 0,function(){return M(this,function(n){return[2,this._engine.getBlacklist()]})})},t.prototype.getBlacklistStatus=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.getBlacklistStatus(n)]})})},t.prototype.insertMessage=function(n,e,r){return L(this,void 0,void 0,function(){var i,o,s;return M(this,function(h){return i=this.checkSearchPropsMsg(r.messageType,r.content),o=i.code,s=i.msg,o!==R.SUCCESS?[2,Promise.resolve({code:o,msg:s})]:[2,this._engine.insertMessage(n,e,r)]})})},t.prototype.batchInsertMessage=function(n,e){return this._engine.batchInsertMessage(n,e)},t.prototype.getMessageCount=function(n,e,r){return r===void 0&&(r=""),L(this,void 0,void 0,function(){return M(this,function(i){return[2,this._engine.getMessageCount(n,e,r)]})})},t.prototype.deleteMessages=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.deleteMessages(n)]})})},t.prototype.deleteMessagesByTimestamp=function(n,e,r,i,o){return o===void 0&&(o=""),L(this,void 0,void 0,function(){return M(this,function(s){return[2,this._engine.deleteMessagesByTimestamp(n,e,r,i,o)]})})},t.prototype.clearMessages=function(n,e,r){return r===void 0&&(r=""),L(this,void 0,void 0,function(){return M(this,function(i){return[2,this._engine.clearMessages(n,e,r)]})})},t.prototype.getMessage=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.getMessage(n)]})})},t.prototype.setMessageContent=function(n,e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return[2,this._engine.setMessageContent(n,e,r)]})})},t.prototype.setMessageSearchField=function(n,e,r){return L(this,void 0,void 0,function(){return M(this,function(i){return[2,this._engine.setMessageSearchField(n,e,r)]})})},t.prototype.setMessageSentStatus=function(n,e){return L(this,void 0,void 0,function(){return M(this,function(r){return[2,this._engine.setMessageSentStatus(n,e)]})})},t.prototype.setMessageReceivedStatus=function(n,e){return L(this,void 0,void 0,function(){return M(this,function(r){return[2,this._engine.setMessageReceivedStatus(n,e)]})})},t.prototype.setMessageStatusToRead=function(n,e,r,i){return L(this,void 0,void 0,function(){return M(this,function(o){return[2,this._engine.updateMessageReceiptStatus(n,e,r,i)]})})},t.prototype.setUserStatus=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.setUserStatus(n)]})})},t.prototype.subscribeUserStatus=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.subscribeUserStatus(n)]})})},t.prototype.getUserStatus=function(n){return L(this,void 0,void 0,function(){return M(this,function(e){return[2,this._engine.getUserStatus(n)]})})},t.prototype.searchConversationByContent=function(n,e,r,i){return e===void 0&&(e=[]),r===void 0&&(r=""),L(this,void 0,void 0,function(){return M(this,function(o){return[2,this._engine.searchConversationByContent(n,e,r,i)]})})},t.prototype.searchConversationByContentWithAllChannel=function(n,e,r){return e===void 0&&(e=[]),L(this,void 0,void 0,function(){return M(this,function(i){return[2,this._engine.searchConversationByContentWithAllChannel(n,e,r)]})})},t.prototype.searchMessageByContent=function(n,e,r,i,o,s,h){return h===void 0&&(h=""),L(this,void 0,void 0,function(){return M(this,function(l){return[2,this._engine.searchMessageByContent(n,e,r,i,o,s,h)]})})},t.prototype.searchMessagesByUser=function(n,e,r,i,o,s){return o===void 0&&(o=5),s===void 0&&(s=""),L(this,void 0,void 0,function(){return M(this,function(h){return[2,this._engine.searchMessagesByUser(n,e,r,i,o,s)]})})},t.prototype.searchMessageByContentWithAllChannel=function(n,e,r,i,o){return L(this,void 0,void 0,function(){return M(this,function(s){return[2,this._engine.searchMessageByContentWithAllChannel(n,e,r,i,o)]})})},t.prototype.searchMessageByContentInTimeRangeWithAllChannel=function(n,e,r,i,o,s,h){return L(this,void 0,void 0,function(){return M(this,function(l){return[2,this._engine.searchMessageByContentInTimeRangeWithAllChannel(n,e,r,i,o,s,h)]})})},t.prototype.getUnreadMentionedMessages=function(n,e,r){return r===void 0&&(r=""),this._engine.getUnreadMentionedMessages(n,e,r)},t.prototype.clearUnreadCountByTimestamp=function(n,e,r,i){return i===void 0&&(i=""),this._engine.clearUnreadCountByTimestamp(n,e,r,i)},t.prototype.getUltraGroupDefaultNotificationLevel=function(n,e){return e===void 0&&(e=""),this._engine.getUltraGroupDefaultNotificationLevel(n,e)},t.prototype.setUltraGroupDefaultNotificationLevel=function(n,e,r){return r===void 0&&(r=""),this._engine.setUltraGroupDefaultNotificationLevel(n,e,r)},t.prototype.getConversationNotificationLevel=function(n,e,r){return r===void 0&&(r=""),this._engine.getConversationNotificationLevel(n,e,r)},t.prototype.getConversationNotificationStatus=function(n,e,r){return r===void 0&&(r=""),this._engine.getConversationNotificationStatus(n,e,r)},t.prototype.getRemoteHistoryMessages=function(n,e,r,i,o,s){return this._engine.getRemoteHistoryMessages(n,e,r,i,o,s)},t.prototype.getConversationListWithAllChannel=function(){return this._engine.getConversationListWithAllChannel()},t.prototype.getConversationListWithAllChannelByPage=function(n,e){return this._engine.getConversationListWithAllChannelByPage(n,e)},t.prototype.clearData=function(){return L(this,void 0,void 0,function(){return M(this,function(n){return[2,this._engine.clearData()]})})},t.prototype.createLogger=function(n,e){return this._engine.createLogger(n,e)},t.prototype.setCheckDuplicateMessage=function(n){return this._engine.setCheckDuplicateMessage(n)},t.prototype.rtcSignaling=function(n,e,r,i){return this._engine.rtcSignaling(n,e,r,i)},t.prototype.rtcPing=function(n,e,r){return this._engine.rtcPing(n,e,r)},t.prototype.bindRTCRoomForChatroom=function(n){return this._engine.bindRTCRoomForChatroom(n)},t.prototype.setProxy=function(n){return this._engine.setProxy(n)},t.prototype.getProxy=function(){return this._engine.getProxy()},t.prototype.testProxy=function(n,e){return this._engine.testProxy(n,e)},t}();export{Ce as $,St as C,cs as D,sr as G,$o as H,ir as K,Tr as L,Tu as M,Iu as N,vu as O,Cu as P,R as W,B as X,Ru as Z,ro as _,it as a,te as b,en as c,Su as d,fn as e,ts as f,It as g,P as h,yu as i,Ot as j,ar as k,Lt as l,mt as m,Yn as n,mu as o,Wt as q,Yo as r,ot as s,re as u,io as v,ce as y,Ou as z};
